cscope 15 $HOME/grocery-shop/language/python -q 0000002911 0000328089
	@/root/grocery-shop/language/python/baseSyntax/classGlobalVarTest.py

4 
şass
 
	gsk_queue
:

5 
queue
=[]

6 
num
 = 0

8 
def
 
	$­³nd
(
£lf
,
obj
):

9 
£lf
.
queue
.
	$­³nd
(
obj
)

10 
£lf
.
num
 += 1

12 
def
 
	$´št_queue
(
£lf
):

13 
´št
 
£lf
.
queue
, s–f.
num


15 
__Çme__
=="__main__":

16 
a
=
	$sk_queue
()

17 
b
=
	$sk_queue
()

19 
a
.
	`­³nd
('tc_1')

20 
a
.
num
 += 1

22 
a
.
	$´št_queue
()

23 
b
.
	$´št_queue
()

25 
sk_queue
.
num
 = 1000

26 
a
.
	$´št_queue
()

27 
b
.
	`´št_queue
()

	@/root/grocery-shop/language/python/baseSyntax/closureTest.py

1 #codšg:
utf
-
job


3 
	gşosu»
é—­åŒ…æµ‹è¯•

6 #deà
makeInc
(
x
):

8 #´šˆ"ID(x):{0}, ID(z):{1}".
fÜm©
(
id
(
x
), id(
z
))

9 #deà
šc
(
y
):

10 ## åœ¨å‡½æ•°
šc
ä¸­ï¼Œ
x
æ˜¯é—­åˆçš„ï¼Œå¹¶å…³è”

11 #»tuº 
x
+
y
, "Closu»(z):id(z)-", 
id
(
z
)

12 ## è¿”å›åŠ¨æ€çš„
šc
å‡½æ•°

13 #»tuº 
šc


15 #šc5 = 
makeInc
(5)

17 #šc10 = 
makeInc
(10)

18 #
## æ‰“å°
__şosu»__
ä¸­çš„å€¼ï¼Œé¢„æµ‹å€¼ä¸ºï¼š

19 ## 
z
çš„
id
æ˜¯ä¸€æ ·çš„ï¼Œéƒ½å¼•ç”¨äº†åŒä¸€å—å†…å­˜å€¼?ï¼ˆä½œç”¨åŸŸå˜ä¸º
glob®
ï¼Œå¯ä»¥é€šè¿‡
co_glob®s
æŸ¥çœ‹ï¼‰

23 #´šˆ"V®ue:", 
šc5
.
__şosu»__
[0].
ûÎ_cÚ‹Ás
, " ", inc5.__closure__[1].cell_contents

24 #´šˆ"Id:", 
id
(
šc5
.
__şosu»__
[0].
ûÎ_cÚ‹Ás
)," ", id(inc5.__closure__[1].cell_contents)

26 #´šˆ"V®ue:", 
šc10
.
__şosu»__
[0].
ûÎ_cÚ‹Ás
," ", inc10.__closure__[1].cell_contents

27 #´šˆ"Id:", 
id
(
šc10
.
__şosu»__
[0].
ûÎ_cÚ‹Ás
)," ", id(inc10.__closure__[1].cell_contents)

29 
def
 
	$makeInc
(
x
):

30 
z
 = 3

31 
´št
 "ID(x):{0}, ID(z):{1}".
	`fÜm©
(
	`id
(
x
), 
	$id
(
z
))

32 
def
 
	$šc
(
y
):

33 #åœ¨å‡½æ•°
šc
ä¸­ï¼Œ
x
æ˜¯é—­åˆçš„ï¼Œå¹¶å…³è”

34  
x
+
y
, "Closu»(z):id(z)-", 
	$id
(
z
)

35 #è¿”å›åŠ¨æ€çš„
šc
å‡½æ•°

36  
šc


39 
šc5
 = 
	$makeInc
(5)

41 
šc10
 = 
	$makeInc
(10)

43 #æ‰“å°
__şosu»__
ä¸­çš„å€¼ï¼Œé¢„æµ‹å€¼ä¸ºï¼š

44 #zçš„
id
æ˜¯ä¸€æ ·çš„ï¼Œéƒ½å¼•ç”¨äº†åŒä¸€å—å†…å­˜å€¼ï¼ˆä½œç”¨åŸŸå˜ä¸º
glob®
ï¼Œå¯ä»¥é€šè¿‡
co_glob®s
æŸ¥çœ‹ï¼‰

45 #
 "Inc5:"

46 
´št
 "V®ue:", 
šc5
.
__şosu»__
[0].
ûÎ_cÚ‹Ás
, " ", inc5.__closure__[1].cell_contents

47 
´št
 "Id:", 
	`id
(
šc5
.
__şosu»__
[0].
ûÎ_cÚ‹Ás
)," ", 
	$id
(
šc5
.
__şosu»__
[1].
ûÎ_cÚ‹Ás
)

48 
´št
 "Inc10:"

49 
´št
 "V®ue:", 
šc10
.
__şosu»__
[0].
ûÎ_cÚ‹Ás
," ", inc10.__closure__[1].cell_contents

50 
´št
 "Id:", 
	`id
(
šc10
.
__şosu»__
[0].
ûÎ_cÚ‹Ás
)," ", id(inc10.__closure__[1].cell_contents)

	@/root/grocery-shop/language/python/baseSyntax/distTest.py

1 #codšg:
utf
-
job


3 
äom
 
cŞËùiÚs
 
impÜt
 
ChašM­


5 
def
 
	$chašDi¡Te¡
():

7 
di¡1
 = {

11 
	}
}

12 
di¡2
 = {

14 '¡upid':
job
,

17 
ÃwDi¡
 = 
	$ChašM­
(
di¡1
, 
di¡2
)

18 
´št
 
ÃwDi¡


19 
di¡1
['shit'] = 'I changed'

20 
´št
 
ÃwDi¡


22 
__Çme__
 == '__main__':

24 
	`chašDi¡Te¡
()

	@/root/grocery-shop/language/python/baseSyntax/generatorTest.py

1 #codšg:
utf
-
job


2 #!/
u¤
/
bš
/
pythÚ


4 
impÜt
 
¿ndom


6 
def
 
	$g‘_d©a
():

7  
¿ndom
.
	`§m¶e
(
	`¿nge
(10), 3)

9 
def
 
	$cÚsume
():

10 
ruÂšg_sum
 = 0

11 
d©a_™ems_£’
 = 0

13 
i
 
š
 
	$¿nge
(6):

14 
d©a
 = 
y›ld


15 
d©a_™ems_£’
 +ğ
	$Ën
(
d©a
)

16 
ruÂšg_sum
 +ğ
	$sum
(
d©a
)

17 
´št
 'ThruÂšg‡v”agi {0}'.
	`fÜm©
(\

18 
ruÂšg_sum
 / (
d©a_™ems_£’
))

21 
def
 
	$´oduû
(
cÚsum”
):

27 4ï¼Œå¦‚æœæ˜¯
IO
å¯†é›†å‹ï¼Œè¯·åˆ«ç”¨è¯¥ç”¨æ³•

30 
d©a
 = 
	$g‘_d©a
()

31 
´št
 'Produûd {0}'.
	$fÜm©
(
d©a
)

32 #g’”©Üçš„å†…ç½®æ–¹æ³•ï¼Œå°†ä¸€ä¸ªå€¼å‘é€ç»™
cÚsum”
ç”Ÿæˆå™¨

33 
cÚsum”
.
	$£nd
(
d©a
)

34 
y›ld


37 
__Çme__
 == '__main__':

38 
cÚsum”
 = 
	$cÚsume
()

39 
cÚsum”
.
	$£nd
(
NÚe
)

40 
´oduûr
 = 
	$´oduû
(
cÚsum”
)

42 
_
 
š
 
	$¿nge
(10):

43 
´št
 'xxxxxxxxxxx'

44 #ä½¿ç”¨
Ãxt
æ¥è·å–ä¸‹ä¸€ä¸ªå€¼ï¼ˆå†…ç½®å‡½æ•°ï¼‰

45 
Œy
:

46 
	$Ãxt
(
´oduûr
)

47 
exû±
 
StİI‹¿tiÚ
,
msg
:

	@/root/grocery-shop/language/python/baseSyntax/iterTest.py

1 #codšg:
utf
-
job


2 
impÜt
 
time


3 
impÜt
 
psut


5 
def
 
	$sim¶eTe¡
():

6 
¡¬tTime
 = 
time
.
	$time
()

7 
i
 
š
 
	$x¿nge
(100000000):

8 
mem
 = 
psut
.
	$vœtu®_memÜy
()

9 
´št
 'TÙ®:', 
mem
.
tÙ®
/1024/1024, 'U£d:', mem.
u£d
/1024/1024

11 
’dTime
 = 
time
.
	$time
()

12 
´št
 'è¿­ä»£å™¨æ¶ˆè€—æ—¶é—´:', 
’dTime
-
¡¬tTime


14 
¡¬tTime
 = 
time
.
	$time
()

15 
i
 
š
 
	$¿nge
(100000000):

16 
mem
 = 
psut
.
	$vœtu®_memÜy
()

17 
´št
 'TÙ®:', 
mem
.
tÙ®
/1024/1024, 'U£d:', mem.
u£d
/1024/1024

19 
’dTime
 = 
time
.
	$time
()

20 
´št
 'æ¶ˆè€—æ—¶é—´:', 
’dTime
-
¡¬tTime


22 
şass
 
	$BambooI‹r
(
objeù
):

24 
def
 
	$__š™__
(
£lf
, 
max
):

25 
	`su³r
(
BambooI‹r
, 
£lf
).
	$__š™__
()

26 
£lf
.
max
 = max

28 
def
 
	$__™”__
(
£lf
):

31 1ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰
__Ãxt__
æ–¹æ³•ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ª
	`__Ãxt__
(
£lf
)çš„å¯¹è±¡

32 2ï¼Œå¦‚æœå­˜åœ¨
__Ãxt__
æ–¹æ³•ï¼Œè¿”å›
£lf
å³å¯

34 è¯¥æ–¹æ³•åœ¨éå†æ—¶ï¼Œè¢«å†…ç½®çš„
	`™”
()è°ƒç”¨ï¼Œè¿”å›å¯¹è±¡è¿­ä»£å™¨ï¼Œä¹‹å

35 é€šè¿‡è¯¥è¿­ä»£å™¨è°ƒç”¨
	`__Ãxt__
(3.0)æ–¹æ³•éå†, å¦å¤–åœ¨
pythÚ2X
ç¯å¢ƒåº”è¯¥

36 å®ç°
	`Ãxt
()æ–¹æ³•

39 
__™”__
 ä»…ä»…è°ƒç”¨ä¸€æ¬¡

40 
__Ãxt__
 è°ƒç”¨
n
æ¬¡

42 
£lf
.
a
 = 0

43 
£lf
.
b
 = 1

44 
£lf
.
n
 = 0

45  
£lf


47 
def
 
	$Ãxt
(
£lf
):

48 
£lf
.
n
 > s–f.
max
:

49 
¿i£
 
StİI‹¿tiÚ


50 
fib
 = 
£lf
.
a


51 
£lf
.
a
, s–f.
b
 = self.b, self.a + self.b

52 
£lf
.
n
 += 1

53  
fib


55 
def
 
	$»ad_fe
(
å©h
):

56 
BLOCK_SIZE
 = 1024

57 
w™h
 
	`İ’
(
å©h
, 'rb'è
as
 
f
:

58 
True
:

59 
block
 = 
f
.
	$»ad
(
BLOCK_SIZE
)

60 
block
:

61 
y›ld
 
block


65 
def
 
	$bambooI‹rFunc
(
max
):

66 
n
, 
a
, 
b
 = 0, 0, 1

67 
n
 < 
max
:

68 
y›ld
 
b


69 
´št
 'yield ä¹‹åçš„ä»£ç '

70 
a
, 
b
 = b,‡+b

71 
n
 += 1

73 
def
 
	$»adFeByI‹r
(
f’ame
):

77 
w™h
 
	`İ’
(
f’ame
, 'r'è
as
 
f
:

78 
lše
 
š
 
f
:

79 
´št
 
lše


81 
impÜt
 
™”toŞs


82 
def
 
	$™”toŞsTe¡
():

84 
def
 
	$f‹rFunc
(
x
):

86  
x
>2

87 
de¡Li¡
 = [3, 5, 2, 3, 2, 10, 3, 
job
, 4]

88 
´št
 'Dropwhileæµ‹è¯•ï¼š'

89 
i
 
š
 
™”toŞs
.
	$drİwhe
(
f‹rFunc
, 
de¡Li¡
):

90 
´št
 
i


91 
´št
 'Takewhileæµ‹è¯•ï¼š'

92 
i
 
š
 
™”toŞs
.
	$kewhe
(
f‹rFunc
, 
de¡Li¡
):

93 
´št
 
i


94 
´št
 'ifilteræµ‹è¯•ï¼š'

95 
i
 
š
 
™”toŞs
.
	$if‹r
(
f‹rFunc
, 
de¡Li¡
):

96 
´št
 
i


97 
´št
 'ifilterfalseæµ‹è¯•ï¼š'

98 
i
 
š
 
™”toŞs
.
	$if‹rçl£
(
f‹rFunc
, 
de¡Li¡
):

99 
´št
 
i


102 
def
 
	$™”toŞGroupby
():

104 
de¡I‹r
 = [(1,2), (1,2),

107 
´št
 'GroupByæµ‹è¯•:'

108 
k
,
v
 
š
 
™”toŞs
.
	$groupby
(
de¡I‹r
):

109 
´št
 
k
, '--', 
	$tu¶e
(
v
)

110 
´št


112 
__Çme__
 == '__main__':

114 #b™” = 
	`BambooI‹r
(3)

115 #fÜ 
i
 
š
 
b™”
:

116 #´šˆ
i


118 
´št
 'ç”Ÿæˆå™¨è¾“å‡º'

119 
j
 
š
 
	$bambooI‹rFunc
(10):

120 
´št
 "å½“å‰å€¼ï¼š", 
j


122 
	$™”toŞsTe¡
()

123 
	`™”toŞGroupby
()

	@/root/grocery-shop/language/python/baseSyntax/listTest.py

1 #!/
u¤
/
bš
/
evn
 
pythÚ


2 #codšg:
utf
-
job


4 
	gfunùiÚ
:
D‘”mše
 
wh‘h”
 
the
 
li¡
 
ÿn
 
¡Üe
 
objeù
.

6 
impÜt
 
th»ad


7 
impÜt
 
time


9 
şass
 
A
:

11 
def
 
	$__š™__
(
£lf
,
desc
):

13 
£lf
.
desc
 = desc

15 
def
 
	$di¥Ïy
(
£lf
):

17 
´št
 
£lf
.
desc


19 
şass
 
B
:

21 
def
 
	$__š™__
(
£lf
):

23 
£lf
.
objLi¡
 = {
	}
}

24 
£lf
.
lock
 = 
th»ad
.
	$®loÿ‹_lock
()

26 
def
 
	$ü—‹
(
£lf
, 
objLi¡
, 
desc
):

28 
£lf
.
lock
.
	$acquœe
()

29 
´št
 
desc
 + 'xx'

30 
a
 = 
	$A
(
desc
)

31 
objLi¡
.
	$­³nd
(
a
)

32 
£lf
.
lock
.
	$»Ëa£
()

34 
def
 
	$muÉËDi¥Ïy
(
£lf
, 
li¡Desc
):

36 
–m
 
š
 
li¡Desc
:

37 
´št
 
–m
 + 'wawa'

38 
th»ad
.
	`¡¬t_Ãw_th»ad
(
£lf
.
ü—‹
, (£lf.
objLi¡
, 
–m
))

39 
time
.
	$¦“p
(2)

40 
–e
 
š
 
£lf
.
objLi¡
:

41 
–e
.
	$di¥Ïy
()

43 
__Çme__
 == '__main__':

45 
b
 = 
	$B
()

46 
b
.
	`muÉËDi¥Ïy
(['aa', 'bb', 'cc', 'dd', 'ff', 'ee'])

	@/root/grocery-shop/language/python/baseSyntax/module/moduleMain.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 
impÜt
 
moduËTe¡


6 
	g´št
 'XXXXXXXXXXXXXXXXXXXXXXXXX'

	@/root/grocery-shop/language/python/baseSyntax/module/moduleTest.py

1 #codšg:
utf
-
job


3 å°è¯•ä»¥
	gpythÚ
 -
m
 
	gmoduË
æ¥æ‰§è¡ŒpythÚæ¨¡å—ï¼Œå¹¶éä»¥è„šæœ¬å½¢å¼æ‰§è¡Œï¼›

4 
S—rches
 
	gsys
.
·th
 
the
 
Çmed
 
moduË
 
ªd
 
runs
h
	gcÜ»¥Údšg
 .
py
 
fe
 
as
 
a
 
	gsüt


7 
	g__Çme__
 == '__main__':

8 
´št
 'å½“å‰__name__ä¸º__main__è„šæœ¬å½¢å¼'

10 
´št
 'æ¨¡å—å¯¼å…¥æ¨¡å¼'

	@/root/grocery-shop/language/python/baseSyntax/module/objectReference.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 å°è¯•ä»¥
	gpythÚ
 -
m
 
	gmoduË
æ¥æ‰§è¡ŒpythÚæ¨¡å—ï¼Œå¹¶éä»¥è„šæœ¬å½¢å¼æ‰§è¡Œï¼Œä¹‹ååˆ†åˆ«æ‰“å°è¾“å‡º

7 
	g__Çme__
 == '__main__':

8 
´št
 'ä»¥python module.pyå½¢å¼æ‰§è¡Œç¨‹åº'

10 
´št
 'ä»¥python -m moduleå½¢å¼æ‰§è¡Œç¨‹åº'

	@/root/grocery-shop/language/python/baseSyntax/moduleTest.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 å°è¯•ä»¥
	gpythÚ
 -
m
 
	gmoduË
æ¥æ‰§è¡ŒpythÚæ¨¡å—ï¼Œå¹¶éä»¥è„šæœ¬å½¢å¼æ‰§è¡Œï¼Œä¹‹ååˆ†åˆ«æ‰“å°è¾“å‡º

7 
	g__Çme__
 =ğ'__maš__' 
ªd
 
__·ckage__
 
is
 
NÚe
:

8 
´št
 'ä»¥python module.pyå½¢å¼æ‰§è¡Œç¨‹åº'

9 
´št
 '__Çme__:', 
__Çme__


10 
	g´št
 '__·ckage__:', 
__·ckage__


12 
´št
 'ä»¥python -m moduleå½¢å¼æ‰§è¡Œç¨‹åº'

13 
´št
 '__Çme__:', 
__Çme__


14 
	g´št
 '__·ckage__:', 
	g__·ckage__


	@/root/grocery-shop/language/python/baseSyntax/objectReference.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 å°è¯•ä»¥
	gpythÚ
 -
m
 
	gmoduË
æ¥æ‰§è¡ŒpythÚæ¨¡å—ï¼Œå¹¶éä»¥è„šæœ¬å½¢å¼æ‰§è¡Œï¼Œä¹‹ååˆ†åˆ«æ‰“å°è¾“å‡º

7 
	g__Çme__
 == '__main__':

8 
´št
 'ä»¥python module.pyå½¢å¼æ‰§è¡Œç¨‹åº'

10 
´št
 'ä»¥python -m moduleå½¢å¼æ‰§è¡Œç¨‹åº'

	@/root/grocery-shop/language/python/baseSyntax/oop.py

1 
şass
 
	$A
(
objeù
):

2 
def
 
	$__š™__
(
£lf
, 
æag
):

3 
£lf
.
qu™FÏg
 = 
æag


5 
def
 
	$£t_æag
(
£lf
):

6 
´št
 '1:', 
	$id
(
£lf
.
qu™FÏg
)

7 
£lf
.
qu™FÏg
 = "quit"

8 
´št
 '2:', 
	$id
(
£lf
.
qu™FÏg
)

10 
æag1
 = "exit"

11 
´št
 '0:', 
	$id
(
æag1
)

12 
aObj
 = 
	$A
(
æag1
)

13 
aObj
.
	$£t_æag
()

14 
´št
 '4:', 
	`id
(
æag1
)

	@/root/grocery-shop/language/python/baseSyntax/package/__init__.py

	@/root/grocery-shop/language/python/baseSyntax/package/main.py

1 
äom
 
sub_·ckage
 
impÜt
 
¡ršg


2 
	g´št
 '******************main****************'

3 
´št
 
	$dœ
(
¡ršg
)

4 
´št
 "SŒšg.fe:", 
¡ršg
.
__fe__


	@/root/grocery-shop/language/python/baseSyntax/package/main2.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 å°è¯•ä»¥
	gpythÚ
 -
m
 
	gmoduË
æ¥æ‰§è¡ŒpythÚæ¨¡å—ï¼Œå¹¶éä»¥è„šæœ¬å½¢å¼æ‰§è¡Œï¼Œä¹‹ååˆ†åˆ«æ‰“å°è¾“å‡º

6 
	g__Çme__
 =ğ'__maš__' 
ªd
 
__·ckage__
 
is
 
NÚe
:

7 
´št
 'ä»¥python module.pyå½¢å¼æ‰§è¡Œç¨‹åº'

8 
´št
 '__Çme__:', 
__Çme__


9 
	g´št
 '__·ckage__:', 
__·ckage__


11 
´št
 'ä»¥python -m moduleå½¢å¼æ‰§è¡Œç¨‹åº'

12 
´št
 '__Çme__:', 
__Çme__


13 
	g´št
 '__·ckage__:', 
__·ckage__


15 
äom
 
sub_·ckage
 
impÜt
 
¡ršg


16 
	gäom
 .. 
pythÚ·th
 
impÜt
 
	gbamboo


	@/root/grocery-shop/language/python/baseSyntax/package/main3.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 å°è¯•ä»¥
	gpythÚ
 -
m
 
	gmoduË
æ¥æ‰§è¡ŒpythÚæ¨¡å—ï¼Œå¹¶éä»¥è„šæœ¬å½¢å¼æ‰§è¡Œï¼Œä¹‹ååˆ†åˆ«æ‰“å°è¾“å‡º

6 
äom
 
sub_·ckage
 
impÜt
 
¡ršg


8 
	g__Çme__
 =ğ'__maš__' 
ªd
 
__·ckage__
 
is
 
NÚe
:

9 
´št
 'ä»¥python module.pyå½¢å¼æ‰§è¡Œç¨‹åº'

10 
´št
 '__Çme__:', 
__Çme__


11 
	g´št
 '__·ckage__:', 
__·ckage__


13 
´št
 'ä»¥python -m moduleå½¢å¼æ‰§è¡Œç¨‹åº'

14 
´št
 '__Çme__:', 
__Çme__


15 
	g´št
 '__·ckage__:', 
	g__·ckage__


	@/root/grocery-shop/language/python/baseSyntax/package/pythonpath/__init__.py

	@/root/grocery-shop/language/python/baseSyntax/package/pythonpath/bamboo.py

1 
	g´št
 "xxxxxxxxxxxxxxxxbambooxxxxxxxxxxxxxxxxxxxx"

2 #´šˆ'impÜˆ¡ršg fÜ %s'%(
__fe__
)

3 
	g´št
 '__Çme__:', 
__Çme__


4 
	g´št
 '__·ckage__:', 
__·ckage__


5 
	g´št
 "xxxxxxxxxxxxxxxxbambooƒndxxxxxxxxxxxxxxxxxxxx"

	@/root/grocery-shop/language/python/baseSyntax/package/repeImport.py

1 #!/
u¤
/
bš
/
evn
 
pythÚ


2 
	gVERSION
=3.0

4 
´št
 'Test„epetive import.'

	@/root/grocery-shop/language/python/baseSyntax/package/repeTest.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 
def
 
	$‹¡1
():

4 
impÜt
 
»³ImpÜt


5 
´št
 'Test1++++++++++++++++++++++++++++++'

7 
__Çme__
 == '__main__':

9 
´št
 'Main==========================='

10 
impÜt
 
time


11 
time
.
	$¦“p
(3)

12 
	`‹¡1
()

	@/root/grocery-shop/language/python/baseSyntax/package/sub_package/__init__.py

	@/root/grocery-shop/language/python/baseSyntax/package/sub_package/mod.py

1 
äom
 
__futu»__
 
impÜt
 
absŞu‹_impÜt


3 
	g´št
 "================mod==========================="

4 
	g´št
 "mod:__·ckage__:", 
__·ckage__


5 
	g´št
 "mod:__Çme__:", 
__Çme__


7 
impÜt
 
	g¡ršg


8 #´šˆ
dœ
(
¡ršg
)

9 
	g´št
 "AbsŞu‹ SŒšg.fe:", 
	g¡ršg
.
__fe__


11 
	gäom
 .. 
pythÚ·th
 
impÜt
 
bamboo


12 
	gäom
 . 
impÜt
 
	g¡ršg


13 #´šˆ
dœ
(
¡ršg
)

14 
	g´št
 "SŒšg.fe:", 
	g¡ršg
.
__fe__


15 
	g´št
 "===============modƒnd====================="

	@/root/grocery-shop/language/python/baseSyntax/package/sub_package/string.py

1 
äom
 
__futu»__
 
impÜt
 
absŞu‹_impÜt


2 
	g´št
 "***************************string****************"

3 
	gAAA
 = 10

4 
´št
 '__Çme__:', 
__Çme__


5 
	g´št
 '__·ckage__:', 
	g__·ckage__


6 #äom .. 
pythÚ·th
 
impÜt
 
bamboo


7 
	gäom
 ..
pythÚ·th
 
impÜt
 
bamboo


8 
	g´št
 "***************************stringƒnd****************"

	@/root/grocery-shop/language/python/baseSyntax/packageTest.py

1 
impÜt
 
sys


2 
	g´št
 'Cu¼’ˆpythÚ…©h:', 
	gsys
.
·th


3 
impÜt
 
	g·ckage
.
	gsub_·ckage
.
	gmod


	@/root/grocery-shop/language/python/baseSyntax/tupleTest.py

1 #codšg:
utf
-
job


3 
äom
 
cŞËùiÚs
 
impÜt
 
Çmedtu¶e


5 
def
 
	$Çmedtu¶eTe¡
():

7 
subsüib”
 = 
	`Çmedtu¶e
('subscriber', ['addr', 'joined'])

8 
sub
 = 
	`subsüib”
('shit@11.com', '2015-2')

9 
sub1
 = 
	`subsüib”
('xiang@11.com', '2015-3')

10 
´št
 
sub


11 
´št
 
sub1


13 
__Çme__
 == '__main__':

15 
	`Çmedtu¶eTe¡
()

	@/root/grocery-shop/language/python/baseSyntax/variParameterTest.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


5 
	g¬gs
: æ™®é€šå‚æ•°

6 
kw¬gs
: 
key
/
wÜd
å‚æ•°

9 
def
 
	$di¥ÏyLi¡
(*
¬gs
):

11 
´št
 '¬g ğ', 
¬gs


13 
def
 
	$foo
(*
¬gs
, **
kw¬gs
):

14 
¬gsLi¡
 = 
¬gs


15 
	$di¥ÏyLi¡
(*
¬gsLi¡
)

16 
´št
 'kw¬g ğ', 
kw¬gs


17 
´št


19 
def
 
	$foo1
(
m‘hod
, 
auth
=
NÚe
, **
kw¬gs
):

20 
d1
 = {
	}
}

21 
d1
['m‘hod'] = 
m‘hod


23 
auth
:

24 
d1
['auth'] = 
auth


26 
k
, 
v
è
š
 
kw¬gs
.
	$™ems
():

27 
d1
[
k
] = 
v


29 
´št
 
d1


31 
__Çme__
 == '__main__':

34 #foo(*
li¡1
)

35 #foo(5,
a
=1,
b
=2,
c
=3)

36 #foo(1,2,3,4, 
a
=1,
b
=2,
c
=3)

37 #foo('a', 1, 
NÚe
, 
a
=1, 
b
='2', 
c
=3)

39 
	`foo1
('m‘hod1', 
auth
='x', 
jsÚ
=3, 
sh™1
 = '4')

	@/root/grocery-shop/language/python/cProfile/simpleTest.py

1 
def
 
	$sum_num
(
max_num
):

2 
tÙ®
 = 0

3 
i
 
š
 
	$¿nge
(
max_num
):

4 
tÙ®
 +ğ
i


5  
tÙ®


8 
def
 
	$‹¡
():

9 
tÙ®
 = 0

10 
i
 
š
 
	$¿nge
(40000):

11 
tÙ®
 +ğ
i


13 
t1
 = 
	$sum_num
(100000)

14 
t2
 = 
	$sum_num
(400000)

16  
tÙ®


18 
__Çme__
 == "__main__":

20 
impÜt
 
cProfe


22 
cProfe
.
	`run
('‹¡()', 
f’ame
="result.out")

	@/root/grocery-shop/language/python/cliOperator/baseparse.py

1 #codšg:
utf
-
job


5 
impÜt
 
os


6 
impÜt
 
sys


7 
impÜt
 
CÚfigP¬£r


9 
şass
 
	$OssCÚfigP¬£
(
objeù
):

11 
def
 
	$__š™__
(
£lf
, 
f’ame
):

13 
£lf
.
_f’ame
 = 
f’ame


14 
£lf
.
_cÚfigP¬£r
 = 
CÚfigP¬£r
.
	$CÚfigP¬£r
()

15 
£lf
.
_cÚfigP¬£r
.
	$»ad
(
f’ame
)

17 
def
 
	$_g‘PythÚ·th
(
£lf
):

19 
Œy
:

20  
£lf
.
_cÚfigP¬£r
.
	`g‘
('pythonenv', \

21 'pythÚ·th').
	`¥l™
('$')

22 
	`exû±
 (
CÚfigP¬£r
.
NoSeùiÚE¼Ü
, \

23 
CÚfigP¬£r
.
NoO±iÚE¼Ü
):

24  
NÚe


26 
def
 
	$£tPythÚ·th
(
£lf
):

28 #chªg
sy¡em·th


29 
dœ
 = 
os
.
·th
.
	`dœÇme
(os.path.dirname(\

30 
os
.
·th
.
	`»®·th
(
__fe__
))) + "/"

31 
addPythÚP©h
 = [
dœ
+
sub·th
 sub·th 
š
 
£lf
.
	`_g‘PythÚ·th
()]

32 
·th
 
š
 
addPythÚP©h
:

33 
sys
.
·th
.
	$š£¹
(0, 
·th
)

34 #sys.
·th
.
	`ex‹nd
(
addPythÚP©h
)

36 
def
 
	$g‘SqlHo¡
(
£lf
, 
db
):

39 :
db
: db 
İtiÚs
 
Çme


41 
Œy
:

42  
£lf
.
_cÚfigP¬£r
.
	`g‘
(
db
, 'host')

43 
	`exû±
 (
CÚfigP¬£r
.
NoSeùiÚE¼Ü
, \

44 
CÚfigP¬£r
.
NoO±iÚE¼Ü
):

45  
NÚe


47 
def
 
	$g‘SqlPÜt
(
£lf
, 
db
):

49 
Œy
:

50  (
£lf
.
_cÚfigP¬£r
.
	`g‘
(
db
, 'port'))

51 
	`exû±
 (
CÚfigP¬£r
.
NoSeùiÚE¼Ü
, \

52 
CÚfigP¬£r
.
NoO±iÚE¼Ü
):

53  
NÚe


55 
def
 
	$g‘SqlU£r
(
£lf
, 
db
):

57 
Œy
:

58  
£lf
.
_cÚfigP¬£r
.
	`g‘
(
db
, 'username')

59 
	`exû±
 (
CÚfigP¬£r
.
NoSeùiÚE¼Ü
, \

60 
CÚfigP¬£r
.
NoO±iÚE¼Ü
):

61  
NÚe


63 
def
 
	$g‘SqlPasswd
(
£lf
, 
db
):

65 
Œy
:

66  
£lf
.
_cÚfigP¬£r
.
	`g‘
(
db
, 'password')

67 
	`exû±
 (
CÚfigP¬£r
.
NoSeùiÚE¼Ü
, \

68 
CÚfigP¬£r
.
NoO±iÚE¼Ü
):

69  
NÚe


71 
def
 
	$g‘SqlDb
(
£lf
, 
db
):

73 
Œy
:

74  
£lf
.
_cÚfigP¬£r
.
	`g‘
(
db
, 'dbname')

75 
	`exû±
 (
CÚfigP¬£r
.
NoSeùiÚE¼Ü
, \

76 
CÚfigP¬£r
.
NoO±iÚE¼Ü
):

77  
NÚe


79 
def
 
	$»_»ad
(
£lf
):

81 
Œy
:

82 
£lf
.
_cÚfigP¬£r
.
	$»ad
(
£lf
.
_f’ame
)

83 
	`exû±
 (
CÚfigP¬£r
.
NoSeùiÚE¼Ü
, \

84 
CÚfigP¬£r
.
NoO±iÚE¼Ü
):

85  
NÚe


87 
def
 
	$İtiÚs
(
£lf
, 
£ùiÚs
):

89 
Œy
:

90  
£lf
.
_cÚfigP¬£r
.
	$İtiÚs
(
£ùiÚs
)

91 
	`exû±
 (
CÚfigP¬£r
.
NoSeùiÚE¼Ü
, \

92 
CÚfigP¬£r
.
NoO±iÚE¼Ü
):

93  
NÚe


95 
def
 
	$g‘
(
£lf
, 
£ùiÚs
, 
İtiÚs
):

97 
Œy
:

98  
£lf
.
_cÚfigP¬£r
.
	$g‘
(
£ùiÚs
, 
İtiÚs
)

99 
	`exû±
 (
CÚfigP¬£r
.
NoSeùiÚE¼Ü
, \

100 
CÚfigP¬£r
.
NoO±iÚE¼Ü
):

101  
NÚe


103 
__Çme__
 == '__main__':

104 
·ss


	@/root/grocery-shop/language/python/cliOperator/cliOptionTest.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
sys


4 
impÜt
 
g‘İt


6 
	gu§ge_doc
 = '''

7 
şi
 
İtiÚ
 
‹¡
.

9 
U§ge
:

10 ./
şi
-
İtiÚ
 -
m
 [
MODULES
] -
s
 
M
 -
d
 
N


12 
O±iÚs
:

13 -
h
 
Ü
 --
h–p


14 -
l
 
Ü
 --
li¡


15 -
m
 
Ü
 --
moduË


16 
¶—£
 
šut
 
a
 
v®id
 
moduË
 
Çme
.

17 -
s
 
Ü
 --
¡¬t


18 
¶—£
 
šput
 
a
 
¡¬t
 
‹¡
 
numb”
.

19 -
e
 
Ü
 --
’d


20 
¶—£
 
šput
 
a
 
’d
 
‹¡
 
numb”
.

21 
FÜ
 
mÜe
 
šfo
 
vis™
 
h‰p
:

23 
def
 
	$u§ge
():

24 
´št
 
u§ge_doc


26 
def
 
	$g‘_şi_İtiÚs
(
¬gv
):

28 
lÚgO±iÚ
=["list", "module=", "start=", "end=", "lisa"]

29 
Œy
:

30 
İts
, 
¬gs
 = 
g‘İt
.
	`g‘İt
(
sys
.
¬gv
[1:], "2:3:m:4", 
lÚgO±iÚ
)

31 
exû±
 
Exû±iÚ
,
e
:

32 
´št
 
e


33 
	`ex™
(-1)

34 
´št
 "O±iÚs:", 
İts


35 
´št
 "Argum’ts:", 
¬gs


37 
İt
, 
¬g
 
š
 
İts
:

38 
İt
 
	`š
 ('-4', '--list'):

39 
´št
 '=========wahaha=============='

42 
def
 
	$maš
(
¬gv
):

44 
	`Ën
(
¬gv
) < 2:

45 
	$u§ge
()

46 
	`ex™
(-1)

47 
	$g‘_şi_İtiÚs
(
¬gv
)

48 
´št
 "Read command†ine successful!"

50 
__Çme__
 == "__main__":

51 
	$maš
(
sys
.
¬gv
)

52 
	`ex™
(0)

	@/root/grocery-shop/language/python/cliOperator/installMonitor.py

1 #!
codšg
:
utf
-
job


3 åŠŸèƒ½ï¼šç”¨äºä¸´æ—¶æ€§çš„å®‰è£…å¯åŠ¨
	gjob
-
	gngšx
éƒ¨åˆ†çš„è„šæœ¬

4 1,ä¿è¯è„šæœ¬ä»¥
	groÙ
æƒé™æ‰§è¡Œ

6 
impÜt
 
os


7 
impÜt
 
sys


8 
impÜt
 
Œaûback


10 
def
 
	$exû±iÚC©ch
(
func
,*
¬gs
,**
kw
):

11 
def
 
	$šÃrFunc
(*
¬gs
, **
kw
):

12 
Œy
:

13  
	$func
(*
¬gs
, **
kw
)

14 
exû±
 
Exû±iÚ
,
msg
:

15 
exc_ty³
, 
_
, 
exc_tb
 = 
sys
.
	$exc_šfo
()

16 
ŒaûLi¡
 = 
Œaûback
.
	$exŒaù_tb
(
exc_tb
)

17 
fe
,
lš’o
, 
funúame
, 
‹xt
è
š
 
ŒaûLi¡
:

18 
´št
 "Error,ype:%s, file:%s, func:%s,lineno:%s, msg:%s"%(\

19 
exc_ty³
, 
fe
, 
funúame
, 
lš’o
, 
msg
)

20 
sys
.
	`ex™
(-1)

21  
šÃrFunc


23 @
exû±iÚC©ch


24 
def
 
	$checkSvn
():

26 
r¥
 = 
os
.
	`sy¡em
("svn --version")

27 
r¥
>>
job
 
is
 0:

30 #š¡®È
svn


31 
os
.
	`sy¡em
('yum -y in¡®Èsvn')>>
job
 
is
 0:

34 @
exû±iÚC©ch


35 
def
 
	$checkEx³ù
():

36 #g‘ 
³x³ù


37 
Œy
:

38 
äom
 
³x³ù
 
impÜt
 *

39 
exû±
 
ImpÜtE¼Ü
:

40 
os
.
	`sy¡em
("—sy_š¡®È³x³ù")>>
job
 
is
 
nÙ
 0:

41 
´št
 'æ‰§è¡Œeasy_istall…expectå¤±è´¥ï¼Œso bad'

42  
F®£


43  
True


45 @
exû±iÚC©ch


46 
def
 
	$svnUpd©e
(
loÿÍ©h
, 
u£r
, 
·sswd
):

48 
os
.
	`sy¡em
('svn up %s --username %s --password %s'%(\

49 
loÿÍ©h
, 
u£r
, 
·sswd
))>>
job
 
is
 
nÙ
 0:

50 
´št
 'svn update å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åã€å¯†ç ä¿¡æ¯'

51  
F®£


52  
True


54 @
exû±iÚC©ch


55 
def
 
	`svnCheck
(
svÅ©h
, 
u£r
, 
·sswd
, 
loÿÍ©h
='.'):

57 
svn¡r
 = "svn co %s %s --username %s --password %s"%(\

58 
svÅ©h
, 
loÿÍ©h
, 
u£r
, 
·sswd
)

59 
os
.
	`sy¡em
(
svn¡r
)>>
job
 
is
 
nÙ
 0:

60 
´št
 'svn checkout å¤±è´¥ï¼Œè¯·æ£€æŸ¥urlã€ç”¨æˆ·åã€å¯†ç ä¿¡æ¯'

61  
F®£


62  
True


64 @
exû±iÚC©ch


65 
def
 
	$runExecu‹
(
cmd
):

67 
os
.
	`sy¡em
(
cmd
)>>
job
 
is
 
nÙ
 0:

68 
´št
 "è¿è¡Œsh–lå‘½ä»¤:%så¤±è´¥"%(
cmd
)

69  
F®£


70  
True


72 @
exû±iÚC©ch


73 
def
 
	$runBasic
():

75 
jobP©h
 = "/apps/job"

76 
u£ºame
 = "shit"

77 
·sswÜd
 = 'E5jobO*uval'

79 
os
.
·th
.
	$exi¡s
(
jobP©h
è
is
 
F®£
:

80 
nÙ
 
	`svnCheck
("http://xxxx.job5.4/svn/shitxxiang_svn/op/shitdev/job", \

81 
u£r
=
u£ºame
,\

82 
·sswd
=
·sswÜd
,\

83 
loÿÍ©h
=
jobP©h
):

86 
nÙ
 
	`svnUpd©e
(
jobP©h
, 
u£ºame
, 
·sswÜd
)>>
job
 
is
‚ot 0:

90 
basiccmd
 = "pythÚ %s/¤c/job-‹¡.py„e¡¬t"%(
jobP©h
)

91 
nÙ
 
	$runExecu‹
(
basiccmd
):

93 
´št
 
os
.
	`pİ’
("p aux|g»°job|g»°-v g»p").
	$»ad
()

94 
´št


95 
´št
 "æˆåŠŸè¿è¡Œbasic job"

96 
´št


98 @
exû±iÚC©ch


99 
def
 
	$runNgšx
():

101 
jobP©h
 = "/apps/job"

102 
u£ºame
 = "shit"

103 
·sswÜd
 = 'E5jobO*uval'

105 
os
.
·th
.
	$exi¡s
(
jobP©h
è
is
 
F®£
:

106 
nÙ
 
	`svnCheck
("http://xxxx.job5.4/svn/shitxxiang_svn/op/shitdev/job", \

107 
u£r
=
u£ºame
,\

108 
·sswd
=
·sswÜd
,\

109 
loÿÍ©h
=
jobP©h
):

112 
nÙ
 
	`svnUpd©e
(
jobP©h
, 
u£ºame
, 
·sswÜd
)>>
job
 
is
‚ot 0:

116 
basiccmd
 = "pythÚ %s/ngšx.py„e¡¬t"%(
jobP©h
)

117 
nÙ
 
	$runExecu‹
(
basiccmd
):

120 
´št
 
os
.
	`pİ’
("p aux|g»°ngšx|g»°-v g»p").
	$»ad
()

121 
´št


122 
´št
 "æˆåŠŸè¿è¡Œbasic job"

123 
´št


125 
def
 
	$u§ge
():

127 
´št
 '''

128 
u§ge
:

129 
basic
 --- 
run
 basiø
mÚ™Ü
 
´og¿m


130 
ngšx
 --- 
run
‚gšx 
mÚ™Ü
 
´og¿m


131 
h–p
 --- h–°
šfÜm©iÚ


134 
__Çme__
 == '__main__':

136 
	`Ën
(
sys
.
¬gv
) == 2:

137 'basic' =ğ
sys
.
¬gv
[1]:

138 
	$runBasic
()

139 
–if
 'ngšx' =ğ
sys
.
¬gv
[1]:

140 
	$runNgšx
()

142 
	$u§ge
()

144 
	$u§ge
()

145 
sys
.
	`ex™
(2)

	@/root/grocery-shop/language/python/cliOperator/pathTest/att.py

1 #codšg:
utf
-
job


2 
impÜt
 
os


3 
impÜt
 
sys


5 
äom
 
‹¡dœ
 
impÜt
 
add


7 
	g´št
 "os.g‘cwd(è :", 
	gos
.
	$g‘cwd
()

8 
´št
 "sys.·th[0] :", 
sys
.
·th
[0]

9 
´št
 "sys.¬gv[0] :", 
sys
.
¬gv
[0]

10 
´št
 "__fe__ :", 
__fe__


11 
´št
 "add.__fe__ :", 
add
.
__fe__


12 
´št
 "dœ(__fe__è :", 
os
.
·th
.
	`dœÇme
(os.·th.
	$ab¥©h
(
__fe__
))

13 
´št
 '»®·th :', 
os
.
·th
.
	$»®·th
(
__fe__
)

14 
´št
 "abs(__fe__è :", 
os
.
·th
.
	$ab¥©h
(
__fe__
)

15 
´št
 'dœÔ—Í©hè :', 
os
.
·th
.
	`dœÇme
(os.·th.
	`»®·th
(
__fe__
))

	@/root/grocery-shop/language/python/cliOperator/pathTest/test/a.py

1 #codšg:
utf
-
job


2 
impÜt
 
os


3 
impÜt
 
sys


5 
äom
 
‹¡dœ
 
impÜt
 
add


7 
	g´št
 "os.g‘cwd(è :", 
	gos
.
	$g‘cwd
()

8 
´št
 "sys.·th[0] :", 
sys
.
·th
[0]

9 
´št
 "sys.¬gv[0] :", 
sys
.
¬gv
[0]

10 
´št
 "__fe__ :", 
__fe__


11 
´št
 "add.__fe__ :", 
add
.
__fe__


12 
´št
 "dœ(__fe__è :", 
os
.
·th
.
	`dœÇme
(os.·th.
	$ab¥©h
(
__fe__
))

13 
´št
 '»®·th :', 
os
.
·th
.
	$»®·th
(
__fe__
)

14 
´št
 "abs(__fe__è :", 
os
.
·th
.
	$ab¥©h
(
__fe__
)

15 
´št
 'dœÔ—Í©hè :', 
os
.
·th
.
	`dœÇme
(os.·th.
	`»®·th
(
__fe__
))

	@/root/grocery-shop/language/python/cliOperator/pathTest/test/testdir/__init__.py

	@/root/grocery-shop/language/python/cliOperator/pathTest/test/testdir/add.py

1 
impÜt
 
sys


3 
impÜt
 
add2


5 
	g´št
 "Add sys.·th[0] :", 
	gsys
.
	g·th
[0]

	@/root/grocery-shop/language/python/cliOperator/pathTest/test/testdir/add2.py

1 
impÜt
 
sys


3 
	g´št
 "Add2 sys.·th[0] :", 
	gsys
.
	g·th
[0]

	@/root/grocery-shop/language/python/descripter/testDescipter.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-8

4 #@
fe
 
‹¡Desc‹r
.
py


5 #@
br›f
 æµ‹è¯•
desc‹r
çš„æŸäº›ç®€å•åŠŸèƒ½

6 #@
authÜ
 
uÆessbamboo


7 #@
v”siÚ
 0.1

8 #@
d©e
 2016-01-29

11 
şass
 
	$Te¡Desc‹r
(
objeù
):

13 
def
 
	$__š™__
(
£lf
, 
Çme
):

16 :
·¿m
 
Çme
: 
Objeù
's‚ame

18 
£lf
.
Çme
 =‚ame

20 
def
 
	$‹¡M‘hod
(
£lf
):

22 
´št
 '‹¡MeÙhd:{0}'.
	$fÜm©
(
£lf
.
Çme
)

25 
def
 
	$m‘hodTe¡
():

27 1ï¼Œæ£€æµ‹
m‘hod
æ˜¯å¦æ˜¯ä¸€ä¸ªå‡½æ•°
desc‹r


30 
‹¡1
 = 
	`Te¡Desc‹r
('test1')

31 
´št
 'Te¡1 info:{0}'.
	$fÜm©
(
‹¡1
.
‹¡M‘hod
)

32 
´št
 'Te¡1 infØäom __diù__[...]:{0}'.
	`fÜm©
(

33 
Te¡Desc‹r
.
__diù__
['testMethod'])

35 
__Çme__
 == '__main__':

37 
	`m‘hodTe¡
()

	@/root/grocery-shop/language/python/django/bamboo/bamboo/__init__.py

	@/root/grocery-shop/language/python/django/bamboo/bamboo/settings.py

1 #DjªgØ
£‰šgs
 
bamboo
 
´ojeù
.

3 #debug 
mod–


4 
	gDEBUG
 = 
True


5 #‹m¶©
debug
 
mod–


6 
TEMPLATE_DEBUG
 = 
DEBUG


8 
ADMINS
 = (

12 
	gMANAGERS
 = 
ADMINS


14 
DATABASES
 = {

16 'ENGINE': 'djªgo.db.back’ds.mysql', #Add 'po¡g»sql_psycİg2', 'mysql', 'sql™e3' 
Ü
 'oracle'.

17 'NAME': 'sh™»¡', #O¸
·th
 
to
 
d©aba£
 
fe
 
usšg
 
sql™e3
.

18 'USER': 'sh™', #NÙ 
u£d
 
w™h
 
sql™e3
.

19 'PASSWORD': 'sh™', #NÙ 
u£d
 
w™h
 
sql™e3
.

20 'HOST': '127.0.0.1', #S‘ 
to
 
em±y
 
¡ršg
 
loÿlho¡
. 
NÙ
 
u£d
 
w™h
 
sql™e3
.

21 'PORT': '3306', #S‘ 
to
 
em±y
 
¡ršg
 . 
NÙ
 
u£d
 
w™h
 
sql™e3
.

25 #Ho¡s/
domaš
 
Çmes
 
th©
 
¬e
 
v®id
 
this
 
s™e
; 
»quœed
 
DEBUG
 
is
 
F®£


26 #S“ 
h‰ps
:

27 
	gALLOWED_HOSTS
 = []

29 #LoÿÈ
time
 
zÚe
 
this
 
š¡®ÏtiÚ
. 
Choiûs
 
ÿn
 
be
 
found
 
h”e
:

31 #®though 
nÙ
 
®l
 
choiûs
 
may
 
be
 
avaabË
 
Ú
‡Î 
İ”©šg
 
sy¡ems
.

32 #IÀ
a
 
Wšdows
 
’vœÚm’t
 
this
 
mu¡
 
be
 
£t
 
to
 
your
 
sy¡em
 
time
 
zÚe
.

33 
TIME_ZONE
 = 'America/Chicago'

35 #Lªguag
code
 
this
 
š¡®ÏtiÚ
. 
AÎ
 
choiûs
 
ÿn
 
be
 
found
 
h”e
:

37 
LANGUAGE_CODE
 = 'en-us'

39 
SITE_ID
 = 1

41 #Ià
you
 
£t
 
this
 
to
 
F®£
, 
Djªgo
 
wl
 
make
 
some
 
İtimiz©iÚs
 
so
 
as
 
nÙ


42 #tØ
lßd
 
the
 
š‹º©iÚ®iz©iÚ
 
machš”y
.

43 
	gUSE_I1jobN
 = 
True


45 #Ià
you
 
£t
 
this
 
to
 
F®£
, 
Djªgo
 
wl
 
nÙ
 
fÜm©
 
d©es
, 
numb”s
 
ªd


46 #ÿËnd¬ 
accÜdšg
 
to
 
the
 
cu¼’t
 
loÿË
.

47 
	gUSE_L10N
 = 
True


49 #Ià
you
 
£t
 
this
 
to
 
F®£
, 
Djªgo
 
wl
 
nÙ
 
u£
 
timezÚe
-
aw¬e
 
d©‘imes
.

50 
	gUSE_TZ
 = 
True


52 #AbsŞu‹ 
fesy¡em
 
·th
 
to
 
the
 
dœeùÜy
 
th©
 
wl
 
hŞd
 
u£r
-
u¶ßded
 
fes
.

54 
MEDIA_ROOT
 = ''

56 #URL 
th©
 
hªdËs
 
the
 
medŸ
 
£rved
 
äom
 
MEDIA_ROOT
. 
Make
 
su»
 
to
 
u£
 
a


57 #Œašg 
¦ash
.

59 
	gMEDIA_URL
 = ''

61 #AbsŞu‹ 
·th
 
to
 
the
 
dœeùÜy
 
fes
 
should
 
be
 
cŞËùed
o.

63 #š 
­ps
' "static/" subdirectories‡nd in STATICFILES_DIRS.

65 
STATIC_ROOT
 = ''

67 #URL 
´efix
 
fes
.

69 
STATIC_URL
 = '/static/'

71 #Add™iÚ® 
loÿtiÚs
 
of
 
fes


72 
STATICFILES_DIRS
 = (

73 #Puˆ
¡ršgs
 
h”e
, 
like
 "/home/html/¡©ic" 
Ü
 "C:/www/django/static".

74 #Alway 
u£
 
fÜw¬d
 
¦ashes
, 
ev’
 
Ú
 
Wšdows
.

78 #Li¡ 
of
 
fšd”
 
şas£s
 
th©
 
know
 
how
 
to
 
fšd
 
fes
 
š


79 #v¬iou 
loÿtiÚs
.

80 
	gSTATICFILES_FINDERS
 = (

83 #'
djªgo
.
cÚŒib
.
¡©icfes
.
fšd”s
.
DeçuÉStÜageFšd”
',

86 #Mak
this
 
unique
, 
ªd
 
dÚ
't share it with‡nybody.

87 
	gSECRET_KEY
 = 'v370g_@arfjob%ggs17_)_-q(+)xlixw9sxb7el*on@va&amp;vv_5tr'

89 #Li¡ 
of
 
ÿÎabËs
 
th©
 
know
 
how
 
to
 
impÜt
 
‹m¶©es
 
äom
 
v¬ious
 
sourûs
.

90 
TEMPLATE_LOADERS
 = (

93 #'
djªgo
.
‹m¶©e
.
lßd”s
.
eggs
.
Lßd”
',

96 
	gMIDDLEWARE_CLASSES
 = (

102 #Uncomm’ˆ
the
 
Ãxt
 
lše
 
sim¶e
 
şickjackšg
 
´ÙeùiÚ
:

103 #'
djªgo
.
middËw¬e
.
şickjackšg
.
XF¿meO±iÚsMiddËw¬e
',

106 
	gROOT_URLCONF
 = 'bamboo.urls'

108 #PythÚ 
dÙ‹d
 
·th
 
to
 
the
 
WSGI
 
­¶iÿtiÚ
 
u£d
 
by
 
Djªgo
's„unserver.

109 
WSGI_APPLICATION
 = 'bamboo.wsgi.application'

111 
TEMPLATE_DIRS
 = (

112 #Puˆ
¡ršgs
 
h”e
, 
like
 "/home/html/djªgo_‹m¶©es" 
Ü
 "C:/www/django/templates".

113 #Alway 
u£
 
fÜw¬d
 
¦ashes
, 
ev’
 
Ú
 
Wšdows
.

117 
	gINSTALLED_APPS
 = (

124 #Uncomm’ˆ
the
 
Ãxt
 
lše
 
to
 
’abË
h
admš
:

125 #'
djªgo
.
cÚŒib
.
admš
',

126 #Uncomm’ˆ
the
 
Ãxt
 
lše
 
to
 
’abË
 
admš
 
docum’tiÚ
:

127 #'
djªgo
.
cÚŒib
.
admšdocs
',

131 #A 
§m¶e
 
loggšg
 
cÚfigu¿tiÚ
. 
The
 
Úly
 
ngibË
†ogging

132 #³rfÜmed 
by
 
this
 
cÚfigu¿tiÚ
 
is
 
to
 
£nd
 
ª
 
ema
o

133 #th
s™e
 
admšs
 
Ú
 
ev”y
 
HTTP
 500 
”rÜ
 
wh’
 
DEBUG
=
F®£
.

134 #S“ 
h‰p
:

135 #mÜ
d‘as
 
Ú
 
how
 
to
 
cu¡omize
 
your
 
loggšg
 
cÚfigu¿tiÚ
.

136 
	gLOGGING
 = {

138 'di§bË_exi¡šg_logg”s': 
F®£
,

155 '´İag©e': 
True
,

	@/root/grocery-shop/language/python/django/bamboo/bamboo/urls.py

1 
äom
 
	gdjªgo
.
	gcÚf
.
u¾s
 
impÜt
 
	g·‰”ns
, 
	gšşude
, 
	gu¾


3 #Uncomm’ˆ
the
 
Ãxt
 
two
 
lšes
 
to
 
’abË
h
admš
:

4 #äom 
djªgo
.
cÚŒib
 
impÜt
 
admš


5 #admš.
autodiscov”
()

7 
	gu¾·‰”ns
 = 
·‰”ns
('',

9 #u¾(
r
'^$', 'bamboo.v›ws.home', 
Çme
='home'),

10 #u¾(
r
'^bamboo/', 
šşude
('bamboo.foo.urls')),

12 #Uncomm’ˆ
the
 
admš
/
doc
 
lše
 
b–ow
 
to
 
’abË
‡dmš 
docum’tiÚ
:

13 #u¾(
r
'^admš/doc/', 
šşude
('django.contrib.admindocs.urls')),

15 #Uncomm’ˆ
the
 
Ãxt
 
lše
 
to
 
’abË
h
admš
:

16 #u¾(
r
'^admš/', 
šşude
(
admš
.
s™e
.
u¾s
)),

	@/root/grocery-shop/language/python/django/bamboo/bamboo/wsgi.py

2 
WSGI
 
cÚfig
 
bamboo
 
	g´ojeù
.

4 
This
 
moduË
 
cÚšs
 
the
 
WSGI
 
­¶iÿtiÚ
 
u£d
 
by
 
	gDjªgo
's development server

5 
ªd
 
ªy
 
´oduùiÚ
 
WSGI
 
	gd•loym’ts
. 
It
 
should
 
expo£
 
a
 
	gmoduË
-
Ëv–
 
v¬ŸbË


6 
	gÇmed
 ``
	g­¶iÿtiÚ
``. 
	gDjªgo
's ``runserver``‡nd ``runfcgi`` commands discover

7 
this
 
­¶iÿtiÚ
 
vŸ
 
	gthe
 ``
	gWSGI_APPLICATION
`` 
	g£‰šg
.

9 
Usu®ly
 
you
 
wl
 
have
 
the
 
¡ªd¬d
 
Djªgo
 
WSGI
 
­¶iÿtiÚ
 
	gh”e
, 
but
 
™
 
®so


10 
might
 
make
 
£n£
 
to
 
»¶aû
 
the
 
whŞe
 
Djªgo
 
WSGI
 
­¶iÿtiÚ
 
w™h
 
a
 
cu¡om
 
Úe


11 
th©
 
Ï‹r
 
d–eg©es
 
to
 
the
 
Djªgo
 
	gÚe
. 
FÜ
 
	gexam¶e
, 
you
 
could
 
šŒoduû
 
WSGI


12 
middËw¬e
 
	gh”e
, 
Ü
 
combše
 
a
 
Djªgo
 
­¶iÿtiÚ
 
w™h
 
ª
‡µliÿtiÚ 
of
 
ªÙh”


13 
	gäamewÜk
.

16 
impÜt
 
os


18 
	gos
.
	g’vœÚ
.
£tdeçuÉ
("DJANGO_SETTINGS_MODULE", "bamboo.settings")

20 #Thi 
­¶iÿtiÚ
 
objeù
 
is
 
u£d
 
by
 
ªy
 
WSGI
 
£rv”
 
cÚfigu»d
 
to
 
u£
 
this


21 #fe. 
This
 
šşudes
 
Djªgo
's development server, ifhe WSGI_APPLICATION

22 #£‰šg 
pošts
 
h”e
.

23 
äom
 
	gdjªgo
.
	gcÜe
.
wsgi
 
impÜt
 
g‘_wsgi_­¶iÿtiÚ


24 
	g­¶iÿtiÚ
 = 
	$g‘_wsgi_­¶iÿtiÚ
()

26 #Aµly 
WSGI
 
middËw¬e
 
h”e
.

27 #äom 
h–lowÜld
.
wsgi
 
impÜt
 
H–loWÜldAµliÿtiÚ


28 #­¶iÿtiÚ = 
	`H–loWÜldAµliÿtiÚ
(
­¶iÿtiÚ
)

	@/root/grocery-shop/language/python/django/bamboo/books/__init__.py

	@/root/grocery-shop/language/python/django/bamboo/books/models.py

1 
äom
 
	gdjªgo
.
db
 
impÜt
 
mod–s


3 
şass
 
	$Publish”
(
mod–s
.
Mod–
):

4 
Çme
 = 
mod–s
.
	$Ch¬F›ld
(
max_Ëngth
=30)

5 
add»ss
 = 
mod–s
.
	$Ch¬F›ld
(
max_Ëngth
=50)

6 
c™y
 = 
mod–s
.
	$Ch¬F›ld
(
max_Ëngth
=60)

7 
¡©e_´ovšû
 = 
mod–s
.
	$Ch¬F›ld
(
max_Ëngth
=30)

8 
couÁry
 = 
mod–s
.
	$Ch¬F›ld
(
max_Ëngth
=50)

9 
webs™e
 = 
mod–s
.
	$URLF›ld
()

10 
put_d©e
 = 
mod–s
.
	$D©eF›ld
()

11 
def
 
	$__unicode__
(
£lf
):

13  
u
'{0} {1} {2} {3} {4} {5} {6}'.
	`fÜm©
(\

14 
£lf
.
Çme
, s–f.
add»ss
, s–f.
c™y
, \

15 
£lf
.
¡©e_´ovšû
, s–f.
couÁry
, \

16 
£lf
.
webs™e
, s–f.
put_d©e
)

17 
şass
 
M‘a
:

18 
Üd”šg
 = ['name']

20 
şass
 
	$AuthÜ
(
mod–s
.
Mod–
):

21 
fœ¡_Çme
 = 
mod–s
.
	$Ch¬F›ld
(
max_Ëngth
=30)

22 
Ï¡_Çme
 = 
mod–s
.
	$Ch¬F›ld
(
max_Ëngth
=40)

23 
ema
 = 
mod–s
.
	$EmaF›ld
()

25 
şass
 
	$Book
(
mod–s
.
Mod–
):

26 
t™Ë
 = 
mod–s
.
	$Ch¬F›ld
(
max_Ëngth
=100)

27 
authÜs
 = 
mod–s
.
	$MªyToMªyF›ld
(
AuthÜ
)

28 
publish”
 = 
mod–s
.
	$FÜeignKey
(
Publish”
)

29 
publiÿtiÚ_d©e
 = 
mod–s
.
	`D©eF›ld
()

	@/root/grocery-shop/language/python/django/bamboo/books/tests.py

2 
This
 
fe
 
demÚ¡¿‹s
 
wr™šg
 
‹¡s
 
usšg
 
the
 
un™‹¡
 
	gmoduË
. 
The£
 
wl
 
·ss


3 
wh’
 
you
 
	grun
 "manage.pyest".

5 
R•Ïû
 
this
 
w™h
 
mÜe
 
­´İrŸ‹
 
‹¡s
 
your
 
	g­¶iÿtiÚ
.

8 
äom
 
	gdjªgo
.
‹¡
 
impÜt
 
Te¡Ca£


11 
şass
 
	$Sim¶eTe¡
(
Te¡Ca£
):

12 
def
 
	$‹¡_basic_add™iÚ
(
£lf
):

14 
Te¡s
 
th©
 1 + 1 
®ways
 
equ®s
 2.

16 
£lf
.
	`as£¹Equ®
(1 + 1, 2)

	@/root/grocery-shop/language/python/django/bamboo/books/views.py

1 #C»©
your
 
v›ws
 
h”e
.

	@/root/grocery-shop/language/python/django/bamboo/manage.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 
impÜt
 
os


3 
impÜt
 
sys


5 
	g__Çme__
 == "__main__":

6 
os
.
’vœÚ
.
£tdeçuÉ
("DJANGO_SETTINGS_MODULE", "bamboo.settings")

8 
äom
 
	gdjªgo
.
	gcÜe
.
mªagem’t
 
impÜt
 
execu‹_äom_commªd_lše


10 
execu‹_äom_commªd_lše
(
sys
.
¬gv
)

	@/root/grocery-shop/language/python/email/mail_header_simple.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 
äom
 
cSŒšgIO
 
impÜt
 
SŒšgIO


5 
äom
 
	gema
.
g’”©Ü
 
impÜt
 
G’”©Ü


6 
äom
 
	gema
.
	gmime
.
‹xt
 
impÜt
 
MIMEText


7 
impÜt
 
time


9 
	gma_body
 = 'This is‡est mail sent by Topwaf,…lease!'

10 
maš_msg
 = 
MIMEText
(
ma_body
, "plain", "utf-job")

11 
	gmaš_msg
['Subject'] = 'Test mail'

12 
maš_msg
['From']='a297413@163.com'

13 
maš_msg
['To']=';'.
još
(['unlessbamboo@gmail.com', 'a297413@163.com'])

14 
	gmaš_msg
['d©e']=
time
.
¡ráime
('%a, %d %b %Y %H:%M:%S %z')

16 
å
 = 
	$SŒšgIO
()

17 
g
 = 
	$G’”©Ü
(
å
, 
mªgË_äom_
=
F®£
, 
maxh—d”Ën
=60)

18 
g
.
	$æ©‹n
(
maš_msg
)

19 
‹xt
 = 
å
.
	$g‘v®ue
()

20 
´št
 
‹xt


	@/root/grocery-shop/language/python/email/mail_image_simple.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 #ImpÜˆ
smlib
 
the
 
aùu®
 
£ndšg
 
funùiÚ


5 
impÜt
 
os


6 
impÜt
 
	gsmlib


8 #H”
¬e
 
the
 
ema
 
·ckage
 
moduËs
 
we
'll‚eed

9 
äom
 
	gema
.
	gmime
.
image
 
impÜt
 
MIMEImage


10 
äom
 
	gema
.
	gmime
.
muÉ¬t
 
impÜt
 
MIMEMuÉ¬t


12 
	gme
 = "a297413@163.com"

13 
çmy
 = ["unlessbamboo@gmail.com"]

15 
COMMASPACE
 = ','

16 #C»©
the
 
cÚš”
 (
ou‹r
è
ema
 
mes§ge
.

17 
msg
 = 
	$MIMENÚMuÉ¬t
()

18 
msg
['Subject'] = 'Our family„eunion'

19 #m=ğ
the
 
£nd”
'sƒmail‡ddress

20 #çmy = 
the
 
li¡
 
of
 
®l
 
»c›Ás
'ƒmail‡ddresses

21 
msg
['From'] = 
me


22 
msg
['To'] = 
COMMASPACE
.
	$još
(
çmy
)

23 
msg
.
´—mbË
 = 'Our family„eunion'

25 #Assum
we
 
know
 
th©
 
the
 
image
 
fes
 
¬e
 
®l
 
š
 
PNG
 
fÜm©


26 
dœÇme
 = 
	`¿w_šput
(">>>Input dirname:")

27 
²gfes
 = 
os
.
	$li¡dœ
(
dœÇme
)

28 
fe
 
š
 
²gfes
:

29 #O³À
the
 
fes
 
š
 
bš¬y
 
mode
. 
L‘
h
MIMEImage
 
şass
 
autom©iÿÎy


30 #gues 
the
 
¥ecific
 
image
 
ty³
.

31 
fe
 = 
dœÇme
 + "/" + file

32 
å
 = 
	`İ’
(
fe
, 'rb')

33 
img
 = 
	`MIMEImage
(
å
.
	$»ad
())

34 
å
.
	$şo£
()

35 
msg
.
	$©ch
(
img
)

37 #S’d 
the
 
ema
 
vŸ
 
our
 
own
 
SMTP
 
£rv”
.

38 
s
 = 
smlib
.
	`SMTP
('smtp.163.com', 25)

39 
s
.
	`logš
('a297413', 'zbf104641719')

40 
s
.
	`£ndma
(
me
, 
çmy
, 
msg
.
	$as_¡ršg
())

41 
s
.
	`qu™
()

	@/root/grocery-shop/language/python/email/mail_parser_send.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 #ImpÜˆ
the
 
ema
 
moduËs
 
we
'll‚eed

4 
äom
 
	gema
.
·r£r
 
impÜt
 
	gP¬£r


6 #Ià
the
 
e
-
ma
 
h—d”s
 
¬e
 
š
 
a
 
fe
, 
uncomm’t
 
this
 
lše
:

7 #h—d” ğ
P¬£r
().
·r£
(
İ’
(
mes§gefe
, 'r'))

8 #O¸
·rsšg
 
h—d”s
 
š
 
a
 
¡ršg
, 
u£
:

9 
	gh—d”s
 = 
P¬£r
().
·r£¡r
('From: <user@example.com>\n'

13 'Body would gØh”e\n', 
True
)

15 #Now 
the
 
h—d”
 
™ems
 
ÿn
 
be
 
acûs£d
 
as
 
a
 
diùiÚ¬y
:

16 
	g´št
 'To: %s' % 
	gh—d”s
['to']

17 
	g´št
 'From: %s' % 
	gh—d”s
['from']

18 
	g´št
 'Subjeù: %s' % 
	gh—d”s
['subject']

20 
	g´št
 "Keys:", 
	gh—d”s
.
	$keys
()

21 
´št
 "Headers:\n"

22 
´št
 
h—d”s


	@/root/grocery-shop/language/python/email/mail_send_simple.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
smlib


4 
äom
 
	gema
.
	gmime
.
‹xt
 
impÜt
 
MIMEText


6 
	gf’ame
 = 
¿w_šput
(">>>Input filename:")

7 
å
 = 
İ’
(
f’ame
, "rb")

8 #ü—‹ 
a
 
‹xt
/
¶aš
 
mes§ge


9 
	gmsg
 = 
MIMEText
(
å
.
	$»ad
())

10 
å
.
	$şo£
()

12 
msg
['subjeù'] = 'ThcÚ‹Á oà%s'%
f’ame


13 
msg
['from'] = 'a297413@163.com'

14 
msg
['to'] = 'unlessbamboo@google.com'

16 #S’d 
the
 
mes§ge
 
vŸ
 
our
 
own
 
SMTP
 
£rv”
, 
but
 
dÚ
â€™
t
 
šşude
he

17 #’v–İ
h—d”
.

18 
s
 = 
smlib
.
	`SMTP
('smtp.163.com', 25)

19 
s
.
	$£t_debugËv–
(
True
)

20 
s
.
	$ehlo
()

21 
s
.
	`logš
('a297413', 'zbf104641719')

22 
s
.
	`£ndma
('a297413@163.com', ['uÆessbamboo@gma.com'], 
msg
.
	$as_¡ršg
())

23 
s
.
	`qu™
()

	@/root/grocery-shop/language/python/email/mail_topsec.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
smlib


4 
äom
 
	gema
.
	gmime
.
‹xt
 
impÜt
 
MIMEText


6 
	gma_body
 = 'This is‡est mail sent by Topwaf,…lease!'

7 
msg
 = 
MIMEText
(
ma_body
, "plain", "utf-job")

8 
	gmsg
['subject'] = 'The contents ofest'

9 
msg
['from'] = 'zheng_bifeng@topsec.com.cn'

10 
msg
['to'] = 'zheng_bifeng@topsec.com.cn'

12 #S’d 
the
 
mes§ge
 
vŸ
 
our
 
own
 
SMTP
 
£rv”
, 
but
 
dÚ
â€™
t
 
šşude
he

13 #’v–İ
h—d”
.

14 
	gs
 = 
smlib
.
SMTP
('192.16job.66.9', 25)

15 
	gs
.
	$£t_debugËv–
(
True
)

16 
s
.
	$ehlo
()

17 
s
.
	`logš
('zheng_bifeng', 'MYLOVE2014')

18 
s
.
	`£ndma
('zh’g_biãng@tİ£c.com.ú', ['zh’g_biãng@tİ£c.com.ú'], 
msg
.
	$as_¡ršg
())

19 
s
.
	`qu™
()

	@/root/grocery-shop/language/python/email/sendmail.py

1 ï»¿#!/
	gu¤
/
	gbš
/
’v
 
	gpythÚ


2 #-*- 
codšg
:
utf
-
job
 -*-

3 
impÜt
 
smlib


4 
impÜt
 
ba£64


5 
impÜt
 
sock‘


7 
impÜt
 
	gema
.
MIMEBa£


8 
äom
 
	gema
.
	gmime
.
‹xt
 
impÜt
 
MIMEText


9 
äom
 
	gema
.
	gmime
.
muÉ¬t
 
impÜt
 
MIMEMuÉ¬t


10 
äom
 
	gema
.
	gmime
.
image
 
impÜt
 
MIMEImage


13 
	gSUCCESS
 = "Send mail successful,OK!"

14 
ERR_SMTP_SERVER_DISCONNECTED
="Mail server unexpectedly disconnects"

15 
ERR_SMTP_SENDER_REFUSED
 = "Sender‡ddress„efused"

16 
ERR_SMTP_RECIPIENT_REFUSED
="All„ecipient‡ddress„efused"

17 
ERR_SMTP_DATA
="Mail server„efusedo‡ccepthe message data"

18 
ERR_SMTP_CONNECT
="Connnect mail server occurƒrror"

19 
ERR_SMTP_HELO
="Mail server„efused our HELO message"

20 
ERR_SMTP_AUTHENTICATION
="Mail server‡uthentication went wrong"

21 
ERR_SMTP_UNKNOWN
="Unknownƒrror"

22 
ERR_DATA_FORMAT
="Sorry, data format is invalidate."

24 
def
 
	$_hªdË_©ch
(
maš
, 
d©aDiù
):

26 #commÚ 
©chm’t
 
fe


27 
d©aDiù
.
	`has_key
('file'):

28 
feA‰ach
 = 
d©aDiù
['file']

29 
Çme
, 
d©a
è
š
 
feA‰ach
:

30 
´št
 '**********************'

31 
´št
 'd©a:', 
d©a


32 
©t
 = 
ema
.
MIMEText
.
	`MIMEText
(
ba£64
.
	`b64decode
(
d©a
), \

34 
©t
["Content-Type"] = 'application/octet-stream'

35 
©t
["Content-Disposition"] = 'attachment; filename="{0}"'.\

36 
	$fÜm©
(
Çme
)

37 
maš
.
	$©ch
(
©t
)

39 #Embed 
piùu»


40 
d©aDiù
.
	`has_key
('image'):

41 
imageA‰ach
 = 
d©aDiù
['image']

42 
Çme
, 
d©a
è
š
 
imageA‰ach
:

43 
©t
 = 
	`MIMEImage
(
ba£64
.
	$b64decode
(
d©a
))

44 
©t
.
	`add_h—d”
('CÚ‹Á-ID', '<{0}>'.
	$fÜm©
(
Çme
))

45 
maš
.
	$©ch
(
©t
)

47 
def
 
	$ü—‹
(
d©aDiù
):

50 :
d©aDiù
: 
a
 
diùiÚ¬y
 
to
 
§ve
 
ma
.

52 
”rÜMsg
 = ''

53 
msg
 = ''

54 
Œy
:

55 
maš
 = 
	`MIMEMuÉ¬t
('related')

56 
	$_hªdË_©ch
(
maš
, 
d©aDiù
)

57 
´št
 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'

58 
´št
 
	$¡r
(
maš
)

59 
maš
.
	`©ch
(
	`MIMEText
(
d©aDiù
['content'], 'html', 'utf-job'))

61 
maš
['Subjeù'] = 
d©aDiù
['subject']

62 
maš
['From'] = 
d©aDiù
['from']

63 
maš
['To'] = ','.
	`još
(
d©aDiù
['recip'])

64 
msg
 = 
maš
.
	$as_¡ršg
()

65 
exû±
 
KeyE¼Ü
:

66 
”rÜMsg
 = 
ERR_DATA_FORMAT


67 
exû±
 
Exû±iÚ
, 
msg
:

68 
”rÜMsg
 = 
ERR_SMTP_UNKNOWN
 + 
msg


70 
r¥Diù
 = {'»suÉ':
F®£
, '”rÜmsg':
”rÜMsg
} ”rÜMsg NÚe

71  
msg
, 
r¥Diù


73 
def
 
	$£nd
(
cÚfDiù
, 
d©a
):

76 :
d©a
: 
ma
 data.

77 :
cÚfDiù
: 
cÚfigu»
 
diùiÚ¬y


79 
”rÜMsg
 = ''

80 
Œy
:

81 
cÚfDiù
['auth'] == 'ssl':

82 
£rv”
 = 
smlib
.
	`SMTP_SSL
(
cÚfDiù
['server'], confDict['port'])

83 
£rv”
.
	$ehlo
()

84 
£rv”
.
esm_ã©u»s
["auth"] = "LOGIN PLAIN"

86 
£rv”
 = 
smlib
.
	`SMTP
(
cÚfDiù
['server'], confDict['port'])

87 #£rv”.
	`£t_debugËv–
(1)

88 
£rv”
.
esm_ã©u»s
['auth'] = 'LOGIN PLAIN'

90 
£rv”
.
	`logš
(
cÚfDiù
['from'], confDict['passwd'])

91 
£rv”
.
	`£ndma
(
cÚfDiù
['äom'], cÚfDiù['»c'], 
d©a
)

92 
£rv”
.
	$qu™
()

93 
exû±
 
smlib
.
SMTPS”v”DiscÚÃùed
, 
d©a
:

94 
”rÜMsg
 = 
ERR_SMTP_SERVER_DISCONNECTED


95 
exû±
 
smlib
.
SMTPS’d”Refu£d
,
d©a
:

96 
”rÜMsg
 =
ERR_SMTP_SENDER_REFUSED


97 
exû±
 
smlib
.
SMTPRec›ÁsRefu£d
,
d©a
:

98 
”rÜMsg
 =
ERR_SMTP_RECIPIENT_REFUSED
;

99 
exû±
 
smlib
.
SMTPD©aE¼Ü
,
d©a
:

100 
”rÜMsg
 =
ERR_SMTP_DATA


101 
exû±
 
smlib
.
SMTPCÚÃùE¼Ü
, 
d©a
:

102 
”rÜMsg
 =
ERR_SMTP_CONNECT


103 
exû±
 
smlib
.
SMTPH–oE¼Ü
,
d©a
:

104 
”rÜMsg
 =
ERR_SMTP_HELO


105 
exû±
 
smlib
.
SMTPAuth’tiÿtiÚE¼Ü
,
d©a
:

106 
”rÜMsg
 =
ERR_SMTP_AUTHENTICATION


107 
	`exû±
 (
sock‘
.
timeout
,sock‘.
”rÜ
), 
d©a
:

108 
”rÜMsg
 =
ERR_SMTP_CONNECT


109 
exû±
 
KeyE¼Ü
, 
d©a
:

110 
”rÜMsg
 = 
ERR_DATA_FORMAT


112 
r¥Diù
 = {'»suÉ': 
F®£
, '”rmsg':
”rÜMsg
} ”rÜMsg \

113 {'»suÉ':
True
}

114  
r¥Diù


117 
__Çme__
 == '__main__':

119 
w™h
 
İ’
('/tmp/1.²g', 'rb'è
as
 
	gå
:

120 
image1D©a
 = 
å
.
	$»ad
()

121 
w™h
 
	`İ’
('/tmp/2.²g', 'rb'è
as
 
å
:

122 
image2D©a
 = 
å
.
	$»ad
()

124 
w™h
 
	`İ’
('/tmp/©ch1.²g', 'rb'è
as
 
å
:

125 
©ch1D©a
 = 
å
.
	$»ad
()

126 
w™h
 
	`İ’
('/tmp/©ch2.‹xt', 'rb'è
as
 
å
:

127 
©ch2D©a
 = 
å
.
	$»ad
()

129 
d©aDiù
 = {
	}
}

130 
d©aDiù
['image'] = [\

131 #('1.²g', 
ba£64
.
b64’code
(
image1D©a
)),

132 #('2.²g', 
ba£64
.
b64’code
(
image2D©a
)),

134 
	gd©aDiù
['file'] = [\

135 ('©ch1.²g', 
ba£64
.
b64’code
(
©ch1D©a
)),

136 ('©ch2.‹xt', 
ba£64
.
b64’code
(
©ch2D©a
)),

138 
	gd©aDiù
['subject'] = 'This is‡est'

139 
d©aDiù
['recip'] = ['agege@shit.com', 'shit@shit.com']

140 
	gd©aDiù
['content'] = ('<b>This is‡est</b>'\

143 
d©aDiù
['to'] = ['shit@shit.com']

144 
d©aDiù
['recip'] = ['shit@shit.com']

145 
d©aDiù
['from'] = 'shit@shit.com'

146 
d©aDiù
['auth'] = 'ssl'

147 
d©aDiù
['passwd'] = 'shit****'

148 
d©aDiù
['server'] = 'smtp.exmail.qq.com'

149 
d©aDiù
['port'] = 465

152 
impÜt
 
»que¡s


153 
impÜt
 
jsÚ


154 
´št
 
d©aDiù


155 
r¥
 = 
»que¡s
.
po¡
('http://xiage.shitx.shit.com/v1/send/mail/', \

156 
d©a
=
jsÚ
.
dumps
(
d©aDiù
), \

157 
h—d”s
={'Content-type':'application/json'})

158 
´št
 
r¥
.
‹xt


160 
´št
 
d©aDiù
['file']

161 
d©a
, 
	gr¥Diù
 = 
	$ü—‹
(
d©aDiù
)

162 
nÙ
 
r¥Diù
:

163 
r¥Diù
 = 
	$£nd
(
d©aDiù
, 
d©a
)

164 
´št
 
r¥Diù


	@/root/grocery-shop/language/python/encodeDiscuss/decodeProblem.py

1 #codšg:
utf
-
job


4 
impÜt
 
os


5 
impÜt
 
sys


7 
def
 
	$decodeIgnÜe
(
d¡
):

9 
True
:

10 
qu™
 = 
	`¿w_šput
("æ˜¯å¦é€€å‡º?(Y/N)").
	$uµ”
()

11 
qu™
 == "Y":

13 
´št
 "ç›®æ ‡çš„ç±»å‹ä¸º:", 
	$ty³
(
d¡
)

14 
b
 = 
u
'/BBB/' + 
d¡
.
	`decode
('utf-job', 
”rÜs
='ignore')

15 
´št
 "æµ‹è¯•ç»è¿‡ç¼–ç ä¹‹åæ˜¯å¦ä¼šæŠ›å‡ºå¼‚å¸¸--", 
	`ty³
(
b
), b

19 
__Çme__
 == '__main__':

21 
´št
 "=============é“¾è¡¨æµ‹è¯•==========="

22 
l
 = [1,3,4]

23 
	$decodeIgnÜe
(
l
)

24 
´št
 "\n=============ä¸²æµ‹è¯•==========="

25 
s
 = "string"

26 
	`decodeIgnÜe
(
s
)

	@/root/grocery-shop/language/python/envOperator/interpreter1.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-8

4 #@
fe
 
š‹´‘”
.
py


5 #@
br›f
 
Te¡
 /
u¤
/
bš
/
evn
 
pythÚ
 
ªd
 /u¤/bš/pythÚ 
aá”
 
š¡®l
 
py’v


6 #@
authÜ
 
uÆessbamboo


7 #@
v”siÚ
 0.1

8 #@
d©e
 2016-01-29

9 
impÜt
 
sys


12 
	g´št
 "è§£é‡Šå™¨ä¸º/u¤/bš/pythÚï¼Œæ­¤æ—¶ç³»ç»Ÿç‰ˆæœ¬ä¸º:{0}".
fÜm©
(
sys
.
v”siÚ_šfo
)

	@/root/grocery-shop/language/python/envOperator/interpreter2.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-8

4 #@
fe
 
š‹´‘”
.
py


5 #@
br›f
 
Te¡
 /
u¤
/
bš
/
evn
 
pythÚ
 
ªd
 /u¤/bš/pythÚ 
aá”
 
š¡®l
 
py’v


6 #@
authÜ
 
uÆessbamboo


7 #@
v”siÚ
 0.1

8 #@
d©e
 2016-01-29

9 
impÜt
 
sys


12 
	g´št
 "è§£é‡Šå™¨ä¸º/u¤/bš/’v…ythÚï¼Œæ­¤æ—¶ç³»ç»Ÿç‰ˆæœ¬ä¸º:{0}".
fÜm©
(
sys
.
v”siÚ_šfo
)

	@/root/grocery-shop/language/python/envOperator/interpreterTest.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-8

4 #@
fe
 
š‹´‘”Te¡
.
py


5 #@
br›f
 è°ƒç”¨
š‹½»‹r
æµ‹è¯•ä»£ç 

6 #@
authÜ
 
uÆessbamboo


7 #@
v”siÚ
 0.1

8 #@
d©e
 2016-01-29

9 
impÜt
 
sub´oûss


12 
def
 
	$‹¡IÁ”´‘”
():

14 
sub´oûss
.
	`ÿÎ
(['python', 'interpreter1.py'])

15 
sub´oûss
.
	`ÿÎ
(['python', 'interpreter2.py'])

17 
__Çme__
 == '__main__':

19 
	`‹¡IÁ”´‘”
()

	@/root/grocery-shop/language/python/exceptOperator/cgitbTest.py

1 #codšg:
utf
-
job


3 
	gcg™b
æ¨¡å—ç”¨äºæ—¥å¿—ä¿¡æ¯è°ƒè¯•ï¼Œè¾“å‡ºå¼‚å¸¸ä¸Šä¸‹æ–‡æ‰€æœ‰ç›¸å…³å˜é‡çš„ä¿¡æ¯

5 
impÜt
 
cg™b


6 
impÜt
 
sys


7 
impÜt
 
Œaûback


9 
def
 
	$cg™bTe¡
():

10 
cg™b
.
	`’abË
(
fÜm©
='text')

11 
li¡1
 = [1, 2, 3]

12 
li¡2
 = 
li¡1


15 
__Çme__
 == '__main__':

17 
	`cg™bTe¡
()

	@/root/grocery-shop/language/python/exceptOperator/decorator/decoratorTest.py

1 
def
 
	$´št_ÿÎ
(
â
):

3 å‡½æ•°æŒ‡é’ˆæˆ–è€…å‡½æ•°çš„
w¿p
ä½¿ç”¨

5 
def
 
	$â_w¿p
(*
¬gs
, **
kw¬gs
):

7 æ³¨æ„è¿™é‡Œçš„
¬gs
ã€
kw¬gs
å…¶å®å’Œå¤–å±‚å°è£…å‡½æ•°æ²¡æœ‰ä»»ä½•å…³ç³»

9 
´št
 "C®lšg % w™h‡rgum’ts: \n\rgs: %s\n\tkw¬gs:%s"%(
â
.
__Çme__
, 
¬gs
, 
kw¬gs
)

10 
»tv®
 = 
	$â
(*
¬gs
, **
kw¬gs
)

11 
´št
 "% »tuºšg '%s'" %(
â
.
func_Çme
, 
»tv®
)

12  
»tv®


14 
â_w¿p
.
func_Çme
 = 
â
.func_name

15  
â_w¿p


17 
def
 
	`biãng_add
(
Çme
, 
age
='26'):

18 
´št
 "Biãng' Çme:%s,‡ge:%s"%(
Çme
, 
age
)

19  
age


21 
func1
 = 
	$´št_ÿÎ
(
biãng_add
)

22 
	`func1
('20')

	@/root/grocery-shop/language/python/exceptOperator/decorator/decoratorType.py

1 #codšg:
utf
-
job


2 
def
 
	$decÜ©Ü
(
func
):

4 
´št
 'ç±»åˆ«1ï¼š'

5  
func


7 @
decÜ©Ü


8 
def
 
	$³rãù
():

9 
´št
 'perfect man'

10 
´št
 '=========================='

11 #ç­‰ä»·äº
³rãù
=
	`decÜ©Ü
Õ”ãù), 
	`³rãù
()

12 
	$³rãù
()

13 
´št
 '==========================end'

14 
´št


16 
def
 
	$decÜ©Ü1
(
func
):

18 
´št
 'ç±»åˆ«2ï¼š'

19 
def
 
	$šÃr_func
(*
¬gs
, **
kw¬gs
):

21 
´št
 '% begš:'%(
func
.
__Çme__
)

22 
	$func
(*
¬gs
, **
kw¬gs
)

23 
´št
 '% ’d:'%(
func
.
__Çme__
)

24  
šÃr_func


25 @
decÜ©Ü1


26 
def
 
	$³rãù1
(
Çme
):

27 
´št
 '³rãù mª who\' Çmi {0}'.
	$fÜm©
(
Çme
)

28 
´št
 '=========================='

29 #ç­‰ä»·äº
³rãù
=
	`decÜ©Ü1
Õ”ãù), 
	`³rãù
('bifeng')

30 
	`³rãù1
('bifeng')

31 
´št
 '==========================end'

32 
´št


35 
def
 
	$decÜ©Ü2
(
decÜ©e_¬gs
):

37 
´št
 'ç±»åˆ«2ï¼š'

38 
def
 
	$ÃwDecÜ©Ü
(
func
):

39 
´št
 'è£…é¥°å™¨å‚æ•°ä¸ºï¼š', 
decÜ©e_¬gs


40  
func


41  
ÃwDecÜ©Ü


42 @
	`decÜ©Ü2
('-type 2‡rgs-')

43 
def
 
	$³rãù2
():

44 
´št
 'perfect man'

45 
´št
 '=========================='

46 #ç­‰ä»·äº
³rãù
 = 
	`decÜ©Ü2
('-ty³ 2‡rgs-')Õ”ãù), 
	`³rãù
()

47 
	$³rãù2
()

48 
´št
 '==========================end'

49 
´št


52 
def
 
	$decÜ©Ü3
(
decÜ©e_¬gs
):

54 
´št
 'ç±»åˆ«3ï¼š'

55 
def
 
	$ÃwDecÜ©Ü
(
func
):

56 
´št
 'è£…é¥°å™¨å‚æ•°ä¸ºï¼š',
decÜ©e_¬gs


57 
def
 
	$šÃr_func
(*
¬gs
, **
kw¬gs
):

58 
	$func
(*
¬gs
, **
kw¬gs
)

59  
šÃr_func


60  
ÃwDecÜ©Ü


61 @
	`decÜ©Ü3
('-type 3‡rgs-')

62 
def
 
	$³rãù3
(
Çme
):

63 
´št
 '³rãù mª who\' Çmi {0}'.
	$fÜm©
(
Çme
)

64 
´št
 '=========================='

65 #ç­‰ä»·äº
³rãù
 = 
	`decÜ©Ü2
('-ty³ 2‡rgs-')Õ”ãù), 
	`³rãù
('bifeng')

66 
	`³rãù3
('bifeng')

67 
´št
 '==========================end'

68 
´št


	@/root/grocery-shop/language/python/exceptOperator/exceptadorner.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
sys


4 
impÜt
 
Œaûback


5 
impÜt
 
loggšg


7 
def
 
	$exû±iÚC©ch
(
func
,*
¬gs
,**
kw
):

9 
exc_ty³
æ˜¯æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹

10 
exc_v®ue
æ˜¯å¼‚å¸¸å€¼ä¿¡æ¯

11 
exc_tb
æ˜¯ä¸€ä¸ª
Œaûback
å¯¹è±¡ï¼Œæ›¿æ¢ä»¥å‰çš„
sys
.
exc_Œaûback
å€¼

13 
def
 
	$šÃrFunc
(*
¬gs
,**
kw
):

14 
Œy
:

15  
	$func
(*
¬gs
,**
kw
)

16 
exû±
 
Exû±iÚ
,
msg
:

18 
exc_ty³
, 
exc_v®ue
, 
exc_tb
 = 
sys
.
	$exc_šfo
()

19 
loggšg
.
	`”rÜ
("å‚æ•°ï¼š{0}-{1}".
	$fÜm©
(
¬gs
, 
kw
))

20 
loggšg
.
	`”rÜ
("å¼‚å¸¸ç±»å‹:%s"%
sys
.
exc_ty³
)

21 
loggšg
.
	`”rÜ
("å¼‚å¸¸å€¼:%s"%
sys
.
exc_v®ue
)

22 
ŒaûLi¡
 = 
Œaûback
.
	$exŒaù_tb
(
exc_tb
)

23 
fe
,
lš’o
,
funùiÚ
,
‹xt
 
š
 
ŒaûLi¡
:

24 
logInfo
 = "%s\t%s\t%s\t%s\t%s"%(

25 
fe
,
lš’o
,
funùiÚ
,

26 
‹xt
, 
msg
)

27 
loggšg
.
	$”rÜ
(
logInfo
)

29  
šÃrFunc


32 
şass
 
	$Te¡Exû±C©ch
(
objeù
):

33 
def
 
	$__š™__
(
£lf
):

34 
£lf
.
my¡ršg
 = 'This isest forƒxcept Catch'

36 @
exû±iÚC©ch


37 
def
 
	`¿i£Exû±
(
£lf
, 
msg
, 
Çme
='biãng', 
age
='26'):

39 
¿i£
 
	`Exû±iÚ
('å“‡å“ˆå“ˆ')

41 
__Çme__
 == '__main__':

43 
impÜt
 
os


44 
´št
 
__fe__


45 
´št
 
os
.
·th
.
	`¥l™ext
(os.·th.
	$ba£Çme
(
__fe__
))

46 
‹¡Objeù
 = 
	$Te¡Exû±C©ch
()

47 
‹¡Objeù
.
	`¿i£Exû±
('Perfect')

	@/root/grocery-shop/language/python/exceptOperator/exceptadorner2.py

1 
def
 
	$decÜ©Ü_wh™h_·¿ms_ªd_func_¬gs
(
¬g_of_decÜ©Ü
):

2 
´št
 '11111111111111'

3 
def
 
	$hªdË_func
(
func
):

4 
´št
 '2222222222'

5 
def
 
	$hªdË_¬gs
(*
¬gs
, **
kw¬gs
):

6 
´št
 '333333333333333'

7 
´št
 "begin"

8 
	$func
(*
¬gs
, **
kw¬gs
)

9 
´št
 "end"

10 
´št
 
¬g_of_decÜ©Ü
, 
func
, 
¬gs
,
kw¬gs


11  
hªdË_¬gs


12  
hªdË_func


14 
def
 
	$decÜ©Ü_wh™h_·¿ms_ªd_func_¬gs1
(
¬g_of_decÜ©Ü
):

15 
´št
 '11111111111111'

16 
def
 
	$hªdË_func
(
func
, *
¬gs
, **
kw¬gs
):

17 
´št
 '333333333333333'

18 
´št
 "begin"

19 
	$func
(*
¬gs
, **
kw¬gs
)

20 
´št
 "end"

21 
´št
 
¬g_of_decÜ©Ü
, 
func
, 
¬gs
,
kw¬gs


22  
hªdË_func


24 
def
 
	$decÜ©Ü_‹¡1
(
func
):

25 
def
 
	$hªdË_func
(*
¬gs
, **
kw¬gs
):

26 
´št
 'begin'

27 
	$func
(
¬gs
, 
kw¬gs
)

28 
´št
 'end'

29  
hªdË_func


31 
şass
 
	$Te¡A
(
objeù
):

32 
def
 
	$__š™__
(
£lf
):

33 
£lf
.
_¡r
 = '123'

35 @
	`decÜ©Ü_wh™h_·¿ms_ªd_func_¬gs
("123")

36 
def
 
	$foo4
(
£lf
, 
a
, 
b
=2):

37 
´št
 "Content"

39 
impÜt
 
pdb


40 
pdb
.
	$£t_Œaû
()

41 
‹¡A
 = 
	$Te¡A
()

42 
‹¡A
.
	`foo4
(1, 
b
=3)

	@/root/grocery-shop/language/python/exceptOperator/excepthookTest.py

1 #codšg:
utf
-
job


5 
impÜt
 
sys


6 
impÜt
 
Œaûback


8 
def
 
	$foo
(
exùy³
, 
v®ue
, 
tb
):

9 
´št
 'My Error Information'

10 
´št
 'Ty³:', 
exùy³


11 
´št
 'V®ue:', 
v®ue


12 
´št
 'T¿ûback:', 
tb


14 
def
 
	$‹¡Exû±
():

17 
__Çme__
 == '__main__':

19 #å¯¹å…¨å±€å¼‚å¸¸æ•æ‰å‡½æ•°çš„
ov”ride


20 
sys
.
exû±hook
 = 
foo


21 
	`‹¡Exû±
()

	@/root/grocery-shop/language/python/exceptOperator/try-except-else.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-
job


4 
def
 
	$A
():

5 
Œy
:

6 
´št
 "xx"

8 
exû±
:

9 
´št
 "err"

11 
´št
 "---"

14 
__Çme__
=='__main__':

15 
	`A
()

	@/root/grocery-shop/language/python/exceptOperator/try-finally.py

1 #codšg:
utf
-
job


3 
	gŒy
/
	gfš®ly
æµ‹è¯•

5 
impÜt
 
os


6 
impÜt
 
sys


8 
def
 
	$ex™Fš®ly
():

10 1, 
sys
.
	`ex™
(0)åœ¨
pythÚ
ä¸­æŠ›å‡º
Sy¡emEx™
å¼‚å¸¸ï¼Œæ‰€ä»¥

11 ä»»ä½•
fš®ly
è¯­å¥ä»æ—§ä¼šæ‰§è¡Œï¼Œä¾‹å­

12 2, 
os
.
	`_ex™
(0)åˆ™ä¼šç›´æ¥æ‰§è¡Œé€€å‡ºå‡½æ•°

14 
Œy
:

15 
sys
.
	$ex™
(0)

16 
exû±
 
Sy¡emEx™
, 
msg
:

17 
´št
 'Caughˆsy¡emex™, msg:%s'%
msg


18 
fš®ly
:

19 
´št
 'Finallyƒxecute. Well coll!'

21 
Œy
:

22 
os
.
	$_ex™
(0)

23 
exû±
 
Sy¡emEx™
, 
msg
:

24 
´št
 '1Caughˆsy¡emex™, msg:%s'%
msg


25 
fš®ly
:

26 
´št
 '1Finallyƒxecute. Well coll!'

28 
__Çme__
 == '__main__':

30 
	`ex™Fš®ly
()

	@/root/grocery-shop/language/python/fileOperator/createFileTest.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
	gos


6 #ü—‹ 
a
 
Ãw
 
fe


7 
	gfd
 = 
İ’
('/tmp/createTest', 'w')

8 
	gfd
.
şo£
()

	@/root/grocery-shop/language/python/fileOperator/dirDfsTest.py

1 #codšg:
utf
-
job


3 1ï¼Œ
	gdfs
--é€’å½’éå†ï¼Œ
Œav”£d
 
	g»cursiv–y


4 2ï¼Œåˆ©ç”¨
	gos
.
	gw®k
æ‰“å°è¾“å‡ºæŸä¸€ä¸ªæŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶

6 
impÜt
 
os


8 
def
 
	$»cur£P©h
(
·th
):

10 æœ¬èº«ä¸ä¼šå¯¹
·th
è¿›è¡Œç»å¯¹å€¼åŒ–ï¼Œ

12 @
roÙ·th
: æ•´ä¸ª
·th
çš„èµ·å§‹æ ¹è·¯å¾„

13 @
dœÇmes
ï¼šæ‰€æœ‰çš„ç›®å½•é¡¹

14 @
f’ames
ï¼šæ‰€æœ‰çš„æ–‡ä»¶é¡¹

15 å‡½æ•°
w®k
æœ¬èº«é€çº§éå†ï¼Œä¸€å±‚å±‚è¿›å…¥

17 
roÙ·th
, 
dœÇmes
, 
f’ames
 
š
 
os
.
	$w®k
(
·th
):

18 
´št
 
roÙ·th
 + "/"

19 
memo
 
š
 
dœÇmes
:

20 
´št
 
memo
 + "/"

22 
memo
 
š
 
f’ames
:

23 
´št
 
memo


26 
__Çme__
 == '__main__':

28 
	`»cur£P©h
('../webOperator')

	@/root/grocery-shop/language/python/fileOperator/fileLockTest.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
fú


4 
impÜt
 
	gos
, 
time


6 
def
 
	$nÜm®Fe
():

8 
FILE
 = "counter.txt"

10 
nÙ
 
os
.
·th
.
	$exi¡s
(
FILE
):

11 #ü—‹ 
the
 
couÁ”
 
fe
 
™
 
dÛ¢
'tƒxist

12 
fe
 = 
	`İ’
(
FILE
, "w")

13 
fe
.
	`wr™e
("0")

14 
fe
.
	$şo£
()

16 
i
 
š
 
	$¿nge
(20):

17 
fe
 = 
	`İ’
(
FILE
, "r+"è#ç”±äº
æock
ç”Ÿæˆçš„æ˜¯åŠå‘Šé”ï¼Œä¸èƒ½é˜»æ­¢è¿›ç¨‹å¯¹æ–‡ä»¶çš„æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥æ­£å¸¸æ‰“å¼€æ–‡ä»¶

19 
fú
.
	`æock
(
fe
.
	`f’o
(), fú.
LOCK_EX
)

20 
´št
 'acquire†ock'

21 
couÁ”
 = (
fe
.
	`»adlše
()) + 1

22 
fe
.
	$£ek
(0)

23 
fe
.
	`wr™e
(
	$¡r
(
couÁ”
))

24 
´št
 
os
.
	`g‘pid
(), "=>", 
couÁ”


25 
time
.
	$¦“p
(2)

26 
fe
.
	$şo£
(è#uÆock 
the
 
fe


27 
´št
 'release†ock'

29 
def
 
	$DœeùÜyFe
():

31 
FILE
 = "testDirectory"

33 
nÙ
 
os
.
·th
.
	$exi¡s
(
FILE
):

34 
os
.
	$mkdœs
(
FILE
)

36 
i
 
š
 
	$¿nge
(20):

38 
fú
.
	`æock
(
fe
.
	`f’o
(), fú.
LOCK_EX
)

39 
´št
 'acquire†ock'

40 
couÁ”
 = (
fe
.
	`»adlše
()) + 1

41 
fe
.
	$£ek
(0)

42 
fe
.
	`wr™e
(
	$¡r
(
couÁ”
))

43 
´št
 
os
.
	`g‘pid
(), "=>", 
couÁ”


44 
time
.
	$¦“p
(2)

45 
fe
.
	$şo£
(è#uÆock 
the
 
fe


46 
´št
 'release†ock'

49 
__Çme__
 == '__main__':

51 
	`nÜm®Fe
()

	@/root/grocery-shop/language/python/fileOperator/fileSortTest.py

1 #!/
u¤
/
bš
/
pythÚ


2 #-*- 
codšg
: 
utf
-
job
 -*-

4 
impÜt
 
sys


5 
impÜt
 
os


6 
impÜt
 
¡©


8 
def
 
sÜtdœ
(
·th
, 
sÜt_cÚd
 = 'mtime', 
sÜt_f‹r
 = 
NÚe
, 
»v”£
 = 
True
, 
ab¥©h
 = True, 
Úlyâ
 = True, 
po¡fix
 = None):

10 
sÜt
 
dœ
 
by
 
give
 
cÚd™iÚ
 & 
f‹r


12 :
·¿m
 
·th
: 
dœ
…ath

13 :
·¿m
 
sÜt_cÚd
:

14 
ùime
: 
ü—‹
 
time


15 
mtime
: 
Ï¡
 
modify
 
time


16 
©ime
:‡time

17 
size
: 
fe
 size

18 :
·¿m
 
sÜt_f‹r
:

19 
funùiÚ
 
to
 
f‹r


20 1: 
Úly
 
fe


21 2: 
Úly
 
dœ


22 3: 
bÙh
 
fe
 
ªd
 
dœ


23 
func
: 
cu¡om
 
funùiÚ


24 :
·¿m
 
»v”£
:

25 
sÜt
 
»v”£d


26 :
·¿m
 
ab¥©h
:

27 
True
,  
li¡
 
w™h
 
absŞu‹
 
·th
 
of
 
fe


28 
Ü
 ,  
	g»Ïtive


29 :
·¿m
 
Úlyâ
:

30 
True
,  [
f’ame1
, 
f’ame2
, ....] 
©
 
sÜt_cÚd


31 ,  [(
f’ame
, 
os
.
¡©
(
fe
), (), ...] 
©
 
	gsÜt_cÚd


34 [(
f’ame
, 
os
.
¡©
(
fe
), (), ...] 
©
 
	gsÜt_cÚd


37 #sÜˆ
cÚd™iÚ


38 
	gsÜt_cÚd
 == "mtime":

39 
f_sÜt_cÚd
 = 
Ïmbda
 
e
:e[1].
¡_mtime


40 
–if
 
sÜt_cÚd
 == "ctime":

41 
f_sÜt_cÚd
 = 
Ïmbda
 
e
:e[1].
¡_ùime


42 
–if
 
sÜt_cÚd
 == "atime":

43 
f_sÜt_cÚd
 = 
Ïmbda
 
e
:e[1].
¡_©ime


44 
–if
 
sÜt_cÚd
 == "size":

45 
f_sÜt_cÚd
 = 
Ïmbda
 
e
:e[1].
¡_size


47 
f_sÜt_cÚd
 = 
Ïmbda
 
e
:e[1].
¡_mtime


49 #sÜˆ
f‹r


50 
f_sf
 = 
NÚe


51 
sÜt_f‹r
 =ğ
NÚe
 
Ü
 sort_filter == 3:

52 #NÚe, 
fe
 
Ü
 
dœeùÜy


53 
	gf_sf
 = 
NÚe


54 
–if
 
ty³
(
sÜt_f‹r
è=ğ
	$ty³
(
Ïmbda
 
x
:x):

55 #u£¸
defšed
 
funùiÚ


56 
f_sf
 = 
sÜt_f‹r


58 
sÜt_f‹r
 == 1:

59 #commÚ 
fe


60 
f_sf
 = 
Ïmbda
 
e
: 
¡©
.
	`S_ISDIR
Ó.
¡_mode
) == 0

61 
–if
 
sÜt_f‹r
 == 2:

63 
f_sf
 = 
Ïmbda
 
e
: 
¡©
.
	$S_ISDIR
(
e
.
¡_mode
)

65 
f_sf
 = 
NÚe


67 #ià
Úlyâ
 
is
 
True
,  [
f’ame1
, 
f’ame2
, ...]

68 
Úlyâ
:

69  
	`m­
(
Ïmbda
 
e
:e[0], 
	$__sÜtdœ
(
·th
, 
f_sÜt_cÚd
, 
f_sf
, 
»v”£
, 
ab¥©h
, 
po¡fix
))

71  
	$__sÜtdœ
(
·th
, 
f_sÜt_cÚd
, 
f_sf
, 
»v”£
, 
ab¥©h
, 
po¡fix
)

73 
def
 
	$__sÜtdœ
(
·th
, 
sÜt_cÚd
, 
sÜt_f‹r
, 
»v”£
, 
ab¥©h
, 
po¡fix
):

75 
SÜt
 
a
 
dœeùÜy
 
by
 
sÜt_cÚd
.

77 
âs
 = 
os
.
	$li¡dœ
(
·th
)

78 
nÙ
 
·th
.
	`’dsw™h
('/'):

79 
·th
 =…ath + '/'

81 #m­å¯¹äº
âs
ä¸­çš„æ¯ä¸ªå‚æ•°ï¼Œè°ƒç”¨å‡½æ•°
f
ï¼Œå‡½æ•°å¼ç¼–ç¨‹

82 
a_âs
 = 
	`m­
(
Ïmbda
 
f
: 
·th
+f, 
âs
)

83 
¡s
 = 
	$m­
(
os
.
¡©
, 
a_âs
)

87 
ab¥©h
:

88 
»s
 = 
	$z
(
a_âs
, 
¡s
)

90 
»s
 = 
	$z
(
âs
, 
¡s
)

92 
n_»s
 = []

93 
e
 
š
 
»s
:

94 
sÜt_f‹r
 !ğ
NÚe
 
ªd
 
po¡fix
 != None:

95 
	$po¡fix
(
e
[0]è
ªd
 
	$sÜt_f‹r
(
e
[1]):

96 
n_»s
.
	$­³nd
(
e
)

97 
–if
 
sÜt_f‹r
 !ğ
NÚe
 
ªd
 
po¡fix
 == None:

98 
	$sÜt_f‹r
(
e
[1]):

99 
n_»s
.
	$­³nd
(
e
)

100 
–if
 
sÜt_f‹r
 =ğ
NÚe
 
ªd
 
po¡fix
 != None:

101 
	$po¡fix
(
e
[0]):

102 
n_»s
.
	$­³nd
(
e
)

104  
	$sÜ‹d
(
n_»s
, 
key
 = 
sÜt_cÚd
, 
»v”£
 =„everse)

106 
def
 
	$»moveOutD©eFe
(
fe_li¡
, 
fe_numb”
):

108 
»move
 
outd©e
 
fe


110 
li¡_Ëngth
 = 
	$Ën
(
fe_li¡
)

111 
´št
 
li¡_Ëngth


112 
fe_numb”
 > 
li¡_Ëngth
:

115 
šdex
 
š
 
	`¿nge
(
fe_numb”
-1, 
li¡_Ëngth
):

116 
os
.
	$»move
(
fe_li¡
[
šdex
])

117 
´št
 
fe_li¡
[
šdex
]

119 
def
 
	$feF‹r
(
f’ame
):

121 
F‹r
 
of
 
fe
.

123  
f’ame
.
	`’dsw™h
(".info")

125 
__Çme__
 == '__main__':

127 
Maš


129 
fe_li¡
 = 
	`sÜtdœ
('/home/‹mp/', 
po¡fix
 = 
feF‹r
)

130 
–em’t
 
š
 
fe_li¡
:

131 
´št
 
–em’t


132 #»moveOutD©eFe(
fe_li¡
, 20)

	@/root/grocery-shop/language/python/fileOperator/parse.py

1 #codšg:
utf
-
job


2 #!/
u¤
/
bš
/
pythÚ


3 
impÜt
 
os


4 
impÜt
 
time


5 
impÜt
 
sys


6 
äom
 
cŞËùiÚs
 
impÜt
 
deçuÉdiù


8 
	gå
 = 
İ’
('result.output')

10 
def
 
	$
(
å
):

11 
å
.
	$£ek
(5000)

14 
lše
 = 
å
.
	$»adlše
()

15 
nÙ
 
lše
:

16 
time
.
	$¦“p
(0.1)

18 
y›ld
 
lše


20 
def
 
	$·r£_fœ¡
():

21 
d¡Diù
 = 
	$deçuÉdiù
(
£t
)

22 
d¡DiùIP
 = 
	$deçuÉdiù
(
£t
)

23 
”rÜS‘
 = 
	$£t
()

25 
”rÜFp
 = 
	`İ’
('./error', 'w')

27 
lše
 
š
 
	$
(
å
):

28 
l1
 = [
¡r1
.
	$¡r
(è
¡r1
 
š
 
lše
.
	`¥l™
('--')]

29 
	`Ën
(
l1
) < 3:

32 
nÙ
 
l1
[1] 
Ü
‚Ù†1[2] o¸'-' 
š
†1[0]:

35 
l1
[1] 
š
 
”rÜS‘
:

37 
d¡Diù
[
l1
[1]].
	$upd©e
([
l1
[2]])

38 
d¡DiùIP
[
l1
[1]].
	$upd©e
([
l1
[0]])

40 
	`Ën
(
d¡Diù
[
l1
[1]]è> 1 
ªd
†1[0] 
nÙ
 
š
 
d¡DiùIP
[l1[1]]‡nd†1[2]:

41 
´št
 'E¼Ü:key', 
l1
[1], 'v®ue:', 
d¡Diù
[l1[1]], 'newIp:',†1[0]

42 
´št
 
d¡Diù
[
l1
[1]]

43 
´št
 
d¡DiùIP
[
l1
[1]]

44 
”rÜS‘
.
	$upd©e
([
l1
[1]])

45 
”rÜFp
.
	$wr™–šes
(
l1
[1])

47 
”rÜFp
.
	$şo£
()

48 
å
.
	$şo£
()

51 
def
 
	$·r£_£cÚd
():

52 
d¡Diù
 = 
	$deçuÉdiù
(
£t
)

53 
d¡DiùIP
 = 
	$deçuÉdiù
(
£t
)

54 
”rÜS‘
 = 
	$£t
()

56 
”rÜFp
 = 
	`İ’
('./error', 'w')

58 
lše
 
š
 
	$
(
å
):

59 
l1
 = [
¡r1
.
	$¡r
(è
¡r1
 
š
 
lše
.
	`¥l™
('--')]

60 
	`Ën
(
l1
) < 3:

63 
nÙ
 
l1
[1] 
Ü
‚Ù†1[2] o¸'-' 
š
†1[0]:

66 
l1
[1] 
š
 
”rÜS‘
:

68 
d¡Diù
[
l1
[1]].
	$upd©e
([
l1
[2]])

69 
d¡DiùIP
[
l1
[1]].
	$upd©e
([
l1
[0]])

71 
	`Ën
(
d¡Diù
[
l1
[1]]è> 1 
ªd
†1[2]:

72 
´št
 'E¼Ü:key', 
l1
[1], 'v®ue:', 
d¡Diù
[l1[1]], 'newIp:',†1[0]

73 
´št
 
d¡Diù
[
l1
[1]]

74 
´št
 
d¡DiùIP
[
l1
[1]]

75 
”rÜS‘
.
	$upd©e
([
l1
[1]])

76 
”rÜFp
.
	$wr™–šes
(
l1
[1])

78 
”rÜFp
.
	$şo£
()

79 
å
.
	$şo£
()

81 
	`·r£_£cÚd
()

	@/root/grocery-shop/language/python/fileOperator/readBigFile.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utfjob


3 
impÜt
 
	gth»adšg
 #è½½å…¥å¤šçº¿ç¨‹æ¨¡å—

4 
impÜt
 
	gtime
 #è½½å…¥æ—¶é—´æ¨¡å—

5 
impÜt
 
	gos
 #è½½å…¥osæ¨¡å—

6 
impÜt
 
	gshut
 #è½½å…¥shutilæ¨¡å—

7 
impÜt
 
	g»
 #è½½å…¥reæ­£åˆ™æ¨¡å—

9 
	gfuhao
=
os
.
lše£p
 #æ¢è¡Œç¬¦

10 
¡¬t_time
=(
time
.
¡ráime
('%H%M%S')) #æ‰§è¡Œç¨‹åºå¼€å§‹æ—¶é—´

11 
´št
 
¡¬t_time


12 
def
 
	$couÁ_ıu_heshu
(): #ç»Ÿè®¡
ıu
æ ¸æ•°å‡½æ•°

13 
fe
=
	`İ’
('/proc/cpuinfo')

14 
ıu_sum
=[]

15 
lše
 
š
 
fe
.
	$»adlšes
():

16 
ıu_he
=
»
.
	`fšd®l
('^´oûssÜ',
lše
)

17 
	`Ën
(
ıu_he
)==1:

18 
ıu_sum
.
	$­³nd
(
ıu_he
)

21 
fe
.
	$şo£
()

22  
	$Ën
(
ıu_sum
è#è¿”å›
ıu
å‡½æ•°

24 
def
 
	$couÁ_memÜy_size
(): #ç»Ÿè®¡ç³»ç»Ÿå†…å­˜å¤§å°å‡½æ•°

25 
mem_sum
=(
os
.
	`pİ’
("ä“ -m|awk '{´šˆ$2}'|£d -À'2p'").
	`»adlše
().
	$¡r
()è#ç»Ÿè®¡å†…å­˜çš„
sh–l


26  
mem_sum
 #è¿”å›å†…å­˜å¤§å°

28 
def
 
	$ngšx_log_ãnge
(): #å› 
ngšx
æ—¥å¿—å¤ªå¤§ï¼Œéœ€è¦æŒ‰500
M
åˆ†å‰²ï¼Œå»ºç«‹æ­¤å‡½æ•°è¿›è¡Œåˆ†å‰²æ—¥å¿—

29 
os
.
·th
.
	`exi¡s
('/d©a/logs/ngšx_tmp/')!=
True
: #åˆ†å‰²æ—¥å¿—çš„ä¸´æ—¶ç›®å½•

30 
os
.
	`makedœs
('/data/logs/nginx_tmp/')

31 
os
.
·th
.
	`exi¡s
('/d©a/logs/ngšx_tmp_bšç/')!=
True
: #å¹¶å‘ç›®å½•

32 
os
.
	`makedœs
('/data/logs/nginx_tmp_binfa/')

33 
os
.
·th
.
	`exi¡s
('/d©a/logs/ngšx_tmp_txt01/')!=
True
: #timeè®°å½•
txt
ç›®å½•

34 
os
.
	`makedœs
('/data/logs/nginx_tmp_txt01/')

35 
os
.
·th
.
	`exi¡s
('/d©a/logs/ngšx_tmp_txt02/')!=
True
: #u¾è®°å½•
txt
ç›®å½•

36 
os
.
	`makedœs
('/data/logs/nginx_tmp_txt02/')

37 
os
.
·th
.
	`exi¡s
('/d©a/logs/ngšx_tmp_chuli/')!=
True
: #å¤„ç†æ‰€æœ‰
txt
ç›®å½•

38 
os
.
	`makedœs
('/data/logs/nginx_tmp_chuli/')

39 
ngšx_log_Çme
=
os
.
	`li¡dœ
('/d©a/logs/ngšx_log')[0].
	$¡r
() #åˆ‡å‰²æ—¥å¿—å

40 
ngšx_fe
='/d©a/logs/ngšx_log/%s' %
ngšx_log_Çme
 #åˆ‡å‰²æ—¥å¿—ååŠè·¯å¾„

41 
fe
=
	$İ’
(
ngšx_fe
) #nginxæ—¥å¿—æ–‡ä»¶è·¯å¾„

42 
sizehšt
=(
	`couÁ_memÜy_size
(è/ 
	`couÁ_ıu_heshu
(è* 0.5 * 1024 * 1024è#æ­¤æ•°å­—æ˜¯æŒ‰å­—èŠ‚è¿›è¡Œè®¡ç®—ï¼Œè¿™é‡Œå¤§å°ä¸ºå†…å­˜é™¤ä»¥
ıu
æ ¸æ•°å‰©ä»¥0.5å¾—åˆ°çš„ç»“æœä¸º500
M


43 
pos™iÚ
=0 #å½“å‰ä½ç½®ä¸º0

44 
fe_num
=1 #åˆ†å‰²æ–‡ä»¶åé»˜è®¤åŠ 1

45 
True
: #å½“æ¡ä»¶ä¸ºçœŸæ‰§è¡Œï¼Œä¸ºå‡é€€å‡ºã€‚

46 
lšes
 = 
fe
.
	$»adlšes
(
sizehšt
) #è¯»æ–‡ä»¶

47 
fe_Çme
='/d©a/logs/ngšx_tmp/dd_acûss%d' %
fe_num
 #åˆ†å‰²æˆåŠŸçš„æ–‡ä»¶å

48 
fe01
=
	`İ’
(
fe_Çme
,'w') #å†™æ–‡ä»¶

49 
fe01
.
	$wr™–šes
(
lšes
è#æŠŠè¯»å–çš„å•ä¸ª1
G
æ–‡ä»¶å†™åˆ°æ–‡ä»¶åä¸­

50 
fe
.
	`‹Î
(è- 
pos™iÚ
 > 0: #å¦‚æœåˆ†å‰²çš„ä½ç½®å¤§äºé»˜è®¤ä½ç½®å°±ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™å°±é€€å‡ºã€‚

51 
pos™iÚ
 = 
fe
.
	$‹Î
() #æ›¿æ¢ä½ç½®

52 
fe_num
=file_num+1

56 
fe
.
	$şo£
()

57 
fe01
.
	$şo£
()

58 
os
.
	$»move
(
fe_Çme
)

59 
time
.
	$¦“p
(300)

61 
def
 
	$ngšx_log_time_couÁ
(
fe_Çme01
): #nginxåˆ†ææ—¥å¿—å‡½æ•°

62 
fe_Çme
='/d©a/logs/ngšx_tmp_bšç/%s' %
fe_Çme01
 #å¹¶å‘æ—¥å¿—å

63 
fe_txt
='/d©a/logs/ngšx_tmp_txt01/%s.txt' %
fe_Çme01
 #æ‰§è¡Œ
sh–l
ç»“æœä¿å­˜ç›®å½•

64 
cmd
="awk '{´šˆ$4}' %s|awk -F / '{´šˆ$NF}'|awk -F : '{´šˆ$2$3$4$5}' 2>/dev/nuÎ|sÜˆ2>/dev/nuÎ|uniq -ø2>/dev/nuÎ|sÜˆ-Ä 2>/dev/nuÎ|h—d -À1 > %s" %(
fe_Çme
,
fe_txt
) #åˆ†æè„šæœ¬

65 
os
.
	$sy¡em
(
cmd
è#æ‰§è¡Œ
sh–l
å‘½ä»¤

66 
fuhao_cmd
='%s' %
fuhao


67 
f
=
	$İ’
(
fe_txt
)

68 
f1
=
	`İ’
('/data/logs/nginx_tmp_chuli/time_sum.txt','a')

69 
lše
 
š
 
f
.
	$»adlšes
():

70 
time_sšgË_max
ğ
lše
.
	`¥l™
()[0] #å•ä¸ªæ–‡ä»¶è¿æ¥æ•°

71 
f1
.
	$wr™–šes
(
time_sšgË_max
)

72 
f1
.
	$wr™e
(
fuhao_cmd
)

73 
f
.
	$şo£
()

74 
f1
.
	$şo£
()

76 
def
 
	$ngšx_log_u¾_couÁ
(
fe_Çme01
): #nginxåˆ†ææ—¥å¿—å‡½æ•°

77 
fe_Çme
='/d©a/logs/ngšx_tmp_bšç/%s' %
fe_Çme01
 #å¹¶å‘æ—¥å¿—å

78 
fe_txt
='/d©a/logs/ngšx_tmp_txt02/%s.txt' %
fe_Çme01
 #æ‰§è¡Œ
sh–l
ç»“æœä¿å­˜ç›®å½•

79 
cmd
="awk '{´šˆ$7}' %  2>/dev/nuÎ|sÜˆ2>/dev/nuÎ|uniq -ø2>/dev/nuÎ|sÜˆ-º 2>/dev/nuÎ|h—d -À200 > % " %(
fe_Çme
,
fe_txt
) #åˆ†æè„šæœ¬

80 
os
.
	$sy¡em
(
cmd
è#æ‰§è¡Œ
sh–l
å‘½ä»¤

81 
fuhao_cmd
='%s' %
fuhao


82 
f
=
	$İ’
(
fe_txt
)

83 
f1
=
	`İ’
('/data/logs/nginx_tmp_chuli/url_sum.txt','a')

84 
lše
 
š
 
f
.
	$»adlšes
(): #æŠŠ
u¾_¡©us
é‡Œé¢æ¯ä¸€è¡Œå€¼ä»¥åˆ—è¡¨æ–¹æ³•å¢åŠ åˆ°
u¾_couÁ
åˆ—è¡¨é‡Œé¢

85 
f1
.
	`wr™–šes
(
lše
.
	$¡r
())

86 
f1
.
	$wr™e
(
fuhao_cmd
)

87 
f
.
	$şo£
()

88 
f1
.
	$şo£
()

90 
def
 
	$dxc_ÿÎ_time_couÁ
(): #å¤šçº¿ç¨‹è°ƒç”¨åˆ†ææ—¥å¿—å‡½æ•°

91 
fe_Çme_»ad
=[] #æ–‡ä»¶åè¯»å–åˆ—è¡¨

92 
f
=
os
.
	`li¡dœ
('/d©a/logs/ngšx_tmp_bšç/'è#æ˜¾ç¤º
d©a
/
logs
/
ngšx_tmp
/ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶

93 
»ad_f’ame
 
š
 
f
:

94 
f’ame_chuªÿn
=
»ad_f’ame
.
	$¡r
() #å•ä¸ªæ–‡ä»¶å

95 
f’ame
=
th»adšg
.
	`Th»ad
(
rg‘
=
ngšx_log_time_couÁ
,
¬gs
=(
f’ame_chuªÿn
,)) #å»ºç«‹å¤šçº¿ç¨‹

96 
fe_Çme_»ad
.
	$­³nd
(
f’ame
è#æ·»åŠ çº¿ç¨‹åˆ°
fe_Çme_»ad
åˆ—è¡¨

97 
f’ame_sum
=
	`¿nge
(
	$Ën
(
fe_Çme_»ad
)) #ç»Ÿè®¡æ–‡ä»¶åæ•°é‡

98 
lše
 
š
 
f’ame_sum
:

99 
fe_Çme_»ad
[
lše
].
	$¡¬t
() #å¯åŠ¨çº¿ç¨‹

100 
lše
 
š
 
f’ame_sum
:

101 
fe_Çme_»ad
[
lše
].
	$još
() #ç­‰å¾…å¤šçº¿ç¨‹ç»“æŸåï¼Œå°±ç»“æŸè¿›ç¨‹ã€‚

103 
def
 
	$dxc_ÿÎ_u¾_couÁ
(): #å¤šçº¿ç¨‹è°ƒç”¨åˆ†ææ—¥å¿—å‡½æ•°

104 
fe_Çme_»ad
=[] #æ–‡ä»¶åè¯»å–åˆ—è¡¨

105 
f
=
os
.
	`li¡dœ
('/d©a/logs/ngšx_tmp_bšç/'è#æ˜¾ç¤º
d©a
/
logs
/
ngšx_tmp
/ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶

106 
»ad_f’ame
 
š
 
f
:

107 
f’ame_chuªÿn
=
»ad_f’ame
.
	$¡r
() #å•ä¸ªæ–‡ä»¶å

108 
f’ame
=
th»adšg
.
	`Th»ad
(
rg‘
=
ngšx_log_u¾_couÁ
,
¬gs
=(
f’ame_chuªÿn
,)) #å»ºç«‹å¤šçº¿ç¨‹

109 
fe_Çme_»ad
.
	$­³nd
(
f’ame
è#æ·»åŠ çº¿ç¨‹åˆ°
fe_Çme_»ad
åˆ—è¡¨

110 
f’ame_sum
=
	`¿nge
(
	$Ën
(
fe_Çme_»ad
)) #ç»Ÿè®¡æ–‡ä»¶åæ•°é‡

111 
lše
 
š
 
f’ame_sum
:

112 
fe_Çme_»ad
[
lše
].
	$¡¬t
() #å¯åŠ¨çº¿ç¨‹

113 
lše
 
š
 
f’ame_sum
:

114 
fe_Çme_»ad
[
lše
].
	$još
() #ç­‰å¾…å¤šçº¿ç¨‹ç»“æŸåï¼Œå°±ç»“æŸè¿›ç¨‹ã€‚

116 
def
 
	$time_couÁ_chuli
(): #timeå¤„ç†å‡½æ•°

117 
f
=
	`İ’
('/data/logs/nginx_tmp_chuli/time_sum.txt')

118 
time_max
=[]

119 
couÁ
 
š
 
f
:

120 
time_max
.
	`­³nd
((
couÁ
.
	$¡r
()))

121 
f
.
	$şo£
()

122  
	$max
(
time_max
)

124 
def
 
	$u¾_couÁ_chuli
(): #urlå¤„ç†å‡½æ•°

125 
f
=
	`İ’
('/data/logs/nginx_tmp_chuli/url_sum.txt')

126 
u¾_max
=[]

127 
couÁ
 
š
 
f
:

128 
u¾_max
.
	`­³nd
(
couÁ
.
	$¥l™
())

129 
f
.
	$şo£
()

130  
u¾_max


132 
def
 
	$wr™e_»pÜt_ema
(): #å†™æ–‡ä»¶ç”¨æ¥å‘
ema


133 
fuhao_cmd
='%s' %
fuhao


134 
time_max
=
	$time_couÁ_chuli
(è#æ¥å—
time
å¤„ç†å‡½æ•°è¿”å›çš„ç»“æœ

135 
u¾_max
=
	$u¾_couÁ_chuli
(è#æ¥å—
u¾
å¤„ç†å‡½æ•°è¿”å›çš„ç»“æœ

136 
fe
=
	`İ’
('/data/logs/nginx_log_email_tmp.txt','w')

137 
fe
.
	`wr™e
("ngšxå•ç§’çš„æœ€å¤§è¯·æ±‚æ•°ä¸º:%d" %
time_max
)

138 
fe
.
	$wr™e
(
fuhao_cmd
)

139 
fe
.
	`wr™e
('nginxè¿æ¥æ•°TOP100æ’åº')

140 
fe
.
	$wr™e
(
fuhao_cmd
)

141 
Ãw_diù
={
	}
} #å®šä¹‰ä¸€å­—å…¸ç”¨æ¥ç»Ÿè®¡è¿æ¥é‡å¤æ•°,å¾—åˆ°å­—å…¸ç»“æœä¸ºè¿æ¥åœ°å€:è¿æ¥é‡å¤æ•°

142 
i
 
š
 
u¾_max
: #éå†url_maxåˆ—è¡¨

143 
Ãw_diù
[
i
[1]] =‚ew_diù.
g‘
(i[1],0) + (i[0]) #i[1]è¡¨ç¤ºè¿æ¥åœ°å€,i[0]è¡¨ç¤ºè¿æ¥é‡å¤æ•°,new_dict[i[1]]è¡¨ç¤ºæŠŠåˆ—è¡¨ä¸­çš„åœ°å€é‡å¤æ•°ä¸åœ°å€è¿æ¥äº¤æ¢,å¦‚æœè¿æ¥ç›¸åŒï¼Œå°±ç´¯åŠ è¿æ¥é‡å¤æ•°.

144 
n_diù
 = {
	}
} #å®šä¹‰ä¸€å­—å…¸ç”¨æ¥æ¢å¤åŸæ¥çš„è¿æ¥é‡å¤æ•°:è¿æ¥åœ°å€

145 
k
 
š
 
Ãw_diù
: #éå†new_dictå­—å…¸

146 
n_diù
[
Ãw_diù
[
k
]] = k #kè¡¨ç¤ºè¿æ¥åœ°å€,
	gÃw_diù
[k]è¡¨ç¤ºè¿æ¥é‡å¤æ•°,æœ€å
	gn_diù
ç»“æœä¸ºè¿æ¥é‡å¤æ•°:è¿æ¥åœ°å€

147 
u¾_couÁ
=
sÜ‹d
(
n_diù
.
™”™ems
(),
key
=
Ïmbda
 
diù1
:diù1[0],
»v”£
=
True
) #å¯¹å­—å…¸è¿›è¡Œæ’åº

148 
lše
 
š
 
u¾_couÁ
:

149 
fe
.
wr™e
('è¿æ¥é‡å¤æ•°:')

150 
fe
.
wr™e
(
	$¡r
(
lše
[0])) #æŠŠè¿æ¥é‡å¤æ•°å†™åˆ°æ—¥å¿—ä¸´æ—¶æ–‡ä»¶

151 
fe
.
	`wr™e
(' ')

152 
fe
.
	`wr™e
('http://d.m1905.com') #å†™è¿æ¥å¤´æ–‡ä»¶

153 
fe
.
	`wr™e
(
	$¡r
(
lše
[1])) #æŠŠè¿æ¥åœ°å€å†™åˆ°æ—¥å¿—ä¸´æ—¶æ–‡ä»¶

154 
fe
.
	$wr™e
(
fuhao_cmd
)

155 
fe
.
	$şo£
()

156 
fe
=
	`İ’
('/data/logs/nginx_log_email_tmp.txt','r') #è¯»å–æ—¥å¿—ä¸´æ—¶æ–‡ä»¶

157 
row
=0

158 
fe01
=
	`İ’
('/data/logs/nginx_log_email.txt','w') #å†™æ–‡ä»¶

159 
lše
 
š
 
fe
.
	$»adlšes
():

160 
row
=row+1 #rowè¡¨ç¤ºè¡Œæ•°

161 
row
 <= 102: #è¯»å–æ–‡ä»¶åˆ°102è¡Œï¼Œå¤§äº102è¡Œå°±é€€å‡º

162 
fe01
.
	$wr™e
(
lše
)

165 
fe
.
	$şo£
()

166 
fe01
.
	$şo£
()

167 
os
.
	`»move
('/data/logs/nginx_log_email_tmp.txt') #åˆ é™¤æ—¥å¿—ä¸´æ—¶æ–‡ä»¶

168 
os
.
	`»move
('/d©a/logs/ngšx_tmp_chuli/time_sum.txt'è#åˆ é™¤
time_sum
æ–‡ä»¶

169 
os
.
	`»move
('/d©a/logs/ngšx_tmp_chuli/u¾_sum.txt'è#åˆ 
u¾_sum
æ–‡ä»¶

171 
def
 
	$rmdœ_ngšx_log_mulu
(): #æ¸…ç©ºæ—¥å¿—ç›®å½•å‡½æ•°

172 
shut
.
	`rmŒ“
('/data/logs/nginx_tmp/') #æ¸…ç©ºæ—¥å¿—ä¸´æ—¶ç›®å½•ï¼Œä¾›æ–°æ—¥å¿—å­˜æ”¾

173 
os
.
	`mkdœ
('/data/logs/nginx_tmp/')

174 
shut
.
	`rmŒ“
('/data/logs/nginx_log/') #æ¸…ç©ºæ—¥å¿—ç›®å½•ï¼Œä¾›æ–°æ—¥å¿—å­˜æ”¾

175 
os
.
	`mkdœ
('/data/logs/nginx_log')

177 
def
 
	$maš
():

178 
shut
.
	`rmŒ“
('/data/logs/nginx_tmp_chuli') #æ¸…ç©ºæ—¥å¿—ä¸´æ—¶ç›®å½•ï¼Œä¾›æ–°æ—¥å¿—å­˜æ”¾

179 
os
.
	`mkdœ
('/data/logs/nginx_tmp_chuli')

180 
ıu_he
=
	$couÁ_ıu_heshu
() #cpuæ ¸æ•°

181 
	`Ën
(
os
.
	`li¡dœ
('/data/logs/nginx_tmp/'))>0: #åŠ¨æ€ç»Ÿè®¡åˆ†å‰²æ—¥å¿—æ–‡ä»¶ä¸ªæ•°

182 
f
=
os
.
	`li¡dœ
('/data/logs/nginx_tmp/') #åŠ¨æ€ç»Ÿè®¡åˆ†å‰²æ—¥å¿—æ–‡ä»¶

183 
key
=0 #é»˜è®¤keyä¸º0

184 
key
<=
ıu_he
-1 
ªd
 key<
	$Ën
(
f
)): #å¯¹
ıu
æ ¸æ•°è¿›è¡Œå¯¹æ¯”

185 
Çme
 = '/d©a/logs/ngšx_tmp/%s' %
f
[
key
] #æ—¥å¿—æ–‡ä»¶å

186 
shut
.
	`move
(
Çme
,'/data/logs/nginx_tmp_binfa/') #ç§»åŠ¨æ—¥å¿—æ–‡ä»¶ï¼Œä¸ºäº†å‡å°‘è´Ÿè½½å¤ªé«˜

187 
key
=key+1

188 
	$dxc_ÿÎ_time_couÁ
()

189 
	$dxc_ÿÎ_u¾_couÁ
()

190 
shut
.
	`rmŒ“
('/data/logs/nginx_tmp_binfa/')

191 
os
.
	`mkdœ
('/data/logs/nginx_tmp_binfa/')

192 
shut
.
	`rmŒ“
('/data/logs/nginx_tmp_txt01/')

193 
os
.
	`mkdœ
('/data/logs/nginx_tmp_txt01/')

194 
shut
.
	`rmŒ“
('/data/logs/nginx_tmp_txt02/')

195 
os
.
	`mkdœ
('/data/logs/nginx_tmp_txt02/')

196 
	$wr™e_»pÜt_ema
()

197 
	$rmdœ_ngšx_log_mulu
()

199 
	$ngšx_log_ãnge
()

200 
	$maš
()

201 
¡İ_time
=(
time
.
	`¡ráime
('%H%M%S'))

202 
´št
 
¡İ_time


203 #os.
	`sy¡em
('/u¤/bš/pythÚ /roÙ/liu_sh–l/ngšx_log/£nd_ema.py'è#£nd_ema.
py
æŠŠç»“æœå‘é‚®ä»¶åˆ°å¼€å‘äººå‘˜

	@/root/grocery-shop/language/python/fileOperator/readFileTest.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
os


4 
impÜt
 
sys


5 
impÜt
 
time


6 
impÜt
 
Œaûback


8 
	gsys
.
	g·th
.
­³nd
(
os
.
g‘cwd
()+"/../")

10 
äom
 
	gba£·ckage
.
ba£log
 
impÜt
 
glob®Log


12 
def
 
	$exû±iÚC©ch
(
func
,*
¬gs
,**
kw
):

13 
def
 
	$šÃrFunc
(*
¬gs
, **
kw
):

14 
Œy
:

15  
	$func
(*
¬gs
, **
kw
)

16 
exû±
 
Exû±iÚ
,
msg
:

17 
ŒaûLi¡
 = 
Œaûback
.
	$exŒaù_tb
(
sys
.
exc_Œaûback
)

18 
fe
,
lš’o
, 
funúame
,
‹xt
è
š
 
ŒaûLi¡
:

19 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, \

20 "Occu¸”rÜ, func:%s,lš’o:%s, msg:%s"%(
funúame
, 
lš’o
, 
msg
))

21  
NÚe


22  
šÃrFunc


24 #@
exû±iÚC©ch


25 
def
 
	$»adNÙExi¡Fe
(
f’ame
):

27 
R—d
 
fe
 
äom
 
fd
, 
ªd
 f
was
 
»move
 
©
 
ªy
 
Úe
 
time
.

29 
fd
 = 
	`İ’
(
f’ame
, "r")

30 
fšo
 = 
os
.
	`¡©
(
f’ame
).
¡_šo


31 
True
:

32 
Œy
:

33 
‹mpio
 = 
os
.
	`¡©
(
f’ame
).
¡_šo


34 
fšo
 !ğ
‹mpio
:

35 
´št
 'xxxxxxxxxxxxxxxxxxxxxxxxxxxx'

36 
fd
.
	$şo£
()

37 
fd
 = 
	`İ’
(
f’ame
, 'r')

38 
´št
 
fd
.
	$»adlše
()

39 
time
.
	$¦“p
(5)

40 
	`exû±
 (
IOE¼Ü
,
OSE¼Ü
),
msg
:

41 
´št
 'IO”rÜ, msg:%s'%
msg


42 
time
.
	$¦“p
(2)

44 
def
 
	$»adFeByI‹r
(
f’ame
):

48 
w™h
 
	`İ’
(
f’ame
, 'r'è
as
 
f
:

49 
lše
 
š
 
f
:

50 
´št
 
lše


52 
__Çme__
 == '__main__':

55 
	`»adFeByI‹r
('./boot.log')

	@/root/grocery-shop/language/python/fileOperator/statTest.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 
impÜt
 
os


6 
def
 
	$‹¡St
(
£lf
):

	@/root/grocery-shop/language/python/ioOperator/__init__.py

	@/root/grocery-shop/language/python/ioOperator/ioNotify.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-8

4 #@
fe
 
ioNÙify
.
py


5 #@
br›f
 æµ‹è¯•
šÙify
æ¨¡å—çš„åŠŸèƒ½

6 #@
authÜ
 
uÆessbamboo


7 #@
v”siÚ
 1.0

8 #@
d©e
 2016-02-14

9 
impÜt
 
os


10 
impÜt
 
sys


11 
impÜt
 
loggšg


12 
impÜt
 
pyšÙify


14 
	g_DEFAULT_LOG_FORMAT
 = '%(asctime)s - %(name)s - %(levelname)s - %(message)s'

16 
_LOGGER
 = 
loggšg
.
	$g‘Logg”
(
__Çme__
)

19 
def
 
	$_cÚfigu»_loggšg
():

21 
_LOGGER
.
	$£tLev–
(
loggšg
.
DEBUG
)

23 
ch
 = 
loggšg
.
	$SŒ—mHªdËr
()

25 
fÜm©‹r
 = 
loggšg
.
	$FÜm©‹r
(
_DEFAULT_LOG_FORMAT
)

26 
ch
.
	$£tFÜm©‹r
(
fÜm©‹r
)

28 
_LOGGER
.
	$addHªdËr
(
ch
)

31 
f1
 = 
	`İ’
('/tmp/iotest', 'w')

34 
şass
 
	$Ev’tHªdËr
(
pyšÙify
.
ProûssEv’t
):

35 
def
 
	$my_š™
(
£lf
, 
myfd
=
sys
.
¡dout
, 
myd©a
=[]):

36 
£lf
.
_myfd
 = 
myfd


37 
£lf
.
_šdex
 = 0

38 
£lf
.
_d©a
 = 
myd©a


40 
def
 
	$´oûss_IN_MODIFY
(
£lf
, 
ev’t
):

41 
£lf
.
_d©a
 = s–f.
_myfd
.
	$»adlšes
()

42 
v®ues_Ën
 = 
	$Ën
(
£lf
.
_d©a
)

43 
v®ues_Ën
:

44 
£lf
.
_šdex
 +ğ
v®ues_Ën


45 
_LOGGER
.
	`šfo
('P©h=[%s], Lšes=[%d]', 
ev’t
.
·thÇme
, 
£lf
.
_šdex
)

48 
def
 
	$_maš
():

50 
f’ame
 = '/tmp/ioNotify.tmp'

51 
nÙ
 
os
.
·th
.
	$exi¡s
(
f’ame
):

52 
w™h
 
	`İ’
(
f’ame
, 'w'è
as
 
f
:

53 
·ss


55 
w™h
 
	`İ’
(
f’ame
, 'r'è
as
 
fd
:

56 
wm
 = 
pyšÙify
.
	$W©chMªag”
()

57 
mask
 = 
pyšÙify
.
IN_MODIFY


58 
wm
.
	$add_w©ch
(
f’ame
, 
mask
, 
»c
=
True
)

59 
my_hªdËr
 = 
	$Ev’tHªdËr
(
myfd
=
fd
)

60 
nÙif›r
 = 
pyšÙify
.
	$NÙif›r
(
wm
, 
my_hªdËr
)

61 
nÙif›r
.
	$loİ
()

62 
f1
.
	$şo£
()

64 
__Çme__
 == '__main__':

65 
	$_cÚfigu»_loggšg
()

66 
	`_maš
()

	@/root/grocery-shop/language/python/ioOperator/ioRedirect.py

1 #codšg:
utf
-
job


2 
impÜt
 
sys


3 
impÜt
 
sim¶e_süt


5 
şass
 
	g__»dœeùiÚ__
:

7 
def
 
	$__š™__
(
£lf
):

8 
£lf
.
buff
=''

9 
£lf
.
__cÚsŞe__
=
sys
.
¡dout


11 
def
 
	$wr™e
(
£lf
, 
ouut_¡»am
):

12 
£lf
.
buff
+=
ouut_¡»am


14 
def
 
	$to_cÚsŞe
(
£lf
):

15 
sys
.
¡dout
=
£lf
.
__cÚsŞe__


16 
´št
 
£lf
.
buff


18 
def
 
	$to_fe
(
£lf
, 
fe_·th
):

19 
f
=
	`İ’
(
fe_·th
,'w')

20 
sys
.
¡dout
=
f


21 
´št
 
£lf
.
buff


22 
f
.
	$şo£
()

24 
def
 
	$æush
(
£lf
):

25 
£lf
.
buff
=''

27 
def
 
	$»£t
(
£lf
):

28 
sys
.
¡dout
=
£lf
.
__cÚsŞe__


31 
__Çme__
=="__main__":

33 
´št
 "æ²¡æœ‰é‡å®šå‘ä¹‹å‰çš„¡doutç±»å‹ï¼š", 
	$ty³
(
sys
.
¡dout
)

34 
r_obj
=
	$__»dœeùiÚ__
()

35 
sys
.
¡dout
=
r_obj


37 
´št
 "å‘ç”Ÿé‡å®šå‘ä¹‹åçš„¡doutç±»å‹ï¼š", 
	$ty³
(
sys
.
¡dout
)

38 #g‘ 
ouut
 
¡»am


39 
´št
 'hello'

40 
´št
 'there'

42 #»dœeù 
to
 
cÚsŞe


43 
r_obj
.
	$to_cÚsŞe
()

45 #»dœeù 
to
 
fe


46 
r_obj
.
	`to_fe
('out.log')

48 #æush 
bufãr


49 
r_obj
.
	$æush
()

52 
r_obj
.
	`»£t
()

	@/root/grocery-shop/language/python/ioOperator/scriptPathTest.py

1 #codšg:
utf
-
job


4 1ï¼Œ
	gg‘cwd
å’Œ
	gsys
.
	g·th
ã€
	g__fe__
åŒºåˆ«

6 3ï¼Œåˆ©ç”¨
	gchdœ
æ”¹å˜å½“å‰å·¥ä½œç›®å½•

8 
impÜt
 
os


9 
impÜt
 
sys


11 
def
 
	$‹¡1
():

13 
´št
 'g‘cwd():', 
os
.
	$g‘cwd
()

14 
´št
 'sys.·th[0]:', 
sys
.
·th
[0]

15 
´št
 '__fe__:', 
os
.
·th
.
	$»®·th
(
__fe__
)

16 
´št
 'dœÇme(__fe__):', 
os
.
·th
.
	`nÜm·th
(os.·th.
	$dœÇme
(
__fe__
))

17 
´št


19 
def
 
	$‹¡3
():

21 
´št
 'g‘cwd():', 
os
.
	$g‘cwd
()

22 
os
.
	`chdœ
('/tmp/')

23 
´št
 'change directory.............'

24 
´št
 'Now, g‘cwd():', 
os
.
	$g‘cwd
()

25 
´št


28 
__Çme__
 == '__main__':

30 
´št
 '==============================test1==========================='

31 
	$‹¡1
()

32 
´št
 '==============================test3==========================='

33 
	`‹¡3
()

	@/root/grocery-shop/language/python/ioOperator/writeMsg.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #@
fe
 
wr™eMsg
.
py


4 #@
br›f
 å°†æ•°æ®å†™å…¥æŒ‡å®šæ–‡ä»¶ï¼Œ
m‘a
å¿…é¡»ä¸ºä¸€è¡Œï¼Œç”¨äºæµ‹è¯•
pyšÙify
æ¨¡å—

5 #@
authÜ
 
uÆessbamboo


6 #@
v”siÚ
 1.0

7 #@
d©e
 2016-02-14

9 #codšg:
utf
-8

10 
impÜt
 
time


12 
	gf’ame
 = '/tmp/ioNotify.tmp'

13 
šdex
 = 0

14 
w™h
 
İ’
(
f’ame
, 'w+'è
as
 
	gf
:

16 
i
 
š
 
	$¿nge
(800):

17 
šdex
 += 1

18 
f
.
	`wr™e
('Th{0}†šes.\n'.
	$fÜm©
(
šdex
))

19 
f
.
	$æush
()

20 
time
.
	$¦“p
(0.5)

21 
i
 > 100000:

	@/root/grocery-shop/language/python/kafka/consumerTest.py

1 #codšg:
utf
-
job


2 
äom
 
kafka
 
	$impÜt
 (
KafkaCÚsum”
)

3 
äom
 
kafka
.
commÚ
 
	$impÜt
 (
CÚsum”Timeout
, 
KafkaMes§ge
)

5 
def
 
	$‹¡Re¡¬t
():

7 æµ‹è¯•æŸä¸€ä¸ª
group
åœ¨æ¶ˆè´¹äº†
kafka
ä¸­çš„æ¶ˆæ¯å¹¶
comm™
ä¹‹åï¼Œæ˜¯å¦èƒ½é‡æ–°è¯»å–ï¼Ÿ

10 
tİicsLi¡
 = ['JOB_NGINX', 'JOB_BASIC', 'JOB_JMON', 'JOB_TOMCAT']

11 
brok”Li¡
 = ['10.10.90.171:9092', '10.10.job2.114:9092', '10.10.94.15:9092']

12 
groupId
 = 'job_consumer_group'

13 
kc
 = 
	`KafkaCÚsum”
(

14 *
tİicsLi¡
,

15 
ãtch_mš_by‹s
 = 1024,

16 
group_id
 = 
groupId
,

17 
boÙ¡¿p_£rv”s
 = 
brok”Li¡
,

18 
cÚsum”_timeout_ms
 = 10*1000,

19 
auto_off£t_»£t
='smallest'

21 
´št
 
kc
.
	$off£ts
()

22 
·¹™iÚ
 
š
 [0, 1, 2]:

23 
cÚsum”Msg
 = 
	`KafkaMes§ge
('JOB_BASIC', \

24 
·¹™iÚ
, 2000, 'shit', 'shit')

25 
kc
.
	$sk_dÚe
(
cÚsum”Msg
)

26 
´št
 
kc
.
	$off£ts
()

27 
kc
.
	`£t_tİic_·¹™iÚs
(

31 
impÜt
 
pdb


32 
pdb
.
	$£t_Œaû
()

34 
Œy
:

35 
cÚsum”
 
š
 
kc
:

36 
´št
 
cÚsum”


37 
´št
 
	$ty³
(
cÚsum”
)

38 
kc
.
	$sk_dÚe
(
cÚsum”
)

39 
exû±
 
CÚsum”Timeout
:

40 
kc
.
	$comm™
()

41 
´št
 'xxxxxxxxxxxxxxxxx'

44 
def
 
	$‹¡Off£t
():

46 æµ‹è¯•æŸä¸€ä¸ª
group
åœ¨è®¾ç½®
off£t
æ˜¯å¦èƒ½æŒ‡å®šä½ç½®è¯»å–ï¼Œå…¶ä¸­æ²¡æœ‰è¿›è¡Œ
comm™
æäº¤æ“ä½œ

48 
tİicsLi¡
 = ['JOB_NGINX', 'JOB_BASIC', 'JOB_JMON', 'JOB_TOMCAT', 'JOB_KV']

49 
groupId
 = 'job_consumer_group'

50 
brok”Li¡
 = ['10.10.90.171:9092', '10.10.job2.114:9092', '10.10.94.15:9092']

51 
kc
 = 
	$KafkaCÚsum”
(

52 *
tİicsLi¡
,

53 
ãtch_mš_by‹s
 = 1024,

54 
group_id
 = 
groupId
,

55 
boÙ¡¿p_£rv”s
 = 
brok”Li¡
,

56 
cÚsum”_timeout_ms
 = 10*1000

58 #off£tDiù = 
kc
.
	`off£ts
()

60 #´šˆ"comm™:", 
off£tDiù
['commit']

61 #´šˆ"sk_dÚe:", 
off£tDiù
['task_done']

62 #´šˆ"ãtch:", 
off£tDiù
['fetch']

66 #fÜ 
cÚsum”
 
š
 
kc
.
	`ãtch_mes§ges
():

67 #´šˆ
cÚsum”


68 #´šˆ
	`ty³
(
cÚsum”
)

69 #exû± 
CÚsum”Timeout
:

72 
´št
 '+++++++++++++++++++++++++++++++'

73 
kc
.
	$£t_tİic_·¹™iÚs
(*
tİicsLi¡
)

75 
Œy
:

76 
cÚsum”
 
š
 
kc
:

77 
´št
 
cÚsum”


78 
´št
 
	$ty³
(
cÚsum”
)

79 
exû±
 
CÚsum”Timeout
:

80 
´št
 'xxxxxxxxxxxxxxxxx'

82 
off£tDiù
 = 
kc
.
	$off£ts
()

83 
´št


84 
´št
 "comm™:", 
off£tDiù
['commit']

85 
´št
 "sk_dÚe:", 
off£tDiù
['task_done']

86 
´št
 "ãtch:", 
off£tDiù
['fetch']

88 
__Çme__
 == '__main__':

92 
	$‹¡Re¡¬t
()

	@/root/grocery-shop/language/python/kafka/partitionTest.py

1 #codšg:
utf
-
job


3 åŠŸèƒ½ï¼šæµ‹è¯•åœ¨å¤šä¸ªåˆ†åŒº(
	g·¹™iÚs
)æƒ…å†µä¸‹ï¼Œå‘é€å¤§è§„æ¨¡çš„æ•°æ®æ—¶ï¼Œæ˜¯å¦ä¼šè‡ªåŠ¨è´Ÿè½½

5 
impÜt
 
sys


6 
impÜt
 
Œaûback


7 
äom
 
kafka
 
impÜt
 
	gSim¶eProduûr
, 
KafkaCl›Á


9 
äom
 
	gba£·cKage
.
ba£log
 
impÜt
 
glob®Log


11 
def
 
	$exû±iÚC©ch
(
func
,*
¬gs
,**
kw
):

12 
def
 
	$šÃrFunc
(*
¬gs
, **
kw
):

13 
Œy
:

14  
	$func
(*
¬gs
, **
kw
)

15 
exû±
 
Exû±iÚ
,
msg
:

16 
ŒaûLi¡
 = 
Œaûback
.
	$exŒaù_tb
(
sys
.
exc_Œaûback
)

17 
fe
,
lš’o
, 
funúame
,
‹xt
è
š
 
ŒaûLi¡
:

18 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, \

19 "Occu¸”rÜ, func:%s,lš’o:%s, msg:%s"%(
funúame
, 
lš’o
, 
msg
))

20 
sys
.
	`ex™
(-1)

21  
šÃrFunc


23 @
exû±iÚC©ch


24 
def
 
	$·¹™iÚsLßdB®ªû
():

26 å‘é€æŒ‡å®šä¿¡æ¯åˆ°
kafka
-
tİic
ï¼ˆ
‹¡
ï¼‰ï¼Œæ­¤æ—¶ä¸º5000æ¬¡

28 
k1
 = 
	`KafkaCl›Á
('localhost:9092')

29 
´oduûr
 = 
	$Sim¶eProduûr
(
k1
)

31 
i
 
š
 
	$¿nge
(200):

32 
msg
 = 'Thi i %d¡e¡'%(
i
)

33 
msg1
 = ''

34 
j
 
š
 
	$¿nge
(2000):

35 
msg1
 = ':'.
	$još
([
msg1
, 
msg
])

36 
´oduûr
.
	`£nd_mes§ges
(
b
'‹¡', 
msg1
)

37 
´oduûr
.
	$¡İ
()

40 
__Çme__
 == '__main__':

42 
	`·¹™iÚsLßdB®ªû
()

	@/root/grocery-shop/language/python/kafka/pykafkaConsumerTest.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-
job


3 
äom
 
pykafka
 
impÜt
 
KafkaCl›Á


4 
	gş›Á
 = 
KafkaCl›Á
(
ho¡s
="devops-dev1:9193")

5 
tİic
 = 
ş›Á
.
tİics
['JOB_TEST_1']

9 
zook“³r_¡r
 = 'registry1.dubbo.host:21job1'

10 
cÚsum”
 = 
tİic
.
	$g‘_b®ªûd_cÚsum”
(

11 
auto_comm™_’abË
=
True
,

12 
zook“³r_cÚÃù
=
zook“³r_¡r
)

13 
mes§ge
 
š
 
cÚsum”
:

14 
mes§ge
 
is
 
nÙ
 
NÚe
:

15 
´št
 
mes§ge
.
off£t
, mes§ge.
v®ue


18 
__Çme__
 == '__main__':

19 
·ss


	@/root/grocery-shop/language/python/kafka/pykafkaProducerTest.py

1 #codšg:
utf
-
job


2 
impÜt
 
time


3 
impÜt
 
Œaûback


4 
äom
 
pykafka
 
impÜt
 
KafkaCl›Á


6 
	gş›Á
 = 
KafkaCl›Á
(
ho¡s
="devops-dev1:9193")

7 
´št
 
ş›Á
.
tİics


8 
tİic
 = 
ş›Á
.
tİics
['JOB_TEST_1']

11 
´oduûr
 = 
tİic
.
	$g‘_´oduûr
()

12 
i
 = 1

13 
True
:

14 
Œy
:

15 
´oduûr
.
	`´oduû
(['thi i ¨mes§ge' + 
	`¡r
(
i
)])

16 
i
 += 1

17 
time
.
	$¦“p
(0.5)

18 
exû±
 
Exû±iÚ
:

19 
´št
 
Œaûback
.
	`fÜm©_exc
()

	@/root/grocery-shop/language/python/kafka/replicaTest.py

1 #codšg:
utf
-
job


3 
	gassume0
ï¼šæµ‹è¯•åœ¨å•ä¸ªåˆ†åŒº(
	g·¹™iÚs
)ï¼Œå¤š
	g»¶iÿ
æƒ…å†µä¸‹:

5 2,å¦‚æœæŸä¸€ä¸ªäººä¸ºå…³é—­
	gËad”
ï¼Œæ˜¯å¦ä¼šè‡ªåŠ¨è´Ÿè½½ï¼Ÿ

8 
	g»¶iÿ
æ— å…³è´Ÿè½½å‡è¡¡ï¼Œä»…ä»…æ¶‰åŠé«˜å¯ç”¨æ€§ï¼Œå³å¯¹äºæ•°æ®çš„å¤åˆ¶

10 åº”è¯¥å…³æ³¨çš„æµ‹è¯•ç‚¹ï¼Œåœ¨
	gËad”
å…³é—­çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç»§ç»­
	g´oduû
æ˜¯å¦å‘ç”Ÿæ•°æ®ä¸¢å¤±ï¼Œ

11 å³
	gcÚsum”
æ˜¯å¦æœ‰æ•°æ®è¾“å‡ºï¼Ÿ

15 
	gassume1
ï¼š

16 æ˜¯å¦å› ä¸º
	gassume0
ä¸­çš„æµ‹è¯•æ¶‰åŠçš„
	gIP
åœ°å€éƒ½æ˜¯
	gloÿlho¡
ï¼Œå¯¼è‡´æ²¡æœ‰å‡ºç°é—®é¢˜ï¼Ÿ

18 0ï¼Œé™å®š
	gzook“³r
æ•°é‡ä¸º1

19 1ï¼Œä¿æŒå½“å‰
	gzook“³r
ä¸å˜ï¼Œä¿®æ”¹æ¯ä¸€ä¸ª
	gbrok”
ä¸­çš„zook“³r.
	gcÚÃù
å€¼

20 2ï¼Œåœ¨10.1.200.124ä¸Šé¢æ–°å»ºä¸¤ä¸ª
	gbrok”


25 
impÜt
 
sys


26 
impÜt
 
Œaûback


28 
äom
 
kafka
 
impÜt
 
	gSim¶eProduûr
, 
KafkaCl›Á


29 
äom
 
	gba£·ckage
.
ba£log
 
impÜt
 
glob®Log


31 
def
 
	$exû±iÚC©ch
(
func
,*
¬gs
,**
kw
):

32 
def
 
	$šÃrFunc
(*
¬gs
, **
kw
):

33 
Œy
:

34  
	$func
(*
¬gs
, **
kw
)

35 
exû±
 
Exû±iÚ
,
msg
:

36 
ŒaûLi¡
 = 
Œaûback
.
	$exŒaù_tb
(
sys
.
exc_Œaûback
)

37 
fe
,
lš’o
, 
funúame
,
‹xt
è
š
 
ŒaûLi¡
:

38 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, \

39 "Occu¸”rÜ, func:%s,lš’o:%s, msg:%s"%(
funúame
, 
lš’o
, 
msg
))

40 
sys
.
	`ex™
(-1)

41  
šÃrFunc


43 @
exû±iÚC©ch


44 
def
 
	$»¶iÿLßdB®ªû
():

46 å‘é€æŒ‡å®šä¿¡æ¯åˆ°
kafka
-
tİic
ï¼ˆ
‹¡
ï¼‰ï¼Œæ­¤æ—¶ä¸º5000æ¬¡

48 
k1
 = 
	`KafkaCl›Á
('localhost:9092')

49 
´oduûr
 = 
	$Sim¶eProduûr
(
k1
)

51 
i
 
š
 
	$¿nge
(200):

52 
msg
 = 'Thi i %d¡e¡'%(
i
)

53 
msg1
 = ''

54 
j
 
š
 
	$¿nge
(2000):

55 
msg1
 = ':'.
	$još
([
msg1
, 
msg
])

56 
´oduûr
.
	`£nd_mes§ges
(
b
'»¶iÿ-‹¡', 
msg1
)

57 
´oduûr
.
	`¡İ
()

59 @
exû±iÚC©ch


60 
def
 
	$»¶iÿLßdB®ªû1
():

62 å‘é€æŒ‡å®šä¿¡æ¯åˆ°
kafka
-
tİic
ï¼ˆ
‹¡
ï¼‰ï¼Œæ­¤æ—¶ä¸º5000æ¬¡

64 
k1
 = 
	`KafkaCl›Á
('localhost:9092')

65 
´oduûr
 = 
	$Sim¶eProduûr
(
k1
)

67 
i
 
š
 
	$¿nge
(200):

68 
msg
 = 'Thi i %d¡e¡'%(
i
)

69 
msg1
 = ''

70 
j
 
š
 
	$¿nge
(2000):

71 
msg1
 = ':'.
	$još
([
msg1
, 
msg
])

72 
´oduûr
.
	`£nd_mes§ges
(
b
'»¶iÿ-‹¡', 
msg1
)

73 
´oduûr
.
	$¡İ
()

75 
__Çme__
 == '__main__':

77 
	`»¶iÿLßdB®ªû
()

	@/root/grocery-shop/language/python/kafka/run_umi.py

1 #!/
u¤
/
bi
/
’v
 
pythÚ


2 #codšg: 
gbk


4 
impÜt
 
sys


5 
impÜt
 
os


6 
impÜt
 
sigÇl


7 
impÜt
 
time


9 
äom
 
g_log
 
impÜt
 
mylog


11 
impÜt
 
»ad_db


12 
impÜt
 
g_cÚf


13 
impÜt
 
pos™iÚ


14 
impÜt
 
commÚ


15 
impÜt
 
u£r_logš


16 
impÜt
 
u£r_mod–


17 
impÜt
 
£gm’t


18 
impÜt
 
š£¹_mod–


19 
äom
 
pykafka
 
impÜt
 
KafkaCl›Á


20 
impÜt
 
loggšg


21 
impÜt
 
	gloggšg
.
cÚfig


22 
impÜt
 
jsÚ


23 
impÜt
 
»


24 
impÜt
 
Œaûback


25 
impÜt
 
th»adšg


26 
impÜt
 
d©‘ime


27 
äom
 
	g­scheduËr
.
	gscheduËrs
.
blockšg
 
impÜt
 
BlockšgScheduËr


28 
impÜt
 
sw™ch_log


30 
	gmyš£¹
 = 
NÚe


32 
def
 
	$š™
() :

33 
glob®
 
myš£¹


35 
t0
 = 
time
.
	$time
()

36 #åŠ è½½è¯å…¸å’Œ
logš_time


37 
commÚ
.
	`š™_’v
() < 0 :

40 #è¯»å–
DB
ä¸­çš„æ•°æ®ï¼Œè½½å…¥ç¼“å­˜

41 
»ad_db
.
	`»ad_bËs
() < 0 :

44 #ä¸
xxxxx_»c
åº“å»ºç«‹è¿æ¥

45 
myš£¹
 = 
š£¹_mod–
.
	$In£¹Mod–
()

46 
myš£¹
.
	`š™_cÚn
() < 0 :

50 
pos™iÚ
.
	`»ad_pos™iÚs
() < 0 :

53 
u£_time
 = 
time
.
	`time
(è- 
t0


54 
mylog
.
	`log_nÙiû
('š™(èfšished, u£ time: %.2à£c [%.2àhours]'%(
u£_time
, use_time/3600.0))

57 
def
 
	$»c_ofæše
() :

61 
glob®
 
myš£¹


63 
t0
 = 
time
.
	$time
()

64 
mylog
.
	`log_Œaû
("begin„ec_offline")

65 
myš£¹
.
	`pšg
() != 0 :

66 
mylog
.
	`log_çl
("ping mysql failed")

70 
commÚ
.
	$»ad_logš_time
()

71 
u£r_logš
.
	`·r£_u£r_logš
() < 0 :

74 #è¯»å–
DB
ä¸­çš„æ•°æ®ï¼Œè½½å…¥ç¼“å­˜

75 
»ad_db
.
	`»ad_bËs
() < 0 :

79 
u£r_mod–
.
	`bud_mod–s
(
myš£¹
) < 0 :

82 #å°†
logš_time
å†™å…¥æ–‡ä»¶

83 
commÚ
.
	$wr™e_logš_time
(
u£r_logš
.
g_max_logš_time_št
)

85 
u£_time
 = 
time
.
	`time
(è- 
t0


86 
mylog
.
	`log_nÙiû
('rec_offline() finished, usesime: %.2f secs [%.2f hours]' % \

87 (
u£_time
, use_time/3600.0))

90 
def
 
	$»Ëa£_»sourû
() :

95 
glob®
 
myš£¹


98 
mylog
.
	`log_Œaû
('startingo„elease wordrank...')

99 
£gm’t
.
	$»Ëa£
()

100 
mylog
.
	`log_Œaû
('fšishedØ»Ëa£ wÜd¿nk: <%d> seg†šes'%(
	$Ën
(
£gm’t
.
lše2£g
)))

103 
myš£¹
.
	$şo£_cÚn
()

104 
mylog
.
	`log_Œaû
('release db connection')

106 
mylog
.
	`log_Œaû
('resource have„eleased')

108 
def
 
	$»c_štime
():

112 
glob®
 
myš£¹


114 #loggšg.
cÚfig
.
	`feCÚfig
(
g_cÚf
.
cÚf_·th
+"/logging.conf")

115 
loggšg
.
	$basicCÚfig
()

116 
mylog
.
	`log_Œaû
("begin„ec_intime");

118 
d–iv”_tİic
 = 
g_cÚf
.deliver_topic

119 
d–iv”_group
 = 
g_cÚf
.deliver_group

120 
brok”1
 = 
g_cÚf
.
d–iv”_brok”


121 
d–iv”_zook“³r
 = 
g_cÚf
.deliver_zookeeper

123 
š‹»¡_tİic
 = 
g_cÚf
.interest_topic

124 
brok”2
 = 
g_cÚf
.
š‹»¡_brok”


126 #ç”¨äºæ¥æ”¶æ¶ˆæ¯çš„
kafka
-
ş›Á


127 
ş›Á1
 = 
	$KafkaCl›Á
(
ho¡s
 = 
brok”1
)

128 
tİic1
 = 
ş›Á1
.
tİics
[
d–iv”_tİic
]

129 
cÚsum”
 = 
tİic1
.
	$g‘_b®ªûd_cÚsum”
(
cÚsum”_group
 = 
d–iv”_group
,

130 
zook“³r_cÚÃù
 = 
d–iv”_zook“³r
)

132 #ç”¨äºå‘é€æ¶ˆæ¯çš„
kafka
-
ş›Á


133 
ş›Á2
 = 
	$KafkaCl›Á
(
ho¡s
 = 
brok”2
)

134 
tİic2
 = 
ş›Á2
.
tİics
[
š‹»¡_tİic
]

135 
´oduûr
 = 
tİic2
.
	$g‘_´oduûr
()

137 #æ¥æ”¶
Üd”
æ¶ˆæ¯

138 
»ûive_num
 = 0

139 
True
:

140 
mes§ge
 = 
cÚsum”
.
	$cÚsume
()

141 
mes§ge
 
is
 
nÙ
 
NÚe
 :

142 
»ûive_num
 += 1

143 #æ¯æ¥æ”¶500æ¡æ¶ˆæ¯æäº¤ä¸€æ¬¡
off£t


144 
»ûive_num
 % 500 == 0 :

145 
cÚsum”
.
	$comm™_off£ts
()

146 
Œy
 :

147 
Üd”
 = 
jsÚ
.
	$lßds
(
mes§ge
.
v®ue
)

148 
Üd”
 :

149 
¡©us
 = 
Üd”
["orderStatus"]

150 
u£rid
 = 
Üd”
["userId"]

151 
pos™iÚid
 = 
Üd”
["positionId"]

152 
ü—‹time
 = 
Üd”
["createTime"]

153 
lše
 = "\t".
	`još
([
	`¡r
(
u£rid
),¡r(
pos™iÚid
),
ü—‹time
,
¡©us
])

154 
mylog
.
	`log_Œaû
("RECEIVE MSG: %s" % 
lše
)

155 #åªæ¶ˆè´¹çŠ¶æ€ä¸º
WAIT
å’Œ
AUTO_FILTER
çš„è®¢å•æ¶ˆæ¯

156 
¡©us
 
ªd
 
u£rid
‡nd 
pos™iÚid
‡nd 
ü—‹time
 \

157 
	`ªd
 (
¡©us
=="WAIT" 
Ü
 status=="AUTO_FILTER") :

158 
now_tuË
 = 
d©‘ime
.d©‘ime.
	`now
().
	$tim‘u¶e
()

159 
ü—‹_tu¶e
 = 
d©‘ime
.d©‘ime.
	`¡½time
(
ü—‹time
, "%Y-%m-%d %H:%M:%S").
	$tim‘u¶e
()

161 
now_tuË
[:3] =ğ
ü—‹_tu¶e
[:3]:

163 
u£r_mod–
.
	`upd©e_u£r_mod–
(
lše
, 
myš£¹
) >= 0 :

164 
mylog
.
	`log_debug
("upd©u£¸%d' š‹»¡ sucûss" % 
u£rid
)

166 
upd©‘ime
 = 
d©‘ime
.d©‘ime.
	`now
().
	`¡ráime
('%Y-%m-%d %H:%M:%S')

167 
msg
 = {"u£rid":
u£rid
,"upd©‘ime":
upd©‘ime
,"d–iv”time":
ü—‹time
}

168 
msg_¡r
 = 
jsÚ
.
	$dumps
(
msg
)

169 
´oduûr
.
	$´oduû
([
msg_¡r
])

170 
mylog
.
	`log_Œaû
("SEND MSG: %s" % 
msg_¡r
)

171 
exû±
 :

172 
mylog
.
	`log_w¬nšg
('update user interest intimeƒrror,„aisedƒxception : %s' % \

173 
Œaûback
.
	$fÜm©_exc
())

175 
__Çme__
 == '__main__' :

176 
mylog
.
	`log_Œaû
("system start")

177 
mylog
.
	`log_Œaû
('pythÚ v”siÚ is: %s' % (
sys
.
v”siÚ
.
	`»¶aû
('\n', '|')))

178 
	`š™
() < 0 :

179 
mylog
.
	`log_çl
("system init failed")

180 
sys
.
	$ex™
()

182 
thd
 = 
th»adšg
.
	$Th»ad
(
rg‘
 = 
»c_štime
,)

183 
thd
.
	$£tD«mÚ
(
True
)

184 
thd
.
	$¡¬t
()

186 #ç”¨
­scheduËr
çš„é—®é¢˜åœ¨äºï¼šåœ¨ä»»åŠ¡å¼€å§‹è°ƒåº¦çš„æ—¶é—´ç‚¹ä¸Šå¿…é¡»ä¿è¯ä¸»çº¿ç¨‹å’Œå…¶ä»–å­çº¿ç¨‹å·²å…¨éƒ¨è¿è¡Œå®Œæ¯•ï¼Œä¸å ç”¨
CPU


187 #æ¯å¤©3:15è¿›è¡Œ
»c_ofæše


188 
scheduËr
 = 
	$BlockšgScheduËr
()

189 
scheduËr
.
	`add_job
(
»c_ofæše
,'üÚ', 
hour
='3',
mšu‹
='15')

190 
scheduËr
.
	`add_job
(
sw™ch_log
.
sw™chLog
,'üÚ', 
hour
='0')

191 
Œy
:

192 
scheduËr
.
	$¡¬t
()

193 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

194 
mylog
.
	`log_çl
("add scheduË¸job„ai£ƒxû±iÚ: %s" % 
Œaûback
.
	$fÜm©_exc
())

195 
scheduËr
.
	`shutdown
()

	@/root/grocery-shop/language/python/kafka/simpleConsumer.py

1 #/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
sys


4 
impÜt
 
time


6 
äom
 
kafka
 
impÜt
 
KafkaCÚsum”


7 
äom
 
	gkafka
.
commÚ
 
	$impÜt
 (

8 
UnknownTİicOrP¬t™iÚE¼Ü
, 
L—d”NÙAvaabËE¼Ü
,

9 
KafkaUÇvaabËE¼Ü
,

12 
def
 
	$sim¶eCÚsum”
():

14 @
funùiÚ
:æµ‹è¯•åŸºæœ¬çš„æ¶ˆè´¹è€…

15 @
tİic
ï¼šå•ä¸€
»¶iÿ
ï¼Œä¸€æ—¦å¯¹åº”çš„
brok”s
å…³é—­åï¼Œæ’é™¤çš„å¼‚å¸¸ä¿¡æ¯

16 @
£rv”s
:è®¾ç½®å¤šä¸ª
brok”s
ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•ç”¨é€”

18 #TØ
cunsume
 
mes§ges


19 
Œy
:

20 
cÚsum”
 = 
	`KafkaCÚsum”
('JOB_TEST_1', \

21 
boÙ¡¿p_£rv”s
=['devops-dev1:9193', 'devops-dev1:9194'])

22 
exû±
 
KafkaUÇvaabËE¼Ü
,
msg
:

23 
´št
 'KafkaUÇvaabËE¼Ü:',
msg


24 
sys
.
	`ex™
(-1)

26 
True
:

27 
Œy
:

28 
mes§ge
 
š
 
cÚsum”
:

30 
mes§ge
 
v®ue
 
is
 
¿w
 
by‹
 
¡ršg


31 @
tİic
:è¯é¢˜åç§°

32 @
·¹™iÚ
:æ¶ˆæ¯å·(æ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½æ˜¯å•ä¸€çš„ä¸ªä½“)

33 @
off£t
:æ¶ˆæ¯åœ¨
tİic
-
·¹™iÚ
ä¸­çš„åç§»é‡

34 @
v®ue
:åŸå§‹å­—èŠ‚(
¿w
 
by‹s
)

36 
	`´št
("TOPIC:%s Partition:%d offset%d key=%s value=%s" % (\

37 
mes§ge
.
tİic
, mes§ge.
·¹™iÚ
,

38 
mes§ge
.
off£t
, mes§ge.
key
,

39 
mes§ge
.
v®ue
))

40 
	`exû±
 (
KafkaUÇvaabËE¼Ü
,
L—d”NÙAvaabËE¼Ü
), 
msg
:

41 
´št
 'Occu¸KafkaUÇvaabËE¼Ü, msg:', 
msg


42 
time
.
	$¦“p
(10)

46 
def
 
	$sim¶eCÚsum”1
(
tİics
):

48 @
funùiÚ
:æµ‹è¯•åŸºæœ¬çš„æ¶ˆè´¹è€…

49 @
tİic
ï¼šå¤šä¸ª
»¶iÿ
ï¼ŒæŸä¸€ä¸ª
brok”s
å…³é—­åï¼Œæ˜¯å¦æ­£å¸¸è¾“å‡º

50 @
£rv”s
:è®¾ç½®å¤šä¸ª
brok”s


51 @
ãtch_mš_by‹s
ï¼šæ¯ä¸€æ¬¡è¯·æ±‚çš„æœ€å°å­—èŠ‚

52 @
group_id
ï¼šæ¶ˆè´¹è€…ç»„
ID
ï¼Œç”¨äº
off£t
çš„è®°å½•

53 @
auto_comm™_’abË
: å®šæ—¶è®°å½•
off£t
åˆ°
kafka
 
şu¡”


55 #TØ
cunsume
 
mes§ges


56 
Œy
:

57 
cÚsum”
 = 
	`KafkaCÚsum”
(

58 *
tİics
,

59 
ãtch_mš_by‹s
 = 1024,

60 
group_id
 = 'job_consumer_group',

62 #auto_comm™_’abË = 
True
,

63 
boÙ¡¿p_£rv”s
=['devops-dev1:9193', 'devops-dev1:9194'])

64 
exû±
 
KafkaUÇvaabËE¼Ü
,
msg
:

65 
´št
 'KafkaUÇvaabËE¼Ü:',
msg


66 
sys
.
	`ex™
(-1)

68 #g‘ 
off£t


69 
cÚsum”
.
	`£t_tİic_·¹™iÚs
('JOB_TEST', 'JOB_TEST_1')

71 
True
:

72 
Œy
:

73 
mes§ge
 
š
 
cÚsum”
:

75 
mes§ge
 
v®ue
 
is
 
¿w
 
by‹
 
¡ršg


76 @
tİic
:è¯é¢˜åç§°

77 @
·¹™iÚ
:æ¶ˆæ¯å·(æ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½æ˜¯å•ä¸€çš„ä¸ªä½“)

78 @
off£t
:æ¶ˆæ¯åœ¨
tİic
-
·¹™iÚ
ä¸­çš„åç§»é‡

79 @
v®ue
:åŸå§‹å­—èŠ‚(
¿w
 
by‹s
)

81 
	`´št
("TOPIC:%s Partition:%d offset%d key=%s value=%s" % (\

82 
mes§ge
.
tİic
, mes§ge.
·¹™iÚ
,

83 
mes§ge
.
off£t
, mes§ge.
key
,

84 
mes§ge
.
v®ue
))

85 
cÚsum”
.
	$sk_dÚe
(
mes§ge
)

86 
cÚsum”
.
	$comm™
()

87 
	`exû±
 (
KafkaUÇvaabËE¼Ü
,
L—d”NÙAvaabËE¼Ü
), 
msg
:

88 
´št
 'Occu¸KafkaUÇvaabËE¼Ü, msg:', 
msg


89 
time
.
	$¦“p
(10)

91 
cÚsum”
.
	$sk_dÚe
()

92 
´št
 "Comm™:", 
cÚsum”
.
	$comm™
()

94 
def
 
	$advªûCÚsum”
():

96 
muÉic
 
tİics
 
ªd
‡utØ
comm™
 
off£t


98 
cÚsum”
 = 
	`KafkaCÚsum”
('bamboo1', 'bamboo2',

99 
boÙ¡¿p_£rv”s
=['10.1.200.63:9092'],

100 
group_id
 = 'job_consumer_group',

101 
auto_comm™_’abË
=
True
,

102 
auto_comm™_š‹rv®_ms
=30 * 1000,

103 
auto_off£t_»£t
='smallest')

105 #š™Ÿliz
™”©iÚ


106 
mes§ge
 
š
 
cÚsum”
:

107 
	`´št
("TOPIC:%s Partition:%d offset%d key=%s value=%s" % (\

108 
mes§ge
.
tİic
, mes§ge.
·¹™iÚ
,

109 
mes§ge
.
off£t
, mes§ge.
key
,

110 
mes§ge
.
v®ue
))

111 
cÚsum”
.
	$sk_dÚe
(
mes§ge
)

113 
cÚsum”
.
	$comm™
()

115 #B©ch 
´oûss
 
š‹rçû


116 
True
:

117 
m
 
š
 
cÚsum”
.
	$ãtch_mes§ges
():

118 
	`´št
("===Topic:%s Partition:%d offset%d key=%s value=%s" % (\

119 
mes§ge
.
tİic
, mes§ge.
·¹™iÚ
,

120 
mes§ge
.
off£t
, mes§ge.
key
,

121 
mes§ge
.
v®ue
))

122 
cÚsum”
.
	$sk_dÚe
(
m
)

125 
__Çme__
 == '__main__':

128 
tİicLi¡
 = ['JOB_TEST', 'JOB_TEST_1']

129 
	$sim¶eCÚsum”1
(
tİicLi¡
)

	@/root/grocery-shop/language/python/kafka/simpleProducer.py

1 #/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
sys


4 
impÜt
 
time


5 
äom
 
kafka
 
impÜt
 
	gSim¶eProduûr
, 
	gKafkaCl›Á
, 
KeyedProduûr


6 
äom
 
	gkafka
.
commÚ
 
	$impÜt
 (

7 
UnknownTİicOrP¬t™iÚE¼Ü
, 
L—d”NÙAvaabËE¼Ü
,

8 
KafkaUÇvaabËE¼Ü
, 
FaedPaylßdsE¼Ü


11 
def
 
	$sim¶eTe¡
():

12 #ä½¿ç”¨
bamboo
:9192
kafka
æœåŠ¡å™¨è¿›è¡Œè¿æ¥æµ‹è¯•

13 
Œy
:

14 
kafka
 = 
	`KafkaCl›Á
('bamboo:9192')

15 
exû±
 
KafkaUÇvaabËE¼Ü
, 
msg
:

16 
´št
 "KafkaUÇvaabËE¼Ü:", 
msg


17 
sys
.
	`ex™
(-1)

18 
exû±
 
Exû±iÚ
,
msg
:

19 
´št
 "Exû±iÚ:", 
msg


20 
sys
.
	`ex™
(-1)

21 
´oduûr
 = 
	$Sim¶eProduûr
(
kafka
)

22 
´št
 
kafka
.
tİics


25 
NÙe
 
th©
 
the
 
­¶iÿtiÚ
 
is
 
»¥ÚsibË


26 
’codšg
 
mes§ges
 
to
 
ty³
 
by‹s


28 'JOB_TEST_1' 
š
 
kafka
.
tİics
:

29 
´oduûr
.
	`£nd_mes§ges
(
b
'JOB_TEST_1', b'some message')

30 
´oduûr
.
	`£nd_mes§ges
(
b
'JOB_TEST_1',

31 
b
'this method', b'is variadic')

33 #S’d 
unicode
 
mes§ge


34 
´oduûr
.
	`£nd_mes§ges
(
b
'JOB_TEST_1',

35 
u
'ä½ æ€ä¹ˆæ ·?'.
	`’code
('utf-job'))

36 
´oduûr
.
	$¡İ
()

38 
def
 
	$keyedProduûrTe¡1
():

40 @
tİic
ï¼šå¤š
»¶iÿ
æƒ…å†µ

41 @
funùiÚ
:æµ‹è¯•
KeyedProduûr
ï¼Œå‘æŒ‡å®šçš„
brok”
å‘å¸ƒæ¶ˆæ¯ï¼Œ

42 å¹¶éªŒè¯
dev–İs
-
dev1
:9193å…³é—­ä¹‹åä»ç„¶èƒ½å¤Ÿé¡ºåˆ©è¿è¡Œ

44 
impÜt
 
pdb


45 
pdb
.
	$£t_Œaû
()

46 
kafkaCl›Á
 = 
	`KafkaCl›Á
('devops-dev1:9193')

47 
´oduûr
 = 
	$KeyedProduûr
(
kafkaCl›Á
)

48 
mes§ge
 = "This is‡est-"

49 
šdex
 = 0

50 
True
:

51 
tmpmsg
 = 
mes§ge
 + 
	$¡r
(
šdex
)

52 
šdex
 += 1

53 
´oduûr
.
	`£nd_mes§ges
(
b
'JOB_TEST', 'keys', 
tmpmsg
)

54 
time
.
	$¦“p
(1)

56 
def
 
	$keyedProduûrTe¡2
():

58 @
tİic
ï¼šå•
»¶iÿ
æƒ…å†µ(
JOB_TEST_1
)

59 @
funùiÚ
:æµ‹è¯•
KeyedProduûr
ï¼Œå‘æŒ‡å®šçš„
brok”
å‘å¸ƒæ¶ˆæ¯ï¼Œ

60 å¹¶éªŒè¯
dev–İs
-
dev1
:9193å…³é—­ä¹‹åçš„å¼‚å¸¸æŠ¥é”™

62 
impÜt
 
pdb


63 
pdb
.
	$£t_Œaû
()

64 
kafkaCl›Á
 = 
	`KafkaCl›Á
('devops-dev1:9193')

65 
´oduûr
 = 
	$KeyedProduûr
(
kafkaCl›Á
)

66 
mes§ge
 = "This is‡est-"

67 
šdex
 = 0

68 
True
:

69 
tmpmsg
 = 
mes§ge
 + 
	$¡r
(
šdex
)

70 
´oduûr
.
	`£nd_mes§ges
(
b
'JOB_TEST_1', 'keys', 
tmpmsg
)

71 
šdex
 += 1

72 
time
.
	$¦“p
(1)

74 
def
 
	$wa™Brok”Recov”
(
kafkaCl›Á
):

76 
Œy
:

77 
´oduûr
 = 
	$KeyedProduûr
(
kafkaCl›Á
)

78 
exû±
 
KafkaUÇvaabËE¼Ü
:

79 
time
.
	$¦“p
(10)

81  
´oduûr


83 
def
 
	$keyedProduûrTe¡3
():

85 @
tİic
ï¼šå•
»¶iÿ
æƒ…å†µ(
JOB_TEST_1
)

86 @
funùiÚ
:æµ‹è¯•
KeyedProduûr
ï¼Œå‘æŒ‡å®šçš„
brok”
å‘å¸ƒæ¶ˆæ¯ï¼Œ

87 å¹¶éªŒè¯
dev–İs
-
dev1
:9193å…³é—­ä¹‹åçš„å¼‚å¸¸çš„æ¢å¤æƒ…å†µ

90 
impÜt
 
pdb


91 
pdb
.
	$£t_Œaû
()

92 
kafkaCl›Á
 = 
	`KafkaCl›Á
('devops-dev1:9193')

93 
´oduûr
 = 
	$KeyedProduûr
(
kafkaCl›Á
)

94 
mes§ge
 = "This is‡est-"

95 
šdex
 = 0

96 
True
:

97 
Œy
:

98 
tmpmsg
 = 
mes§ge
 + 
	$¡r
(
šdex
)

99 
´oduûr
.
	`£nd_mes§ges
(
b
'JOB_TEST_1', 'keys', 
tmpmsg
)

100 
šdex
 += 1

101 
time
.
	$¦“p
(1)

102 
	`exû±
 (
FaedPaylßdsE¼Ü
,
KafkaUÇvaabËE¼Ü
), 
msg
:

103 
´št
 'Occu¸FaedPaylßdsE¼Üƒ¼Ü, msg:', 
msg


104 
time
.
	$¦“p
(10)

106 
__Çme__
 == '__main__':

108 
	`keyedProduûrTe¡1
()

	@/root/grocery-shop/language/python/kafka/test/__init__.py

1 
impÜt
 
sys


3 
	gsys
.
	gv”siÚ_šfo
 < (2, 7):

4 
impÜt
 
un™‹¡2
 
as
 
un™‹¡


6 
impÜt
 
un™‹¡


	@/root/grocery-shop/language/python/kafka/test/fixtures.py

1 
impÜt
 
loggšg


2 
impÜt
 
os


3 
impÜt
 
	gos
.
·th


4 
impÜt
 
shut


5 
impÜt
 
sub´oûss


6 
impÜt
 
‹mpfe


7 
impÜt
 
time


8 
äom
 
	gsix
.
moves
 
impÜt
 
u¾lib


9 
impÜt
 
uuid


11 
äom
 
	gsix
.
	gmoves
.
	gu¾lib
.
·r£
 
impÜt
 
	gu¾·r£
 #pylšt: 
di§bË
-
msg
=
E0611


12 
äom
 
‹¡
.
£rviû
 
impÜt
 
Ex‹º®S”viû
, 
S·wÃdS”viû


13 
äom
 
	g‹¡
.
‹¡ut
 
impÜt
 
g‘_İ’_pÜt


16 
	glog
 = 
loggšg
.
	$g‘Logg”
(
__Çme__
)

19 
şass
 
	$Fixtu»
(
objeù
):

20 
kafka_v”siÚ
 = 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION', '0.job.0')

21 
sÿÏ_v”siÚ
 = 
os
.
’vœÚ
.
	`g‘
("SCALA_VERSION", '2.job.0')

22 
´ojeù_roÙ
 = 
os
.
’vœÚ
.
	`g‘
('PROJECT_ROOT', os.
·th
.
	`ab¥©h
(os.·th.
	`još
(os.·th.
	`dœÇme
(
__fe__
), "..")))

23 
kafka_roÙ
 = 
os
.
’vœÚ
.
	`g‘
("KAFKA_ROOT", os.
·th
.
	`još
(
´ojeù_roÙ
, '£rv”s', 
kafka_v”siÚ
, "kafka-bin"))

24 
ivy_roÙ
 = 
os
.
’vœÚ
.
	`g‘
('IVY_ROOT', os.
·th
.
	`ex·ndu£r
("~/.ivy2/cache"))

26 @
şassm‘hod


27 
def
 
	$dowÆßd_officŸl_di¡ributiÚ
(
şs
,

28 
kafka_v”siÚ
=
NÚe
,

29 
sÿÏ_v”siÚ
=
NÚe
,

30 
ouut_dœ
=
NÚe
):

31 
nÙ
 
kafka_v”siÚ
:

32 
kafka_v”siÚ
 = 
şs
.kafka_version

33 
nÙ
 
sÿÏ_v”siÚ
:

34 
sÿÏ_v”siÚ
 = 
şs
.scala_version

35 
nÙ
 
ouut_dœ
:

36 
ouut_dœ
 = 
os
.
·th
.
	`još
(
şs
.
´ojeù_roÙ
, 'servers', 'dist')

38 
di¡fe
 = 'kafka_%s-%s' % (
sÿÏ_v”siÚ
, 
kafka_v”siÚ
,)

39 
u¾_ba£
 = 'h‰ps://¬chive.­ache.Üg/di¡/kafka/%s/' % (
kafka_v”siÚ
,)

40 
ouut_fe
 = 
os
.
·th
.
	`još
(
ouut_dœ
, 
di¡fe
 + '.tgz')

42 
os
.
·th
.
	$isfe
(
ouut_fe
):

43 
log
.
	`šfo
("Found f®»ady oÀdisk: %s", 
ouut_fe
)

44  
ouut_fe


46 #New 
rb®ls
 
¬e
 .
tgz
, 
Şd”
 
Úes
‡» 
som‘imes
 .
r
.
gz


47 
Œy
:

48 
u¾
 = 
u¾_ba£
 + 
di¡fe
 + '.tgz'

49 
log
.
	`šfo
("A‰em±šgØdowÆßd %s", 
u¾
)

50 
»¥Ú£
 = 
u¾lib
.
»que¡
.
	$u¾İ’
(
u¾
)

51 
exû±
 
u¾lib
.
”rÜ
.
HTTPE¼Ü
:

52 
log
.
	`exû±iÚ
("HTTP Error")

53 
u¾
 = 
u¾_ba£
 + 
di¡fe
 + '.tar.gz'

54 
log
.
	`šfo
("A‰em±šgØdowÆßd %s", 
u¾
)

55 
»¥Ú£
 = 
u¾lib
.
»que¡
.
	$u¾İ’
(
u¾
)

57 
log
.
	`šfo
("Savšg di¡ributiÚ ftØ%s", 
ouut_fe
)

58 
w™h
 
	`İ’
(
ouut_fe
, 'w'è
as
 
ouut_fe_fd
:

59 
ouut_fe_fd
.
	`wr™e
(
»¥Ú£
.
	$»ad
())

61  
ouut_fe


63 @
şassm‘hod


64 
def
 
	$‹¡_»sourû
(
şs
, 
f’ame
):

65  
os
.
·th
.
	`još
(
şs
.
´ojeù_roÙ
, "£rv”s", cls.
kafka_v”siÚ
, "»sourûs", 
f’ame
)

67 @
şassm‘hod


68 
def
 
	$kafka_run_şass_¬gs
(
şs
, *
¬gs
):

69 
»suÉ
 = [
os
.
·th
.
	`još
(
şs
.
kafka_roÙ
, 'bin', 'kafka-run-class.sh')]

70 
»suÉ
.
	$ex‹nd
(
¬gs
)

71  
»suÉ


73 @
şassm‘hod


74 
def
 
	$kafka_run_şass_’v
(
şs
):

75 
’v
 = 
os
.
’vœÚ
.
	$cİy
()

76 
’v
['KAFKA_LOG4J_OPTS'] = "-Dlog4j.cÚfigu¿tiÚ=fe:%s" % 
şs
.
	`‹¡_»sourû
("log4j.properties")

77  
’v


79 @
şassm‘hod


80 
def
 
	$»nd”_‹m¶©e
(
şs
, 
sourû_fe
, 
rg‘_fe
, 
bšdšg
):

81 
w™h
 
	`İ’
(
sourû_fe
, "r"è
as
 
hªdË
:

82 
‹m¶©e
 = 
hªdË
.
	$»ad
()

83 
w™h
 
	`İ’
(
rg‘_fe
, "w"è
as
 
hªdË
:

84 
hªdË
.
	`wr™e
(
‹m¶©e
.
	$fÜm©
(**
bšdšg
))

87 
şass
 
	$Zook“³rFixtu»
(
Fixtu»
):

88 @
şassm‘hod


89 
def
 
	$š¡ªû
(
şs
):

90 "ZOOKEEPER_URI" 
š
 
os
.
’vœÚ
:

91 
·r£
 = 
	`u¾·r£
(
os
.
’vœÚ
["ZOOKEEPER_URI"])

92 (
ho¡
, 
pÜt
èğ(
·r£
.
ho¡Çme
,…arse.port)

93 
fixtu»
 = 
	$Ex‹º®S”viû
(
ho¡
, 
pÜt
)

95 (
ho¡
, 
pÜt
èğ("127.0.0.1", 
	$g‘_İ’_pÜt
())

96 
fixtu»
 = 
	$şs
(
ho¡
, 
pÜt
)

98 
fixtu»
.
	$İ’
()

99  
fixtu»


101 
def
 
	$__š™__
(
£lf
, 
ho¡
, 
pÜt
):

102 
£lf
.
ho¡
 = host

103 
£lf
.
pÜt
 =…ort

105 
£lf
.
tmp_dœ
 = 
NÚe


106 
£lf
.
chd
 = 
NÚe


108 
def
 
	$out
(
£lf
, 
mes§ge
):

109 
log
.
	`šfo
("*** Zook“³¸[%s:%d]: %s", 
£lf
.
ho¡
, s–f.
pÜt
, 
mes§ge
)

111 
def
 
	$İ’
(
£lf
):

112 
£lf
.
tmp_dœ
 = 
‹mpfe
.
	$mkd‹mp
()

113 
£lf
.
	`out
("Running†ocal instance...")

114 
log
.
	`šfo
(" ho¡ = %s", 
£lf
.
ho¡
)

115 
log
.
	`šfo
("…Üˆ = %s", 
£lf
.
pÜt
)

116 
log
.
	`šfo
("mp_dœ = %s", 
£lf
.
tmp_dœ
)

118 #G’”©
cÚfigs


119 
‹m¶©e
 = 
£lf
.
	`‹¡_»sourû
("zookeeper.properties")

120 
´İ”t›s
 = 
os
.
·th
.
	`još
(
£lf
.
tmp_dœ
, "zookeeper.properties")

121 
£lf
.
	`»nd”_‹m¶©e
(
‹m¶©e
, 
´İ”t›s
, 
	$v¬s
(
£lf
))

123 #CÚfigu» 
Zook“³r
 
chd
 
´oûss


124 
¬gs
 = 
£lf
.
	`kafka_run_şass_¬gs
("Üg.­ache.zook“³r.£rv”.quÜum.QuÜumP“rMaš", 
´İ”t›s
)

125 
’v
 = 
£lf
.
	$kafka_run_şass_’v
()

128 
£lf
.
	`out
("Starting...")

129 
timeout
 = 5

130 
max_timeout
 = 30

131 
backoff
 = 1

132 
True
:

133 
£lf
.
chd
 = 
	$S·wÃdS”viû
(
¬gs
, 
’v
)

134 
£lf
.
chd
.
	$¡¬t
()

135 
timeout
 = 
	$mš
(
timeout
, 
max_timeout
)

136 
£lf
.
chd
.
	`wa™_fÜ
(
r
"bšdšgØpÜt", 
timeout
=timeout):

138 
£lf
.
chd
.
	$¡İ
()

139 
timeout
 *= 2

140 
time
.
	$¦“p
(
backoff
)

141 
£lf
.
	`out
("Done!")

143 
def
 
	$şo£
(
£lf
):

144 
£lf
.
	`out
("Stopping...")

145 
£lf
.
chd
.
	$¡İ
()

146 
£lf
.
chd
 = 
NÚe


147 
£lf
.
	`out
("Done!")

148 
shut
.
	$rmŒ“
(
£lf
.
tmp_dœ
)

151 
şass
 
	$KafkaFixtu»
(
Fixtu»
):

152 @
şassm‘hod


153 
def
 
	$š¡ªû
(
şs
, 
brok”_id
, 
zk_ho¡
, 
zk_pÜt
, 
zk_chroÙ
=
NÚe
, 
»¶iÿs
=1, 
·¹™iÚs
=2):

154 
zk_chroÙ
 
is
 
NÚe
:

155 
zk_chroÙ
 = "kafka-pythÚ_" + 
	`¡r
(
uuid
.
	`uuid4
()).
	`»¶aû
("-", "_")

156 "KAFKA_URI" 
š
 
os
.
’vœÚ
:

157 
·r£
 = 
	`u¾·r£
(
os
.
’vœÚ
["KAFKA_URI"])

158 (
ho¡
, 
pÜt
èğ(
·r£
.
ho¡Çme
,…arse.port)

159 
fixtu»
 = 
	$Ex‹º®S”viû
(
ho¡
, 
pÜt
)

161 (
ho¡
, 
pÜt
èğ("127.0.0.1", 
	$g‘_İ’_pÜt
())

162 
fixtu»
 = 
	$KafkaFixtu»
(
ho¡
, 
pÜt
, 
brok”_id
, 
zk_ho¡
, 
zk_pÜt
, 
zk_chroÙ
, 
»¶iÿs
, 
·¹™iÚs
)

163 
fixtu»
.
	$İ’
()

164  
fixtu»


166 
def
 
	$__š™__
(
£lf
, 
ho¡
, 
pÜt
, 
brok”_id
, 
zk_ho¡
, 
zk_pÜt
, 
zk_chroÙ
, 
»¶iÿs
=1, 
·¹™iÚs
=2):

167 
£lf
.
ho¡
 = host

168 
£lf
.
pÜt
 =…ort

170 
£lf
.
brok”_id
 = broker_id

172 
£lf
.
zk_ho¡
 = zk_host

173 
£lf
.
zk_pÜt
 = zk_port

174 
£lf
.
zk_chroÙ
 = zk_chroot

176 
£lf
.
»¶iÿs
 =„eplicas

177 
£lf
.
·¹™iÚs
 =…artitions

179 
£lf
.
tmp_dœ
 = 
NÚe


180 
£lf
.
chd
 = 
NÚe


181 
£lf
.
ruÂšg
 = 
F®£


183 
def
 
	$out
(
£lf
, 
mes§ge
):

184 
log
.
	`šfo
("*** Kafk¨[%s:%d]: %s", 
£lf
.
ho¡
, s–f.
pÜt
, 
mes§ge
)

186 
def
 
	$İ’
(
£lf
):

187 
£lf
.
ruÂšg
:

188 
£lf
.
	`out
("Instance‡lready„unning")

191 
£lf
.
tmp_dœ
 = 
‹mpfe
.
	$mkd‹mp
()

192 
£lf
.
	`out
("Running†ocal instance...")

193 
log
.
	`šfo
(" ho¡ = %s", 
£lf
.
ho¡
)

194 
log
.
	`šfo
("…Üˆ = %s", 
£lf
.
pÜt
)

195 
log
.
	`šfo
(" brok”_id = %s", 
£lf
.
brok”_id
)

196 
log
.
	`šfo
(" zk_ho¡ = %s", 
£lf
.
zk_ho¡
)

197 
log
.
	`šfo
(" zk_pÜˆ = %s", 
£lf
.
zk_pÜt
)

198 
log
.
	`šfo
(" zk_chroÙ = %s", 
£lf
.
zk_chroÙ
)

199 
log
.
	`šfo
("„•liÿ  = %s", 
£lf
.
»¶iÿs
)

200 
log
.
	`šfo
("…¬t™iÚ ğ%s", 
£lf
.
·¹™iÚs
)

201 
log
.
	`šfo
("mp_dœ = %s", 
£lf
.
tmp_dœ
)

203 #C»©
dœeùÜ›s


204 
os
.
	`mkdœ
(os.
·th
.
	`još
(
£lf
.
tmp_dœ
, "logs"))

205 
os
.
	`mkdœ
(os.
·th
.
	`još
(
£lf
.
tmp_dœ
, "data"))

207 #G’”©
cÚfigs


208 
‹m¶©e
 = 
£lf
.
	`‹¡_»sourû
("kafka.properties")

209 
´İ”t›s
 = 
os
.
·th
.
	`još
(
£lf
.
tmp_dœ
, "kafka.properties")

210 
£lf
.
	`»nd”_‹m¶©e
(
‹m¶©e
, 
´İ”t›s
, 
	$v¬s
(
£lf
))

213 
£lf
.
	`out
("Creating Zookeeper chroot‚ode...")

214 
¬gs
 = 
£lf
.
	`kafka_run_şass_¬gs
("org.apache.zookeeper.ZooKeeperMain",

215 "-£rv”", "%s:%d" % (
£lf
.
zk_ho¡
, s–f.
zk_pÜt
),

217 "/%s" % 
£lf
.
zk_chroÙ
,

219 
’v
 = 
£lf
.
	$kafka_run_şass_’v
()

220 
´oc
 = 
sub´oûss
.
	$Pİ’
(
¬gs
, 
’v
ónv, 
¡dout
=
sub´oûss
.
PIPE
, 
¡d”r
=subprocess.PIPE)

222 
´oc
.
	`wa™
() != 0:

223 
£lf
.
	`out
("Failedo create Zookeeper chroot‚ode")

224 
£lf
.
	`out
(
´oc
.
¡dout
.
	$»ad
())

225 
£lf
.
	`out
(
´oc
.
¡d”r
.
	$»ad
())

226 
¿i£
 
	`RuÁimeE¼Ü
("Failedo create Zookeeper chroot‚ode")

227 
£lf
.
	`out
("Done!")

229 
£lf
.
	`out
("Starting...")

231 #CÚfigu» 
Kafka
 
chd
 
´oûss


232 
¬gs
 = 
£lf
.
	`kafka_run_şass_¬gs
("kafka.Kafka", 
´İ”t›s
)

233 
’v
 = 
£lf
.
	$kafka_run_şass_’v
()

235 
timeout
 = 5

236 
max_timeout
 = 30

237 
backoff
 = 1

238 
True
:

239 
£lf
.
chd
 = 
	$S·wÃdS”viû
(
¬gs
, 
’v
)

240 
£lf
.
chd
.
	$¡¬t
()

241 
timeout
 = 
	$mš
(
timeout
, 
max_timeout
)

242 
£lf
.
chd
.
	`wa™_fÜ
(
r
"\[Kafka Server %d\], Started" %

243 
£lf
.
brok”_id
, 
timeout
=timeout):

245 
£lf
.
chd
.
	$¡İ
()

246 
timeout
 *= 2

247 
time
.
	$¦“p
(
backoff
)

248 
£lf
.
	`out
("Done!")

249 
£lf
.
ruÂšg
 = 
True


251 
def
 
	$şo£
(
£lf
):

252 
nÙ
 
£lf
.
ruÂšg
:

253 
£lf
.
	`out
("Instance‡lready stopped")

256 
£lf
.
	`out
("Stopping...")

257 
£lf
.
chd
.
	$¡İ
()

258 
£lf
.
chd
 = 
NÚe


259 
£lf
.
	`out
("Done!")

260 
shut
.
	$rmŒ“
(
£lf
.
tmp_dœ
)

261 
£lf
.
ruÂšg
 = 
F®£


	@/root/grocery-shop/language/python/kafka/test/service.py

1 
impÜt
 
loggšg


2 
impÜt
 
»


3 
impÜt
 
£Ëù


4 
impÜt
 
sub´oûss


5 
impÜt
 
th»adšg


6 
impÜt
 
time


8 
	g__®l__
 = [

15 
	glog
 = 
loggšg
.
	$g‘Logg”
(
__Çme__
)

18 
şass
 
	$Ex‹º®S”viû
(
objeù
):

19 
def
 
	$__š™__
(
£lf
, 
ho¡
, 
pÜt
):

20 
log
.
	`šfo
("Usšg‡Ì—dy„uÂšg s”viû‡ˆ%s:%d", 
ho¡
, 
pÜt
)

21 
£lf
.
ho¡
 = host

22 
£lf
.
pÜt
 =…ort

24 
def
 
	$İ’
(
£lf
):

25 
·ss


27 
def
 
	$şo£
(
£lf
):

28 
·ss


31 
şass
 
	$S·wÃdS”viû
(
th»adšg
.
Th»ad
):

32 
def
 
	$__š™__
(
£lf
, 
¬gs
=
NÚe
, 
’v
=None):

33 
th»adšg
.
Th»ad
.
	$__š™__
(
£lf
)

35 
¬gs
 
is
 
NÚe
:

36 
¿i£
 
	`Ty³E¼Ü
("args…arameter is„equired")

37 
£lf
.
¬gs
 =‡rgs

38 
£lf
.
’v
 =ƒnv

39 
£lf
.
ÿ±u»d_¡dout
 = []

40 
£lf
.
ÿ±u»d_¡d”r
 = []

42 
£lf
.
should_d›
 = 
th»adšg
.
	$Ev’t
()

43 
£lf
.
chd
 = 
NÚe


44 
£lf
.
®ive
 = 
F®£


46 
def
 
	$run
(
£lf
):

47 
£lf
.
	$run_w™h_hªdËs
()

49 
def
 
	$_¥awn
(
£lf
):

50 
£lf
.
®ive
: 

51 
£lf
.
chd
 
ªd
 s–f.chd.
	$pŞl
(è
is
 
NÚe
: 

53 
£lf
.
chd
 = 
sub´oûss
.
	$Pİ’
(

54 
£lf
.
¬gs
,

55 
’v
=
£lf
.env,

56 
bufsize
=1,

57 
¡dout
=
sub´oûss
.
PIPE
,

58 
¡d”r
=
sub´oûss
.
PIPE
)

59 
£lf
.
®ive
 = 
True


61 
def
 
	$_de¥awn
(
£lf
):

62 
£lf
.
chd
.
	$pŞl
(è
is
 
NÚe
:

63 
£lf
.
chd
.
	$‹rmš©e
()

64 
£lf
.
®ive
 = 
F®£


65 
_
 
š
 
	$¿nge
(50):

66 
£lf
.
chd
.
	$pŞl
(è
is
 
nÙ
 
NÚe
:

67 
£lf
.
chd
 = 
NÚe


69 
time
.
	$¦“p
(0.1)

71 
£lf
.
chd
.
	$kl
()

73 
def
 
	$run_w™h_hªdËs
(
£lf
):

74 
£lf
.
	$_¥awn
()

75 
True
:

76 (
rds
, 
_
, _èğ
£Ëù
.
	$£Ëù
([
£lf
.
chd
.
¡dout
, s–f.chd.
¡d”r
], [], [], 1)

78 
£lf
.
chd
.
¡dout
 
š
 
rds
:

79 
lše
 = 
£lf
.
chd
.
¡dout
.
	$»adlše
()

80 
£lf
.
ÿ±u»d_¡dout
.
	`­³nd
(
lše
.
	`decode
('utf-job'))

82 
£lf
.
chd
.
¡d”r
 
š
 
rds
:

83 
lše
 = 
£lf
.
chd
.
¡d”r
.
	$»adlše
()

84 
£lf
.
ÿ±u»d_¡d”r
.
	`­³nd
(
lše
.
	`decode
('utf-job'))

86 
£lf
.
chd
.
	$pŞl
(è
is
 
nÙ
 
NÚe
:

87 
£lf
.
	$dump_logs
()

88 
£lf
.
	$_¥awn
()

90 
£lf
.
should_d›
.
	$is_£t
():

91 
£lf
.
	$_de¥awn
()

94 
def
 
	$dump_logs
(
£lf
):

95 
log
.
	`ü™iÿl
('stderr')

96 
lše
 
š
 
£lf
.
ÿ±u»d_¡d”r
:

97 
log
.
	`ü™iÿl
(
lše
.
	$r¡r
())

99 
log
.
	`ü™iÿl
('stdout')

100 
lše
 
š
 
£lf
.
ÿ±u»d_¡dout
:

101 
log
.
	`ü™iÿl
(
lše
.
	$r¡r
())

103 
def
 
	$wa™_fÜ
(
£lf
, 
·‰”n
, 
timeout
=30):

104 
t1
 = 
time
.
	$time
()

105 
True
:

106 
t2
 = 
time
.
	$time
()

107 
t2
 - 
t1
 >ğ
timeout
:

108 
Œy
:

109 
£lf
.
chd
.
	$kl
()

110 
exû±
:

111 
log
.
	`exû±iÚ
("Receivedƒxception when killing child…rocess")

112 
£lf
.
	$dump_logs
()

114 
log
.
	`”rÜ
("Wa™šg fÜ %¸timed ouˆaá” %d secÚds", 
·‰”n
, 
timeout
)

115  
F®£


117 
»
.
	`£¬ch
(
·‰”n
, '\n'.
	`još
(
£lf
.
ÿ±u»d_¡dout
),„e.
IGNORECASE
è
is
 
nÙ
 
NÚe
:

118 
log
.
	`šfo
("Found…©‹º %¸š %d secÚd vŸ stdout", 
·‰”n
, (
t2
 - 
t1
))

119  
True


120 
»
.
	`£¬ch
(
·‰”n
, '\n'.
	`još
(
£lf
.
ÿ±u»d_¡d”r
),„e.
IGNORECASE
è
is
 
nÙ
 
NÚe
:

121 
log
.
	`šfo
("Found…©‹º %¸š %d secÚd vŸ std”r", 
·‰”n
, (
t2
 - 
t1
))

122  
True


123 
time
.
	$¦“p
(0.1)

125 
def
 
	$¡¬t
(
£lf
):

126 
th»adšg
.
Th»ad
.
	$¡¬t
(
£lf
)

128 
def
 
	$¡İ
(
£lf
):

129 
£lf
.
should_d›
.
	$£t
()

130 
£lf
.
	`još
()

	@/root/grocery-shop/language/python/kafka/test/test_client.py

1 
impÜt
 
sock‘


2 
äom
 
time
 
impÜt
 
¦“p


4 
äom
 
mock
 
impÜt
 
	gANY
, 
	gMagicMock
, 
·tch


5 
impÜt
 
six


6 
	gäom
 . 
impÜt
 
un™‹¡


8 
äom
 
kafka
 
impÜt
 
KafkaCl›Á


9 
äom
 
	gkafka
.
commÚ
 
	$impÜt
 (

10 
ProduûReque¡
, 
M‘ad©aRe¥Ú£
,

11 
Brok”M‘ad©a
, 
TİicM‘ad©a
, 
P¬t™iÚM‘ad©a
,

12 
TİicAndP¬t™iÚ
, 
KafkaUÇvaabËE¼Ü
,

13 
L—d”NÙAvaabËE¼Ü
, 
UnknownTİicOrP¬t™iÚE¼Ü
,

14 
KafkaTimeoutE¼Ü
, 
CÚÃùiÚE¼Ü


16 
äom
 
kafka
.
cÚn
 
impÜt
 
KafkaCÚÃùiÚ


17 
äom
 
kafka
.
´ÙocŞ
 
impÜt
 
KafkaPrÙocŞ
, 
ü—‹_mes§ge


19 
äom
 
‹¡
.
‹¡ut
 
impÜt
 
Tim”


21 
NO_ERROR
 = 0

22 
UNKNOWN_TOPIC_OR_PARTITION
 = 3

23 
NO_LEADER
 = 5

25 
şass
 
	$Te¡KafkaCl›Á
(
un™‹¡
.
Te¡Ca£
):

26 
def
 
	$‹¡_š™_w™h_li¡
(
£lf
):

27 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, 'load_metadata_for_topics'):

28 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
=['kafka01:9092', 'kafka02:9092', 'kafka03:9092'])

30 
£lf
.
	`as£¹Equ®
(

31 
	`sÜ‹d
([('kafka01', 9092), ('kafka02', 9092), ('kafka03', 9092)]),

32 
	$sÜ‹d
(
ş›Á
.
ho¡s
))

34 
def
 
	$‹¡_š™_w™h_csv
(
£lf
):

35 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, 'load_metadata_for_topics'):

36 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
='kafka01:9092,kafka02:9092,kafka03:9092')

38 
£lf
.
	`as£¹Equ®
(

39 
	`sÜ‹d
([('kafka01', 9092), ('kafka02', 9092), ('kafka03', 9092)]),

40 
	$sÜ‹d
(
ş›Á
.
ho¡s
))

42 
def
 
	$‹¡_š™_w™h_unicode_csv
(
£lf
):

43 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, 'load_metadata_for_topics'):

44 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
=
u
'kafka01:9092,kafka02:9092,kafka03:9092')

46 
£lf
.
	`as£¹Equ®
(

47 
	`sÜ‹d
([('kafka01', 9092), ('kafka02', 9092), ('kafka03', 9092)]),

48 
	$sÜ‹d
(
ş›Á
.
ho¡s
))

50 
def
 
	$‹¡_£nd_brok”_uÇw¬e_»que¡_ç
(
£lf
):

53 
mocked_cÚns
 = {

54 ('kafka01', 9092): 
	`MagicMock
(),

55 ('kafka02', 9092): 
	`MagicMock
()

56 
	}
}

58 #šjeù 
KafkaCÚÃùiÚ
 
side
 
efãùs


59 
mocked_cÚns
[('kafka01', 9092)].
	g£nd
.
	gside_efãù
 = 
RuÁimeE¼Ü
("kafka01 went‡way (unittest)")

60 
mocked_cÚns
[('kafka02', 9092)].
	g£nd
.
	gside_efãù
 = 
RuÁimeE¼Ü
("Kafka02 went‡way (unittest)")

62 
def
 
	$mock_g‘_cÚn
(
ho¡
, 
pÜt
):

63  
mocked_cÚns
[(
ho¡
, 
pÜt
)]

65 #·tch 
to
 
avoid
 
makšg
 
»que¡s
 
befÜe
 
we
 
wªt
 
™


66 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, 'load_metadata_for_topics'):

67 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, '_g‘_cÚn', 
side_efãù
=
mock_g‘_cÚn
):

68 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
=['kafka01:9092', 'kafka02:9092'])

70 
»q
 = 
KafkaPrÙocŞ
.
	`’code_m‘ad©a_»que¡
(
b
'client', 0)

71 
w™h
 
£lf
.
	$as£¹Rai£s
(
KafkaUÇvaabËE¼Ü
):

72 
ş›Á
.
	`_£nd_brok”_uÇw¬e_»que¡
(
·ylßds
=['fake„equest'],

73 
’cod”_â
=
	`MagicMock
(
»tuº_v®ue
='fakeƒncoded message'),

74 
decod”_â
=
Ïmbda
 
x
: x)

76 
key
, 
cÚn
 
š
 
six
.
	$™”™ems
(
mocked_cÚns
):

77 
cÚn
.
£nd
.
	`as£¹_ÿÎed_w™h
(
ANY
, 'fakeƒncoded message')

79 
def
 
	$‹¡_£nd_brok”_uÇw¬e_»que¡
(
£lf
):

82 
mocked_cÚns
 = {

83 ('kafka01', 9092): 
	`MagicMock
(),

84 ('kafka02', 9092): 
	`MagicMock
(),

85 ('kafka03', 9092): 
	`MagicMock
()

86 
	}
}

87 #šjeù 
KafkaCÚÃùiÚ
 
side
 
efãùs


88 
mocked_cÚns
[('kafka01', 9092)].
	g£nd
.
	gside_efãù
 = 
RuÁimeE¼Ü
("kafka01 went‡way (unittest)")

89 
mocked_cÚns
[('kafka02', 9092)].
	g»cv
.
	g»tuº_v®ue
 = 'valid„esponse'

90 
mocked_cÚns
[('kafka03', 9092)].
	g£nd
.
	gside_efãù
 = 
RuÁimeE¼Ü
("kafka03 went‡way (unittest)")

92 
def
 
	$mock_g‘_cÚn
(
ho¡
, 
pÜt
):

93  
mocked_cÚns
[(
ho¡
, 
pÜt
)]

95 #·tch 
to
 
avoid
 
makšg
 
»que¡s
 
befÜe
 
we
 
wªt
 
™


96 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, 'load_metadata_for_topics'):

97 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, '_g‘_cÚn', 
side_efãù
=
mock_g‘_cÚn
):

98 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, '_Ãxt_id', 
»tuº_v®ue
=1):

99 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
='kafka01:9092,kafka02:9092')

101 
»¥
 = 
ş›Á
.
	`_£nd_brok”_uÇw¬e_»que¡
(
·ylßds
=['fake„equest'],

102 
’cod”_â
=
	`MagicMock
(),

103 
decod”_â
=
Ïmbda
 
x
: x)

105 
£lf
.
	`as£¹Equ®
('v®id„e¥Ú£', 
»¥
)

106 
mocked_cÚns
[('kafka02', 9092)].
»cv
.
	`as£¹_ÿÎed_w™h
(1)

108 @
	`·tch
('kafka.client.KafkaConnection')

109 @
	`·tch
('kafka.client.KafkaProtocol')

110 
def
 
	$‹¡_lßd_m‘ad©a
(
£lf
, 
´ÙocŞ
, 
cÚn
):

112 
cÚn
.
»cv
.
»tuº_v®ue
 = '»¥Ú£' #ªythšg 
but
 
NÚe


114 
brok”s
 = [

115 
	`Brok”M‘ad©a
(0, 'broker_1', 4567),

116 
	`Brok”M‘ad©a
(1, 'brok”_2', 567
job
)

119 
tİics
 = [

120 
	`TİicM‘ad©a
(
b
'tİic_1', 
NO_ERROR
, [

121 
	`P¬t™iÚM‘ad©a
(
b
'tİic_1', 0, 1, [1, 2], [1, 2], 
NO_ERROR
)

123 
	`TİicM‘ad©a
(
b
'tİic_nŞ—d”', 
NO_ERROR
, [

124 
	`P¬t™iÚM‘ad©a
(
b
'topic_noleader', 0, -1, [], [],

125 
NO_LEADER
),

126 
	`P¬t™iÚM‘ad©a
(
b
'topic_noleader', 1, -1, [], [],

127 
NO_LEADER
),

129 
	`TİicM‘ad©a
(
b
'tİic_no_·¹™iÚs', 
NO_LEADER
, []),

130 
	`TİicM‘ad©a
(
b
'tİic_unknown', 
UNKNOWN_TOPIC_OR_PARTITION
, []),

131 
	`TİicM‘ad©a
(
b
'tİic_3', 
NO_ERROR
, [

132 
	`P¬t™iÚM‘ad©a
(
b
'tİic_3', 0, 0, [0, 1], [0, 1], 
NO_ERROR
),

133 
	`P¬t™iÚM‘ad©a
(
b
'tİic_3', 1, 1, [1, 0], [1, 0], 
NO_ERROR
),

134 
	`P¬t™iÚM‘ad©a
(
b
'tİic_3', 2, 0, [0, 1], [0, 1], 
NO_ERROR
)

137 
´ÙocŞ
.
decode_m‘ad©a_»¥Ú£
.
»tuº_v®ue
 = 
	$M‘ad©aRe¥Ú£
(
brok”s
, 
tİics
)

139 #ş›Á 
lßds
 
m‘ad©a
 
©
 
š™


140 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
=['broker_1:4567'])

141 
£lf
.
	`as£¹DiùEqu®
({

142 
	`TİicAndP¬t™iÚ
(
b
'tİic_1', 0): 
brok”s
[1],

143 
	`TİicAndP¬t™iÚ
(
b
'tİic_nŞ—d”', 0): 
NÚe
,

144 
	`TİicAndP¬t™iÚ
(
b
'tİic_nŞ—d”', 1): 
NÚe
,

145 
	`TİicAndP¬t™iÚ
(
b
'tİic_3', 0): 
brok”s
[0],

146 
	`TİicAndP¬t™iÚ
(
b
'tİic_3', 1): 
brok”s
[1],

147 
	`TİicAndP¬t™iÚ
(
b
'tİic_3', 2): 
brok”s
[0]
	}
},

148 
	gş›Á
.
	gtİics_to_brok”s
)

150 #ià
we
 
ask
 
m‘ad©a
 
ex¶ic™ly
, 
™
 
should
 
¿i£
 
”rÜs


151 
w™h
 
	g£lf
.
	$as£¹Rai£s
(
L—d”NÙAvaabËE¼Ü
):

152 
ş›Á
.
	`lßd_m‘ad©a_fÜ_tİics
('topic_no_partitions')

154 
w™h
 
£lf
.
	$as£¹Rai£s
(
UnknownTİicOrP¬t™iÚE¼Ü
):

155 
ş›Á
.
	`lßd_m‘ad©a_fÜ_tİics
('topic_unknown')

157 #Thi 
should
 
nÙ
 
¿i£


158 
ş›Á
.
	`lßd_m‘ad©a_fÜ_tİics
('topic_no_leader')

159 
ş›Á
.
	`lßd_m‘ad©a_fÜ_tİics
(
b
'topic_no_leader')

161 @
	`·tch
('kafka.client.KafkaConnection')

162 @
	`·tch
('kafka.client.KafkaProtocol')

163 
def
 
	$‹¡_has_m‘ad©a_fÜ_tİic
(
£lf
, 
´ÙocŞ
, 
cÚn
):

165 
cÚn
.
»cv
.
»tuº_v®ue
 = '»¥Ú£' #ªythšg 
but
 
NÚe


167 
brok”s
 = [

168 
	`Brok”M‘ad©a
(0, 'broker_1', 4567),

169 
	`Brok”M‘ad©a
(1, 'brok”_2', 567
job
)

172 
tİics
 = [

173 
	`TİicM‘ad©a
(
b
'tİic_¡l_ü—tšg', 
NO_LEADER
, []),

174 
	`TİicM‘ad©a
(
b
'tİic_dÛ¢t_exi¡', 
UNKNOWN_TOPIC_OR_PARTITION
, []),

175 
	`TİicM‘ad©a
(
b
'tİic_nŞ—d”s', 
NO_ERROR
, [

176 
	`P¬t™iÚM‘ad©a
(
b
'tİic_nŞ—d”s', 0, -1, [], [], 
NO_LEADER
),

177 
	`P¬t™iÚM‘ad©a
(
b
'tİic_nŞ—d”s', 1, -1, [], [], 
NO_LEADER
),

180 
´ÙocŞ
.
decode_m‘ad©a_»¥Ú£
.
»tuº_v®ue
 = 
	$M‘ad©aRe¥Ú£
(
brok”s
, 
tİics
)

182 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
=['broker_1:4567'])

184 #Tİic 
w™h
 
no
 
·¹™iÚs
  
F®£


185 
£lf
.
	`as£¹F®£
(
ş›Á
.
	`has_m‘ad©a_fÜ_tİic
('topic_still_creating'))

186 
£lf
.
	`as£¹F®£
(
ş›Á
.
	`has_m‘ad©a_fÜ_tİic
('topic_doesnt_exist'))

188 #Tİiø
w™h
 
·¹™iÚ
 
m‘ad©a
, 
but
 
no
 
Ëad”s
  
True


189 
£lf
.
	`as£¹True
(
ş›Á
.
	`has_m‘ad©a_fÜ_tİic
('topic_noleaders'))

191 @
	`·tch
('kafka.client.KafkaConnection')

192 @
	`·tch
('kafka.client.KafkaProtocol.decode_metadata_response')

193 
def
 
	$‹¡_’su»_tİic_exi¡s
(
£lf
, 
decode_m‘ad©a_»¥Ú£
, 
cÚn
):

195 
cÚn
.
»cv
.
»tuº_v®ue
 = '»¥Ú£' #ªythšg 
but
 
NÚe


197 
brok”s
 = [

198 
	`Brok”M‘ad©a
(0, 'broker_1', 4567),

199 
	`Brok”M‘ad©a
(1, 'brok”_2', 567
job
)

202 
tİics
 = [

203 
	`TİicM‘ad©a
(
b
'tİic_¡l_ü—tšg', 
NO_LEADER
, []),

204 
	`TİicM‘ad©a
(
b
'tİic_dÛ¢t_exi¡', 
UNKNOWN_TOPIC_OR_PARTITION
, []),

205 
	`TİicM‘ad©a
(
b
'tİic_nŞ—d”s', 
NO_ERROR
, [

206 
	`P¬t™iÚM‘ad©a
(
b
'tİic_nŞ—d”s', 0, -1, [], [], 
NO_LEADER
),

207 
	`P¬t™iÚM‘ad©a
(
b
'tİic_nŞ—d”s', 1, -1, [], [], 
NO_LEADER
),

210 
decode_m‘ad©a_»¥Ú£
.
»tuº_v®ue
 = 
	$M‘ad©aRe¥Ú£
(
brok”s
, 
tİics
)

212 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
=['broker_1:4567'])

214 
w™h
 
£lf
.
	$as£¹Rai£s
(
UnknownTİicOrP¬t™iÚE¼Ü
):

215 
ş›Á
.
	`’su»_tİic_exi¡s
('tİic_dÛ¢t_exi¡', 
timeout
=1)

217 
w™h
 
£lf
.
	$as£¹Rai£s
(
KafkaTimeoutE¼Ü
):

218 
ş›Á
.
	`’su»_tİic_exi¡s
('tİic_¡l_ü—tšg', 
timeout
=1)

220 #Thi 
should
 
nÙ
 
¿i£


221 
ş›Á
.
	`’su»_tİic_exi¡s
('tİic_nŞ—d”s', 
timeout
=1)

222 
ş›Á
.
	`’su»_tİic_exi¡s
(
b
'tİic_nŞ—d”s', 
timeout
=1)

224 @
	`·tch
('kafka.client.KafkaConnection')

225 @
	`·tch
('kafka.client.KafkaProtocol')

226 
def
 
	$‹¡_g‘_Ëad”_fÜ_·¹™iÚs_»lßds_m‘ad©a
(
£lf
, 
´ÙocŞ
, 
cÚn
):

229 
cÚn
.
»cv
.
»tuº_v®ue
 = '»¥Ú£' #ªythšg 
but
 
NÚe


231 
brok”s
 = [

232 
	`Brok”M‘ad©a
(0, 'broker_1', 4567),

233 
	`Brok”M‘ad©a
(1, 'brok”_2', 567
job
)

236 
tİics
 = [

237 
	`TİicM‘ad©a
('tİic_no_·¹™iÚs', 
NO_LEADER
, [])

239 
´ÙocŞ
.
decode_m‘ad©a_»¥Ú£
.
»tuº_v®ue
 = 
	$M‘ad©aRe¥Ú£
(
brok”s
, 
tİics
)

241 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
=['broker_1:4567'])

243 #tİiø
m‘ad©a
 
is
 
lßded
 
but
 
em±y


244 
£lf
.
	`as£¹DiùEqu®
({
	}
}, 
	gş›Á
.
	gtİics_to_brok”s
)

246 
	gtİics
 = [

247 
TİicM‘ad©a
('tİic_Úe_·¹™iÚ', 
NO_ERROR
, [

248 
P¬t™iÚM‘ad©a
('tİic_no_·¹™iÚ', 0, 0, [0, 1], [0, 1], 
NO_ERROR
)

251 
	g´ÙocŞ
.
	gdecode_m‘ad©a_»¥Ú£
.
	g»tuº_v®ue
 = 
	$M‘ad©aRe¥Ú£
(
brok”s
, 
tİics
)

253 #ÿÎšg 
	`_g‘_Ëad”_fÜ_·¹™iÚ
 (
äom
 
ªy
 
brok”
 
aw¬e
 
»que¡
)

254 #wÈ
Œy
 
lßdšg
 
m‘ad©a
 
agaš
 
the
 
§me
 
tİic


255 
Ëad”
 = 
ş›Á
.
	`_g‘_Ëad”_fÜ_·¹™iÚ
('topic_one_partition', 0)

257 
£lf
.
	$as£¹Equ®
(
brok”s
[0], 
Ëad”
)

258 
£lf
.
	`as£¹DiùEqu®
({

259 
	`TİicAndP¬t™iÚ
('tİic_Úe_·¹™iÚ', 0): 
brok”s
[0]
	}
},

260 
	gş›Á
.
	gtİics_to_brok”s
)

262 @
·tch
('kafka.client.KafkaConnection')

263 @
·tch
('kafka.client.KafkaProtocol')

264 
def
 
	$‹¡_g‘_Ëad”_fÜ_uÇssigÃd_·¹™iÚs
(
£lf
, 
´ÙocŞ
, 
cÚn
):

266 
cÚn
.
»cv
.
»tuº_v®ue
 = '»¥Ú£' #ªythšg 
but
 
NÚe


268 
brok”s
 = [

269 
	`Brok”M‘ad©a
(0, 'broker_1', 4567),

270 
	`Brok”M‘ad©a
(1, 'brok”_2', 567
job
)

273 
tİics
 = [

274 
	`TİicM‘ad©a
(
b
'tİic_no_·¹™iÚs', 
NO_LEADER
, []),

275 
	`TİicM‘ad©a
(
b
'tİic_unknown', 
UNKNOWN_TOPIC_OR_PARTITION
, []),

277 
´ÙocŞ
.
decode_m‘ad©a_»¥Ú£
.
»tuº_v®ue
 = 
	$M‘ad©aRe¥Ú£
(
brok”s
, 
tİics
)

279 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
=['broker_1:4567'])

281 
£lf
.
	`as£¹DiùEqu®
({
	}
}, 
	gş›Á
.
	gtİics_to_brok”s
)

283 
w™h
 
	g£lf
.
	$as£¹Rai£s
(
L—d”NÙAvaabËE¼Ü
):

284 
ş›Á
.
	`_g‘_Ëad”_fÜ_·¹™iÚ
(
b
'topic_no_partitions', 0)

286 
w™h
 
£lf
.
	$as£¹Rai£s
(
UnknownTİicOrP¬t™iÚE¼Ü
):

287 
ş›Á
.
	`_g‘_Ëad”_fÜ_·¹™iÚ
(
b
'topic_unknown', 0)

289 @
	`·tch
('kafka.client.KafkaConnection')

290 @
	`·tch
('kafka.client.KafkaProtocol')

291 
def
 
	$‹¡_g‘_Ëad”_exû±iÚs_wh’_nŞ—d”
(
£lf
, 
´ÙocŞ
, 
cÚn
):

293 
cÚn
.
»cv
.
»tuº_v®ue
 = '»¥Ú£' #ªythšg 
but
 
NÚe


295 
brok”s
 = [

296 
	`Brok”M‘ad©a
(0, 'broker_1', 4567),

297 
	`Brok”M‘ad©a
(1, 'brok”_2', 567
job
)

300 
tİics
 = [

301 
	`TİicM‘ad©a
('tİic_nŞ—d”', 
NO_ERROR
, [

302 
	`P¬t™iÚM‘ad©a
('topic_noleader', 0, -1, [], [],

303 
NO_LEADER
),

304 
	`P¬t™iÚM‘ad©a
('topic_noleader', 1, -1, [], [],

305 
NO_LEADER
),

308 
´ÙocŞ
.
decode_m‘ad©a_»¥Ú£
.
»tuº_v®ue
 = 
	$M‘ad©aRe¥Ú£
(
brok”s
, 
tİics
)

310 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
=['broker_1:4567'])

311 
£lf
.
	`as£¹DiùEqu®
(

313 
	`TİicAndP¬t™iÚ
('tİic_nŞ—d”', 0): 
NÚe
,

314 
	`TİicAndP¬t™iÚ
('tİic_nŞ—d”', 1): 
NÚe


315 
	}
},

316 
	gş›Á
.
	gtİics_to_brok”s
)

318 #NØ
Ëad”
 
·¹™iÚs
 -- 
¿i£
 
L—d”NÙAvaabËE¼Ü


319 
w™h
 
	g£lf
.
	$as£¹Rai£s
(
L—d”NÙAvaabËE¼Ü
):

320 
£lf
.
	`as£¹IsNÚe
(
ş›Á
.
	`_g‘_Ëad”_fÜ_·¹™iÚ
('topic_noleader', 0))

321 
w™h
 
£lf
.
	$as£¹Rai£s
(
L—d”NÙAvaabËE¼Ü
):

322 
£lf
.
	`as£¹IsNÚe
(
ş›Á
.
	`_g‘_Ëad”_fÜ_·¹™iÚ
('topic_noleader', 1))

324 #UnknowÀ
·¹™iÚs
 -- 
¿i£
 
UnknownTİicOrP¬t™iÚE¼Ü


325 
w™h
 
£lf
.
	$as£¹Rai£s
(
UnknownTİicOrP¬t™iÚE¼Ü
):

326 
£lf
.
	`as£¹IsNÚe
(
ş›Á
.
	`_g‘_Ëad”_fÜ_·¹™iÚ
('topic_noleader', 2))

328 
tİics
 = [

329 
	`TİicM‘ad©a
('tİic_nŞ—d”', 
NO_ERROR
, [

330 
	`P¬t™iÚM‘ad©a
('tİic_nŞ—d”', 0, 0, [0, 1], [0, 1], 
NO_ERROR
),

331 
	`P¬t™iÚM‘ad©a
('tİic_nŞ—d”', 1, 1, [1, 0], [1, 0], 
NO_ERROR
)

334 
´ÙocŞ
.
decode_m‘ad©a_»¥Ú£
.
»tuº_v®ue
 = 
	$M‘ad©aRe¥Ú£
(
brok”s
, 
tİics
)

335 
£lf
.
	`as£¹Equ®
(
brok”s
[0], 
ş›Á
.
	`_g‘_Ëad”_fÜ_·¹™iÚ
('topic_noleader', 0))

336 
£lf
.
	`as£¹Equ®
(
brok”s
[1], 
ş›Á
.
	`_g‘_Ëad”_fÜ_·¹™iÚ
('topic_noleader', 1))

338 @
	`·tch
('kafka.client.KafkaConnection')

339 @
	`·tch
('kafka.client.KafkaProtocol')

340 
def
 
	$‹¡_£nd_´oduû_»que¡_¿i£s_wh’_nŞ—d”
(
£lf
, 
´ÙocŞ
, 
cÚn
):

343 
cÚn
.
»cv
.
»tuº_v®ue
 = '»¥Ú£' #ªythšg 
but
 
NÚe


345 
brok”s
 = [

346 
	`Brok”M‘ad©a
(0, 'broker_1', 4567),

347 
	`Brok”M‘ad©a
(1, 'brok”_2', 567
job
)

350 
tİics
 = [

351 
	`TİicM‘ad©a
('tİic_nŞ—d”', 
NO_ERROR
, [

352 
	`P¬t™iÚM‘ad©a
('topic_noleader', 0, -1, [], [],

353 
NO_LEADER
),

354 
	`P¬t™iÚM‘ad©a
('topic_noleader', 1, -1, [], [],

355 
NO_LEADER
),

358 
´ÙocŞ
.
decode_m‘ad©a_»¥Ú£
.
»tuº_v®ue
 = 
	$M‘ad©aRe¥Ú£
(
brok”s
, 
tİics
)

360 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
=['broker_1:4567'])

362 
»que¡s
 = [
	`ProduûReque¡
(

364 [
	`ü—‹_mes§ge
("a"), create_message("b")])]

366 
w™h
 
£lf
.
	$as£¹Rai£s
(
L—d”NÙAvaabËE¼Ü
):

367 
ş›Á
.
	`£nd_´oduû_»que¡
(
»que¡s
)

369 @
	`·tch
('kafka.client.KafkaConnection')

370 @
	`·tch
('kafka.client.KafkaProtocol')

371 
def
 
	$‹¡_£nd_´oduû_»que¡_¿i£s_wh’_tİic_unknown
(
£lf
, 
´ÙocŞ
, 
cÚn
):

373 
cÚn
.
»cv
.
»tuº_v®ue
 = '»¥Ú£' #ªythšg 
but
 
NÚe


375 
brok”s
 = [

376 
	`Brok”M‘ad©a
(0, 'broker_1', 4567),

377 
	`Brok”M‘ad©a
(1, 'brok”_2', 567
job
)

380 
tİics
 = [

381 
	`TİicM‘ad©a
('tİic_dÛ¢t_exi¡', 
UNKNOWN_TOPIC_OR_PARTITION
, []),

383 
´ÙocŞ
.
decode_m‘ad©a_»¥Ú£
.
»tuº_v®ue
 = 
	$M‘ad©aRe¥Ú£
(
brok”s
, 
tİics
)

385 
ş›Á
 = 
	`KafkaCl›Á
(
ho¡s
=['broker_1:4567'])

387 
»que¡s
 = [
	`ProduûReque¡
(

389 [
	`ü—‹_mes§ge
("a"), create_message("b")])]

391 
w™h
 
£lf
.
	$as£¹Rai£s
(
UnknownTİicOrP¬t™iÚE¼Ü
):

392 
ş›Á
.
	$£nd_´oduû_»que¡
(
»que¡s
)

394 
def
 
	$‹¡_timeout
(
£lf
):

395 
def
 
	$_timeout
(*
¬gs
, **
kw¬gs
):

396 
timeout
 = 
¬gs
[1]

397 
	$¦“p
(
timeout
)

398 
¿i£
 
sock‘
.
timeout


400 
w™h
 
·tch
.
	`objeù
(
sock‘
, "ü—‹_cÚÃùiÚ", 
side_efãù
=
_timeout
):

402 
w™h
 
	$Tim”
(è
as
 
t
:

403 
w™h
 
£lf
.
	$as£¹Rai£s
(
CÚÃùiÚE¼Ü
):

404 
	`KafkaCÚÃùiÚ
("nowhere", 1234, 1.0)

405 
£lf
.
	$as£¹G»©”Equ®
(
t
.
š‹rv®
, 1.0)

407 
def
 
	$‹¡_cÜ»ÏtiÚ_rŞlov”
(
£lf
):

408 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, 'load_metadata_for_topics'):

409 
big_num
 = 2**31 - 3

410 
ş›Á
 = 
	$KafkaCl›Á
(
ho¡s
=[], 
cÜ»ÏtiÚ_id
=
big_num
)

411 
£lf
.
	`as£¹Equ®
(
big_num
 + 1, 
ş›Á
.
	$_Ãxt_id
())

412 
£lf
.
	`as£¹Equ®
(
big_num
 + 2, 
ş›Á
.
	$_Ãxt_id
())

413 
£lf
.
	`as£¹Equ®
(0, 
ş›Á
.
	`_Ãxt_id
())

	@/root/grocery-shop/language/python/kafka/test/test_client_integration.py

1 
impÜt
 
os


3 
äom
 
	gkafka
.
commÚ
 
	$impÜt
 (

4 
F‘chReque¡
, 
Off£tComm™Reque¡
, 
Off£tF‘chReque¡
,

5 
KafkaTimeoutE¼Ü
, 
ProduûReque¡


7 
äom
 
kafka
.
´ÙocŞ
 
impÜt
 
ü—‹_mes§ge


9 
äom
 
‹¡
.
fixtu»s
 
impÜt
 
Zook“³rFixtu»
, 
KafkaFixtu»


10 
äom
 
‹¡
.
‹¡ut
 
impÜt
 
KafkaIÁeg¿tiÚTe¡Ca£
, 
kafka_v”siÚs


13 
şass
 
	$Te¡KafkaCl›ÁIÁeg¿tiÚ
(
KafkaIÁeg¿tiÚTe¡Ca£
):

14 @
şassm‘hod


15 
def
 
	$£tUpCÏss
(
şs
): #noqa

16 
nÙ
 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION'):

19 
şs
.
zk
 = 
Zook“³rFixtu»
.
	$š¡ªû
()

20 
şs
.
£rv”
 = 
KafkaFixtu»
.
	`š¡ªû
(0, cls.
zk
.
ho¡
, cls.zk.
pÜt
)

22 @
şassm‘hod


23 
def
 
	$‹¬DownCÏss
(
şs
): #noqa

24 
nÙ
 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION'):

27 
şs
.
£rv”
.
	$şo£
()

28 
şs
.
zk
.
	`şo£
()

30 @
	`kafka_v”siÚs
("all")

31 
def
 
	$‹¡_cÚsume_nÚe
(
£lf
):

32 
ãtch
 = 
	$F‘chReque¡
(
£lf
.
by‹s_tİic
, 0, 0, 1024)

34 
ãtch_»¥
, = 
£lf
.
ş›Á
.
	$£nd_ãtch_»que¡
([
ãtch
])

35 
£lf
.
	$as£¹Equ®
(
ãtch_»¥
.
”rÜ
, 0)

36 
£lf
.
	$as£¹Equ®
(
ãtch_»¥
.
tİic
, 
£lf
.
by‹s_tİic
)

37 
£lf
.
	$as£¹Equ®
(
ãtch_»¥
.
·¹™iÚ
, 0)

39 
mes§ges
 = 
	$li¡
(
ãtch_»¥
.
mes§ges
)

40 
£lf
.
	`as£¹Equ®
(
	`Ën
(
mes§ges
), 0)

42 @
	`kafka_v”siÚs
("all")

43 
def
 
	$‹¡_’su»_tİic_exi¡s
(
£lf
):

45 #assum
th©
 
£lf
.
tİic
 
was
 
ü—‹d
 
by
 
£tUp


46 #ià
so
, 
this
 
should
 
sucûed


47 
£lf
.
ş›Á
.
	$’su»_tİic_exi¡s
(
£lf
.
tİic
, 
timeout
=1)

49 #’su»_tİic_exi¡ 
should
 
ç
 
w™h
 
KafkaTimeoutE¼Ü


50 
w™h
 
£lf
.
	$as£¹Rai£s
(
KafkaTimeoutE¼Ü
):

51 
£lf
.
ş›Á
.
	`’su»_tİic_exi¡s
(
b
"this_tİic_dÛ¢t_exi¡", 
timeout
=0)

53 @
	`kafka_v”siÚs
('all')

54 
def
 
	$‹¡_£nd_´oduû_»que¡_maššs_»que¡_»¥Ú£_Üd”
(
£lf
):

56 
£lf
.
ş›Á
.
	`’su»_tİic_exi¡s
(
b
'foo')

57 
£lf
.
ş›Á
.
	`’su»_tİic_exi¡s
(
b
'bar')

59 
»que¡s
 = [

60 
	`ProduûReque¡
(

61 
b
'foo', 0,

62 [
	`ü—‹_mes§ge
(
b
'a'), create_message(b'b')]),

63 
	`ProduûReque¡
(

64 
b
'bar', 1,

65 [
	`ü—‹_mes§ge
(
b
'a'), create_message(b'b')]),

66 
	`ProduûReque¡
(

67 
b
'foo', 1,

68 [
	`ü—‹_mes§ge
(
b
'a'), create_message(b'b')]),

69 
	`ProduûReque¡
(

70 
b
'bar', 0,

71 [
	`ü—‹_mes§ge
(
b
'a'), create_message(b'b')]),

74 
»¥Ú£s
 = 
£lf
.
ş›Á
.
	$£nd_´oduû_»que¡
(
»que¡s
)

75 
	$Ën
(
»¥Ú£s
):

76 
»que¡
 = 
»que¡s
.
	$pİ
()

77 
»¥Ú£
 = 
»¥Ú£s
.
	$pİ
()

78 
£lf
.
	$as£¹Equ®
(
»que¡
.
tİic
, 
»¥Ú£
.topic)

79 
£lf
.
	$as£¹Equ®
(
»que¡
.
·¹™iÚ
, 
»¥Ú£
.partition)

83 #Off£ˆ
Te¡s
 #
####################

85 @
	`kafka_v”siÚs
("0.job.1", "0.job.1.1", "0.job.2.1")

86 
def
 
	$‹¡_comm™_ãtch_off£ts
(
£lf
):

87 
»q
 = 
	`Off£tComm™Reque¡
(
£lf
.
by‹s_tİic
, 0, 42, 
b
"metadata")

88 (
»¥
,èğ
£lf
.
ş›Á
.
	`£nd_off£t_comm™_»que¡
(
b
"group", [
»q
])

89 
£lf
.
	$as£¹Equ®
(
»¥
.
”rÜ
, 0)

91 
»q
 = 
	$Off£tF‘chReque¡
(
£lf
.
by‹s_tİic
, 0)

92 (
»¥
,èğ
£lf
.
ş›Á
.
	`£nd_off£t_ãtch_»que¡
(
b
"group", [
»q
])

93 
£lf
.
	$as£¹Equ®
(
»¥
.
”rÜ
, 0)

94 
£lf
.
	$as£¹Equ®
(
»¥
.
off£t
, 42)

95 
£lf
.
	`as£¹Equ®
(
»¥
.
m‘ad©a
, 
b
""è#M‘ad©¨
i¢
't stored for‚ow

	@/root/grocery-shop/language/python/kafka/test/test_codec.py

1 
impÜt
 

3 
äom
 
	gsix
.
moves
 
impÜt
 
x¿nge


4 
	gäom
 . 
impÜt
 
un™‹¡


6 
äom
 
	gkafka
.
codec
 
	$impÜt
 (

7 
has_¢­py
, 
gz_’code
, 
gz_decode
,

8 
¢­py_’code
, 
¢­py_decode


11 
äom
 
‹¡
.
‹¡ut
 
impÜt
 
¿ndom_¡ršg


13 
şass
 
	$Te¡Codec
(
un™‹¡
.
Te¡Ca£
):

14 
def
 
	$‹¡_gz
(
£lf
):

15 
i
 
š
 
	$x¿nge
(1000):

16 
b1
 = 
	`¿ndom_¡ršg
(100).
	`’code
('utf-job')

17 
b2
 = 
	`gz_decode
(
	$gz_’code
(
b1
))

18 
£lf
.
	`as£¹Equ®
(
b1
, 
b2
)

20 @
un™‹¡
.
	`skUÆess
(
	`has_¢­py
(), "Snappy‚ot‡vailable")

21 
def
 
	$‹¡_¢­py
(
£lf
):

22 
i
 
š
 
	$x¿nge
(1000):

23 
b1
 = 
	`¿ndom_¡ršg
(100).
	`’code
('utf-job')

24 
b2
 = 
	`¢­py_decode
(
	$¢­py_’code
(
b1
))

25 
£lf
.
	`as£¹Equ®
(
b1
, 
b2
)

27 @
un™‹¡
.
	`skUÆess
(
	`has_¢­py
(), "Snappy‚ot‡vailable")

28 
def
 
	$‹¡_¢­py_d‘eù_x”Ÿl
(
£lf
):

29 
impÜt
 
kafka
 
as
 
kafka1


30 
_d‘eù_x”Ÿl_¡»am
 = 
kafka1
.
codec
._detect_xerial_stream

32 
h—d”
 = 
b
'\xjob2SNAPPY\x00\x00\x00\x00\x01\x00\x00\x00\x01Someƒxtra bytes'

33 
çl£_h—d”
 = 
b
'\x01SNAPPY\x00\x00\x00\x01\x00\x00\x00\x01'

34 
¿ndom_¢­py
 = 
	`¢­py_’code
(
b
'SNAPPY' * 50)

35 
shÜt_d©a
 = 
b
'\x01\x02\x03\x04'

37 
£lf
.
	`as£¹True
(
	$_d‘eù_x”Ÿl_¡»am
(
h—d”
))

38 
£lf
.
	`as£¹F®£
(
	`_d‘eù_x”Ÿl_¡»am
(
b
''))

39 
£lf
.
	`as£¹F®£
(
	`_d‘eù_x”Ÿl_¡»am
(
b
'\x00'))

40 
£lf
.
	`as£¹F®£
(
	$_d‘eù_x”Ÿl_¡»am
(
çl£_h—d”
))

41 
£lf
.
	`as£¹F®£
(
	$_d‘eù_x”Ÿl_¡»am
(
¿ndom_¢­py
))

42 
£lf
.
	`as£¹F®£
(
	`_d‘eù_x”Ÿl_¡»am
(
shÜt_d©a
))

44 @
un™‹¡
.
	`skUÆess
(
	`has_¢­py
(), "Snappy‚ot‡vailable")

45 
def
 
	$‹¡_¢­py_decode_x”Ÿl
(
£lf
):

46 
h—d”
 = 
b
'\xjob2SNAPPY\x00\x00\x00\x00\x01\x00\x00\x00\x01'

47 
¿ndom_¢­py
 = 
	`¢­py_’code
(
b
'SNAPPY' * 50)

48 
block_Ën
 = 
	$Ën
(
¿ndom_¢­py
)

49 
¿ndom_¢­py2
 = 
	`¢­py_’code
(
b
'XERIAL' * 50)

50 
block_Ën2
 = 
	$Ën
(
¿ndom_¢­py2
)

52 
to_‹¡
 = 
h—d”
 \

53 + .
	`·ck
('!i', 
block_Ën
è+ 
¿ndom_¢­py
 \

54 + .
	`·ck
('!i', 
block_Ën2
è+ 
¿ndom_¢­py2
 \

56 
£lf
.
	`as£¹Equ®
(
	`¢­py_decode
(
to_‹¡
), (
b
'SNAPPY' * 50) + (b'XERIAL' * 50))

58 @
un™‹¡
.
	`skUÆess
(
	`has_¢­py
(), "Snappy‚ot‡vailable")

59 
def
 
	$‹¡_¢­py_’code_x”Ÿl
(
£lf
):

60 
to_’su»
 = (

61 
b
'\xjob2SNAPPY\x00\x00\x00\x00\x01\x00\x00\x00\x01'

62 
b
'\x00\x00\x00\x1job'

63 
b
'\xac\x02\x14SNAPPY\xfe\x06\x00\xfe\x06\x00\xfe\x06\x00\xfe\x06\x00\x96\x06\x00'

64 
b
'\x00\x00\x00\x1job'

65 
b
'\xac\x02\x14XERIAL\xfe\x06\x00\xfe\x06\x00\xfe\x06\x00\xfe\x06\x00\x96\x06\x00'

68 
to_‹¡
 = (
b
'SNAPPY' * 50) + (b'XERIAL' * 50)

70 
com´es£d
 = 
	$¢­py_’code
(
to_‹¡
, 
x”Ÿl_com·tibË
=
True
, 
x”Ÿl_blocksize
=300)

71 
£lf
.
	`as£¹Equ®
(
com´es£d
, 
to_’su»
)

	@/root/grocery-shop/language/python/kafka/test/test_conn.py

1 
impÜt
 
loggšg


2 
impÜt
 
sock‘


3 
impÜt
 

4 
äom
 
th»adšg
 
impÜt
 
Th»ad


6 
impÜt
 
mock


7 
	gäom
 . 
impÜt
 
un™‹¡


9 
äom
 
	gkafka
.
commÚ
 
impÜt
 
CÚÃùiÚE¼Ü


10 
äom
 
	gkafka
.
cÚn
 
impÜt
 
	gKafkaCÚÃùiÚ
, 
	gcŞËù_ho¡s
, 
DEFAULT_SOCKET_TIMEOUT_SECONDS


12 
şass
 
	$CÚnTe¡
(
un™‹¡
.
Te¡Ca£
):

13 
def
 
	$£tUp
(
£lf
):

15 #kafka.
cÚn
 
debug
 
loggšg
 
is
 
v”bo£
, 
so
 
Úly
 
’abË
 
š
 cÚÀ
‹¡s


16 
loggšg
.
	`g‘Logg”
('kafka.cÚn').
	$£tLev–
(
loggšg
.
DEBUG
)

18 
£lf
.
cÚfig
 = {

22 '·ylßd': 
b
'test data',

23 '·ylßd2': 
b
'another…acket'

24 
	}
}

26 #Mockšg 
sock‘
.
ü—‹_cÚÃùiÚ
 
wl
 
ÿu£
 
_sock
 
to
 
®ways
 
be
 
a


28 
·tch”
 = 
mock
.
·tch
('sock‘.ü—‹_cÚÃùiÚ', 
¥ec
=
True
)

29 
£lf
.
MockC»©eCÚn
 = 
·tch”
.
	$¡¬t
()

30 
£lf
.
	$addCËªup
(
·tch”
.
¡İ
)

32 #AlsØ
mock
 
sock‘
.
	`£nd®l
(è
to
 
­³¬
 
sucûssful


33 
£lf
.
	`MockC»©eCÚn
().
£nd®l
.
»tuº_v®ue
 = 
NÚe


35 #And 
mock
 
sock‘
.
	`»cv
(è
to
  
two
 
·ylßds
, 
th’
 '',h’ 
¿i£


36 #NÙ
th©
 
this
 
cu¼’y
 
ignÜes
 
the
 
num_by‹s
 
·¿m‘”
 
to
 
sock
.
	`»cv
()

37 
·ylßd_size
 = 
	`Ën
(
£lf
.
cÚfig
['payload'])

38 
·ylßd2_size
 = 
	`Ën
(
£lf
.
cÚfig
['payload2'])

39 
£lf
.
	`MockC»©eCÚn
().
»cv
.
side_efãù
 = [

40 .
	`·ck
('>i', 
·ylßd_size
),

41 .
	`·ck
('>%ds' % 
·ylßd_size
, 
£lf
.
cÚfig
['payload']),

42 .
	`·ck
('>i', 
·ylßd2_size
),

43 .
	`·ck
('>%ds' % 
·ylßd2_size
, 
£lf
.
cÚfig
['payload2']),

44 
b
''

47 #C»©
a
 
cÚÃùiÚ
 
objeù


48 
£lf
.
cÚn
 = 
	`KafkaCÚÃùiÚ
(£lf.
cÚfig
['host'], self.config['port'])

50 #Re£ˆ
ªy
 
mock
 
couÁs
 
ÿu£d
 
by
 
__š™__


51 
£lf
.
MockC»©eCÚn
.
	$»£t_mock
()

53 
def
 
	$‹¬Down
(
£lf
):

54 #R‘uº 
cÚÃùiÚ
 
loggšg
 
to
 
INFO


55 
loggšg
.
	`g‘Logg”
('kafka.cÚn').
	$£tLev–
(
loggšg
.
INFO
)

58 
def
 
	$‹¡_cŞËù_ho¡s__h­py_·th
(
£lf
):

59 
ho¡s
 = "localhost:1234,localhost"

60 
»suÉs
 = 
	$cŞËù_ho¡s
(
ho¡s
)

62 
£lf
.
	`as£¹Equ®
(
	`£t
(
»suÉs
), set([

67 
def
 
	$‹¡_cŞËù_ho¡s__¡ršg_li¡
(
£lf
):

68 
ho¡s
 = [

73 
»suÉs
 = 
	$cŞËù_ho¡s
(
ho¡s
)

75 
£lf
.
	`as£¹Equ®
(
	`£t
(
»suÉs
), set([

80 
def
 
	$‹¡_cŞËù_ho¡s__w™h_¥aûs
(
£lf
):

81 
ho¡s
 = "localhost:1234,†ocalhost"

82 
»suÉs
 = 
	$cŞËù_ho¡s
(
ho¡s
)

84 
£lf
.
	`as£¹Equ®
(
	`£t
(
»suÉs
), set([

89 
def
 
	$‹¡_£nd
(
£lf
):

90 
£lf
.
cÚn
.
	`£nd
(£lf.
cÚfig
['request_id'], self.config['payload'])

91 
£lf
.
cÚn
.
_sock
.
£nd®l
.
	`as£¹_ÿÎed_w™h
(£lf.
cÚfig
['payload'])

93 
def
 
	$‹¡_š™_ü—‹s_sock‘_cÚÃùiÚ
(
£lf
):

94 
	`KafkaCÚÃùiÚ
(
£lf
.
cÚfig
['host'], self.config['port'])

95 
£lf
.
MockC»©eCÚn
.
	`as£¹_ÿÎed_w™h
((£lf.
cÚfig
['ho¡'], s–f.cÚfig['pÜt']), 
DEFAULT_SOCKET_TIMEOUT_SECONDS
)

97 
def
 
	$‹¡_š™_çu»_¿i£s_cÚÃùiÚ_”rÜ
(
£lf
):

99 
def
 
	$¿i£_”rÜ
(*
¬gs
):

100 
¿i£
 
sock‘
.
”rÜ


102 
as£¹
 
sock‘
.
ü—‹_cÚÃùiÚ
 
is
 
£lf
.
MockC»©eCÚn


103 
sock‘
.
ü—‹_cÚÃùiÚ
.
side_efãù
=
¿i£_”rÜ


104 
w™h
 
£lf
.
	$as£¹Rai£s
(
CÚÃùiÚE¼Ü
):

105 
	`KafkaCÚÃùiÚ
(
£lf
.
cÚfig
['host'], self.config['port'])

107 
def
 
	$‹¡_£nd__»cÚÃùs_Ú_dœty_cÚn
(
£lf
):

109 #Dœty 
the
 
cÚÃùiÚ


110 
Œy
:

111 
£lf
.
cÚn
.
	$_¿i£_cÚÃùiÚ_”rÜ
()

112 
exû±
 
CÚÃùiÚE¼Ü
:

113 
·ss


115 #Now 
‹¡
 
th©
 
£ndšg
 
©‹m±s
 
to
 
»cÚÃù


116 
£lf
.
	$as£¹Equ®
(
£lf
.
MockC»©eCÚn
.
ÿÎ_couÁ
, 0)

117 
£lf
.
cÚn
.
	`£nd
(£lf.
cÚfig
['request_id'], self.config['payload'])

118 
£lf
.
	$as£¹Equ®
(
£lf
.
MockC»©eCÚn
.
ÿÎ_couÁ
, 1)

120 
def
 
	$‹¡_£nd__çu»_£ts_dœty_cÚÃùiÚ
(
£lf
):

122 
def
 
	$¿i£_”rÜ
(*
¬gs
):

123 
¿i£
 
sock‘
.
”rÜ


125 
as£¹
 
	$isš¡ªû
(
£lf
.
cÚn
.
_sock
, 
mock
.
Mock
)

126 
£lf
.
cÚn
.
_sock
.
£nd®l
.
side_efãù
=
¿i£_”rÜ


127 
Œy
:

128 
£lf
.
cÚn
.
	`£nd
(£lf.
cÚfig
['request_id'], self.config['payload'])

129 
exû±
 
CÚÃùiÚE¼Ü
:

130 
£lf
.
	$as£¹IsNÚe
(
£lf
.
cÚn
.
_sock
)

132 
def
 
	$‹¡_»cv
(
£lf
):

134 
£lf
.
	`as£¹Equ®
(£lf.
cÚn
.
	`»cv
(£lf.
cÚfig
['request_id']), self.config['payload'])

136 
def
 
	$‹¡_»cv__»cÚÃùs_Ú_dœty_cÚn
(
£lf
):

138 #Dœty 
the
 
cÚÃùiÚ


139 
Œy
:

140 
£lf
.
cÚn
.
	$_¿i£_cÚÃùiÚ_”rÜ
()

141 
exû±
 
CÚÃùiÚE¼Ü
:

142 
·ss


144 #Now 
‹¡
 
th©
 
»cv
'ing‡ttemptso„econnect

145 
£lf
.
	$as£¹Equ®
(
£lf
.
MockC»©eCÚn
.
ÿÎ_couÁ
, 0)

146 
£lf
.
cÚn
.
	`»cv
(£lf.
cÚfig
['request_id'])

147 
£lf
.
	$as£¹Equ®
(
£lf
.
MockC»©eCÚn
.
ÿÎ_couÁ
, 1)

149 
def
 
	$‹¡_»cv__çu»_£ts_dœty_cÚÃùiÚ
(
£lf
):

151 
def
 
	$¿i£_”rÜ
(*
¬gs
):

152 
¿i£
 
sock‘
.
”rÜ


154 #‹¡ 
th©
 
»cv
'ing‡ttemptso„econnect

155 
as£¹
 
	$isš¡ªû
(
£lf
.
cÚn
.
_sock
, 
mock
.
Mock
)

156 
£lf
.
cÚn
.
_sock
.
»cv
.
side_efãù
=
¿i£_”rÜ


157 
Œy
:

158 
£lf
.
cÚn
.
	`»cv
(£lf.
cÚfig
['request_id'])

159 
exû±
 
CÚÃùiÚE¼Ü
:

160 
£lf
.
	$as£¹IsNÚe
(
£lf
.
cÚn
.
_sock
)

162 
def
 
	$‹¡_»cv__dÛ¢t_cÚsume_exŒa_d©a_š_¡»am
(
£lf
):

164 #H”
ju¡
 
‹¡
 
th©
 
—ch
 
ÿÎ
 
to
 
»cv
 
wl
  
a
 
sšgË
 
·ylßd


165 
£lf
.
	`as£¹Equ®
(£lf.
cÚn
.
	`»cv
(£lf.
cÚfig
['request_id']), self.config['payload'])

166 
£lf
.
	`as£¹Equ®
(£lf.
cÚn
.
	`»cv
(£lf.
cÚfig
['request_id']), self.config['payload2'])

168 
def
 
	$‹¡_şo£__objeù_is_»u§bË
(
£lf
):

170 #‹¡ 
th©
 
£ndšg
 
to
 
a
 
şo£d
 
cÚÃùiÚ


171 #wÈ
»
-
cÚÃù
 
ªd
 
£nd
 
d©a
 
to
 
the
 
sock‘


172 
£lf
.
cÚn
.
	$şo£
()

173 
£lf
.
cÚn
.
	`£nd
(£lf.
cÚfig
['request_id'], self.config['payload'])

174 
£lf
.
	$as£¹Equ®
(
£lf
.
MockC»©eCÚn
.
ÿÎ_couÁ
, 1)

175 
£lf
.
cÚn
.
_sock
.
£nd®l
.
	`as£¹_ÿÎed_w™h
(£lf.
cÚfig
['payload'])

178 
şass
 
	$Te¡KafkaCÚÃùiÚ
(
un™‹¡
.
Te¡Ca£
):

180 
def
 
	$£tUp
(
£lf
):

181 #kafka.
cÚn
 
debug
 
loggšg
 
is
 
v”bo£
, 
so
 
Úly
 
’abË
 
š
 cÚÀ
‹¡s


182 
loggšg
.
	`g‘Logg”
('kafka.cÚn').
	$£tLev–
(
loggšg
.
DEBUG
)

184 
def
 
	$‹¬Down
(
£lf
):

185 #R‘uº 
cÚÃùiÚ
 
loggšg
 
to
 
INFO


186 
loggšg
.
	`g‘Logg”
('kafka.cÚn').
	`£tLev–
Öoggšg.
INFO
)

188 @
mock
.
	`·tch
('socket.create_connection')

189 
def
 
	$‹¡_cİy
(
£lf
, 
sock‘
):

192 
cÚn
 = 
	`KafkaCÚÃùiÚ
('kafka', 9092)

193 
£lf
.
	$as£¹Equ®
(
sock‘
.
ÿÎ_couÁ
, 1)

195 
cİy
 = 
cÚn
.
	$cİy
()

196 
£lf
.
	$as£¹Equ®
(
sock‘
.
ÿÎ_couÁ
, 1)

197 
£lf
.
	`as£¹Equ®
(
cİy
.
ho¡
, 'kafka')

198 
£lf
.
	$as£¹Equ®
(
cİy
.
pÜt
, 9092)

199 
£lf
.
	$as£¹Equ®
(
cİy
.
_sock
, 
NÚe
)

201 
cİy
.
	$»š™
()

202 
£lf
.
	$as£¹Equ®
(
sock‘
.
ÿÎ_couÁ
, 2)

203 
£lf
.
	`as£¹NÙEqu®
(
cİy
.
_sock
, 
NÚe
)

205 @
mock
.
	`·tch
('socket.create_connection')

206 
def
 
	$‹¡_cİy_th»ad
(
£lf
, 
sock‘
):

209 
”r
 = []

210 
cİy
 = 
	`KafkaCÚÃùiÚ
('kafka', 9092).
	$cİy
()

212 
def
 
	$th»ad_func
(
”r
, 
cİy
):

213 
Œy
:

214 
£lf
.
	`as£¹Equ®
(
cİy
.
ho¡
, 'kafka')

215 
£lf
.
	$as£¹Equ®
(
cİy
.
pÜt
, 9092)

216 
£lf
.
	$as£¹NÙEqu®
(
cİy
.
_sock
, 
NÚe
)

217 
exû±
 
Exû±iÚ
 
as
 
e
:

218 
”r
.
	$­³nd
(
e
)

220 
”r
.
	$­³nd
(
NÚe
)

221 
th»ad
 = 
	`Th»ad
(
rg‘
=
th»ad_func
, 
¬gs
=(
”r
, 
cİy
))

222 
th»ad
.
	$¡¬t
()

223 
th»ad
.
	$još
()

225 
£lf
.
	$as£¹Equ®
(
”r
, [
NÚe
])

226 
£lf
.
	`as£¹Equ®
(
sock‘
.
ÿÎ_couÁ
, 2)

	@/root/grocery-shop/language/python/kafka/test/test_consumer.py

2 
äom
 
mock
 
impÜt
 
	gMagicMock
, 
·tch


3 
	gäom
 . 
impÜt
 
un™‹¡


5 
äom
 
kafka
 
impÜt
 
	gSim¶eCÚsum”
, 
	gKafkaCÚsum”
, 
MuÉiProûssCÚsum”


6 
äom
 
	gkafka
.
commÚ
 
	$impÜt
 (

7 
KafkaCÚfigu¿tiÚE¼Ü
, 
F‘chRe¥Ú£
, 
Off£tF‘chRe¥Ú£
,

8 
FaedPaylßdsE¼Ü
, 
Off£tAndMes§ge
,

9 
NÙL—d”FÜP¬t™iÚE¼Ü
, 
UnknownTİicOrP¬t™iÚE¼Ü


13 
şass
 
	$Te¡KafkaCÚsum”
(
un™‹¡
.
Te¡Ca£
):

14 
def
 
	$‹¡_nÚ_š‹g”_·¹™iÚs
(
£lf
):

15 
w™h
 
£lf
.
	$as£¹Rai£s
(
As£¹iÚE¼Ü
):

16 
	`Sim¶eCÚsum”
(
	`MagicMock
(), 'group', 'tİic', 
·¹™iÚs
 = [ '0' ])

18 
def
 
	$‹¡_brok”_li¡_»quœed
(
£lf
):

19 
w™h
 
£lf
.
	$as£¹Rai£s
(
KafkaCÚfigu¿tiÚE¼Ü
):

20 
	$KafkaCÚsum”
()

23 
şass
 
	$Te¡MuÉiProûssCÚsum”
(
un™‹¡
.
Te¡Ca£
):

24 
def
 
	$‹¡_·¹™iÚ_li¡
(
£lf
):

25 
ş›Á
 = 
	$MagicMock
()

26 
·¹™iÚs
 = (0,)

27 
w™h
 
·tch
.
	`objeù
(
MuÉiProûssCÚsum”
, 'ãtch_Ï¡_known_off£ts'è
as
 
ãtch_Ï¡_known_off£ts
:

28 
	`MuÉiProûssCÚsum”
(
ş›Á
, '‹¡šg-group', '‹¡šg-tİic', 
·¹™iÚs
=partitions)

29 
£lf
.
	`as£¹Equ®
(
ãtch_Ï¡_known_off£ts
.
ÿÎ_¬gs
[0], (
·¹™iÚs
,) )

30 
£lf
.
	$as£¹Equ®
(
ş›Á
.
g‘_·¹™iÚ_ids_fÜ_tİic
.
ÿÎ_couÁ
, 0è#pylšt: 
di§bË
=
no
-
memb”


32 
şass
 
	$Te¡Sim¶eCÚsum”
(
un™‹¡
.
Te¡Ca£
):

33 
def
 
	$‹¡_sim¶e_cÚsum”_çed_·ylßds
(
£lf
):

34 
ş›Á
 = 
	$MagicMock
()

35 
cÚsum”
 = 
	`Sim¶eCÚsum”
(
ş›Á
, 
group
=
NÚe
,

36 
tİic
='tİic', 
·¹™iÚs
=[0, 1],

37 
auto_comm™
=
F®£
)

39 
def
 
	$çed_·ylßds
(
·ylßd
):

40  
	$FaedPaylßdsE¼Ü
(
·ylßd
)

42 
ş›Á
.
£nd_ãtch_»que¡
.
side_efãù
 = 
£lf
.
	$ç_»que¡s_çùÜy
(
çed_·ylßds
)

44 #Thi 
should
 
nÙ
 
¿i£
 
ª
 
exû±iÚ


45 
cÚsum”
.
	$g‘_mes§ges
(5)

47 
def
 
	$‹¡_sim¶e_cÚsum”_Ëad”_chªge
(
£lf
):

48 
ş›Á
 = 
	$MagicMock
()

49 
cÚsum”
 = 
	`Sim¶eCÚsum”
(
ş›Á
, 
group
=
NÚe
,

50 
tİic
='tİic', 
·¹™iÚs
=[0, 1],

51 
auto_comm™
=
F®£
)

53 #Mock 
so
 
th©
 
Úly
 
the
 
fœ¡
 
»que¡
 
g‘s
 
a
 
v®id
 
»¥Ú£


54 
def
 
	$nÙ_Ëad”
(
»que¡
):

55  
	`F‘chRe¥Ú£
(
»que¡
.
tİic
,„eque¡.
·¹™iÚ
,

56 
NÙL—d”FÜP¬t™iÚE¼Ü
.
”ºo
, -1, ())

58 
ş›Á
.
£nd_ãtch_»que¡
.
side_efãù
 = 
£lf
.
	$ç_»que¡s_çùÜy
(
nÙ_Ëad”
)

60 #Thi 
should
 
nÙ
 
¿i£
 
ª
 
exû±iÚ


61 
cÚsum”
.
	$g‘_mes§ges
(20)

63 #ş›Á 
should
 
have
 
upd©ed
 
m‘ad©a


64 
£lf
.
	$as£¹G»©”Equ®
(
ş›Á
.
»£t_tİic_m‘ad©a
.
ÿÎ_couÁ
, 1)

65 
£lf
.
	$as£¹G»©”Equ®
(
ş›Á
.
lßd_m‘ad©a_fÜ_tİics
.
ÿÎ_couÁ
, 1)

67 
def
 
	$‹¡_sim¶e_cÚsum”_unknown_tİic_·¹™iÚ
(
£lf
):

68 
ş›Á
 = 
	$MagicMock
()

69 
cÚsum”
 = 
	`Sim¶eCÚsum”
(
ş›Á
, 
group
=
NÚe
,

70 
tİic
='tİic', 
·¹™iÚs
=[0, 1],

71 
auto_comm™
=
F®£
)

73 #Mock 
so
 
th©
 
Úly
 
the
 
fœ¡
 
»que¡
 
g‘s
 
a
 
v®id
 
»¥Ú£


74 
def
 
	$unknown_tİic_·¹™iÚ
(
»que¡
):

75  
	`F‘chRe¥Ú£
(
»que¡
.
tİic
,„eque¡.
·¹™iÚ
,

76 
UnknownTİicOrP¬t™iÚE¼Ü
.
”ºo
, -1, ())

78 
ş›Á
.
£nd_ãtch_»que¡
.
side_efãù
 = 
£lf
.
	$ç_»que¡s_çùÜy
(
unknown_tİic_·¹™iÚ
)

80 #Thi 
should
 
nÙ
 
¿i£
 
ª
 
exû±iÚ


81 
w™h
 
£lf
.
	$as£¹Rai£s
(
UnknownTİicOrP¬t™iÚE¼Ü
):

82 
cÚsum”
.
	$g‘_mes§ges
(20)

84 
def
 
	$‹¡_sim¶e_cÚsum”_comm™_dÛs_nÙ_¿i£
(
£lf
):

85 
ş›Á
 = 
	$MagicMock
()

86 
ş›Á
.
g‘_·¹™iÚ_ids_fÜ_tİic
.
»tuº_v®ue
 = [0, 1]

88 
def
 
	$mock_off£t_ãtch_»que¡
(
group
, 
·ylßds
, **
kw¬gs
):

89  [
	`Off£tF‘chRe¥Ú£
(
p
.
tİic
,….
·¹™iÚ
, 0, 
b
'', 0è°
š
 
·ylßds
]

91 
ş›Á
.
£nd_off£t_ãtch_»que¡
.
side_efãù
 = 
mock_off£t_ãtch_»que¡


93 
def
 
	$mock_off£t_comm™_»que¡
(
group
, 
·ylßds
, **
kw¬gs
):

94 
¿i£
 
	$FaedPaylßdsE¼Ü
(
·ylßds
[0])

96 
ş›Á
.
£nd_off£t_comm™_»que¡
.
side_efãù
 = 
mock_off£t_comm™_»que¡


98 
cÚsum”
 = 
	`Sim¶eCÚsum”
(
ş›Á
, 
group
='foobar',

99 
tİic
='tİic', 
·¹™iÚs
=[0, 1],

100 
auto_comm™
=
F®£
)

102 #Mock 
š‹º®
 
comm™
 
check


103 
cÚsum”
.
couÁ_sšû_comm™
 = 10

105 #Thi 
should
 
nÙ
 
¿i£
 
ª
 
exû±iÚ


106 
£lf
.
	`as£¹F®£
(
cÚsum”
.
	$comm™
(
·¹™iÚs
=[0, 1]))

108 
def
 
	$‹¡_sim¶e_cÚsum”_»£t_·¹™iÚ_off£t
(
£lf
):

109 
ş›Á
 = 
	$MagicMock
()

111 
def
 
	$mock_off£t_»que¡
(
·ylßds
, **
kw¬gs
):

112 
¿i£
 
	$FaedPaylßdsE¼Ü
(
·ylßds
[0])

114 
ş›Á
.
£nd_off£t_»que¡
.
side_efãù
 = 
mock_off£t_»que¡


116 
cÚsum”
 = 
	`Sim¶eCÚsum”
(
ş›Á
, 
group
='foobar',

117 
tİic
='tİic', 
·¹™iÚs
=[0, 1],

118 
auto_comm™
=
F®£
)

120 #Thi 
should
 
nÙ
 
¿i£
 
ª
 
exû±iÚ


121 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
	`»£t_·¹™iÚ_off£t
(0), 
NÚe
)

123 @
¡©icm‘hod


124 
def
 
	$ç_»que¡s_çùÜy
(
”rÜ_çùÜy
):

125 #Mock 
so
 
th©
 
Úly
 
the
 
fœ¡
 
»que¡
 
g‘s
 
a
 
v®id
 
»¥Ú£


126 
def
 
	$ç_»que¡s
(
·ylßds
, **
kw¬gs
):

127 
»¥Ú£s
 = [

128 
	`F‘chRe¥Ú£
(
·ylßds
[0].
tİic
,…aylßds[0].
·¹™iÚ
, 0, 0,

129 (
	`Off£tAndMes§ge
(

130 
·ylßds
[0].
off£t
 + 
i
,

131 "msg %d" % (
·ylßds
[0].
off£t
 + 
i
))

132 
i
 
š
 
	`¿nge
(10))),

134 
çu»
 
š
 
·ylßds
[1:]:

135 
»¥Ú£s
.
	`­³nd
(
	$”rÜ_çùÜy
(
çu»
))

136  
»¥Ú£s


137  
ç_»que¡s


140 
__Çme__
 == '__main__':

142 
·ss


	@/root/grocery-shop/language/python/kafka/test/test_consumer_integration.py

1 
impÜt
 
loggšg


2 
impÜt
 
os


4 
äom
 
	gsix
.
moves
 
impÜt
 
x¿nge


6 
äom
 
kafka
 
	$impÜt
 (

7 
KafkaCÚsum”
, 
MuÉiProûssCÚsum”
, 
Sim¶eCÚsum”
, 
ü—‹_mes§ge


9 
äom
 
kafka
.
commÚ
 
	$impÜt
 (

10 
ProduûReque¡
, 
CÚsum”F‘chSizeTooSm®l
, 
CÚsum”Timeout
,

11 
Off£tOutOfRªgeE¼Ü


13 
äom
 
kafka
.
cÚsum”
.
ba£
 
impÜt
 
MAX_FETCH_BUFFER_SIZE_BYTES


15 
äom
 
‹¡
.
fixtu»s
 
impÜt
 
Zook“³rFixtu»
, 
KafkaFixtu»


16 
äom
 
‹¡
.
‹¡ut
 
	$impÜt
 (

17 
KafkaIÁeg¿tiÚTe¡Ca£
, 
kafka_v”siÚs
, 
¿ndom_¡ršg
, 
Tim”


21 
şass
 
	$Te¡CÚsum”IÁeg¿tiÚ
(
KafkaIÁeg¿tiÚTe¡Ca£
):

22 @
şassm‘hod


23 
def
 
	$£tUpCÏss
(
şs
):

24 
nÙ
 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION'):

27 
şs
.
zk
 = 
Zook“³rFixtu»
.
	$š¡ªû
()

28 
şs
.
£rv”1
 = 
KafkaFixtu»
.
	$š¡ªû
(0, 
şs
.
zk
.
ho¡
, cls.zk.
pÜt
)

29 
şs
.
£rv”2
 = 
KafkaFixtu»
.
	$š¡ªû
(1, 
şs
.
zk
.
ho¡
, cls.zk.
pÜt
)

31 
şs
.
£rv”
 = cls.
£rv”1
 #Bootstrapping server

33 @
şassm‘hod


34 
def
 
	$‹¬DownCÏss
(
şs
):

35 
nÙ
 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION'):

38 
şs
.
£rv”1
.
	$şo£
()

39 
şs
.
£rv”2
.
	$şo£
()

40 
şs
.
zk
.
	$şo£
()

42 
def
 
	$£nd_mes§ges
(
£lf
, 
·¹™iÚ
, 
mes§ges
):

43 
mes§ges
 = [ 
	`ü—‹_mes§ge
(
£lf
.
	`msg
(
	$¡r
(
msg
))èmsg 
š
 
mes§ges
 ]

44 
´oduû
 = 
	$ProduûReque¡
(
£lf
.
by‹s_tİic
, 
·¹™iÚ
, 
mes§ges
 = messages)

45 
»¥
, = 
£lf
.
ş›Á
.
	$£nd_´oduû_»que¡
([
´oduû
])

46 
£lf
.
	$as£¹Equ®
(
»¥
.
”rÜ
, 0)

48  [ 
x
.
v®ue
 x 
š
 
mes§ges
 ]

50 
def
 
	$as£¹_mes§ge_couÁ
(
£lf
, 
mes§ges
, 
num_mes§ges
):

51 #Mak
su»
 
we
 
gÙ
 
them
 
®l


52 
£lf
.
	`as£¹Equ®
(
	`Ën
(
mes§ges
), 
num_mes§ges
)

54 #Mak
su»
 
th”e
 
¬e
 
no
 
du¶iÿ‹s


55 
£lf
.
	`as£¹Equ®
(
	`Ën
(
	`£t
(
mes§ges
)), 
num_mes§ges
)

57 
def
 
	$cÚsum”
(
£lf
, **
kw¬gs
):

58 
os
.
’vœÚ
['KAFKA_VERSION'] == "0.job.0":

59 #Kafk¨0.
job
.0 
sim¶y
 
dÛ¢
't support offset„equests, so hard code it being off

60 
kw¬gs
['group'] = 
NÚe


61 
kw¬gs
['auto_comm™'] = 
F®£


63 
kw¬gs
.
	`£tdeçuÉ
('auto_comm™', 
True
)

65 
cÚsum”_şass
 = 
kw¬gs
.
	`pİ
('cÚsum”', 
Sim¶eCÚsum”
)

66 
group
 = 
kw¬gs
.
	`pİ
('group', 
£lf
.
	`id
().
	`’code
('utf-job'))

67 
tİic
 = 
kw¬gs
.
	`pİ
('tİic', 
£lf
.topic)

69 
cÚsum”_şass
 
š
 [
Sim¶eCÚsum”
, 
MuÉiProûssCÚsum”
]:

70 
kw¬gs
.
	`£tdeçuÉ
('iter_timeout', 0)

72  
	$cÚsum”_şass
(
£lf
.
ş›Á
, 
group
, 
tİic
, **
kw¬gs
)

74 
def
 
	$kafka_cÚsum”
(
£lf
, **
cÚfigs
):

75 
brok”s
 = '%s:%d' % (
£lf
.
£rv”
.
ho¡
, s–f.£rv”.
pÜt
)

76 
cÚsum”
 = 
	$KafkaCÚsum”
(
£lf
.
tİic
,

77 
boÙ¡¿p_£rv”s
=
brok”s
,

78 **
cÚfigs
)

79  
cÚsum”


81 @
	`kafka_v”siÚs
("all")

82 
def
 
	$‹¡_sim¶e_cÚsum”
(
£lf
):

83 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 100))

84 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(100, 200))

86 #S¹ 
a
 
cÚsum”


87 
cÚsum”
 = 
£lf
.
	$cÚsum”
()

89 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”
 ], 200)

91 
cÚsum”
.
	`¡İ
()

93 @
	`kafka_v”siÚs
('all')

94 
def
 
	$‹¡_sim¶e_cÚsum”_sm®Ë¡_off£t_»£t
(
£lf
):

95 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 100))

96 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(100, 200))

98 
cÚsum”
 = 
£lf
.
	`cÚsum”
(
auto_off£t_»£t
='smallest')

99 #Mov
ãtch
 
off£t
 
ah—d
 
of
 300 
	`mes§ge
 (
out
 oà
¿nge
)

100 
cÚsum”
.
	$£ek
(300, 2)

101 #Sšû 
auto_off£t_»£t
 
is
 
£t
 
to
 
sm®Ë¡
 
we
 
should
 
»ad
 
®l
 200

102 #mes§ge 
äom
 
begšnšg
.

103 
£lf
.
	`as£¹_mes§ge_couÁ
([
mes§ge
 mes§g
š
 
cÚsum”
], 200)

105 @
	`kafka_v”siÚs
('all')

106 
def
 
	$‹¡_sim¶e_cÚsum”_Ïrge¡_off£t_»£t
(
£lf
):

107 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 100))

108 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(100, 200))

110 #DeçuÉ 
Ïrge¡


111 
cÚsum”
 = 
£lf
.
	$cÚsum”
()

112 #Mov
ãtch
 
off£t
 
ah—d
 
of
 300 
	`mes§ge
 (
out
 oà
¿nge
)

113 
cÚsum”
.
	$£ek
(300, 2)

114 #Sšû 
auto_off£t_»£t
 
is
 
£t
 
to
 
Ïrge¡
 
we
 
should
 
nÙ
 
»ad
 
ªy


116 
£lf
.
	$as£¹_mes§ge_couÁ
([
mes§ge
 mes§g
š
 
cÚsum”
], 0)

117 #S’d 200 
Ãw
 
mes§ges
 
to
 
the
 
queue


118 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(200, 300))

119 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(300, 400))

120 #Sšû 
the
 
off£t
 
is
 
£t
 
to
 
Ïrge¡
 
we
 
should
 
»ad
 
®l
h
Ãw
 
mes§ges
.

121 
£lf
.
	`as£¹_mes§ge_couÁ
([
mes§ge
 mes§g
š
 
cÚsum”
], 200)

123 @
	`kafka_v”siÚs
('all')

124 
def
 
	$‹¡_sim¶e_cÚsum”_no_»£t
(
£lf
):

125 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 100))

126 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(100, 200))

128 #DeçuÉ 
Ïrge¡


129 
cÚsum”
 = 
£lf
.
	$cÚsum”
(
auto_off£t_»£t
=
NÚe
)

130 #Mov
ãtch
 
off£t
 
ah—d
 
of
 300 
	`mes§ge
 (
out
 oà
¿nge
)

131 
cÚsum”
.
	$£ek
(300, 2)

132 
w™h
 
£lf
.
	$as£¹Rai£s
(
Off£tOutOfRªgeE¼Ü
):

133 
cÚsum”
.
	`g‘_mes§ge
()

135 @
	`kafka_v”siÚs
("0.job.1", "0.job.1.1", "0.job.2.1")

136 
def
 
	$‹¡_sim¶e_cÚsum”_lßd_š™Ÿl_off£ts
(
£lf
):

137 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 100))

138 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(100, 200))

140 #C»©1
¡
 
cÚsum”
 
ªd
 
chªge
 
off£ts


141 
cÚsum”
 = 
£lf
.
	$cÚsum”
()

142 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
off£ts
, {0: 0, 1: 0
	}
})

143 
cÚsum”
.
off£ts
.
upd©e
({0:51, 1:101})

144 #Upd©
couÁ”
 
aá”
 
mªu®
 
off£ts
 
upd©e


145 
cÚsum”
.
couÁ_sšû_comm™
 += 1

146 
cÚsum”
.
	$comm™
()

148 #C»©2
nd
 
cÚsum”
 
ªd
 
check
 
š™Ÿl
 
off£ts


149 
cÚsum”
 = 
£lf
.
	$cÚsum”
(
auto_comm™
=
F®£
)

150 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
off£ts
, {0: 51, 1: 101
	}
})

152 @
kafka_v”siÚs
("all")

153 
def
 
	$‹¡_sim¶e_cÚsum”__£ek
(
£lf
):

154 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 100))

155 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(100, 200))

157 
cÚsum”
 = 
£lf
.
	$cÚsum”
()

159 #Rewšd 10 
mes§ges
 
äom
 
the
 
’d


160 
cÚsum”
.
	`£ek
(-10, 2)

161 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”
 ], 10)

163 #Rewšd 13 
mes§ges
 
äom
 
the
 
’d


164 
cÚsum”
.
	`£ek
(-13, 2)

165 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”
 ], 13)

167 #S‘ 
absŞu‹
 
off£t


168 
cÚsum”
.
	$£ek
(100)

169 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”
 ], 0)

170 
cÚsum”
.
	$£ek
(100, 
·¹™iÚ
=0)

171 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”
 ], 0)

172 
cÚsum”
.
	$£ek
(101, 
·¹™iÚ
=1)

173 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”
 ], 0)

174 
cÚsum”
.
	$£ek
(90, 
·¹™iÚ
=0)

175 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”
 ], 10)

176 
cÚsum”
.
	$£ek
(20, 
·¹™iÚ
=1)

177 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”
 ], 
job0
)

178 
cÚsum”
.
	$£ek
(0, 
·¹™iÚ
=1)

179 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”
 ], 100)

181 
cÚsum”
.
	`¡İ
()

183 @
	`kafka_v”siÚs
("all")

184 
def
 
	$‹¡_sim¶e_cÚsum”_blockšg
(
£lf
):

185 
cÚsum”
 = 
£lf
.
	$cÚsum”
()

187 #Ask 5 
mes§ges
, 
nÙhšg
 
š
 
queue
, 
block
 1 
£cÚd


188 
w™h
 
	$Tim”
(è
as
 
t
:

189 
mes§ges
 = 
cÚsum”
.
	$g‘_mes§ges
(
block
=
True
, 
timeout
=1)

190 
£lf
.
	$as£¹_mes§ge_couÁ
(
mes§ges
, 0)

191 
£lf
.
	$as£¹G»©”Equ®
(
t
.
š‹rv®
, 1)

193 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 10))

195 #Ask 5 
mes§ges
, 10 
š
 
queue
. 
G‘
 5 
back
, 
no
 
blockšg


196 
w™h
 
	$Tim”
(è
as
 
t
:

197 
mes§ges
 = 
cÚsum”
.
	$g‘_mes§ges
(
couÁ
=5, 
block
=
True
, 
timeout
=5)

198 
£lf
.
	$as£¹_mes§ge_couÁ
(
mes§ges
, 5)

199 
£lf
.
	$as£¹LessEqu®
(
t
.
š‹rv®
, 1)

201 #Ask 10 
mes§ges
, 
g‘
 5 
back
, 
block
 1 
£cÚd


202 
w™h
 
	$Tim”
(è
as
 
t
:

203 
mes§ges
 = 
cÚsum”
.
	$g‘_mes§ges
(
couÁ
=10, 
block
=
True
, 
timeout
=1)

204 
£lf
.
	$as£¹_mes§ge_couÁ
(
mes§ges
, 5)

205 
£lf
.
	$as£¹G»©”Equ®
(
t
.
š‹rv®
, 1)

207 
cÚsum”
.
	`¡İ
()

209 @
	`kafka_v”siÚs
("all")

210 
def
 
	$‹¡_sim¶e_cÚsum”_³ndšg
(
£lf
):

211 #mak
su»
 
th©
 
we
 
¡¬t
 
w™h
 
no
 
³ndšg
 
mes§ges


212 
cÚsum”
 = 
£lf
.
	$cÚsum”
()

213 
£lf
.
	`as£¹Equ®s
(
cÚsum”
.
	`³ndšg
(), 0)

214 
£lf
.
	`as£¹Equ®s
(
cÚsum”
.
	`³ndšg
(
·¹™iÚs
=[0]), 0)

215 
£lf
.
	`as£¹Equ®s
(
cÚsum”
.
	`³ndšg
(
·¹™iÚs
=[1]), 0)

217 #Produû 10 
mes§ges
 
to
 
·¹™iÚs
 0 
ªd
 1

218 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 10))

219 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(10, 20))

221 
cÚsum”
 = 
£lf
.
	$cÚsum”
()

223 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
	`³ndšg
(), 20)

224 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
	`³ndšg
(
·¹™iÚs
=[0]), 10)

225 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
	`³ndšg
(
·¹™iÚs
=[1]), 10)

227 #mov
to
 
Ï¡
 
mes§ge
, 
so
 
Úe
 
·¹™iÚ
 
should
 
have
 1 
³ndšg


228 #mes§g
ªd
 
Ùh”
 0

229 
cÚsum”
.
	`£ek
(-1, 2)

230 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
	`³ndšg
(), 1)

232 
³ndšg_·¹1
 = 
cÚsum”
.
	$³ndšg
(
·¹™iÚs
=[0])

233 
³ndšg_·¹2
 = 
cÚsum”
.
	$³ndšg
(
·¹™iÚs
=[1])

234 
£lf
.
	`as£¹Equ®s
(
	`£t
([0, 1]), 
	$£t
([
³ndšg_·¹1
, 
³ndšg_·¹2
]))

235 
cÚsum”
.
	`¡İ
()

237 @
	`kafka_v”siÚs
("all")

238 
def
 
	$‹¡_muÉi_´oûss_cÚsum”
(
£lf
):

239 #Produû 100 
mes§ges
 
to
 
·¹™iÚs
 0 
ªd
 1

240 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 100))

241 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(100, 200))

243 
cÚsum”
 = 
£lf
.
	$cÚsum”
(
cÚsum”
 = 
MuÉiProûssCÚsum”
)

245 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”
 ], 200)

247 
cÚsum”
.
	`¡İ
()

249 @
	`kafka_v”siÚs
("all")

250 
def
 
	$‹¡_muÉi_´oûss_cÚsum”_blockšg
(
£lf
):

251 
cÚsum”
 = 
£lf
.
	$cÚsum”
(
cÚsum”
 = 
MuÉiProûssCÚsum”
)

253 #Ask 5 
mes§ges
, 
No
 mes§ge 
š
 
queue
, 
block
 1 
£cÚd


254 
w™h
 
	$Tim”
(è
as
 
t
:

255 
mes§ges
 = 
cÚsum”
.
	$g‘_mes§ges
(
block
=
True
, 
timeout
=1)

256 
£lf
.
	$as£¹_mes§ge_couÁ
(
mes§ges
, 0)

258 
£lf
.
	$as£¹G»©”Equ®
(
t
.
š‹rv®
, 1)

260 #S’d 10 
mes§ges


261 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 10))

263 #Ask 5 
mes§ges
, 10 mes§ge 
š
 
queue
, 
block
 0 
£cÚds


264 
w™h
 
	$Tim”
(è
as
 
t
:

265 
mes§ges
 = 
cÚsum”
.
	$g‘_mes§ges
(
couÁ
=5, 
block
=
True
, 
timeout
=5)

266 
£lf
.
	$as£¹_mes§ge_couÁ
(
mes§ges
, 5)

267 
£lf
.
	$as£¹LessEqu®
(
t
.
š‹rv®
, 1)

269 #Ask 10 
mes§ges
, 5 
š
 
queue
, 
block
 1 
£cÚd


270 
w™h
 
	$Tim”
(è
as
 
t
:

271 
mes§ges
 = 
cÚsum”
.
	$g‘_mes§ges
(
couÁ
=10, 
block
=
True
, 
timeout
=1)

272 
£lf
.
	$as£¹_mes§ge_couÁ
(
mes§ges
, 5)

273 
£lf
.
	$as£¹G»©”Equ®
(
t
.
š‹rv®
, 1)

275 
cÚsum”
.
	`¡İ
()

277 @
	`kafka_v”siÚs
("all")

278 
def
 
	$‹¡_muÉi_´oc_³ndšg
(
£lf
):

279 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 10))

280 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(10, 20))

282 #£ˆ
group
 
to
 
NÚe
 
ªd
 
auto_comm™
Ø
F®£
Ø
avoid
 
š‹¿ùiÚs
 
w
/

283 #off£ˆ
comm™
/
ãtch
 
­is


284 
cÚsum”
 = 
	$MuÉiProûssCÚsum”
(
£lf
.
ş›Á
, 
NÚe
, s–f.
tİic
,

285 
auto_comm™
=
F®£
, 
™”_timeout
=0)

287 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
	`³ndšg
(), 20)

288 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
	`³ndšg
(
·¹™iÚs
=[0]), 10)

289 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
	`³ndšg
(
·¹™iÚs
=[1]), 10)

291 
cÚsum”
.
	`¡İ
()

293 @
	`kafka_v”siÚs
("0.job.1", "0.job.1.1", "0.job.2.1")

294 
def
 
	$‹¡_muÉi_´oûss_cÚsum”_lßd_š™Ÿl_off£ts
(
£lf
):

295 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 10))

296 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(10, 20))

298 #C»©1
¡
 
cÚsum”
 
ªd
 
chªge
 
off£ts


299 
cÚsum”
 = 
£lf
.
	$cÚsum”
()

300 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
off£ts
, {0: 0, 1: 0
	}
})

301 
cÚsum”
.
off£ts
.
upd©e
({0:5, 1:15})

302 #Upd©
couÁ”
 
aá”
 
mªu®
 
off£ts
 
upd©e


303 
cÚsum”
.
couÁ_sšû_comm™
 += 1

304 
cÚsum”
.
	$comm™
()

306 #C»©2
nd
 
cÚsum”
 
ªd
 
check
 
š™Ÿl
 
off£ts


307 
cÚsum”
 = 
£lf
.
	$cÚsum”
(
cÚsum”
 = 
MuÉiProûssCÚsum”
,

308 
auto_comm™
=
F®£
)

309 
£lf
.
	`as£¹Equ®
(
cÚsum”
.
off£ts
, {0: 5, 1: 15
	}
})

311 @
kafka_v”siÚs
("all")

312 
def
 
	$‹¡_Ïrge_mes§ges
(
£lf
):

313 #Produû 10 "nÜm®" 
size
 
mes§ges


314 
sm®l_mes§ges
 = 
£lf
.
	`£nd_mes§ges
(0, [ 
	$¡r
(
x
èx 
š
 
	`¿nge
(10) ])

316 #Produû 10 
mes§ges
 
th©
 
¬e
 
	`Ïrge
 (
bigg”
 
thª
  
ãtch
 
size
)

317 
Ïrge_mes§ges
 = 
£lf
.
	`£nd_mes§ges
(0, [ 
	$¿ndom_¡ršg
(5000è
x
 
š
 
	`¿nge
(10) ])

319 #CÚsum” 
should
 
¡l
 
g‘
 
®l
 
of
 
them


320 
cÚsum”
 = 
£lf
.
	$cÚsum”
()

322 
ex³ùed_mes§ges
 = 
	`£t
(
sm®l_mes§ges
 + 
Ïrge_mes§ges
)

323 
aùu®_mes§ges
 = 
	$£t
([ 
x
.
mes§ge
.
v®ue
 x 
š
 
cÚsum”
 ])

324 
£lf
.
	$as£¹Equ®
(
ex³ùed_mes§ges
, 
aùu®_mes§ges
)

326 
cÚsum”
.
	`¡İ
()

328 @
	`kafka_v”siÚs
("all")

329 
def
 
	$‹¡_huge_mes§ges
(
£lf
):

330 
huge_mes§ge
, = 
£lf
.
	`£nd_mes§ges
(0, [

331 
	`ü—‹_mes§ge
(
	`¿ndom_¡ršg
(
MAX_FETCH_BUFFER_SIZE_BYTES
 + 10)),

334 #C»©
a
 
cÚsum”
 
w™h
 
the
  
bufãr
 
size


335 
cÚsum”
 = 
£lf
.
	$cÚsum”
()

337 #Thi 
cÚsum”
 
çes
 
to
 
g‘
 
the
 
mes§ge


338 
w™h
 
£lf
.
	$as£¹Rai£s
(
CÚsum”F‘chSizeTooSm®l
):

339 
cÚsum”
.
	$g‘_mes§ge
(
F®£
, 0.1)

341 
cÚsum”
.
	$¡İ
()

343 #C»©
a
 
cÚsum”
 
w™h
 
no
 
ãtch
 
size
 
lim™


344 
big_cÚsum”
 = 
£lf
.
	$cÚsum”
(

345 
max_bufãr_size
 = 
NÚe
,

346 
·¹™iÚs
 = [0],

349 #S“k 
to
 
the
 
Ï¡
 
mes§ge


350 
big_cÚsum”
.
	`£ek
(-1, 2)

352 #CÚsum
gŸÁ
 
mes§ge
 
sucûssfuÎy


353 
mes§ge
 = 
big_cÚsum”
.
	$g‘_mes§ge
(
block
=
F®£
, 
timeout
=10)

354 
£lf
.
	$as£¹IsNÙNÚe
(
mes§ge
)

355 
£lf
.
	$as£¹Equ®
(
mes§ge
.mes§ge.
v®ue
, 
huge_mes§ge
)

357 
big_cÚsum”
.
	`¡İ
()

359 @
	`kafka_v”siÚs
("0.job.1", "0.job.1.1", "0.job.2.1")

360 
def
 
	$‹¡_off£t_behaviÜ__»sumšg_behaviÜ
(
£lf
):

361 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 100))

362 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(100, 200))

364 #S¹ 
a
 
cÚsum”


365 
cÚsum”1
 = 
£lf
.
	$cÚsum”
(

366 
auto_comm™_ev”y_t
 = 
NÚe
,

367 
auto_comm™_ev”y_n
 = 20,

370 #G¿b 
the
 
fœ¡
 195 
mes§ges


371 
ouut_msgs1
 = [ 
cÚsum”1
.
	`g‘_mes§ge
().
mes§ge
.
v®ue
 
_
 
š
 
	`x¿nge
(195) ]

372 
£lf
.
	$as£¹_mes§ge_couÁ
(
ouut_msgs1
, 195)

374 #Th
tÙ®
 
off£t
 
aüsh™
 
bÙh
 
·¹™iÚs
 
should
 
be
 
©
 1
job0


375 
cÚsum”2
 = 
£lf
.
	$cÚsum”
(

376 
auto_comm™_ev”y_t
 = 
NÚe
,

377 
auto_comm™_ev”y_n
 = 20,

380 #1
job1
-200

381 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”2
 ], 20)

383 
cÚsum”1
.
	$¡İ
()

384 
cÚsum”2
.
	`¡İ
()

386 @
	`kafka_v”siÚs
("0.job.1", "0.job.1.1", "0.job.2.1")

387 
def
 
	$‹¡_muÉi_´oûss_off£t_behaviÜ__»sumšg_behaviÜ
(
£lf
):

388 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 100))

389 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(100, 200))

391 #S¹ 
a
 
cÚsum”


392 
cÚsum”1
 = 
£lf
.
	$cÚsum”
(

393 
cÚsum”
=
MuÉiProûssCÚsum”
,

394 
auto_comm™_ev”y_t
 = 
NÚe
,

395 
auto_comm™_ev”y_n
 = 20,

398 #G¿b 
the
 
fœ¡
 195 
mes§ges


399 
ouut_msgs1
 = []

400 
idx
 = 0

401 
mes§ge
 
š
 
cÚsum”1
:

402 
ouut_msgs1
.
	$­³nd
(
mes§ge
.mes§ge.
v®ue
)

403 
idx
 += 1

404 
idx
 >= 195:

406 
£lf
.
	$as£¹_mes§ge_couÁ
(
ouut_msgs1
, 195)

408 #Th
tÙ®
 
off£t
 
aüsh™
 
bÙh
 
·¹™iÚs
 
should
 
be
 
©
 1
job0


409 
cÚsum”2
 = 
£lf
.
	$cÚsum”
(

410 
cÚsum”
=
MuÉiProûssCÚsum”
,

411 
auto_comm™_ev”y_t
 = 
NÚe
,

412 
auto_comm™_ev”y_n
 = 20,

415 #1
job1
-200

416 
£lf
.
	$as£¹_mes§ge_couÁ
([ 
mes§ge
 mes§g
š
 
cÚsum”2
 ], 20)

418 
cÚsum”1
.
	$¡İ
()

419 
cÚsum”2
.
	$¡İ
()

421 #TODO: 
Make
 
this
 
a
 
un™
 
‹¡
 -- 
should
 
nÙ
 
»quœe
 
š‹g¿tiÚ


422 @
	`kafka_v”siÚs
("all")

423 
def
 
	$‹¡_ãtch_bufãr_size
(
£lf
):

425 #Te¡ 
	`·¿m‘”s
 (
£e
 
issue
 135 / 
PR
 136)

426 
TEST_MESSAGE_SIZE
=104
job


427 
INIT_BUFFER_SIZE
=1024

428 
MAX_BUFFER_SIZE
=204
job


429 
as£¹
 
TEST_MESSAGE_SIZE
 > 
INIT_BUFFER_SIZE


430 
as£¹
 
TEST_MESSAGE_SIZE
 < 
MAX_BUFFER_SIZE


431 
as£¹
 
MAX_BUFFER_SIZE
 =ğ2 * 
INIT_BUFFER_SIZE


433 
£lf
.
	`£nd_mes§ges
(0, [ "x" * 104
job
 ])

434 
£lf
.
	`£nd_mes§ges
(1, [ "x" * 104
job
 ])

436 
cÚsum”
 = 
£lf
.
	$cÚsum”
(
bufãr_size
=1024, 
max_bufãr_size
=204
job
)

437 
mes§ges
 = [ 
mes§ge
 mes§g
š
 
cÚsum”
 ]

438 
£lf
.
	`as£¹Equ®
(
	`Ën
(
mes§ges
), 2)

440 @
	`kafka_v”siÚs
("all")

441 
def
 
	$‹¡_kafka_cÚsum”
(
£lf
):

442 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 100))

443 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(100, 200))

445 #S¹ 
a
 
cÚsum”


446 
cÚsum”
 = 
£lf
.
	`kafka_cÚsum”
(
auto_off£t_»£t
='smallest',

447 
cÚsum”_timeout_ms
=5000)

448 
n
 = 0

449 
mes§ges
 = {0: 
	`£t
(), 1: s‘()
	}
}

450 
loggšg
.
debug
("kafk¨cÚsum” off£ts: %s" % 
cÚsum”
.
	$off£ts
())

451 
m
 
š
 
cÚsum”
:

452 
loggšg
.
	`debug
("CÚsumed mes§g%s" % 
	$»´
(
m
))

453 
n
 += 1

454 
mes§ges
[
m
.
·¹™iÚ
].
	$add
(
m
.
off£t
)

455 
n
 >= 200:

458 
£lf
.
	`as£¹Equ®
(
	`Ën
(
mes§ges
[0]), 100)

459 
£lf
.
	`as£¹Equ®
(
	`Ën
(
mes§ges
[1]), 100)

461 @
	`kafka_v”siÚs
("all")

462 
def
 
	$‹¡_kafka_cÚsum”__blockšg
(
£lf
):

463 
TIMEOUT_MS
 = 500

464 
cÚsum”
 = 
£lf
.
	`kafka_cÚsum”
(
auto_off£t_»£t
='smallest',

465 
cÚsum”_timeout_ms
=
TIMEOUT_MS
)

467 #Ask 5 
mes§ges
, 
nÙhšg
 
š
 
queue
, 
block
 500
ms


468 
w™h
 
	$Tim”
(è
as
 
t
:

469 
w™h
 
£lf
.
	$as£¹Rai£s
(
CÚsum”Timeout
):

470 
msg
 = 
cÚsum”
.
	$Ãxt
()

471 
£lf
.
	`as£¹G»©”Equ®
(
t
.
š‹rv®
, 
TIMEOUT_MS
 / 1000.0 )

473 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 10))

475 #Ask 5 
mes§ges
, 10 
š
 
queue
. 
G‘
 5 
back
, 
no
 
blockšg


476 
mes§ges
 = 
	$£t
()

477 
w™h
 
	$Tim”
(è
as
 
t
:

478 
i
 
š
 
	$¿nge
(5):

479 
msg
 = 
cÚsum”
.
	$Ãxt
()

480 
mes§ges
.
	`add
((
msg
.
·¹™iÚ
, msg.
off£t
))

481 
£lf
.
	`as£¹Equ®
(
	`Ën
(
mes§ges
), 5)

482 
£lf
.
	`as£¹Less
(
t
.
š‹rv®
, 
TIMEOUT_MS
 / 1000.0 )

484 #Ask 10 
mes§ges
, 
g‘
 5 
back
, 
block
 500
ms


485 
mes§ges
 = 
	$£t
()

486 
w™h
 
	$Tim”
(è
as
 
t
:

487 
w™h
 
£lf
.
	$as£¹Rai£s
(
CÚsum”Timeout
):

488 
i
 
š
 
	$¿nge
(10):

489 
msg
 = 
cÚsum”
.
	$Ãxt
()

490 
mes§ges
.
	`add
((
msg
.
·¹™iÚ
, msg.
off£t
))

491 
£lf
.
	`as£¹Equ®
(
	`Ën
(
mes§ges
), 5)

492 
£lf
.
	`as£¹G»©”Equ®
(
t
.
š‹rv®
, 
TIMEOUT_MS
 / 1000.0 )

494 @
	`kafka_v”siÚs
("0.job.1", "0.job.1.1", "0.job.2.1")

495 
def
 
	$‹¡_kafka_cÚsum”__off£t_comm™_»sume
(
£lf
):

496 
GROUP_ID
 = 
	`¿ndom_¡ršg
(10).
	`’code
('utf-job')

498 
£lf
.
	`£nd_mes§ges
(0, 
	$¿nge
(0, 100))

499 
£lf
.
	`£nd_mes§ges
(1, 
	$¿nge
(100, 200))

501 #S¹ 
a
 
cÚsum”


502 
cÚsum”1
 = 
£lf
.
	`kafka_cÚsum”
(

503 
group_id
 = 
GROUP_ID
,

504 
auto_comm™_’abË
 = 
True
,

505 
auto_comm™_š‹rv®_ms
 = 
NÚe
,

506 
auto_comm™_š‹rv®_mes§ges
 = 20,

507 
auto_off£t_»£t
='smallest',

510 #G¿b 
the
 
fœ¡
 195 
mes§ges


511 
ouut_msgs1
 = []

512 
_
 
š
 
	$x¿nge
(195):

513 
m
 = 
cÚsum”1
.
	$Ãxt
()

514 
ouut_msgs1
.
	$­³nd
(
m
)

515 
cÚsum”1
.
	$sk_dÚe
(
m
)

516 
£lf
.
	$as£¹_mes§ge_couÁ
(
ouut_msgs1
, 195)

518 #Th
tÙ®
 
off£t
 
aüsh™
 
bÙh
 
·¹™iÚs
 
should
 
be
 
©
 1
job0


519 
cÚsum”2
 = 
£lf
.
	`kafka_cÚsum”
(

520 
group_id
 = 
GROUP_ID
,

521 
auto_comm™_’abË
 = 
True
,

522 
auto_comm™_š‹rv®_ms
 = 
NÚe
,

523 
auto_comm™_š‹rv®_mes§ges
 = 20,

524 
cÚsum”_timeout_ms
 = 100,

525 
auto_off£t_»£t
='smallest',

528 #1
job1
-200

529 
ouut_msgs2
 = []

530 
w™h
 
£lf
.
	$as£¹Rai£s
(
CÚsum”Timeout
):

531 
True
:

532 
m
 = 
cÚsum”2
.
	$Ãxt
()

533 
ouut_msgs2
.
	$­³nd
(
m
)

534 
£lf
.
	$as£¹_mes§ge_couÁ
(
ouut_msgs2
, 20)

535 
£lf
.
	`as£¹Equ®
(
	`Ën
(
	`£t
(
ouut_msgs1
è& s‘(
ouut_msgs2
)), 15)

	@/root/grocery-shop/language/python/kafka/test/test_context.py

2 
Off£tComm™CÚ‹xt
 
	g‹¡s
.

4 
	gäom
 . 
impÜt
 
un™‹¡


6 
äom
 
mock
 
impÜt
 
	gMagicMock
, 
·tch


8 
äom
 
	gkafka
.
commÚ
 
impÜt
 
Off£tOutOfRªgeE¼Ü


9 
äom
 
	gkafka
.
cÚ‹xt
 
impÜt
 
Off£tComm™CÚ‹xt


12 
şass
 
	$Te¡Off£tComm™CÚ‹xt
(
un™‹¡
.
Te¡Ca£
):

14 
Off£tComm™CÚ‹xt
 
‹¡s
.

17 
def
 
	$£tUp
(
£lf
):

18 
£lf
.
ş›Á
 = 
	$MagicMock
()

19 
£lf
.
cÚsum”
 = 
	$MagicMock
()

20 
£lf
.
tİic
 = "topic"

21 
£lf
.
group
 = "group"

22 
£lf
.
·¹™iÚ
 = 0

23 
£lf
.
cÚsum”
.
tİic
 = self.topic

24 
£lf
.
cÚsum”
.
group
 = self.group

25 
£lf
.
cÚsum”
.
ş›Á
 = self.client

26 
£lf
.
cÚsum”
.
off£ts
 = {£lf.
·¹™iÚ
: 0
	}
}

27 
£lf
.
cÚ‹xt
 = 
	$Off£tComm™CÚ‹xt
(
£lf
.
cÚsum”
)

29 
def
 
	$‹¡_noİ
(
£lf
):

31 
Should
 
»v”t
 
cÚsum”
 
aá”
 
cÚ‹xt
 
ex™
 
w™h
 
no
 
	$m¬k
(è
ÿÎ
.

33 
w™h
 
£lf
.
cÚ‹xt
:

34 #advªû 
off£t


35 
£lf
.
cÚsum”
.
off£ts
 = {£lf.
·¹™iÚ
: 1
	}
}

37 #off£ˆ
»¡Üed


38 
£lf
.
as£¹Equ®
(£lf.
cÚsum”
.
off£ts
, {£lf.
·¹™iÚ
: 0})

39 #ªd 
£ek
 
ÿÎed
 
w™h
 
»Ïtive
 
z”o
 
d–


40 
£lf
.
	$as£¹Equ®
(
£lf
.
cÚsum”
.
£ek
.
ÿÎ_couÁ
, 1)

41 
£lf
.
	`as£¹Equ®
(£lf.
cÚsum”
.
£ek
.
ÿÎ_¬gs
[0], (0, 1))

43 
def
 
	$‹¡_m¬k
(
£lf
):

45 
Should
 
»maš
 
©
 
m¬ked
 
loÿtiÚ
 
©”
 
cÚ‹xt
 
ex™
.

47 
w™h
 
£lf
.
cÚ‹xt
 
as
 context:

48 
cÚ‹xt
.
	$m¬k
(
£lf
.
·¹™iÚ
, 0)

49 #advªû 
off£t


50 
£lf
.
cÚsum”
.
off£ts
 = {£lf.
·¹™iÚ
: 1
	}
}

52 #off£ˆ
£Á
 
to
 
ş›Á


53 
£lf
.
	$as£¹Equ®
(
£lf
.
ş›Á
.
£nd_off£t_comm™_»que¡
.
ÿÎ_couÁ
, 1)

55 #off£ˆ
»mašs
 
advªûd


56 
£lf
.
	`as£¹Equ®
(£lf.
cÚsum”
.
off£ts
, {£lf.
·¹™iÚ
: 1
	}
})

58 #ªd 
£ek
 
ÿÎed
 
w™h
 
»Ïtive
 
z”o
 
d–


59 
£lf
.
	$as£¹Equ®
(
£lf
.
cÚsum”
.
£ek
.
ÿÎ_couÁ
, 1)

60 
£lf
.
	`as£¹Equ®
(£lf.
cÚsum”
.
£ek
.
ÿÎ_¬gs
[0], (0, 1))

62 
def
 
	$‹¡_m¬k_muÉË
(
£lf
):

64 
Should
 
»maš
 
©
 
highe¡
 
m¬ked
 
loÿtiÚ
 
aá”
 
cÚ‹xt
 
ex™
.

66 
w™h
 
£lf
.
cÚ‹xt
 
as
 context:

67 
cÚ‹xt
.
	$m¬k
(
£lf
.
·¹™iÚ
, 0)

68 
cÚ‹xt
.
	$m¬k
(
£lf
.
·¹™iÚ
, 1)

69 
cÚ‹xt
.
	$m¬k
(
£lf
.
·¹™iÚ
, 2)

70 #advªû 
off£t


71 
£lf
.
cÚsum”
.
off£ts
 = {£lf.
·¹™iÚ
: 3
	}
}

73 #off£ˆ
£Á
 
to
 
ş›Á


74 
£lf
.
	$as£¹Equ®
(
£lf
.
ş›Á
.
£nd_off£t_comm™_»que¡
.
ÿÎ_couÁ
, 1)

76 #off£ˆ
»mašs
 
advªûd


77 
£lf
.
	`as£¹Equ®
(£lf.
cÚsum”
.
off£ts
, {£lf.
·¹™iÚ
: 3
	}
})

79 #ªd 
£ek
 
ÿÎed
 
w™h
 
»Ïtive
 
z”o
 
d–


80 
£lf
.
	$as£¹Equ®
(
£lf
.
cÚsum”
.
£ek
.
ÿÎ_couÁ
, 1)

81 
£lf
.
	`as£¹Equ®
(£lf.
cÚsum”
.
£ek
.
ÿÎ_¬gs
[0], (0, 1))

83 
def
 
	$‹¡_rŞlback
(
£lf
):

85 
Should
 
rŞlback
 
to
 
š™Ÿl
 
off£ts
 
Ú
 
cÚ‹xt
 
ex™
 
w™h
 
exû±iÚ
.

87 
w™h
 
£lf
.
	$as£¹Rai£s
(
Exû±iÚ
):

88 
w™h
 
£lf
.
cÚ‹xt
 
as
 context:

89 
cÚ‹xt
.
	$m¬k
(
£lf
.
·¹™iÚ
, 0)

90 #advªû 
off£t


91 
£lf
.
cÚsum”
.
off£ts
 = {£lf.
·¹™iÚ
: 1
	}
}

93 
¿i£
 
Exû±iÚ
("Intentional failure")

95 #off£ˆ
rŞËd
 
back
 (
ignÜšg
 
m¬k
)

96 
£lf
.
as£¹Equ®
(£lf.
cÚsum”
.
off£ts
, {£lf.
·¹™iÚ
: 0})

98 #ªd 
£ek
 
ÿÎed
 
w™h
 
»Ïtive
 
z”o
 
d–


99 
£lf
.
	$as£¹Equ®
(
£lf
.
cÚsum”
.
£ek
.
ÿÎ_couÁ
, 1)

100 
£lf
.
	`as£¹Equ®
(£lf.
cÚsum”
.
£ek
.
ÿÎ_¬gs
[0], (0, 1))

102 
def
 
	$‹¡_out_of_¿nge
(
£lf
):

104 
Should
 
»£t
 
to
 
begšnšg
 
of
 
v®id
 
off£ts
 
Ú
 `
Off£tOutOfRªgeE¼Ü
`

106 
def
 
	$_£ek
(
off£t
, 
wh’û
):

107 #£ek 
mu¡
 
be
 
ÿÎed
 
w™h
 0, 0 
to
 
fšd
 
the
 
begšnšg
 
of
h
¿nge


108 
£lf
.
	$as£¹Equ®
(
off£t
, 0)

109 
£lf
.
	$as£¹Equ®
(
wh’û
, 0)

110 #£ˆ
off£ts
 
to
 
som‘hšg
 
difã»Á


111 
£lf
.
cÚsum”
.
off£ts
 = {£lf.
·¹™iÚ
: 100
	}
}

113 
w™h
 
·tch
.
objeù
(
£lf
.
cÚsum”
, "£ek", 
_£ek
):

114 
w™h
 
£lf
.
cÚ‹xt
:

115 
¿i£
 
	$Off£tOutOfRªgeE¼Ü
()

117 
£lf
.
	`as£¹Equ®
(£lf.
cÚsum”
.
off£ts
, {£lf.
·¹™iÚ
: 100
	}
})

	@/root/grocery-shop/language/python/kafka/test/test_failover_integration.py

1 
impÜt
 
loggšg


2 
impÜt
 
os


3 
impÜt
 
time


5 
äom
 
kafka
 
impÜt
 
	gKafkaCl›Á
, 
	gSim¶eCÚsum”
, 
KeyedProduûr


6 
äom
 
	gkafka
.
commÚ
 
impÜt
 
	gTİicAndP¬t™iÚ
, 
	gFaedPaylßdsE¼Ü
, 
CÚÃùiÚE¼Ü


7 
äom
 
	gkafka
.
	g´oduûr
.
ba£
 
impÜt
 
Produûr


8 
äom
 
	gkafka
.
ut
 
impÜt
 
kafka_by‹¡ršg


10 
äom
 
	g‹¡
.
fixtu»s
 
impÜt
 
	gZook“³rFixtu»
, 
KafkaFixtu»


11 
äom
 
	g‹¡
.
‹¡ut
 
	$impÜt
 (

12 
KafkaIÁeg¿tiÚTe¡Ca£
, 
kafka_v”siÚs
, 
¿ndom_¡ršg


16 
log
 = 
loggšg
.
	$g‘Logg”
(
__Çme__
)

19 
şass
 
	$Te¡Faov”
(
KafkaIÁeg¿tiÚTe¡Ca£
):

20 
ü—‹_ş›Á
 = 
F®£


22 
def
 
	$£tUp
(
£lf
):

23 
nÙ
 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION'):

26 
zk_chroÙ
 = 
	$¿ndom_¡ršg
(10)

27 
»¶iÿs
 = 3

28 
·¹™iÚs
 = 3

30 #mš˜
zook“³r
, 3 
kafka
 
brok”s


31 
£lf
.
zk
 = 
Zook“³rFixtu»
.
	$š¡ªû
()

32 
kk_¬gs
 = [
£lf
.
zk
.
ho¡
, s–f.zk.
pÜt
, 
zk_chroÙ
, 
»¶iÿs
, 
·¹™iÚs
]

33 
£lf
.
brok”s
 = [
KafkaFixtu»
.
	$š¡ªû
(
i
, *
kk_¬gs
è˜
š
 
	`¿nge
(
»¶iÿs
)]

35 
ho¡s
 = ['%s:%d' % (
b
.
ho¡
, b.
pÜt
èb 
š
 
£lf
.
brok”s
]

36 
£lf
.
ş›Á
 = 
	$KafkaCl›Á
(
ho¡s
)

37 
	`su³r
(
Te¡Faov”
, 
£lf
).
	$£tUp
()

39 
def
 
	$‹¬Down
(
£lf
):

40 
	`su³r
(
Te¡Faov”
, 
£lf
).
	$‹¬Down
()

41 
nÙ
 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION'):

44 
£lf
.
ş›Á
.
	$şo£
()

45 
brok”
 
š
 
£lf
.
brok”s
:

46 
brok”
.
	$şo£
()

47 
£lf
.
zk
.
	`şo£
()

49 @
	`kafka_v”siÚs
("all")

50 
def
 
	$‹¡_sw™ch_Ëad”
(
£lf
):

51 
tİic
 = 
£lf
.topic

52 
·¹™iÚ
 = 0

54 #Te¡šg 
the
 
ba£
 
Produûr
 
şass
 
h”e
 
so
 
th©
 
we
 
ÿn
 
—sy
 
£nd


55 #mes§ge 
to
 
a
 
¥ecific
 
·¹™iÚ
, 
kl
 
the
 
Ëad”
 
th©
…artition

56 #ªd 
check
 
th©
 
aá”
 
ªÙh”
 
brok”
 
kes
 
Ëad”sh
 
the
 
´oduûr


57 #i 
abË
 
to
 
»sume
 
£ndšg
 
mes§ges


59 #»quœ
th©
 
the
 
£rv”
 
comm™
 
mes§ges
 
to
 
®l
 
š
-
sync
 
»¶iÿs


60 #sØ
th©
 
çov”
 
dÛ¢
't†ose‡ny messages on server-side

61 #ªd 
we
 
ÿn
 
as£¹
 
th©
 
£rv”
-
side
 
mes§ge
 
couÁ
 
equ®s
 
ş›Á
-side

62 
´oduûr
 = 
	$Produûr
(
£lf
.
ş›Á
, 
async
=
F®£
,

63 
»q_acks
=
Produûr
.
ACK_AFTER_CLUSTER_COMMIT
)

65 #S’d 100 
¿ndom
 
mes§ges
 
to
 
a
 
¥ecific
 
·¹™iÚ


66 
£lf
.
	$_£nd_¿ndom_mes§ges
(
´oduûr
, 
tİic
, 
·¹™iÚ
, 100)

68 #kÈ
Ëad”
 
·¹™iÚ


69 
£lf
.
	$_kl_Ëad”
(
tİic
, 
·¹™iÚ
)

71 #ex³ù 
çu»
, 
but
 
dÚt
 
wa™
 
mÜe
 
thª
 60 
£cs
 
to
 
»cov”


72 
»cov”ed
 = 
F®£


73 
¡¬‹d
 = 
time
.
	$time
()

74 
timeout
 = 60

75 
nÙ
 
»cov”ed
 
	`ªd
 (
time
.
	`time
(è- 
¡¬‹d
è< 
timeout
:

76 
Œy
:

77 
log
.
	`debug
("attemptingo send 'success' message‡fter†eader killed")

78 
´oduûr
.
	`£nd_mes§ges
(
tİic
, 
·¹™iÚ
, 
b
'success')

79 
log
.
	`debug
("success!")

80 
»cov”ed
 = 
True


81 
	$exû±
 (
FaedPaylßdsE¼Ü
, 
CÚÃùiÚE¼Ü
):

82 
log
.
	`debug
("caughtƒxception sending message -- will„etry")

85 #V”ify 
we
 
sucûssfuÎy
 
£Á
 
the
 
mes§ge


86 
£lf
.
	$as£¹True
(
»cov”ed
)

88 #£nd 
some
 
mÜe
 
mes§ges
 
to
 
Ãw
 
Ëad”


89 
£lf
.
	$_£nd_¿ndom_mes§ges
(
´oduûr
, 
tİic
, 
·¹™iÚ
, 100)

91 #couÁ 
numb”
 
of
 
mes§ges


92 #Should 
be
 
equ®
 
to
 100 
befÜe
 + 1 
»cov”y
 + 100 
aá”


93 #©_Ëa¡=
True
 
beÿu£
 
exaùly
 
Úû
 
d–iv”y
 
i¢
't„eally‡hing

94 
£lf
.
	`as£¹_mes§ge_couÁ
(
tİic
, 201, 
·¹™iÚs
=(
·¹™iÚ
,),

95 
©_Ëa¡
=
True
)

97 @
	`kafka_v”siÚs
("all")

98 
def
 
	$‹¡_sw™ch_Ëad”_async
(
£lf
):

99 
tİic
 = 
£lf
.topic

100 
·¹™iÚ
 = 0

102 #Te¡ 
the
 
ba£
 
şass
 
Produûr
 -- 
£nd_mes§ges
 
to
 
a
 
¥ecific
 
·¹™iÚ


103 
´oduûr
 = 
	$Produûr
(
£lf
.
ş›Á
, 
async
=
True
,

104 
b©ch_£nd_ev”y_n
=15,

105 
b©ch_£nd_ev”y_t
=3,

106 
»q_acks
=
Produûr
.
ACK_AFTER_CLUSTER_COMMIT
,

107 
async_log_mes§ges_Ú_”rÜ
=
F®£
)

109 #S’d 10 
¿ndom
 
mes§ges


110 
£lf
.
	$_£nd_¿ndom_mes§ges
(
´oduûr
, 
tİic
, 
·¹™iÚ
, 10)

111 
£lf
.
	`_£nd_¿ndom_mes§ges
(
´oduûr
, 
tİic
, 
·¹™iÚ
 + 1, 10)

113 #kÈ
Ëad”
 
·¹™iÚ


114 
£lf
.
	$_kl_Ëad”
(
tİic
, 
·¹™iÚ
)

116 
log
.
	`debug
("attemptingo send 'success' message‡fter†eader killed")

118 #š 
async
 
mode
, 
this
 
should
  
immedŸ‹ly


119 
´oduûr
.
	`£nd_mes§ges
(
tİic
, 
·¹™iÚ
, 
b
'success')

120 
´oduûr
.
	`£nd_mes§ges
(
tİic
, 
·¹™iÚ
 + 1, 
b
'success')

122 #£nd 
to
 
Ãw
 
Ëad”


123 
£lf
.
	$_£nd_¿ndom_mes§ges
(
´oduûr
, 
tİic
, 
·¹™iÚ
, 10)

124 
£lf
.
	`_£nd_¿ndom_mes§ges
(
´oduûr
, 
tİic
, 
·¹™iÚ
 + 1, 10)

126 #Stİ 
the
 
´oduûr
 
ªd
 
wa™
 
™
 
to
 
shutdown


127 
´oduûr
.
	$¡İ
()

128 
¡¬‹d
 = 
time
.
	$time
()

129 
timeout
 = 60

130 
time
.
	`time
(è- 
¡¬‹d
è< 
timeout
:

131 
nÙ
 
´oduûr
.
th»ad
.
	$is_®ive
():

133 
time
.
	$¦“p
(0.1)

135 
£lf
.
	`ç
('timeout waiting for…roducer queueoƒmpty')

137 #couÁ 
numb”
 
of
 
mes§ges


138 #Should 
be
 
equ®
 
to
 10 
befÜe
 + 1 
»cov”y
 + 10 
aá”


139 #©_Ëa¡=
True
 
beÿu£
 
exaùly
 
Úû
 
d–iv”y
 
i¢
't„eally‡hing

140 
£lf
.
	`as£¹_mes§ge_couÁ
(
tİic
, 21, 
·¹™iÚs
=(
·¹™iÚ
,),

141 
©_Ëa¡
=
True
)

142 
£lf
.
	`as£¹_mes§ge_couÁ
(
tİic
, 21, 
·¹™iÚs
=(
·¹™iÚ
 + 1,),

143 
©_Ëa¡
=
True
)

145 @
	`kafka_v”siÚs
("all")

146 
def
 
	$‹¡_sw™ch_Ëad”_keyed_´oduûr
(
£lf
):

147 
tİic
 = 
£lf
.topic

149 
´oduûr
 = 
	$KeyedProduûr
(
£lf
.
ş›Á
, 
async
=
F®£
)

151 #S’d 10 
¿ndom
 
mes§ges


152 
_
 
š
 
	$¿nge
(10):

153 
key
 = 
	`¿ndom_¡ršg
(3).
	`’code
('utf-job')

154 
msg
 = 
	`¿ndom_¡ršg
(10).
	`’code
('utf-job')

155 
´oduûr
.
	$£nd_mes§ges
(
tİic
, 
key
, 
msg
)

157 #kÈ
Ëad”
 
·¹™iÚ
 0

158 
£lf
.
	$_kl_Ëad”
(
tİic
, 0)

160 
»cov”ed
 = 
F®£


161 
¡¬‹d
 = 
time
.
	$time
()

162 
timeout
 = 60

163 
nÙ
 
»cov”ed
 
	`ªd
 (
time
.
	`time
(è- 
¡¬‹d
è< 
timeout
:

164 
Œy
:

165 
key
 = 
	`¿ndom_¡ršg
(3).
	`’code
('utf-job')

166 
msg
 = 
	`¿ndom_¡ršg
(10).
	`’code
('utf-job')

167 
´oduûr
.
	$£nd_mes§ges
(
tİic
, 
key
, 
msg
)

168 
´oduûr
.
·¹™iÚ”s
[
	`kafka_by‹¡ršg
(
tİic
)].
	`·¹™iÚ
(
key
) == 0:

169 
»cov”ed
 = 
True


170 
	$exû±
 (
FaedPaylßdsE¼Ü
, 
CÚÃùiÚE¼Ü
):

171 
log
.
	`debug
("caughtƒxception sending message -- will„etry")

174 #V”ify 
we
 
sucûssfuÎy
 
£Á
 
the
 
mes§ge


175 
£lf
.
	$as£¹True
(
»cov”ed
)

177 #£nd 
some
 
mÜe
 
mes§ges
 
ju¡
 
to
 
make
 
su»
 
no
 mÜ
exû±iÚs


178 
_
 
š
 
	$¿nge
(10):

179 
key
 = 
	`¿ndom_¡ršg
(3).
	`’code
('utf-job')

180 
msg
 = 
	`¿ndom_¡ršg
(10).
	`’code
('utf-job')

181 
´oduûr
.
	`£nd_mes§ges
(
tİic
, 
key
, 
msg
)

183 @
	`kafka_v”siÚs
("all")

184 
def
 
	$‹¡_sw™ch_Ëad”_sim¶e_cÚsum”
(
£lf
):

185 
´oduûr
 = 
	$Produûr
(
£lf
.
ş›Á
, 
async
=
F®£
)

186 
cÚsum”
 = 
	$Sim¶eCÚsum”
(
£lf
.
ş›Á
, 
NÚe
, s–f.
tİic
, 
·¹™iÚs
=NÚe, 
auto_comm™
=
F®£
, 
™”_timeout
=10)

187 
£lf
.
	$_£nd_¿ndom_mes§ges
(
´oduûr
, 
£lf
.
tİic
, 0, 2)

188 
cÚsum”
.
	$g‘_mes§ges
()

189 
£lf
.
	$_kl_Ëad”
(
£lf
.
tİic
, 0)

190 
cÚsum”
.
	$g‘_mes§ges
()

192 
def
 
	$_£nd_¿ndom_mes§ges
(
£lf
, 
´oduûr
, 
tİic
, 
·¹™iÚ
, 
n
):

193 
j
 
š
 
	$¿nge
(
n
):

194 
msg
 = 'msg {0}: {1}'.
	`fÜm©
(
j
, 
	$¿ndom_¡ršg
(10))

195 
log
.
	`debug
('_£nd_¿ndom_mes§g% tØ%s:%d', 
msg
, 
tİic
, 
·¹™iÚ
)

196 
True
:

197 
Œy
:

198 
´oduûr
.
	`£nd_mes§ges
(
tİic
, 
·¹™iÚ
, 
msg
.
	`’code
('utf-job'))

199 
exû±
:

200 
log
.
	`exû±iÚ
('failure in _send_random_messages -„etrying')

205 
def
 
	$_kl_Ëad”
(
£lf
, 
tİic
, 
·¹™iÚ
):

206 
Ëad”
 = 
£lf
.
ş›Á
.
tİics_to_brok”s
[
	`TİicAndP¬t™iÚ
(
	`kafka_by‹¡ršg
(
tİic
), 
·¹™iÚ
)]

207 
brok”
 = 
£lf
.
brok”s
[
Ëad”
.
nodeId
]

208 
brok”
.
	$şo£
()

209  
brok”


211 
def
 
	$as£¹_mes§ge_couÁ
(
£lf
, 
tİic
, 
check_couÁ
, 
timeout
=10,

212 
·¹™iÚs
=
NÚe
, 
©_Ëa¡
=
F®£
):

213 
ho¡s
 = ','.
	`još
(['%s:%d' % (
brok”
.
ho¡
, brok”.
pÜt
)

214 
brok”
 
š
 
£lf
.
brok”s
])

216 
ş›Á
 = 
	$KafkaCl›Á
(
ho¡s
)

217 
cÚsum”
 = 
	$Sim¶eCÚsum”
(
ş›Á
, 
NÚe
, 
tİic
,

218 
·¹™iÚs
=partitions,

219 
auto_comm™
=
F®£
,

220 
™”_timeout
=
timeout
)

222 
¡¬‹d_©
 = 
time
.
	$time
()

223 
³ndšg
 = 
cÚsum”
.
	$³ndšg
(
·¹™iÚs
)

225 #K“°
checkšg
 
™
 
i¢
't immediately correct, subjectoimeout

226 
³ndšg
 < 
check_couÁ
 
	`ªd
 (
time
.
	`time
(è- 
¡¬‹d_©
 < 
timeout
):

227 
³ndšg
 = 
cÚsum”
.
	$³ndšg
(
·¹™iÚs
)

228 
time
.
	$¦“p
(0.5)

230 
cÚsum”
.
	$¡İ
()

231 
ş›Á
.
	$şo£
()

233 
³ndšg
 < 
check_couÁ
:

234 
£lf
.
	`ç
('Too few…ending messages: found %d,ƒxpected %d' %

235 (
³ndšg
, 
check_couÁ
))

236 
–if
 
³ndšg
 > 
check_couÁ
 
ªd
 
nÙ
 
©_Ëa¡
:

237 
£lf
.
	`ç
('Too many…ending messages: found %d,ƒxpected %d' %

238 (
³ndšg
, 
check_couÁ
))

239  
True


	@/root/grocery-shop/language/python/kafka/test/test_package.py

1 
	gäom
 . 
impÜt
 
un™‹¡


3 
şass
 
	$Te¡Package
(
un™‹¡
.
Te¡Ca£
):

4 
def
 
	$‹¡_tİ_Ëv–_Çme¥aû
(
£lf
):

5 
impÜt
 
kafka
 
as
 
kafka1


6 
£lf
.
	`as£¹Equ®
(
kafka1
.
KafkaCl›Á
.
__Çme__
, "KafkaClient")

7 
£lf
.
	`as£¹Equ®
(
kafka1
.
ş›Á
.
__Çme__
, "kafka.client")

8 
£lf
.
	`as£¹Equ®
(
kafka1
.
codec
.
__Çme__
, "kafka.codec")

10 
def
 
	$‹¡_submoduË_Çme¥aû
(
£lf
):

11 
impÜt
 
kafka
.
ş›Á
 
as
 
ş›Á1


12 
£lf
.
	`as£¹Equ®
(
ş›Á1
.
__Çme__
, "kafka.client")

13 
£lf
.
	`as£¹Equ®
(
ş›Á1
.
KafkaCl›Á
.
__Çme__
, "KafkaClient")

15 
äom
 
kafka
 
impÜt
 
ş›Á
 
as
 
ş›Á2


16 
£lf
.
	`as£¹Equ®
(
ş›Á2
.
__Çme__
, "kafka.client")

17 
£lf
.
	`as£¹Equ®
(
ş›Á2
.
KafkaCl›Á
.
__Çme__
, "KafkaClient")

19 
äom
 
kafka
.
ş›Á
 
impÜt
 
KafkaCl›Á
 
as
 
KafkaCl›Á1


20 
£lf
.
	`as£¹Equ®
(
KafkaCl›Á1
.
__Çme__
, "KafkaClient")

22 
äom
 
kafka
.
codec
 
impÜt
 
gz_’code
 
as
 
gz_’code1


23 
£lf
.
	`as£¹Equ®
(
gz_’code1
.
__Çme__
, "gzip_encode")

25 
äom
 
kafka
 
impÜt
 
KafkaCl›Á
 
as
 
KafkaCl›Á2


26 
£lf
.
	`as£¹Equ®
(
KafkaCl›Á2
.
__Çme__
, "KafkaClient")

28 
äom
 
kafka
.
codec
 
impÜt
 
¢­py_’code


29 
£lf
.
	`as£¹Equ®
(
¢­py_’code
.
__Çme__
, "snappy_encode")

	@/root/grocery-shop/language/python/kafka/test/test_producer.py

1 #-*- 
codšg
: 
utf
-
job
 -*-

3 
impÜt
 
cŞËùiÚs


4 
impÜt
 
loggšg


5 
impÜt
 
time


7 
äom
 
mock
 
impÜt
 
	gMagicMock
, 
·tch


8 
	gäom
 . 
impÜt
 
un™‹¡


10 
äom
 
kafka
 
impÜt
 
	gKafkaCl›Á
, 
Sim¶eProduûr


11 
äom
 
	gkafka
.
commÚ
 
	$impÜt
 (

12 
AsyncProduûrQueueFuÎ
, 
FaedPaylßdsE¼Ü
, 
NÙL—d”FÜP¬t™iÚE¼Ü
,

13 
ProduûRe¥Ú£
, 
R‘ryO±iÚs
, 
TİicAndP¬t™iÚ


15 
äom
 
kafka
.
´oduûr
.
ba£
 
impÜt
 
Produûr
, 
_£nd_up¡»am


16 
äom
 
kafka
.
´ÙocŞ
 
impÜt
 
CODEC_NONE


18 
impÜt
 
th»adšg


19 
Œy
:

20 
äom
 
queue
 
impÜt
 
Em±y
, 
Queue


21 
exû±
 
ImpÜtE¼Ü
:

22 
äom
 
Queue
 
impÜt
 
Em±y
, Queue

23 
Œy
:

24 
x¿nge


25 
exû±
 
NameE¼Ü
:

26 
x¿nge
 = 
¿nge


29 
şass
 
	$Te¡KafkaProduûr
(
un™‹¡
.
Te¡Ca£
):

30 
def
 
	$‹¡_´oduûr_mes§ge_ty³s
(
£lf
):

32 
´oduûr
 = 
	`Produûr
(
	$MagicMock
())

33 
tİic
 = 
b
"test-topic"

34 
·¹™iÚ
 = 0

36 
bad_d©a_ty³s
 = (
u
'ä½ æ€ä¹ˆæ ·?', 12, ['a', 'li¡'], ('a', 'tu¶e'), {'a': 'diù'
	}
})

37 
m
 
š
 
bad_d©a_ty³s
:

38 
w™h
 
£lf
.
	$as£¹Rai£s
(
Ty³E¼Ü
):

39 
loggšg
.
	`debug
("©‹m±šgØ£nd mes§goàty³ %s", 
	$ty³
(
m
))

40 
´oduûr
.
	$£nd_mes§ges
(
tİic
, 
·¹™iÚ
, 
m
)

42 
good_d©a_ty³s
 = (
b
'a string!',)

43 
m
 
š
 
good_d©a_ty³s
:

44 #Thi 
should
 
nÙ
 
¿i£
 
ª
 
exû±iÚ


45 
´oduûr
.
	$£nd_mes§ges
(
tİic
, 
·¹™iÚ
, 
m
)

47 
def
 
	$‹¡_tİic_mes§ge_ty³s
(
£lf
):

48 
ş›Á
 = 
	$MagicMock
()

50 
def
 
	$·¹™iÚs
(
tİic
):

53 
ş›Á
.
g‘_·¹™iÚ_ids_fÜ_tİic
 = 
·¹™iÚs


55 
´oduûr
 = 
	$Sim¶eProduûr
(
ş›Á
, 
¿ndom_¡¬t
=
F®£
)

56 
tİic
 = 
b
"test-topic"

57 
´oduûr
.
	`£nd_mes§ges
(
tİic
, 
b
'hi')

58 
as£¹
 
ş›Á
.
£nd_´oduû_»que¡
.
ÿÎed


60 @
	`·tch
('kafka.producer.base._send_upstream')

61 
def
 
	$‹¡_´oduûr_async_queue_ov”fËd
(
£lf
, 
mock
):

62 
queue_size
 = 2

63 
´oduûr
 = 
	`Produûr
(
	`MagicMock
(), 
async
=
True
,

64 
async_queue_maxsize
=
queue_size
)

66 
tİic
 = 
b
'test-topic'

67 
·¹™iÚ
 = 0

68 
mes§ge
 = 
b
'test-message'

70 
w™h
 
£lf
.
	$as£¹Rai£s
(
AsyncProduûrQueueFuÎ
):

71 
mes§ge_li¡
 = [
mes§ge
] * (
queue_size
 + 1)

72 
´oduûr
.
	$£nd_mes§ges
(
tİic
, 
·¹™iÚ
, *
mes§ge_li¡
)

73 
£lf
.
	`as£¹Equ®
(
´oduûr
.
queue
.
	`qsize
(), 
queue_size
)

74 
_
 
š
 
	`x¿nge
(
´oduûr
.
queue
.
	$qsize
()):

75 
´oduûr
.
queue
.
	$g‘
()

77 
def
 
	$‹¡_´oduûr_sync_ç_Ú_”rÜ
(
£lf
):

78 
”rÜ
 = 
	`FaedPaylßdsE¼Ü
('failure')

79 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, 'load_metadata_for_topics'):

80 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, 'g‘_·¹™iÚ_ids_fÜ_tİic', 
»tuº_v®ue
=[0, 1]):

81 
w™h
 
·tch
.
	`objeù
(
KafkaCl›Á
, '_£nd_brok”_aw¬e_»que¡', 
»tuº_v®ue
 = [
”rÜ
]):

83 
ş›Á
 = 
	`KafkaCl›Á
(
	$MagicMock
())

84 
´oduûr
 = 
	$Sim¶eProduûr
(
ş›Á
, 
async
=
F®£
, 
sync_ç_Ú_”rÜ
=False)

86 #Thi 
should
 
nÙ
 
¿i£


87 (
»¥Ú£
,èğ
´oduûr
.
	`£nd_mes§ges
('foob¬', 
b
'test message')

88 
£lf
.
	$as£¹Equ®
(
»¥Ú£
, 
”rÜ
)

90 
´oduûr
 = 
	$Sim¶eProduûr
(
ş›Á
, 
async
=
F®£
, 
sync_ç_Ú_”rÜ
=
True
)

91 
w™h
 
£lf
.
	$as£¹Rai£s
(
FaedPaylßdsE¼Ü
):

92 
´oduûr
.
	`£nd_mes§ges
('foob¬', 
b
'test message')

95 
şass
 
	$Te¡KafkaProduûrS’dUp¡»am
(
un™‹¡
.
Te¡Ca£
):

97 
def
 
	$£tUp
(
£lf
):

98 
£lf
.
ş›Á
 = 
	$MagicMock
()

99 
£lf
.
queue
 = 
	$Queue
()

101 
def
 
	$_run_´oûss
(
£lf
, 
»Œ›s_lim™
=3, 
¦“p_timeout
=1):

102 #ruÀ
_£nd_up¡»am
 
´oûss
 
w™h
 
the
 
queue


103 
¡İ_ev’t
 = 
th»adšg
.
	$Ev’t
()

104 
»Œy_İtiÚs
 = 
	$R‘ryO±iÚs
(
lim™
=
»Œ›s_lim™
,

105 
backoff_ms
=50,

106 
»Œy_Ú_timeouts
=
F®£
)

107 
£lf
.
th»ad
 = 
th»adšg
.
	`Th»ad
(

108 
rg‘
=
_£nd_up¡»am
,

109 
¬gs
=(
£lf
.
queue
, s–f.
ş›Á
, 
CODEC_NONE
,

110 0.3, #b©ch 
	`time
 (
£cÚds
)

111 3, #b©ch 
Ëngth


112 
Produûr
.
ACK_AFTER_LOCAL_WRITE
,

113 
Produûr
.
DEFAULT_ACK_TIMEOUT
,

114 
»Œy_İtiÚs
,

115 
¡İ_ev’t
))

116 
£lf
.
th»ad
.
d«mÚ
 = 
True


117 
£lf
.
th»ad
.
	$¡¬t
()

118 
time
.
	$¦“p
(
¦“p_timeout
)

119 
¡İ_ev’t
.
	$£t
()

121 
def
 
	$‹¡_wo_»Œ›s
(
£lf
):

123 #Ët 
ü—‹
 
a
 
queue
 
ªd
 
add
 10 
mes§ges
 1 
·¹™iÚ


124 
i
 
š
 
	$¿nge
(10):

125 
£lf
.
queue
.
	`put
((
	`TİicAndP¬t™iÚ
("test", 0), "msg %i", "key %i"))

127 
£lf
.
	$_run_´oûss
()

129 #th
queue
 
should
 
be
 
©
 
the
 
’d
 
of
h
‹¡


130 
£lf
.
	`as£¹Equ®
(£lf.
queue
.
	`em±y
(), 
True
)

132 #th”
should
 
be
 4 
nÚ
-
ÿls
:

133 #3 
b©ches
 
of
 3 
msgs
 
—ch
 + 1 
b©ch
 oà1 
mes§ge


134 
£lf
.
	$as£¹Equ®
(
£lf
.
ş›Á
.
£nd_´oduû_»que¡
.
ÿÎ_couÁ
, 4)

136 
def
 
	$‹¡_fœ¡_£nd_çed
(
£lf
):

138 #Ët 
ü—‹
 
a
 
queue
 
ªd
 
add
 10 
mes§ges
 10 
difã»Á
 
·¹™iÚs


139 #tØ
show
 
how
 
»Œ›s
 
should
 
wÜk
 
id—Îy


140 
i
 
š
 
	$¿nge
(10):

141 
£lf
.
queue
.
	`put
((
	`TİicAndP¬t™iÚ
("‹¡", 
i
), "msg %i", "key %i"))

143 #Mock 
off£ts
 
couÁ”
 
şosu»


144 
off£ts
 = 
cŞËùiÚs
.
	`deçuÉdiù
(
Ïmbda
: cŞËùiÚs.
	$deçuÉdiù
(
Ïmbda
: 0))

145 
£lf
.
ş›Á
.
is_fœ¡_time
 = 
True


146 
def
 
	$£nd_side_efãù
(
»qs
, *
¬gs
, **
kw¬gs
):

147 
£lf
.
ş›Á
.
is_fœ¡_time
:

148 
£lf
.
ş›Á
.
is_fœ¡_time
 = 
F®£


149  [
	$FaedPaylßdsE¼Ü
(
»q
è»q 
š
 
»qs
]

150 
»¥Ú£s
 = []

151 
»q
 
š
 
»qs
:

152 
off£t
 = 
off£ts
[
»q
.
tİic
][»q.
·¹™iÚ
]

153 
off£ts
[
»q
.
tİic
][»q.
·¹™iÚ
] +ğ
	$Ën
(
»q
.
mes§ges
)

154 
»¥Ú£s
.
	`­³nd
(

155 
	$ProduûRe¥Ú£
(
»q
.
tİic
,„eq.
·¹™iÚ
, 0, 
off£t
)

157  
»¥Ú£s


159 
£lf
.
ş›Á
.
£nd_´oduû_»que¡
.
side_efãù
 = 
£nd_side_efãù


161 
£lf
.
	$_run_´oûss
(2)

163 #th
queue
 
should
 
be
 
©
 
the
 
’d
 
of
h
‹¡


164 
£lf
.
	`as£¹Equ®
(£lf.
queue
.
	`em±y
(), 
True
)

166 #th”
should
 
be
 5 
nÚ
-
ÿÎs
: 1
¡
 
çed
 
b©ch
 
of
 3 
msgs


167 #¶u 3 
b©ches
 
of
 3 
msgs
 
—ch
 + 1 
b©ch
 oà1 
mes§ge


168 
£lf
.
	$as£¹Equ®
(
£lf
.
ş›Á
.
£nd_´oduû_»que¡
.
ÿÎ_couÁ
, 5)

170 
def
 
	$‹¡_w™h_lim™ed_»Œ›s
(
£lf
):

172 #Ët 
ü—‹
 
a
 
queue
 
ªd
 
add
 10 
mes§ges
 10 
difã»Á
 
·¹™iÚs


173 #tØ
show
 
how
 
»Œ›s
 
should
 
wÜk
 
id—Îy


174 
i
 
š
 
	$¿nge
(10):

175 
£lf
.
queue
.
	`put
((
	`TİicAndP¬t™iÚ
("‹¡", 
i
), "msg %i" % i, "key %i" % i))

177 
def
 
	$£nd_side_efãù
(
»qs
, *
¬gs
, **
kw¬gs
):

178  [
	$FaedPaylßdsE¼Ü
(
»q
è»q 
š
 
»qs
]

180 
£lf
.
ş›Á
.
£nd_´oduû_»que¡
.
side_efãù
 = 
£nd_side_efãù


182 
£lf
.
	$_run_´oûss
(3, 3)

184 #th
queue
 
should
 
be
 
©
 
the
 
’d
 
of
h
‹¡


185 
£lf
.
	`as£¹Equ®
(£lf.
queue
.
	`em±y
(), 
True
)

187 #th”
should
 
be
 16 
nÚ
-
ÿÎs
:

188 #3 
š™Ÿl
 
b©ches
 
of
 3 
msgs
 
—ch
 + 1 in™ŸÈ
b©ch
 oà1 
msg
 +

189 #3 
»Œ›s
 
of
 
the
 
b©ches
 
above
 = (1 + 3„etries) * 4 batches = 16

190 
£lf
.
	$as£¹Equ®
(
£lf
.
ş›Á
.
£nd_´oduû_»que¡
.
ÿÎ_couÁ
, 16)

192 
def
 
	$‹¡_async_´oduûr_nÙ_Ëad”
(
£lf
):

194 
i
 
š
 
	$¿nge
(10):

195 
£lf
.
queue
.
	`put
((
	`TİicAndP¬t™iÚ
("‹¡", 
i
), "msg %i", "key %i"))

197 #Mock 
off£ts
 
couÁ”
 
şosu»


198 
off£ts
 = 
cŞËùiÚs
.
	`deçuÉdiù
(
Ïmbda
: cŞËùiÚs.
	$deçuÉdiù
(
Ïmbda
: 0))

199 
£lf
.
ş›Á
.
is_fœ¡_time
 = 
True


200 
def
 
	$£nd_side_efãù
(
»qs
, *
¬gs
, **
kw¬gs
):

201 
£lf
.
ş›Á
.
is_fœ¡_time
:

202 
£lf
.
ş›Á
.
is_fœ¡_time
 = 
F®£


203  [
	`ProduûRe¥Ú£
(
»q
.
tİic
,„eq.
·¹™iÚ
,

204 
NÙL—d”FÜP¬t™iÚE¼Ü
.
”ºo
, -1)

205 
»q
 
š
 
»qs
]

207 
»¥Ú£s
 = []

208 
»q
 
š
 
»qs
:

209 
off£t
 = 
off£ts
[
»q
.
tİic
][»q.
·¹™iÚ
]

210 
off£ts
[
»q
.
tİic
][»q.
·¹™iÚ
] +ğ
	$Ën
(
»q
.
mes§ges
)

211 
»¥Ú£s
.
	`­³nd
(

212 
	$ProduûRe¥Ú£
(
»q
.
tİic
,„eq.
·¹™iÚ
, 0, 
off£t
)

214  
»¥Ú£s


216 
£lf
.
ş›Á
.
£nd_´oduû_»que¡
.
side_efãù
 = 
£nd_side_efãù


218 
£lf
.
	$_run_´oûss
(2)

220 #th
queue
 
should
 
be
 
©
 
the
 
’d
 
of
h
‹¡


221 
£lf
.
	`as£¹Equ®
(£lf.
queue
.
	`em±y
(), 
True
)

223 #th”
should
 
be
 5 
nÚ
-
ÿÎs
: 1
¡
 
çed
 
b©ch
 
of
 3 
msgs


224 #+ 3 
b©ches
 
of
 3 
msgs
 
—ch
 + 1 
b©ch
 oà1 
msg
 = 1 + 3 + 1 = 5

225 
£lf
.
	$as£¹Equ®
(
£lf
.
ş›Á
.
£nd_´oduû_»que¡
.
ÿÎ_couÁ
, 5)

227 
def
 
	$‹¬Down
(
£lf
):

228 
_
 
š
 
	`x¿nge
(
£lf
.
queue
.
	$qsize
()):

229 
£lf
.
queue
.
	`g‘
()

	@/root/grocery-shop/language/python/kafka/test/test_producer_integration.py

1 
impÜt
 
os


2 
impÜt
 
time


3 
impÜt
 
uuid


5 
äom
 
	gsix
.
moves
 
impÜt
 
¿nge


7 
äom
 
kafka
 
	$impÜt
 (

8 
Sim¶eProduûr
, 
KeyedProduûr
,

9 
ü—‹_mes§ge
, 
ü—‹_gz_mes§ge
, 
ü—‹_¢­py_mes§ge
,

10 
RoundRobšP¬t™iÚ”
, 
HashedP¬t™iÚ”


12 
äom
 
kafka
.
codec
 
impÜt
 
has_¢­py


13 
äom
 
kafka
.
commÚ
 
	$impÜt
 (

14 
F‘chReque¡
, 
ProduûReque¡
,

15 
UnknownTİicOrP¬t™iÚE¼Ü
, 
L—d”NÙAvaabËE¼Ü


17 
äom
 
kafka
.
´oduûr
.
ba£
 
impÜt
 
Produûr


19 
äom
 
‹¡
.
fixtu»s
 
impÜt
 
Zook“³rFixtu»
, 
KafkaFixtu»


20 
äom
 
‹¡
.
‹¡ut
 
impÜt
 
KafkaIÁeg¿tiÚTe¡Ca£
, 
kafka_v”siÚs


23 
şass
 
	$Te¡KafkaProduûrIÁeg¿tiÚ
(
KafkaIÁeg¿tiÚTe¡Ca£
):

25 @
şassm‘hod


26 
def
 
	$£tUpCÏss
(
şs
): #noqa

27 
nÙ
 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION'):

30 
şs
.
zk
 = 
Zook“³rFixtu»
.
	$š¡ªû
()

31 
şs
.
£rv”
 = 
KafkaFixtu»
.
	`š¡ªû
(0, cls.
zk
.
ho¡
, cls.zk.
pÜt
)

33 @
şassm‘hod


34 
def
 
	$‹¬DownCÏss
(
şs
): #noqa

35 
nÙ
 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION'):

38 
şs
.
£rv”
.
	$şo£
()

39 
şs
.
zk
.
	`şo£
()

41 @
	`kafka_v”siÚs
("all")

42 
def
 
	$‹¡_´oduû_mªy_sim¶e
(
£lf
):

43 
¡¬t_off£t
 = 
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 0)

45 
£lf
.
	`as£¹_´oduû_»que¡
(

46 [
	`ü—‹_mes§ge
(("Te¡ mes§g%d" % 
i
).
	`’code
('utf-job'))

47 
i
 
š
 
	`¿nge
(100)],

48 
¡¬t_off£t
,

52 
£lf
.
	`as£¹_´oduû_»que¡
(

53 [
	`ü—‹_mes§ge
(("Te¡ mes§g%d" % 
i
).
	`’code
('utf-job'))

54 
i
 
š
 
	`¿nge
(100)],

55 
¡¬t_off£t
+100,

59 @
	`kafka_v”siÚs
("all")

60 
def
 
	$‹¡_´oduû_10k_sim¶e
(
£lf
):

61 
¡¬t_off£t
 = 
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 0)

63 
£lf
.
	`as£¹_´oduû_»que¡
(

64 [
	`ü—‹_mes§ge
(("Te¡ mes§g%d" % 
i
).
	`’code
('utf-job'))

65 
i
 
š
 
	`¿nge
(10000)],

66 
¡¬t_off£t
,

70 @
	`kafka_v”siÚs
("all")

71 
def
 
	$‹¡_´oduû_mªy_gz
(
£lf
):

72 
¡¬t_off£t
 = 
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 0)

74 
mes§ge1
 = 
	`ü—‹_gz_mes§ge
([

75 (("Gz³d 1 %d" % 
i
).
	`’code
('utf-job'), 
NÚe
è˜
š
 
	`¿nge
(100)])

76 
mes§ge2
 = 
	`ü—‹_gz_mes§ge
([

77 (("Gz³d 2 %d" % 
i
).
	`’code
('utf-job'), 
NÚe
è˜
š
 
	`¿nge
(100)])

79 
£lf
.
	`as£¹_´oduû_»que¡
(

80 [ 
mes§ge1
, 
mes§ge2
 ],

81 
¡¬t_off£t
,

85 @
	`kafka_v”siÚs
("all")

86 
def
 
	$‹¡_´oduû_mªy_¢­py
(
£lf
):

87 
£lf
.
	`skTe¡
("All snappy integrationests fail with‚osnappyjava")

88 
¡¬t_off£t
 = 
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 0)

90 
£lf
.
	`as£¹_´oduû_»que¡
([

91 
	`ü—‹_¢­py_mes§ge
([("SÇµy 1 %d" % 
i
, 
NÚe
è˜
š
 
	`¿nge
(100)]),

92 
	`ü—‹_¢­py_mes§ge
([("SÇµy 2 %d" % 
i
, 
NÚe
è˜
š
 
	`¿nge
(100)]),

94 
¡¬t_off£t
,

98 @
	`kafka_v”siÚs
("all")

99 
def
 
	$‹¡_´oduû_mixed
(
£lf
):

100 
¡¬t_off£t
 = 
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 0)

102 
msg_couÁ
 = 1+100

103 
mes§ges
 = [

104 
	`ü—‹_mes§ge
(
b
"Just‡…lain message"),

105 
	`ü—‹_gz_mes§ge
([

106 (("Gz³d %d" % 
i
).
	`’code
('utf-job'), 
NÚe
è˜
š
 
	`¿nge
(100)]),

109 #AÎ 
¢­py
 
š‹g¿tiÚ
 
‹¡s
 
ç
 
w™h
 
no¢­pyjava


110 
F®£
 
ªd
 
	$has_¢­py
():

111 
msg_couÁ
 += 100

112 
mes§ges
.
	`­³nd
(
	`ü—‹_¢­py_mes§ge
([("SÇµy %d" % 
i
, 
NÚe
è˜
š
 
	`¿nge
(100)]))

114 
£lf
.
	`as£¹_´oduû_»que¡
(
mes§ges
, 
¡¬t_off£t
, 
msg_couÁ
)

116 @
	`kafka_v”siÚs
("all")

117 
def
 
	$‹¡_´oduû_100k_gz³d
(
£lf
):

118 
¡¬t_off£t
 = 
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 0)

120 
£lf
.
	`as£¹_´oduû_»que¡
([

121 
	`ü—‹_gz_mes§ge
([

122 (("Gz³d b©ch 1, mes§g%d" % 
i
).
	`’code
('utf-job'), 
NÚe
)

123 
i
 
š
 
	`¿nge
(50000)])

125 
¡¬t_off£t
,

129 
£lf
.
	`as£¹_´oduû_»que¡
([

130 
	`ü—‹_gz_mes§ge
([

131 (("Gz³d b©ch 1, mes§g%d" % 
i
).
	`’code
('utf-job'), 
NÚe
)

132 
i
 
š
 
	`¿nge
(50000)])

134 
¡¬t_off£t
+50000,

139 #Sim¶eProduû¸
Te¡s
 #
############################

141 @
	`kafka_v”siÚs
("all")

142 
def
 
	$‹¡_sim¶e_´oduûr
(
£lf
):

143 
·¹™iÚs
 = 
£lf
.
ş›Á
.
	$g‘_·¹™iÚ_ids_fÜ_tİic
(
£lf
.
tİic
)

144 
¡¬t_off£ts
 = [
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 
p
è°
š
 
·¹™iÚs
]

146 
´oduûr
 = 
	$Sim¶eProduûr
(
£lf
.
ş›Á
, 
¿ndom_¡¬t
=
F®£
)

148 #GÛ 
to
 
fœ¡
 
·¹™iÚ
, 
¿ndomly
.

149 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`msg
("one"), self.msg("two"))

150 
£lf
.
	$as£¹_´oduû_»¥Ú£
(
»¥
, 
¡¬t_off£ts
[0])

152 #GÛ 
to
 
the
 
Ãxt
 
·¹™iÚ
, 
¿ndomly
.

153 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`msg
("three"))

154 
£lf
.
	$as£¹_´oduû_»¥Ú£
(
»¥
, 
¡¬t_off£ts
[1])

156 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚs
[0], 
¡¬t_off£ts
[0], [ s–f.
	`msg
("one"), self.msg("two") ])

157 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚs
[1], 
¡¬t_off£ts
[1], [ s–f.
	`msg
("three") ])

159 #GÛ 
back
 
to
 
the
 
fœ¡
 
·¹™iÚ
 
beÿu£
 
th”e
's onlywo…artitions

160 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`msg
("four"), self.msg("five"))

161 
£lf
.
	`as£¹_´oduû_»¥Ú£
(
»¥
, 
¡¬t_off£ts
[0]+2)

162 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚs
[0], 
¡¬t_off£ts
[0], [ s–f.
	`msg
("one"), self.msg("two"), self.msg("four"), self.msg("five") ])

164 
´oduûr
.
	`¡İ
()

166 @
	`kafka_v”siÚs
("all")

167 
def
 
	$‹¡_´oduû__Ãw_tİic_çs_w™h_»asÚabË_”rÜ
(
£lf
):

168 
Ãw_tİic
 = 'Ãw_tİic_{guid}'.
	`fÜm©
(
guid
 = 
	`¡r
(
uuid
.
	`uuid4
())).
	`’code
('utf-job')

169 
´oduûr
 = 
	$Sim¶eProduûr
(
£lf
.
ş›Á
, 
¿ndom_¡¬t
=
F®£
)

171 #Aˆ
fœ¡
 
™
 
dÛ¢
'tƒxist

172 
w™h
 
£lf
.
	`as£¹Rai£s
((
UnknownTİicOrP¬t™iÚE¼Ü
,

173 
L—d”NÙAvaabËE¼Ü
)):

174 
´oduûr
.
	`£nd_mes§ges
(
Ãw_tİic
, 
£lf
.
	`msg
("one"))

176 @
	`kafka_v”siÚs
("all")

177 
def
 
	$‹¡_´oduûr_¿ndom_Üd”
(
£lf
):

178 
´oduûr
 = 
	$Sim¶eProduûr
(
£lf
.
ş›Á
, 
¿ndom_¡¬t
=
True
)

179 
»¥1
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`msg
("one"), self.msg("two"))

180 
»¥2
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`msg
("three"))

181 
»¥3
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`msg
("four"), self.msg("five"))

183 
£lf
.
	$as£¹Equ®
(
»¥1
[0].
·¹™iÚ
, 
»¥3
[0].partition)

184 
£lf
.
	`as£¹NÙEqu®
(
»¥1
[0].
·¹™iÚ
, 
»¥2
[0].partition)

186 @
	`kafka_v”siÚs
("all")

187 
def
 
	$‹¡_´oduûr_Üd”ed_¡¬t
(
£lf
):

188 
´oduûr
 = 
	$Sim¶eProduûr
(
£lf
.
ş›Á
, 
¿ndom_¡¬t
=
F®£
)

189 
»¥1
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`msg
("one"), self.msg("two"))

190 
»¥2
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`msg
("three"))

191 
»¥3
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`msg
("four"), self.msg("five"))

193 
£lf
.
	$as£¹Equ®
(
»¥1
[0].
·¹™iÚ
, 0)

194 
£lf
.
	$as£¹Equ®
(
»¥2
[0].
·¹™iÚ
, 1)

195 
£lf
.
	`as£¹Equ®
(
»¥3
[0].
·¹™iÚ
, 0)

197 @
	`kafka_v”siÚs
("all")

198 
def
 
	$‹¡_async_sim¶e_´oduûr
(
£lf
):

199 
·¹™iÚ
 = 
£lf
.
ş›Á
.
	`g‘_·¹™iÚ_ids_fÜ_tİic
(£lf.
tİic
)[0]

200 
¡¬t_off£t
 = 
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 
·¹™iÚ
)

202 
´oduûr
 = 
	$Sim¶eProduûr
(
£lf
.
ş›Á
, 
async
=
True
, 
¿ndom_¡¬t
=
F®£
)

203 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`msg
("one"))

204 
£lf
.
	`as£¹Equ®
(
	`Ën
(
»¥
), 0)

206 #wa™ 
the
 
£rv”
 
to
 
»pÜt
 
a
 
Ãw
 
highw©”m¬k


207 
£lf
.
	`cu¼’t_off£t
(£lf.
tİic
, 
·¹™iÚ
è=ğ
¡¬t_off£t
:

208 
time
.
	$¦“p
(0.1)

210 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚ
, 
¡¬t_off£t
, [ s–f.
	`msg
("one") ])

212 
´oduûr
.
	`¡İ
()

214 @
	`kafka_v”siÚs
("all")

215 
def
 
	$‹¡_b©ched_sim¶e_´oduûr__Œigg”s_by_mes§ge
(
£lf
):

216 
·¹™iÚs
 = 
£lf
.
ş›Á
.
	$g‘_·¹™iÚ_ids_fÜ_tİic
(
£lf
.
tİic
)

217 
¡¬t_off£ts
 = [
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 
p
è°
š
 
·¹™iÚs
]

219 #CÚfigu» 
b©ch
 
´oduûr


220 
b©ch_mes§ges
 = 5

221 
b©ch_š‹rv®
 = 5

222 
´oduûr
 = 
	$Sim¶eProduûr
(

223 
£lf
.
ş›Á
,

224 
async
=
True
,

225 
b©ch_£nd_ev”y_n
=
b©ch_mes§ges
,

226 
b©ch_£nd_ev”y_t
=
b©ch_š‹rv®
,

227 
¿ndom_¡¬t
=
F®£
)

229 #S’d 4 
mes§ges
 -- 
should
 
nÙ
 
Œigg”
 
a
 
b©ch


230 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(

231 
£lf
.
tİic
,

232 
£lf
.
	`msg
("one"),

233 
£lf
.
	`msg
("two"),

234 
£lf
.
	`msg
("three"),

235 
£lf
.
	`msg
("four"),

238 #B©ch 
mode
 
is
 
async
. 
No
 
ack


239 
£lf
.
	`as£¹Equ®
(
	`Ën
(
»¥
), 0)

241 #Iˆ
ha¢
't sent yet

242 
£lf
.
	$as£¹_ãtch_off£t
(
·¹™iÚs
[0], 
¡¬t_off£ts
[0], [])

243 
£lf
.
	$as£¹_ãtch_off£t
(
·¹™iÚs
[1], 
¡¬t_off£ts
[1], [])

245 #£nd 3 
mÜe
 
mes§ges
 -- 
should
 
Œigg”
 
b©ch
 
Ú
 
fœ¡
 5

246 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(

247 
£lf
.
tİic
,

248 
£lf
.
	`msg
("five"),

249 
£lf
.
	`msg
("six"),

250 
£lf
.
	`msg
("seven"),

253 #B©ch 
mode
 
is
 
async
. 
No
 
ack


254 
£lf
.
	`as£¹Equ®
(
	`Ën
(
»¥
), 0)

256 #Wa™ 
uÁ
 
´oduûr
 
has
 
puÎed
 
®l
 
mes§ges
 
äom
 
š‹º®
 
queue


257 #thi 
should
 
sigÇl
 
th©
 
the
 
fœ¡
 
b©ch
 
was
 
£Á
, 
ªd
h
´oduûr


258 #i 
now
 
wa™šg
 
’ough
 
mes§ges
 
to
 
b©ch
 
	`agaš
 (
Ü
 
a
 
timeout
)

259 
timeout
 = 5

260 
¡¬t
 = 
time
.
	$time
()

261 
nÙ
 
´oduûr
.
queue
.
	$em±y
():

262 
time
.
	`time
(è- 
¡¬t
 > 
timeout
:

263 
£lf
.
	`ç
('timeout waiting for…roducer queueoƒmpty')

264 
time
.
	$¦“p
(0.1)

266 #£nd 
mes§ges
 
groups
 
®l
 *
msgs
 
š
 
a
 
sšgË
 
ÿÎ
 
to
 
the
 
§me
 
·¹™iÚ


267 #sØ
we
 
should
 
£e
 
®l
 
mes§ges
 
äom
 
the
 
fœ¡
 
ÿÎ
 
š
 
Úe
 
·¹™iÚ


268 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚs
[0], 
¡¬t_off£ts
[0], [

269 
£lf
.
	`msg
("one"),

270 
£lf
.
	`msg
("two"),

271 
£lf
.
	`msg
("three"),

272 
£lf
.
	`msg
("four"),

275 #Beÿu£ 
we
 
¬e
 
b©chšg
 
ev”y
 5 
mes§ges
, w
should
 
Úly
 
£e
 
Úe


276 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚs
[1], 
¡¬t_off£ts
[1], [

277 
£lf
.
	`msg
("five"),

280 
´oduûr
.
	`¡İ
()

282 @
	`kafka_v”siÚs
("all")

283 
def
 
	$‹¡_b©ched_sim¶e_´oduûr__Œigg”s_by_time
(
£lf
):

284 
·¹™iÚs
 = 
£lf
.
ş›Á
.
	$g‘_·¹™iÚ_ids_fÜ_tİic
(
£lf
.
tİic
)

285 
¡¬t_off£ts
 = [
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 
p
è°
š
 
·¹™iÚs
]

287 
b©ch_š‹rv®
 = 5

288 
´oduûr
 = 
	$Sim¶eProduûr
(

289 
£lf
.
ş›Á
,

290 
async
=
True
,

291 
b©ch_£nd_ev”y_n
=100,

292 
b©ch_£nd_ev”y_t
=
b©ch_š‹rv®
,

293 
¿ndom_¡¬t
=
F®£
)

295 #S’d 5 
mes§ges
 
ªd
 dØ
a
 
ãtch


296 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(

297 
£lf
.
tİic
,

298 
£lf
.
	`msg
("one"),

299 
£lf
.
	`msg
("two"),

300 
£lf
.
	`msg
("three"),

301 
£lf
.
	`msg
("four"),

304 #B©ch 
mode
 
is
 
async
. 
No
 
ack


305 
£lf
.
	`as£¹Equ®
(
	`Ën
(
»¥
), 0)

307 #Iˆ
ha¢
't sent yet

308 
£lf
.
	$as£¹_ãtch_off£t
(
·¹™iÚs
[0], 
¡¬t_off£ts
[0], [])

309 
£lf
.
	$as£¹_ãtch_off£t
(
·¹™iÚs
[1], 
¡¬t_off£ts
[1], [])

311 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
,

312 
£lf
.
	`msg
("five"),

313 
£lf
.
	`msg
("six"),

314 
£lf
.
	`msg
("seven"),

317 #B©ch 
mode
 
is
 
async
. 
No
 
ack


318 
£lf
.
	`as£¹Equ®
(
	`Ën
(
»¥
), 0)

320 #Wa™ 
the
 
timeout
 
out


321 
time
.
	$¦“p
(
b©ch_š‹rv®
)

323 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚs
[0], 
¡¬t_off£ts
[0], [

324 
£lf
.
	`msg
("one"),

325 
£lf
.
	`msg
("two"),

326 
£lf
.
	`msg
("three"),

327 
£lf
.
	`msg
("four"),

330 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚs
[1], 
¡¬t_off£ts
[1], [

331 
£lf
.
	`msg
("five"),

332 
£lf
.
	`msg
("six"),

333 
£lf
.
	`msg
("seven"),

336 
´oduûr
.
	$¡İ
()

340 #KeyedProduû¸
Te¡s
 #
############################

342 @
	`kafka_v”siÚs
("all")

343 
def
 
	$‹¡_round_robš_·¹™iÚ”
(
£lf
):

344 
·¹™iÚs
 = 
£lf
.
ş›Á
.
	$g‘_·¹™iÚ_ids_fÜ_tİic
(
£lf
.
tİic
)

345 
¡¬t_off£ts
 = [
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 
p
è°
š
 
·¹™iÚs
]

347 
´oduûr
 = 
	$KeyedProduûr
(
£lf
.
ş›Á
, 
·¹™iÚ”
=
RoundRobšP¬t™iÚ”
)

348 
»¥1
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`key
("key1"), s–f.
	`msg
("one"))

349 
»¥2
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`key
("key2"), s–f.
	`msg
("two"))

350 
»¥3
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`key
("key3"), s–f.
	`msg
("three"))

351 
»¥4
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`key
("key4"), s–f.
	`msg
("four"))

353 
£lf
.
	`as£¹_´oduû_»¥Ú£
(
»¥1
, 
¡¬t_off£ts
[0]+0)

354 
£lf
.
	`as£¹_´oduû_»¥Ú£
(
»¥2
, 
¡¬t_off£ts
[1]+0)

355 
£lf
.
	`as£¹_´oduû_»¥Ú£
(
»¥3
, 
¡¬t_off£ts
[0]+1)

356 
£lf
.
	`as£¹_´oduû_»¥Ú£
(
»¥4
, 
¡¬t_off£ts
[1]+1)

358 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚs
[0], 
¡¬t_off£ts
[0], [ s–f.
	`msg
("one"), self.msg("three") ])

359 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚs
[1], 
¡¬t_off£ts
[1], [ s–f.
	`msg
("two"), self.msg("four") ])

361 
´oduûr
.
	`¡İ
()

363 @
	`kafka_v”siÚs
("all")

364 
def
 
	$‹¡_hashed_·¹™iÚ”
(
£lf
):

365 
·¹™iÚs
 = 
£lf
.
ş›Á
.
	$g‘_·¹™iÚ_ids_fÜ_tİic
(
£lf
.
tİic
)

366 
¡¬t_off£ts
 = [
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 
p
è°
š
 
·¹™iÚs
]

368 
´oduûr
 = 
	$KeyedProduûr
(
£lf
.
ş›Á
, 
·¹™iÚ”
=
HashedP¬t™iÚ”
)

369 
»¥1
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`key
("1"), s–f.
	`msg
("one"))

370 
»¥2
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`key
("2"), s–f.
	`msg
("two"))

371 
»¥3
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`key
("3"), s–f.
	`msg
("three"))

372 
»¥4
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`key
("3"), s–f.
	`msg
("four"))

373 
»¥5
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`key
("4"), s–f.
	`msg
("five"))

375 
off£ts
 = {
·¹™iÚs
[0]: 
¡¬t_off£ts
[0],…¬t™iÚs[1]: s¹_off£ts[1]
	}
}

376 
mes§ges
 = {
·¹™iÚs
[0]: [],…artitions[1]: []}

378 
keys
 = [
£lf
.
	$key
(
k
èk 
š
 ["1", "2", "3", "3", "4"]]

379 
»¥s
 = [
»¥1
, 
»¥2
, 
»¥3
, 
»¥4
, 
»¥5
]

380 
msgs
 = [
£lf
.
	$msg
(
m
èm 
š
 ["one", "two", "three", "four", "five"]]

382 
key
, 
»¥
, 
msg
 
š
 
	$z
(
keys
, 
»¥s
, 
msgs
):

383 
k
 = 
	`hash
(
key
) % 2

384 
·¹™iÚ
 = 
·¹™iÚs
[
k
]

385 
off£t
 = 
off£ts
[
·¹™iÚ
]

386 
£lf
.
	$as£¹_´oduû_»¥Ú£
(
»¥
, 
off£t
)

387 
off£ts
[
·¹™iÚ
] += 1

388 
mes§ges
[
·¹™iÚ
].
	$­³nd
(
msg
)

390 
£lf
.
	$as£¹_ãtch_off£t
(
·¹™iÚs
[0], 
¡¬t_off£ts
[0], 
mes§ges
[partitions[0]])

391 
£lf
.
	$as£¹_ãtch_off£t
(
·¹™iÚs
[1], 
¡¬t_off£ts
[1], 
mes§ges
[partitions[1]])

393 
´oduûr
.
	`¡İ
()

395 @
	`kafka_v”siÚs
("all")

396 
def
 
	$‹¡_async_keyed_´oduûr
(
£lf
):

397 
·¹™iÚ
 = 
£lf
.
ş›Á
.
	`g‘_·¹™iÚ_ids_fÜ_tİic
(£lf.
tİic
)[0]

398 
¡¬t_off£t
 = 
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 
·¹™iÚ
)

400 
´oduûr
 = 
	$KeyedProduûr
(
£lf
.
ş›Á
, 
·¹™iÚ”
 = 
RoundRobšP¬t™iÚ”
, 
async
=
True
)

402 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, s–f.
	`key
("key1"), s–f.
	`msg
("one"))

403 
£lf
.
	`as£¹Equ®
(
	`Ën
(
»¥
), 0)

405 #wa™ 
the
 
£rv”
 
to
 
»pÜt
 
a
 
Ãw
 
highw©”m¬k


406 
£lf
.
	`cu¼’t_off£t
(£lf.
tİic
, 
·¹™iÚ
è=ğ
¡¬t_off£t
:

407 
time
.
	$¦“p
(0.1)

409 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚ
, 
¡¬t_off£t
, [ s–f.
	`msg
("one") ])

411 
´oduûr
.
	$¡İ
()

414 #Produû¸
ACK
 
Te¡s
 #
############################

416 @
	`kafka_v”siÚs
("all")

417 
def
 
	$‹¡_acks_nÚe
(
£lf
):

418 
·¹™iÚ
 = 
£lf
.
ş›Á
.
	`g‘_·¹™iÚ_ids_fÜ_tİic
(£lf.
tİic
)[0]

419 
¡¬t_off£t
 = 
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 
·¹™iÚ
)

421 
´oduûr
 = 
	$Produûr
(

422 
£lf
.
ş›Á
,

423 
»q_acks
=
Produûr
.
ACK_NOT_REQUIRED
,

425 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, 
·¹™iÚ
, s–f.
	`msg
("one"))

427 #NØ
»¥Ú£
 
äom
 
´oduû
 
»que¡
 
w™h
 
no
 
acks
 
»quœed


428 
£lf
.
	`as£¹Equ®
(
	`Ën
(
»¥
), 0)

430 #Buˆ
the
 
mes§ge
 
should
 
¡l
 
have
 
b“n
 
d–iv”ed


431 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚ
, 
¡¬t_off£t
, [ s–f.
	`msg
("one") ])

432 
´oduûr
.
	`¡İ
()

434 @
	`kafka_v”siÚs
("all")

435 
def
 
	$‹¡_acks_loÿl_wr™e
(
£lf
):

436 
·¹™iÚ
 = 
£lf
.
ş›Á
.
	`g‘_·¹™iÚ_ids_fÜ_tİic
(£lf.
tİic
)[0]

437 
¡¬t_off£t
 = 
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 
·¹™iÚ
)

439 
´oduûr
 = 
	$Produûr
(

440 
£lf
.
ş›Á
,

441 
»q_acks
=
Produûr
.
ACK_AFTER_LOCAL_WRITE
,

443 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, 
·¹™iÚ
, s–f.
	`msg
("one"))

445 
£lf
.
	$as£¹_´oduû_»¥Ú£
(
»¥
, 
¡¬t_off£t
)

446 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚ
, 
¡¬t_off£t
, [ s–f.
	`msg
("one") ])

448 
´oduûr
.
	`¡İ
()

450 @
	`kafka_v”siÚs
("all")

451 
def
 
	$‹¡_acks_şu¡”_comm™
(
£lf
):

452 
·¹™iÚ
 = 
£lf
.
ş›Á
.
	`g‘_·¹™iÚ_ids_fÜ_tİic
(£lf.
tİic
)[0]

453 
¡¬t_off£t
 = 
£lf
.
	$cu¼’t_off£t
(
£lf
.
tİic
, 
·¹™iÚ
)

455 
´oduûr
 = 
	$Produûr
(

456 
£lf
.
ş›Á
,

457 
»q_acks
=
Produûr
.
ACK_AFTER_CLUSTER_COMMIT
,

460 
»¥
 = 
´oduûr
.
	`£nd_mes§ges
(
£lf
.
tİic
, 
·¹™iÚ
, s–f.
	`msg
("one"))

461 
£lf
.
	$as£¹_´oduû_»¥Ú£
(
»¥
, 
¡¬t_off£t
)

462 
£lf
.
	`as£¹_ãtch_off£t
(
·¹™iÚ
, 
¡¬t_off£t
, [ s–f.
	`msg
("one") ])

464 
´oduûr
.
	$¡İ
()

466 
def
 
	$as£¹_´oduû_»que¡
(
£lf
, 
mes§ges
, 
š™Ÿl_off£t
, 
mes§ge_ù
,

467 
·¹™iÚ
=0):

468 
´oduû
 = 
	$ProduûReque¡
(
£lf
.
by‹s_tİic
, 
·¹™iÚ
, 
mes§ges
=messages)

470 #Th”
should
 
Úly
 
be
 
Úe
 
»¥Ú£
 
mes§ge
 
äom
 
the
 
£rv”
.

471 #Thi 
wl
 
throw
 
ª
 
exû±iÚ
 
th”e
's morehan one.

472 
»¥
 = 
£lf
.
ş›Á
.
	$£nd_´oduû_»que¡
([ 
´oduû
 ])

473 
£lf
.
	$as£¹_´oduû_»¥Ú£
(
»¥
, 
š™Ÿl_off£t
)

475 
£lf
.
	`as£¹Equ®
(£lf.
	`cu¼’t_off£t
(£lf.
tİic
, 
·¹™iÚ
), 
š™Ÿl_off£t
 + 
mes§ge_ù
)

477 
def
 
	$as£¹_´oduû_»¥Ú£
(
£lf
, 
»¥
, 
š™Ÿl_off£t
):

478 
£lf
.
	`as£¹Equ®
(
	`Ën
(
»¥
), 1)

479 
£lf
.
	$as£¹Equ®
(
»¥
[0].
”rÜ
, 0)

480 
£lf
.
	$as£¹Equ®
(
»¥
[0].
off£t
, 
š™Ÿl_off£t
)

482 
def
 
	$as£¹_ãtch_off£t
(
£lf
, 
·¹™iÚ
, 
¡¬t_off£t
, 
ex³ùed_mes§ges
):

483 #Th”
should
 
Úly
 
be
 
Úe
 
»¥Ú£
 
mes§ge
 
äom
 
the
 
£rv”
.

484 #Thi 
wl
 
throw
 
ª
 
exû±iÚ
 
th”e
's morehan one.

486 
»¥
, = 
£lf
.
ş›Á
.
	`£nd_ãtch_»que¡
([ 
	`F‘chReque¡
(£lf.
by‹s_tİic
, 
·¹™iÚ
, 
¡¬t_off£t
, 1024) ])

488 
£lf
.
	$as£¹Equ®
(
»¥
.
”rÜ
, 0)

489 
£lf
.
	$as£¹Equ®
(
»¥
.
·¹™iÚ
,…artition)

490 
mes§ges
 = [ 
x
.
mes§ge
.
v®ue
 x 
š
 
»¥
.messages ]

492 
£lf
.
	$as£¹Equ®
(
mes§ges
, 
ex³ùed_mes§ges
)

493 
£lf
.
	`as£¹Equ®
(
»¥
.
highw©”M¬k
, 
¡¬t_off£t
+
	`Ën
(
ex³ùed_mes§ges
))

	@/root/grocery-shop/language/python/kafka/test/test_protocol.py

1 
äom
 
cÚ‹xib
 
impÜt
 
cÚ‹xtmªag”


2 
impÜt
 

4 
impÜt
 
six


5 
äom
 
mock
 
impÜt
 
	g·tch
, 
£Áš–


6 
	gäom
 . 
impÜt
 
un™‹¡


8 
äom
 
	gkafka
.
codec
 
impÜt
 
	ghas_¢­py
, 
	ggz_decode
, 
¢­py_decode


9 
äom
 
	gkafka
.
commÚ
 
	$impÜt
 (

10 
Off£tReque¡
, 
Off£tComm™Reque¡
, 
Off£tF‘chReque¡
,

11 
Off£tRe¥Ú£
, 
Off£tComm™Re¥Ú£
, 
Off£tF‘chRe¥Ú£
,

12 
ProduûReque¡
, 
F‘chReque¡
, 
Mes§ge
, 
ChecksumE¼Ü
,

13 
ProduûRe¥Ú£
, 
F‘chRe¥Ú£
, 
Off£tAndMes§ge
,

14 
Brok”M‘ad©a
, 
TİicM‘ad©a
, 
P¬t™iÚM‘ad©a
, 
TİicAndP¬t™iÚ
,

15 
KafkaUÇvaabËE¼Ü
, 
UnsuµÜ‹dCodecE¼Ü
, 
CÚsum”F‘chSizeTooSm®l
,

16 
PrÙocŞE¼Ü


18 
äom
 
kafka
.
´ÙocŞ
 
	$impÜt
 (

19 
ATTRIBUTE_CODEC_MASK
, 
CODEC_NONE
, 
CODEC_GZIP
, 
CODEC_SNAPPY
, 
KafkaPrÙocŞ
,

20 
ü—‹_mes§ge
, 
ü—‹_gz_mes§ge
, 
ü—‹_¢­py_mes§ge
,

21 
ü—‹_mes§ge_£t


24 
şass
 
	$Te¡PrÙocŞ
(
un™‹¡
.
Te¡Ca£
):

25 
def
 
	$‹¡_ü—‹_mes§ge
(
£lf
):

26 
·ylßd
 = "test"

27 
key
 = "key"

28 
msg
 = 
	$ü—‹_mes§ge
(
·ylßd
, 
key
)

29 
£lf
.
	$as£¹Equ®
(
msg
.
magic
, 0)

30 
£lf
.
	$as£¹Equ®
(
msg
.
©Œibu‹s
, 0)

31 
£lf
.
	$as£¹Equ®
(
msg
.
key
, key)

32 
£lf
.
	$as£¹Equ®
(
msg
.
v®ue
, 
·ylßd
)

34 
def
 
	$‹¡_ü—‹_gz
(
£lf
):

35 
·ylßds
 = [(
b
"v1", 
NÚe
), (b"v2", None)]

36 
msg
 = 
	$ü—‹_gz_mes§ge
(
·ylßds
)

37 
£lf
.
	$as£¹Equ®
(
msg
.
magic
, 0)

38 
£lf
.
	$as£¹Equ®
(
msg
.
©Œibu‹s
, 
ATTRIBUTE_CODEC_MASK
 & 
CODEC_GZIP
)

39 
£lf
.
	$as£¹Equ®
(
msg
.
key
, 
NÚe
)

40 #N“d 
to
 
decode
Ø
check
 
sšû
 
gz³d
 
·ylßd
 
is
 
nÚ
-
d‘”mši¡ic


41 
decoded
 = 
	$gz_decode
(
msg
.
v®ue
)

42 
ex³ù
 = 
b
"".
	`još
([

43 .
	`·ck
(">q", 0), #MsgS‘ 
off£t


44 .
	`·ck
(">i", 16), #MsgS‘ 
size


45 .
	`·ck
(">i", 12
job5512130
), #CRC

46 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


47 .
	`·ck
(">i", -1), #-1 
šdiÿ‹s
 
a
 
nuÎ
 
key


48 .
	`·ck
(">i", 2), #Msg 
	$Ëngth
 (
by‹s
)

49 
b
"v1", #Mes§g
cÚ‹Ás


51 .
	`·ck
(">q", 0), #MsgS‘ 
off£t


52 .
	`·ck
(">i", 16), #MsgS‘ 
size


53 .
	`·ck
(">i", -7115
job720job
), #CRC

54 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


55 .
	`·ck
(">i", -1), #-1 
šdiÿ‹s
 
a
 
nuÎ
 
key


56 .
	`·ck
(">i", 2), #Msg 
	$Ëngth
 (
by‹s
)

57 
b
"v2", #Mes§g
cÚ‹Ás


60 
£lf
.
	$as£¹Equ®
(
decoded
, 
ex³ù
)

62 
def
 
	$‹¡_ü—‹_gz_keyed
(
£lf
):

63 
·ylßds
 = [(
b
"v1", b"k1"), (b"v2", b"k2")]

64 
msg
 = 
	$ü—‹_gz_mes§ge
(
·ylßds
)

65 
£lf
.
	$as£¹Equ®
(
msg
.
magic
, 0)

66 
£lf
.
	$as£¹Equ®
(
msg
.
©Œibu‹s
, 
ATTRIBUTE_CODEC_MASK
 & 
CODEC_GZIP
)

67 
£lf
.
	$as£¹Equ®
(
msg
.
key
, 
NÚe
)

68 #N“d 
to
 
decode
Ø
check
 
sšû
 
gz³d
 
·ylßd
 
is
 
nÚ
-
d‘”mši¡ic


69 
decoded
 = 
	$gz_decode
(
msg
.
v®ue
)

70 
ex³ù
 = 
b
"".
	`još
([

71 .
	`·ck
(">q", 0), #MsgS‘ 
Off£t


72 .
	`·ck
(">i", 1
job
), #Msg 
Size


73 .
	`·ck
(">i", 1474775406), #CRC

74 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


75 .
	`·ck
(">i", 2), #L’gth 
of
 
key


76 
b
"k1", #Key

77 .
	`·ck
(">i", 2), #L’gth 
of
 
v®ue


78 
b
"v1", #Value

80 .
	`·ck
(">q", 0), #MsgS‘ 
Off£t


81 .
	`·ck
(">i", 1
job
), #Msg 
Size


82 .
	`·ck
(">i", -163
job3415
), #CRC

83 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


84 .
	`·ck
(">i", 2), #L’gth 
of
 
key


85 
b
"k2", #Key

86 .
	`·ck
(">i", 2), #L’gth 
of
 
v®ue


87 
b
"v2", #Value

90 
£lf
.
	`as£¹Equ®
(
decoded
, 
ex³ù
)

92 @
un™‹¡
.
	`skUÆess
(
	`has_¢­py
(), "Snappy‚ot‡vailable")

93 
def
 
	$‹¡_ü—‹_¢­py
(
£lf
):

94 
·ylßds
 = [(
b
"v1", 
NÚe
), (b"v2", None)]

95 
msg
 = 
	$ü—‹_¢­py_mes§ge
(
·ylßds
)

96 
£lf
.
	$as£¹Equ®
(
msg
.
magic
, 0)

97 
£lf
.
	$as£¹Equ®
(
msg
.
©Œibu‹s
, 
ATTRIBUTE_CODEC_MASK
 & 
CODEC_SNAPPY
)

98 
£lf
.
	$as£¹Equ®
(
msg
.
key
, 
NÚe
)

99 
decoded
 = 
	$¢­py_decode
(
msg
.
v®ue
)

100 
ex³ù
 = 
b
"".
	`još
([

101 .
	`·ck
(">q", 0), #MsgS‘ 
off£t


102 .
	`·ck
(">i", 16), #MsgS‘ 
size


103 .
	`·ck
(">i", 12
job5512130
), #CRC

104 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


105 .
	`·ck
(">i", -1), #-1 
šdiÿ‹s
 
a
 
nuÎ
 
key


106 .
	`·ck
(">i", 2), #Msg 
	$Ëngth
 (
by‹s
)

107 
b
"v1", #Mes§g
cÚ‹Ás


109 .
	`·ck
(">q", 0), #MsgS‘ 
off£t


110 .
	`·ck
(">i", 16), #MsgS‘ 
size


111 .
	`·ck
(">i", -7115
job720job
), #CRC

112 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


113 .
	`·ck
(">i", -1), #-1 
šdiÿ‹s
 
a
 
nuÎ
 
key


114 .
	`·ck
(">i", 2), #Msg 
	$Ëngth
 (
by‹s
)

115 
b
"v2", #Mes§g
cÚ‹Ás


118 
£lf
.
	`as£¹Equ®
(
decoded
, 
ex³ù
)

120 @
un™‹¡
.
	`skUÆess
(
	`has_¢­py
(), "Snappy‚ot‡vailable")

121 
def
 
	$‹¡_ü—‹_¢­py_keyed
(
£lf
):

122 
·ylßds
 = [(
b
"v1", b"k1"), (b"v2", b"k2")]

123 
msg
 = 
	$ü—‹_¢­py_mes§ge
(
·ylßds
)

124 
£lf
.
	$as£¹Equ®
(
msg
.
magic
, 0)

125 
£lf
.
	$as£¹Equ®
(
msg
.
©Œibu‹s
, 
ATTRIBUTE_CODEC_MASK
 & 
CODEC_SNAPPY
)

126 
£lf
.
	$as£¹Equ®
(
msg
.
key
, 
NÚe
)

127 
decoded
 = 
	$¢­py_decode
(
msg
.
v®ue
)

128 
ex³ù
 = 
b
"".
	`još
([

129 .
	`·ck
(">q", 0), #MsgS‘ 
Off£t


130 .
	`·ck
(">i", 1
job
), #Msg 
Size


131 .
	`·ck
(">i", 1474775406), #CRC

132 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


133 .
	`·ck
(">i", 2), #L’gth 
of
 
key


134 
b
"k1", #Key

135 .
	`·ck
(">i", 2), #L’gth 
of
 
v®ue


136 
b
"v1", #Value

138 .
	`·ck
(">q", 0), #MsgS‘ 
Off£t


139 .
	`·ck
(">i", 1
job
), #Msg 
Size


140 .
	`·ck
(">i", -163
job3415
), #CRC

141 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


142 .
	`·ck
(">i", 2), #L’gth 
of
 
key


143 
b
"k2", #Key

144 .
	`·ck
(">i", 2), #L’gth 
of
 
v®ue


145 
b
"v2", #Value

148 
£lf
.
	$as£¹Equ®
(
decoded
, 
ex³ù
)

150 
def
 
	$‹¡_’code_mes§ge_h—d”
(
£lf
):

151 
ex³ù
 = 
b
"".
	`još
([

152 .
	`·ck
(">h", 10), #API 
Key


153 .
	`·ck
(">h", 0), #API 
V”siÚ


154 .
	`·ck
(">i", 4), #CÜ»ÏtiÚ 
Id


155 .
	`·ck
(">h", 
	`Ën
("ş›Á3")), #L’gth 
of
 
ş›ÁId


156 
b
"client3", #ClientId

159 
’coded
 = 
KafkaPrÙocŞ
.
	`_’code_mes§ge_h—d”
(
b
"client3", 4, 10)

160 
£lf
.
	$as£¹Equ®
(
’coded
, 
ex³ù
)

162 
def
 
	$‹¡_’code_mes§ge
(
£lf
):

163 
mes§ge
 = 
	`ü—‹_mes§ge
(
b
"test", b"key")

164 
’coded
 = 
KafkaPrÙocŞ
.
	$_’code_mes§ge
(
mes§ge
)

165 
ex³ù
 = 
b
"".
	`još
([

166 .
	`·ck
(">i", -1427009701), #CRC

167 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


168 .
	`·ck
(">i", 3), #L’gth 
of
 
key


169 
b
"key", #key

170 .
	`·ck
(">i", 4), #L’gth 
of
 
v®ue


171 
b
"test", #value

174 
£lf
.
	$as£¹Equ®
(
’coded
, 
ex³ù
)

176 
def
 
	$‹¡_decode_mes§ge
(
£lf
):

177 
’coded
 = 
b
"".
	`još
([

178 .
	`·ck
(">i", -1427009701), #CRC

179 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


180 .
	`·ck
(">i", 3), #L’gth 
of
 
key


181 
b
"key", #key

182 .
	`·ck
(">i", 4), #L’gth 
of
 
v®ue


183 
b
"test", #value

186 
off£t
 = 10

187 (
»tuºed_off£t
, 
decoded_mes§ge
èğ
	`li¡
(
KafkaPrÙocŞ
.
	`_decode_mes§ge
(
’coded
, 
off£t
))[0]

189 
£lf
.
	$as£¹Equ®
(
»tuºed_off£t
, 
off£t
)

190 
£lf
.
	`as£¹Equ®
(
decoded_mes§ge
, 
	`ü—‹_mes§ge
(
b
"test", b"key"))

192 
def
 
	$‹¡_’code_mes§ge_çu»
(
£lf
):

193 
w™h
 
£lf
.
	$as£¹Rai£s
(
PrÙocŞE¼Ü
):

194 
KafkaPrÙocŞ
.
	`_’code_mes§ge
(
	`Mes§ge
(1, 0, "key", "test"))

196 
def
 
	$‹¡_’code_mes§ge_£t
(
£lf
):

197 
mes§ge_£t
 = [

198 
	`ü—‹_mes§ge
(
b
"v1", b"k1"),

199 
	`ü—‹_mes§ge
(
b
"v2", b"k2")

202 
’coded
 = 
KafkaPrÙocŞ
.
	$_’code_mes§ge_£t
(
mes§ge_£t
)

203 
ex³ù
 = 
b
"".
	`još
([

204 .
	`·ck
(">q", 0), #MsgS‘ 
Off£t


205 .
	`·ck
(">i", 1
job
), #Msg 
Size


206 .
	`·ck
(">i", 1474775406), #CRC

207 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


208 .
	`·ck
(">i", 2), #L’gth 
of
 
key


209 
b
"k1", #Key

210 .
	`·ck
(">i", 2), #L’gth 
of
 
v®ue


211 
b
"v1", #Value

213 .
	`·ck
(">q", 0), #MsgS‘ 
Off£t


214 .
	`·ck
(">i", 1
job
), #Msg 
Size


215 .
	`·ck
(">i", -163
job3415
), #CRC

216 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


217 .
	`·ck
(">i", 2), #L’gth 
of
 
key


218 
b
"k2", #Key

219 .
	`·ck
(">i", 2), #L’gth 
of
 
v®ue


220 
b
"v2", #Value

223 
£lf
.
	$as£¹Equ®
(
’coded
, 
ex³ù
)

225 
def
 
	$‹¡_decode_mes§ge_£t
(
£lf
):

226 
’coded
 = 
b
"".
	`još
([

227 .
	`·ck
(">q", 0), #MsgS‘ 
Off£t


228 .
	`·ck
(">i", 1
job
), #Msg 
Size


229 .
	`·ck
(">i", 1474775406), #CRC

230 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


231 .
	`·ck
(">i", 2), #L’gth 
of
 
key


232 
b
"k1", #Key

233 .
	`·ck
(">i", 2), #L’gth 
of
 
v®ue


234 
b
"v1", #Value

236 .
	`·ck
(">q", 1), #MsgS‘ 
Off£t


237 .
	`·ck
(">i", 1
job
), #Msg 
Size


238 .
	`·ck
(">i", -163
job3415
), #CRC

239 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


240 .
	`·ck
(">i", 2), #L’gth 
of
 
key


241 
b
"k2", #Key

242 .
	`·ck
(">i", 2), #L’gth 
of
 
v®ue


243 
b
"v2", #Value

246 
msgs
 = 
	`li¡
(
KafkaPrÙocŞ
.
	$_decode_mes§ge_£t_™”
(
’coded
))

247 
£lf
.
	`as£¹Equ®
(
	`Ën
(
msgs
), 2)

248 
msg1
, 
msg2
 = 
msgs


250 
»tuºed_off£t1
, 
decoded_mes§ge1
 = 
msg1


251 
»tuºed_off£t2
, 
decoded_mes§ge2
 = 
msg2


253 
£lf
.
	$as£¹Equ®
(
»tuºed_off£t1
, 0)

254 
£lf
.
	`as£¹Equ®
(
decoded_mes§ge1
, 
	`ü—‹_mes§ge
(
b
"v1", b"k1"))

256 
£lf
.
	$as£¹Equ®
(
»tuºed_off£t2
, 1)

257 
£lf
.
	`as£¹Equ®
(
decoded_mes§ge2
, 
	`ü—‹_mes§ge
(
b
"v2", b"k2"))

259 
def
 
	$‹¡_decode_mes§ge_gz
(
£lf
):

260 
gz_’coded
 = (
b
'\xc0\x11\xb2\xf0\x00\x01\xff\xff\xff\xff\x00\x00\x000'

261 
b
'\x1f\xjobb\x0job\x00\xa1\xc1\xc5R\x02\xffc`\xjob0\x03\x01'

262 
b
'\x9f\xf9\xd1\xjob7\x1job\x1job\xfe\x03\x01\x90\xc7Tf\xcjob'

263 
b
'\xjob0$wu\x1aW\x05\x92\x9c\x11\x00z\xc0h\xjobjobjob\x00\x00'

264 
b
'\x00')

265 
off£t
 = 11

266 
mes§ges
 = 
	`li¡
(
KafkaPrÙocŞ
.
	$_decode_mes§ge
(
gz_’coded
, 
off£t
))

268 
£lf
.
	`as£¹Equ®
(
	`Ën
(
mes§ges
), 2)

269 
msg1
, 
msg2
 = 
mes§ges


271 
»tuºed_off£t1
, 
decoded_mes§ge1
 = 
msg1


272 
£lf
.
	$as£¹Equ®
(
»tuºed_off£t1
, 0)

273 
£lf
.
	`as£¹Equ®
(
decoded_mes§ge1
, 
	`ü—‹_mes§ge
(
b
"v1"))

275 
»tuºed_off£t2
, 
decoded_mes§ge2
 = 
msg2


276 
£lf
.
	$as£¹Equ®
(
»tuºed_off£t2
, 0)

277 
£lf
.
	`as£¹Equ®
(
decoded_mes§ge2
, 
	`ü—‹_mes§ge
(
b
"v2"))

279 @
un™‹¡
.
	`skUÆess
(
	`has_¢­py
(), "Snappy‚ot‡vailable")

280 
def
 
	$‹¡_decode_mes§ge_¢­py
(
£lf
):

281 
¢­py_’coded
 = (
b
'\xec\xjob0\xa1\x95\x00\x02\xff\xff\xff\xff\x00\x00'

282 
b
'\x00,job\x00\x00\x19\x01@\x10L\x9f[\xc2\x00\x00\xff'

283 
b
'\xff\xff\xff\x00\x00\x00\x02v1\x19\x1bD\x00\x10\xd5'

284 
b
'\x96\nx\x00\x00\xff\xff\xff\xff\x00\x00\x00\x02v2')

285 
off£t
 = 11

286 
mes§ges
 = 
	`li¡
(
KafkaPrÙocŞ
.
	$_decode_mes§ge
(
¢­py_’coded
, 
off£t
))

287 
£lf
.
	`as£¹Equ®
(
	`Ën
(
mes§ges
), 2)

289 
msg1
, 
msg2
 = 
mes§ges


291 
»tuºed_off£t1
, 
decoded_mes§ge1
 = 
msg1


292 
£lf
.
	$as£¹Equ®
(
»tuºed_off£t1
, 0)

293 
£lf
.
	`as£¹Equ®
(
decoded_mes§ge1
, 
	`ü—‹_mes§ge
(
b
"v1"))

295 
»tuºed_off£t2
, 
decoded_mes§ge2
 = 
msg2


296 
£lf
.
	$as£¹Equ®
(
»tuºed_off£t2
, 0)

297 
£lf
.
	`as£¹Equ®
(
decoded_mes§ge2
, 
	`ü—‹_mes§ge
(
b
"v2"))

299 
def
 
	$‹¡_decode_mes§ge_checksum_”rÜ
(
£lf
):

300 
šv®id_’coded_mes§ge
 = 
b
"This is‚ot‡ validƒncoded message"

301 
™”
 = 
KafkaPrÙocŞ
.
	$_decode_mes§ge
(
šv®id_’coded_mes§ge
, 0)

302 
£lf
.
	$as£¹Rai£s
(
ChecksumE¼Ü
, 
li¡
, 
™”
)

304 #NOTE: 
The
 
”rÜ
 
hªdlšg
 
š
 
	`_decode_mes§ge_£t_™”
(è
is
 
que¡iÚabË
.

305 #Ià
™
's modified,he‚extwoests might‚eedo be fixed.

306 
def
 
	$‹¡_decode_mes§ge_£t_ãtch_size_too_sm®l
(
£lf
):

307 
w™h
 
£lf
.
	$as£¹Rai£s
(
CÚsum”F‘chSizeTooSm®l
):

308 
	`li¡
(
KafkaPrÙocŞ
.
	`_decode_mes§ge_£t_™”
('a'))

310 
def
 
	$‹¡_decode_mes§ge_£t_¡İ_™”©iÚ
(
£lf
):

311 
’coded
 = 
b
"".
	`još
([

312 .
	`·ck
(">q", 0), #MsgS‘ 
Off£t


313 .
	`·ck
(">i", 1
job
), #Msg 
Size


314 .
	`·ck
(">i", 1474775406), #CRC

315 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


316 .
	`·ck
(">i", 2), #L’gth 
of
 
key


317 
b
"k1", #Key

318 .
	`·ck
(">i", 2), #L’gth 
of
 
v®ue


319 
b
"v1", #Value

321 .
	`·ck
(">q", 1), #MsgS‘ 
Off£t


322 .
	`·ck
(">i", 1
job
), #Msg 
Size


323 .
	`·ck
(">i", -163
job3415
), #CRC

324 .
	`·ck
(">bb", 0, 0), #Magic, 
æags


325 .
	`·ck
(">i", 2), #L’gth 
of
 
key


326 
b
"k2", #Key

327 .
	`·ck
(">i", 2), #L’gth 
of
 
v®ue


328 
b
"v2", #Value

329 
b
"@1$%(Y!", #Rªdom 
·ddšg


332 
msgs
 = 
	`li¡
(
KafkaPrÙocŞ
.
	$_decode_mes§ge_£t_™”
(
’coded
))

333 
£lf
.
	`as£¹Equ®
(
	`Ën
(
msgs
), 2)

334 
msg1
, 
msg2
 = 
msgs


336 
»tuºed_off£t1
, 
decoded_mes§ge1
 = 
msg1


337 
»tuºed_off£t2
, 
decoded_mes§ge2
 = 
msg2


339 
£lf
.
	$as£¹Equ®
(
»tuºed_off£t1
, 0)

340 
£lf
.
	`as£¹Equ®
(
decoded_mes§ge1
, 
	`ü—‹_mes§ge
(
b
"v1", b"k1"))

342 
£lf
.
	$as£¹Equ®
(
»tuºed_off£t2
, 1)

343 
£lf
.
	`as£¹Equ®
(
decoded_mes§ge2
, 
	`ü—‹_mes§ge
(
b
"v2", b"k2"))

345 
def
 
	$‹¡_’code_´oduû_»que¡
(
£lf
):

346 
»que¡s
 = [

347 
	`ProduûReque¡
(
b
"topic1", 0, [

348 
	`ü—‹_mes§ge
(
b
"a"),

349 
	`ü—‹_mes§ge
(
b
"b")

351 
	`ProduûReque¡
(
b
"topic2", 1, [

352 
	`ü—‹_mes§ge
(
b
"c")

356 
msg_a_bš¬y
 = 
KafkaPrÙocŞ
.
	`_’code_mes§ge
(
	`ü—‹_mes§ge
(
b
"a"))

357 
msg_b_bš¬y
 = 
KafkaPrÙocŞ
.
	`_’code_mes§ge
(
	`ü—‹_mes§ge
(
b
"b"))

358 
msg_c_bš¬y
 = 
KafkaPrÙocŞ
.
	`_’code_mes§ge
(
	`ü—‹_mes§ge
(
b
"c"))

360 
h—d”
 = 
b
"".
	`još
([

361 .
	`·ck
('>i', 0x94), #Th
Ëngth
 
of
 
the
 
mes§ge
 
ov”®l


362 .
	`·ck
('>h', 0), #Msg 
H—d”
, 
Mes§ge
 
ty³
 = 
Produû


363 .
	`·ck
('>h', 0), #Msg 
H—d”
, 
API
 
v”siÚ


364 .
	`·ck
('>i', 2), #Msg 
H—d”
, 
CÜ»ÏtiÚ
 
ID


365 .
	`·ck
('>h7s', 7, 
b
"ş›Á1"), #Msg 
H—d”
, 
The
 
ş›Á
 
ID


366 .
	`·ck
('>h', 2), #Num 
acks
 
»quœed


367 .
	`·ck
('>i', 100), #Reque¡ 
Timeout


368 .
	`·ck
('>i', 2), #Th
numb”
 
of
 
»que¡s


371 
tÙ®_Ën
 = 
	`Ën
(
msg_a_bš¬y
è+ 
	$Ën
(
msg_b_bš¬y
)

372 
tİic1
 = 
b
"".
	`još
([

373 .
	`·ck
('>h6s', 6, 
b
'tİic1'), #Th
tİic1


374 .
	`·ck
('>i', 1), #OÃ 
mes§ge
 
£t


375 .
	`·ck
('>i', 0), #Partition 0

376 .
	`·ck
('>i', 
tÙ®_Ën
 + 24), #Siz
of
 
the
 
šcomšg
 
mes§ge
 
£t


377 .
	`·ck
('>q', 0), #NØ
off£t
 
¥ecif›d


378 .
	`·ck
('>i', 
	`Ën
(
msg_a_bš¬y
)), #L’gth 
of
 
mes§ge


379 
msg_a_bš¬y
, #Aùu® 
mes§ge


380 .
	`·ck
('>q', 0), #NØ
off£t
 
¥ecif›d


381 .
	`·ck
('>i', 
	`Ën
(
msg_b_bš¬y
)), #L’gth 
of
 
mes§ge


382 
msg_b_bš¬y
, #Aùu® 
mes§ge


385 
tİic2
 = 
b
"".
	`još
([

386 .
	`·ck
('>h6s', 6, 
b
'tİic2'), #Th
tİic1


387 .
	`·ck
('>i', 1), #OÃ 
mes§ge
 
£t


388 .
	`·ck
('>i', 1), #Partition 1

389 .
	`·ck
('>i', 
	`Ën
(
msg_c_bš¬y
è+ 12), #Siz
of
 
the
 
šcomšg
 
mes§ge
 
£t


390 .
	`·ck
('>q', 0), #NØ
off£t
 
¥ecif›d


391 .
	`·ck
('>i', 
	`Ën
(
msg_c_bš¬y
)), #L’gth 
of
 
mes§ge


392 
msg_c_bš¬y
, #Aùu® 
mes§ge


395 
ex³ùed1
 = 
b
"".
	$još
([ 
h—d”
, 
tİic1
, 
tİic2
 ])

396 
ex³ùed2
 = 
b
"".
	$još
([ 
h—d”
, 
tİic2
, 
tİic1
 ])

398 
’coded
 = 
KafkaPrÙocŞ
.
	`’code_´oduû_»que¡
(
b
"ş›Á1", 2, 
»que¡s
, 2, 100)

399 
£lf
.
	$as£¹In
(
’coded
, [ 
ex³ùed1
, 
ex³ùed2
 ])

401 
def
 
	$‹¡_decode_´oduû_»¥Ú£
(
£lf
):

402 
t1
 = 
b
"topic1"

403 
t2
 = 
b
"topic2"

404 
_lÚg
 = 

405 
six
.
PY2
:

406 
_lÚg
 = 

407 
’coded
 = .
	`·ck
('>iih%dsiihqihqh%dsiihq' % (
	`Ën
(
t1
),†’(
t2
)),

408 2, 2, 
	`Ën
(
t1
),1, 2, 0, 0, 
	`_lÚg
(10), 1, 1, _long(20),

409 
	`Ën
(
t2
),2, 1, 0, 0, 
	$_lÚg
(30))

410 
»¥Ú£s
 = 
	`li¡
(
KafkaPrÙocŞ
.
	$decode_´oduû_»¥Ú£
(
’coded
))

411 
£lf
.
	`as£¹Equ®
(
»¥Ú£s
,

412 [
	`ProduûRe¥Ú£
(
t1
, 0, 0, 
	`_lÚg
(10)),

413 
	`ProduûRe¥Ú£
(
t1
, 1, 1, 
	`_lÚg
(20)),

414 
	`ProduûRe¥Ú£
(
t2
, 0, 0, 
	`_lÚg
(30))])

416 
def
 
	$‹¡_’code_ãtch_»que¡
(
£lf
):

417 
»que¡s
 = [

418 
	`F‘chReque¡
(
b
"topic1", 0, 10, 1024),

419 
	`F‘chReque¡
(
b
"topic2", 1, 20, 100),

422 
h—d”
 = 
b
"".
	`još
([

423 .
	`·ck
('>i', 
job9
), #Th
Ëngth
 
of
 
the
 
mes§ge
 
ov”®l


424 .
	`·ck
('>h', 1), #Msg 
H—d”
, 
Mes§ge
 
ty³
 = 
F‘ch


425 .
	`·ck
('>h', 0), #Msg 
H—d”
, 
API
 
v”siÚ


426 .
	`·ck
('>i', 3), #Msg 
H—d”
, 
CÜ»ÏtiÚ
 
ID


427 .
	`·ck
('>h7s', 7, 
b
"ş›Á1"),#Msg 
H—d”
, 
The
 
ş›Á
 
ID


428 .
	`·ck
('>i', -1), #R•liÿ 
Id


429 .
	`·ck
('>i', 2), #Max 
wa™
 
time


430 .
	`·ck
('>i', 100), #Mš 
by‹s


431 .
	`·ck
('>i', 2), #Num 
»que¡s


434 
tİic1
 = 
b
"".
	`još
([

435 .
	`·ck
('>h6s', 6, 
b
'topic1'),#Topic

436 .
	`·ck
('>i', 1), #Num 
Paylßds


437 .
	`·ck
('>i', 0), #Partition 0

438 .
	`·ck
('>q', 10), #Offset

439 .
	`·ck
('>i', 1024), #Max 
By‹s


442 
tİic2
 = 
b
"".
	`još
([

443 .
	`·ck
('>h6s', 6, 
b
'topic2'),#Topic

444 .
	`·ck
('>i', 1), #Num 
Paylßds


445 .
	`·ck
('>i', 1), #Partition 0

446 .
	`·ck
('>q', 20), #Offset

447 .
	`·ck
('>i', 100), #Max 
By‹s


450 
ex³ùed1
 = 
b
"".
	$još
([ 
h—d”
, 
tİic1
, 
tİic2
 ])

451 
ex³ùed2
 = 
b
"".
	$još
([ 
h—d”
, 
tİic2
, 
tİic1
 ])

453 
’coded
 = 
KafkaPrÙocŞ
.
	`’code_ãtch_»que¡
(
b
"ş›Á1", 3, 
»que¡s
, 2, 100)

454 
£lf
.
	$as£¹In
(
’coded
, [ 
ex³ùed1
, 
ex³ùed2
 ])

456 
def
 
	$‹¡_decode_ãtch_»¥Ú£
(
£lf
):

457 
t1
 = 
b
"topic1"

458 
t2
 = 
b
"topic2"

459 
msgs
 = [
	$ü—‹_mes§ge
(
msg
)

460 
msg
 
š
 [
b
"message1", b"hi", b"boo", b"foo", b"so fun!"]]

461 
ms1
 = 
KafkaPrÙocŞ
.
	$_’code_mes§ge_£t
([
msgs
[0], msgs[1]])

462 
ms2
 = 
KafkaPrÙocŞ
.
	$_’code_mes§ge_£t
([
msgs
[2]])

463 
ms3
 = 
KafkaPrÙocŞ
.
	$_’code_mes§ge_£t
([
msgs
[3], msgs[4]])

465 
’coded
 = .
	`·ck
('>iih%dsiihqi%dsihqi%dsh%dsiihqi%ds' %

466 (
	`Ën
(
t1
),†’(
ms1
),†’(
ms2
),†’(
t2
),†’(
ms3
)),

467 4, 2, 
	`Ën
(
t1
),1, 2, 0, 0, 10,†’(
ms1
), ms1, 1,

468 1, 20, 
	`Ën
(
ms2
), ms2,†’(
t2
),2, 1, 0, 0, 30,

469 
	`Ën
(
ms3
), ms3)

471 
»¥Ú£s
 = 
	`li¡
(
KafkaPrÙocŞ
.
	$decode_ãtch_»¥Ú£
(
’coded
))

472 
def
 
	$ex·nd_mes§ges
(
»¥Ú£
):

473  
	`F‘chRe¥Ú£
(
»¥Ú£
.
tİic
,„e¥Ú£.
·¹™iÚ
,

474 
»¥Ú£
.
”rÜ
,„e¥Ú£.
highw©”M¬k
,

475 
	$li¡
(
»¥Ú£
.
mes§ges
))

477 
ex·nded_»¥Ú£s
 = 
	`li¡
(
	$m­
(
ex·nd_mes§ges
, 
»¥Ú£s
))

478 
ex³ù
 = [
	`F‘chRe¥Ú£
(
t1
, 0, 0, 10, [
	`Off£tAndMes§ge
(0, 
msgs
[0]),

479 
	`Off£tAndMes§ge
(0, 
msgs
[1])]),

480 
	`F‘chRe¥Ú£
(
t1
, 1, 1, 20, [
	`Off£tAndMes§ge
(0, 
msgs
[2])]),

481 
	`F‘chRe¥Ú£
(
t2
, 0, 0, 30, [
	`Off£tAndMes§ge
(0, 
msgs
[3]),

482 
	`Off£tAndMes§ge
(0, 
msgs
[4])])]

483 
£lf
.
	$as£¹Equ®
(
ex·nded_»¥Ú£s
, 
ex³ù
)

485 
def
 
	$‹¡_’code_m‘ad©a_»que¡_no_tİics
(
£lf
):

486 
ex³ùed
 = 
b
"".
	`još
([

487 .
	`·ck
(">i", 17), #TÙ® 
Ëngth
 
of
 
the
 
»que¡


488 .
	`·ck
('>h', 3), #API 
key
 
m‘ad©a
 
ãtch


489 .
	`·ck
('>h', 0), #API 
v”siÚ


490 .
	`·ck
('>i', 4), #CÜ»ÏtiÚ 
ID


491 .
	`·ck
('>h3s', 3, 
b
"cid"),#Th
ş›Á
 
ID


492 .
	`·ck
('>i', 0), #NØ
tİics
, 
give
 
®l
 
the
 
d©a
!

495 
’coded
 = 
KafkaPrÙocŞ
.
	`’code_m‘ad©a_»que¡
(
b
"cid", 4)

497 
£lf
.
	$as£¹Equ®
(
’coded
, 
ex³ùed
)

499 
def
 
	$‹¡_’code_m‘ad©a_»que¡_w™h_tİics
(
£lf
):

500 
ex³ùed
 = 
b
"".
	`još
([

501 .
	`·ck
(">i", 25), #TÙ® 
Ëngth
 
of
 
the
 
»que¡


502 .
	`·ck
('>h', 3), #API 
key
 
m‘ad©a
 
ãtch


503 .
	`·ck
('>h', 0), #API 
v”siÚ


504 .
	`·ck
('>i', 4), #CÜ»ÏtiÚ 
ID


505 .
	`·ck
('>h3s', 3, 
b
"cid"),#Th
ş›Á
 
ID


506 .
	`·ck
('>i', 2), #Numb” 
of
 
tİics
 
š
 
the
 
»que¡


507 .
	`·ck
('>h2s', 2, 
b
"t1"), #Topic "t1"

508 .
	`·ck
('>h2s', 2, 
b
"t2"), #Topic "t2"

511 
’coded
 = 
KafkaPrÙocŞ
.
	`’code_m‘ad©a_»que¡
(
b
"cid", 4, [b"t1", b"t2"])

513 
£lf
.
	$as£¹Equ®
(
’coded
, 
ex³ùed
)

515 
def
 
	$_ü—‹_’coded_m‘ad©a_»¥Ú£
(
£lf
, 
brok”s
, 
tİics
):

516 
’coded
 = []

517 
’coded
.
	`­³nd
(.
	`·ck
('>ii', 3, 
	$Ën
(
brok”s
)))

518 
brok”
 
š
 
brok”s
:

519 
’coded
.
	`­³nd
(.
	`·ck
('>ih%dsi' % 
	`Ën
(
brok”
.
ho¡
),

520 
brok”
.
nodeId
, 
	`Ën
(brok”.
ho¡
),

521 
brok”
.
ho¡
, brok”.
pÜt
))

523 
’coded
.
	`­³nd
(.
	`·ck
('>i', 
	$Ën
(
tİics
)))

524 
tİic
 
š
 
tİics
:

525 
’coded
.
	`­³nd
(.
	`·ck
('>hh%dsi' % 
	`Ën
(
tİic
.topic),

526 
tİic
.
”rÜ
, 
	`Ën
(topic.topic),

527 
tİic
.tİic, 
	$Ën
(
tİic
.
·¹™iÚs
)))

528 
m‘ad©a
 
š
 
tİic
.
·¹™iÚs
:

529 
’coded
.
	`­³nd
(.
	`·ck
('>hiii', 
m‘ad©a
.
”rÜ
,

530 
m‘ad©a
.
·¹™iÚ
, m‘ad©a.
Ëad”
,

531 
	$Ën
(
m‘ad©a
.
»¶iÿs
)))

532 
	`Ën
(
m‘ad©a
.
»¶iÿs
) > 0:

533 
’coded
.
	`­³nd
(.
	`·ck
('>%di' % 
	`Ën
(
m‘ad©a
.
»¶iÿs
),

534 *
m‘ad©a
.
»¶iÿs
))

536 
’coded
.
	`­³nd
(.
	`·ck
('>i', 
	$Ën
(
m‘ad©a
.
i¤
)))

537 
	`Ën
(
m‘ad©a
.
i¤
) > 0:

538 
’coded
.
	`­³nd
(.
	`·ck
('>%di' % 
	`Ën
(
m‘ad©a
.
i¤
),

539 *
m‘ad©a
.
i¤
))

540  
b
''.
	$još
(
’coded
)

542 
def
 
	$‹¡_decode_m‘ad©a_»¥Ú£
(
£lf
):

543 
node_brok”s
 = [

544 
	`Brok”M‘ad©a
(0, 
b
"brokers1.kafka.rdio.com", 1000),

545 
	`Brok”M‘ad©a
(1, 
b
"brokers1.kafka.rdio.com", 1001),

546 
	`Brok”M‘ad©a
(3, 
b
"brokers2.kafka.rdio.com", 1000)

549 
tİic_·¹™iÚs
 = [

550 
	`TİicM‘ad©a
(
b
"topic1", 0, [

551 
	`P¬t™iÚM‘ad©a
(
b
"topic1", 0, 1, (0, 2), (2,), 0),

552 
	`P¬t™iÚM‘ad©a
(
b
"topic1", 1, 3, (0, 1), (0, 1), 1)

554 
	`TİicM‘ad©a
(
b
"topic2", 1, [

555 
	`P¬t™iÚM‘ad©a
(
b
"topic2", 0, 0, (), (), 0),

558 
’coded
 = 
£lf
.
	$_ü—‹_’coded_m‘ad©a_»¥Ú£
(
node_brok”s
,

559 
tİic_·¹™iÚs
)

560 
decoded
 = 
KafkaPrÙocŞ
.
	$decode_m‘ad©a_»¥Ú£
(
’coded
)

561 
£lf
.
	`as£¹Equ®
(
decoded
, (
node_brok”s
, 
tİic_·¹™iÚs
))

563 
def
 
	$‹¡_’code_off£t_»que¡
(
£lf
):

564 
ex³ùed
 = 
b
"".
	`još
([

565 .
	`·ck
(">i", 21), #TÙ® 
Ëngth
 
of
 
the
 
»que¡


566 .
	`·ck
('>h', 2), #Mes§g
ty³
 = 
off£t
 
ãtch


567 .
	`·ck
('>h', 0), #API 
v”siÚ


568 .
	`·ck
('>i', 4), #CÜ»ÏtiÚ 
ID


569 .
	`·ck
('>h3s', 3, 
b
"cid"), #Th
ş›Á
 
ID


570 .
	`·ck
('>i', -1), #R•liÿ 
Id


571 .
	`·ck
('>i', 0), #NØ
tİic
/
·¹™iÚs


574 
’coded
 = 
KafkaPrÙocŞ
.
	`’code_off£t_»que¡
(
b
"cid", 4)

576 
£lf
.
	$as£¹Equ®
(
’coded
, 
ex³ùed
)

578 
def
 
	$‹¡_’code_off£t_»que¡__no_·ylßd
(
£lf
):

579 
ex³ùed
 = 
b
"".
	`još
([

580 .
	`·ck
(">i", 65), #TÙ® 
Ëngth
 
of
 
the
 
»que¡


582 .
	`·ck
('>h', 2), #Mes§g
ty³
 = 
off£t
 
ãtch


583 .
	`·ck
('>h', 0), #API 
v”siÚ


584 .
	`·ck
('>i', 4), #CÜ»ÏtiÚ 
ID


585 .
	`·ck
('>h3s', 3, 
b
"cid"), #Th
ş›Á
 
ID


586 .
	`·ck
('>i', -1), #R•liÿ 
Id


587 .
	`·ck
('>i', 1), #Num 
tİics


588 .
	`·ck
(">h6s", 6, 
b
"tİic1"),#Tİiø
the
 
»que¡


589 .
	`·ck
(">i", 2), #TwØ
·¹™iÚs


591 .
	`·ck
(">i", 3), #Partition 3

592 .
	`·ck
(">q", -1), #NØ
time
 
off£t


593 .
	`·ck
(">i", 1), #OÃ 
off£t
 
»que¡ed


595 .
	`·ck
(">i", 4), #Partition 3

596 .
	`·ck
(">q", -1), #NØ
time
 
off£t


597 .
	`·ck
(">i", 1), #OÃ 
off£t
 
»que¡ed


600 
’coded
 = 
KafkaPrÙocŞ
.
	`’code_off£t_»que¡
(
b
"cid", 4, [

601 
	`Off£tReque¡
(
b
'topic1', 3, -1, 1),

602 
	`Off£tReque¡
(
b
'topic1', 4, -1, 1),

605 
£lf
.
	$as£¹Equ®
(
’coded
, 
ex³ùed
)

607 
def
 
	$‹¡_decode_off£t_»¥Ú£
(
£lf
):

608 
’coded
 = 
b
"".
	`još
([

609 .
	`·ck
(">i", 42), #CÜ»ÏtiÚ 
ID


610 .
	`·ck
(">i", 1), #OÃ 
tİics


611 .
	`·ck
(">h6s", 6, 
b
"tİic1"),#Fœ¡ 
tİic


612 .
	`·ck
(">i", 2), #TwØ
·¹™iÚs


614 .
	`·ck
(">i", 2), #Partition 2

615 .
	`·ck
(">h", 0), #NØ
”rÜ


616 .
	`·ck
(">i", 1), #OÃ 
off£t


617 .
	`·ck
(">q", 4), #Offset 4

619 .
	`·ck
(">i", 4), #Partition 4

620 .
	`·ck
(">h", 0), #NØ
”rÜ


621 .
	`·ck
(">i", 1), #OÃ 
off£t


622 .
	`·ck
(">q", 
job
), #Offset job

625 
»suÉs
 = 
KafkaPrÙocŞ
.
	$decode_off£t_»¥Ú£
(
’coded
)

626 
£lf
.
	`as£¹Equ®
(
	`£t
(
»suÉs
), set([

627 
	`Off£tRe¥Ú£
(
tİic
 = 
b
'tİic1', 
·¹™iÚ
 = 2, 
”rÜ
 = 0, 
off£ts
=(4,)),

628 
	`Off£tRe¥Ú£
(
tİic
 = 
b
'tİic1', 
·¹™iÚ
 = 4, 
”rÜ
 = 0, 
off£ts
=(
job
,)),

631 
def
 
	$‹¡_’code_off£t_comm™_»que¡
(
£lf
):

632 
h—d”
 = 
b
"".
	`još
([

633 .
	`·ck
('>i', 99), #TÙ® 
mes§ge
 
Ëngth


635 .
	`·ck
('>h', 
job
), #Mes§g
ty³
 = 
off£t
 
comm™


636 .
	`·ck
('>h', 0), #API 
v”siÚ


637 .
	`·ck
('>i', 42), #CÜ»ÏtiÚ 
ID


638 .
	`·ck
('>h9s', 9, 
b
"ş›Á_id"),#Th
ş›Á
 
ID


639 .
	`·ck
('>hjobs', 
job
, 
b
"group_id"), #Th
group
 
to
 
comm™
 

640 .
	`·ck
('>i', 2), #Num 
tİics


643 
tİic1
 = 
b
"".
	`još
([

644 .
	`·ck
(">h6s", 6, 
b
"tİic1"), #Tİiø
the
 
»que¡


645 .
	`·ck
(">i", 2), #TwØ
·¹™iÚs


646 .
	`·ck
(">i", 0), #Partition 0

647 .
	`·ck
(">q", 123), #Offset 123

648 .
	`·ck
(">h", -1), #NuÎ 
m‘ad©a


649 .
	`·ck
(">i", 1), #Partition 1

650 .
	`·ck
(">q", 234), #Offset 234

651 .
	`·ck
(">h", -1), #NuÎ 
m‘ad©a


654 
tİic2
 = 
b
"".
	`još
([

655 .
	`·ck
(">h6s", 6, 
b
"tİic2"), #Tİiø
the
 
»que¡


656 .
	`·ck
(">i", 1), #OÃ 
·¹™iÚ


657 .
	`·ck
(">i", 2), #Partition 2

658 .
	`·ck
(">q", 345), #Offset 345

659 .
	`·ck
(">h", -1), #NuÎ 
m‘ad©a


662 
ex³ùed1
 = 
b
"".
	$još
([ 
h—d”
, 
tİic1
, 
tİic2
 ])

663 
ex³ùed2
 = 
b
"".
	$još
([ 
h—d”
, 
tİic2
, 
tİic1
 ])

665 
’coded
 = 
KafkaPrÙocŞ
.
	`’code_off£t_comm™_»que¡
(
b
"client_id", 42, b"group_id", [

666 
	`Off£tComm™Reque¡
(
b
"tİic1", 0, 123, 
NÚe
),

667 
	`Off£tComm™Reque¡
(
b
"tİic1", 1, 234, 
NÚe
),

668 
	`Off£tComm™Reque¡
(
b
"tİic2", 2, 345, 
NÚe
),

671 
£lf
.
	$as£¹In
(
’coded
, [ 
ex³ùed1
, 
ex³ùed2
 ])

673 
def
 
	$‹¡_decode_off£t_comm™_»¥Ú£
(
£lf
):

674 
’coded
 = 
b
"".
	`još
([

675 .
	`·ck
(">i", 42), #CÜ»ÏtiÚ 
ID


676 .
	`·ck
(">i", 1), #OÃ 
tİic


677 .
	`·ck
(">h6s", 6, 
b
"tİic1"),#Fœ¡ 
tİic


678 .
	`·ck
(">i", 2), #TwØ
·¹™iÚs


680 .
	`·ck
(">i", 2), #Partition 2

681 .
	`·ck
(">h", 0), #NØ
”rÜ


683 .
	`·ck
(">i", 4), #Partition 4

684 .
	`·ck
(">h", 0), #NØ
”rÜ


687 
»suÉs
 = 
KafkaPrÙocŞ
.
	$decode_off£t_comm™_»¥Ú£
(
’coded
)

688 
£lf
.
	`as£¹Equ®
(
	`£t
(
»suÉs
), set([

689 
	`Off£tComm™Re¥Ú£
(
tİic
 = 
b
'tİic1', 
·¹™iÚ
 = 2, 
”rÜ
 = 0),

690 
	`Off£tComm™Re¥Ú£
(
tİic
 = 
b
'tİic1', 
·¹™iÚ
 = 4, 
”rÜ
 = 0),

693 
def
 
	$‹¡_’code_off£t_ãtch_»que¡
(
£lf
):

694 
h—d”
 = 
b
"".
	`još
([

695 .
	`·ck
('>i', 69), #TÙ® 
mes§ge
 
Ëngth


696 .
	`·ck
('>h', 9), #Mes§g
ty³
 = 
off£t
 
ãtch


697 .
	`·ck
('>h', 0), #API 
v”siÚ


698 .
	`·ck
('>i', 42), #CÜ»ÏtiÚ 
ID


699 .
	`·ck
('>h9s', 9, 
b
"ş›Á_id"),#Th
ş›Á
 
ID


700 .
	`·ck
('>hjobs', 
job
, 
b
"group_id"), #Th
group
 
to
 
comm™
 

701 .
	`·ck
('>i', 2), #Num 
tİics


704 
tİic1
 = 
b
"".
	`još
([

705 .
	`·ck
(">h6s", 6, 
b
"tİic1"), #Tİiø
the
 
»que¡


706 .
	`·ck
(">i", 2), #TwØ
·¹™iÚs


707 .
	`·ck
(">i", 0), #Partition 0

708 .
	`·ck
(">i", 1), #Partition 1

711 
tİic2
 = 
b
"".
	`još
([

712 .
	`·ck
(">h6s", 6, 
b
"tİic2"), #Tİiø
the
 
»que¡


713 .
	`·ck
(">i", 1), #OÃ 
·¹™iÚs


714 .
	`·ck
(">i", 2), #Partition 2

717 
ex³ùed1
 = 
b
"".
	$još
([ 
h—d”
, 
tİic1
, 
tİic2
 ])

718 
ex³ùed2
 = 
b
"".
	$još
([ 
h—d”
, 
tİic2
, 
tİic1
 ])

720 
’coded
 = 
KafkaPrÙocŞ
.
	`’code_off£t_ãtch_»que¡
(
b
"client_id", 42, b"group_id", [

721 
	`Off£tF‘chReque¡
(
b
"topic1", 0),

722 
	`Off£tF‘chReque¡
(
b
"topic1", 1),

723 
	`Off£tF‘chReque¡
(
b
"topic2", 2),

726 
£lf
.
	$as£¹In
(
’coded
, [ 
ex³ùed1
, 
ex³ùed2
 ])

728 
def
 
	$‹¡_decode_off£t_ãtch_»¥Ú£
(
£lf
):

729 
’coded
 = 
b
"".
	`još
([

730 .
	`·ck
(">i", 42), #CÜ»ÏtiÚ 
ID


731 .
	`·ck
(">i", 1), #OÃ 
tİics


732 .
	`·ck
(">h6s", 6, 
b
"tİic1"),#Fœ¡ 
tİic


733 .
	`·ck
(">i", 2), #TwØ
·¹™iÚs


735 .
	`·ck
(">i", 2), #Partition 2

736 .
	`·ck
(">q", 4), #Offset 4

737 .
	`·ck
(">h4s", 4, 
b
"meta"), #Metadata

738 .
	`·ck
(">h", 0), #NØ
”rÜ


740 .
	`·ck
(">i", 4), #Partition 4

741 .
	`·ck
(">q", 
job
), #Offset job

742 .
	`·ck
(">h4s", 4, 
b
"meta"), #Metadata

743 .
	`·ck
(">h", 0), #NØ
”rÜ


746 
»suÉs
 = 
KafkaPrÙocŞ
.
	$decode_off£t_ãtch_»¥Ú£
(
’coded
)

747 
£lf
.
	`as£¹Equ®
(
	`£t
(
»suÉs
), set([

748 
	`Off£tF‘chRe¥Ú£
(
tİic
 = 
b
'tİic1', 
·¹™iÚ
 = 2, 
off£t
 = 4, 
”rÜ
 = 0, 
m‘ad©a
 = b"meta"),

749 
	`Off£tF‘chRe¥Ú£
(
tİic
 = 
b
'tİic1', 
·¹™iÚ
 = 4, 
off£t
 = 
job
, 
”rÜ
 = 0, 
m‘ad©a
 = b"meta"),

752 @
cÚ‹xtmªag”


753 
def
 
	$mock_ü—‹_mes§ge_âs
(
£lf
):

754 
impÜt
 
kafka
.
´ÙocŞ


755 
w™h
 
·tch
.
	`objeù
(
kafka
.
´ÙocŞ
, "create_message",

756 
»tuº_v®ue
=
£Áš–
.
mes§ge
):

757 
w™h
 
·tch
.
	`objeù
(
kafka
.
´ÙocŞ
, "create_gzip_message",

758 
»tuº_v®ue
=
£Áš–
.
gz_mes§ge
):

759 
w™h
 
·tch
.
	`objeù
(
kafka
.
´ÙocŞ
, "create_snappy_message",

760 
»tuº_v®ue
=
£Áš–
.
¢­py_mes§ge
):

761 
y›ld


763 
def
 
	$‹¡_ü—‹_mes§ge_£t
(
£lf
):

764 
mes§ges
 = [(1, "k1"), (2, "k2"), (3, "k3")]

766 #DeçuÉ 
codec
 
is
 
CODEC_NONE
. 
Ex³ù
 
li¡
 
of
 
»guÏr
 
mes§ges
.

767 
ex³ù
 = [
£Áš–
.
mes§ge
] * 
	$Ën
(
mes§ges
)

768 
w™h
 
£lf
.
	$mock_ü—‹_mes§ge_âs
():

769 
mes§ge_£t
 = 
	$ü—‹_mes§ge_£t
(
mes§ges
)

770 
£lf
.
	$as£¹Equ®
(
mes§ge_£t
, 
ex³ù
)

772 #CODEC_NONE: 
Ex³ù
 
li¡
 
of
 
»guÏr
 
mes§ges
.

773 
ex³ù
 = [
£Áš–
.
mes§ge
] * 
	$Ën
(
mes§ges
)

774 
w™h
 
£lf
.
	$mock_ü—‹_mes§ge_âs
():

775 
mes§ge_£t
 = 
	$ü—‹_mes§ge_£t
(
mes§ges
, 
CODEC_NONE
)

776 
£lf
.
	$as£¹Equ®
(
mes§ge_£t
, 
ex³ù
)

778 #CODEC_GZIP: 
Ex³ù
 
li¡
 
of
 
Úe
 
gz
-
’coded
 
mes§ge
.

779 
ex³ù
 = [
£Áš–
.
gz_mes§ge
]

780 
w™h
 
£lf
.
	$mock_ü—‹_mes§ge_âs
():

781 
mes§ge_£t
 = 
	$ü—‹_mes§ge_£t
(
mes§ges
, 
CODEC_GZIP
)

782 
£lf
.
	$as£¹Equ®
(
mes§ge_£t
, 
ex³ù
)

784 #CODEC_SNAPPY: 
Ex³ù
 
li¡
 
of
 
Úe
 
¢­py
-
’coded
 
mes§ge
.

785 
ex³ù
 = [
£Áš–
.
¢­py_mes§ge
]

786 
w™h
 
£lf
.
	$mock_ü—‹_mes§ge_âs
():

787 
mes§ge_£t
 = 
	$ü—‹_mes§ge_£t
(
mes§ges
, 
CODEC_SNAPPY
)

788 
£lf
.
	$as£¹Equ®
(
mes§ge_£t
, 
ex³ù
)

790 #UnknowÀ
codec
 
should
 
¿i£
 
UnsuµÜ‹dCodecE¼Ü
.

791 
w™h
 
£lf
.
	$as£¹Rai£s
(
UnsuµÜ‹dCodecE¼Ü
):

792 
	`ü—‹_mes§ge_£t
(
mes§ges
, -1)

	@/root/grocery-shop/language/python/kafka/test/test_util.py

1 #-*- 
codšg
: 
utf
-
job
 -*-

2 
impÜt
 

4 
impÜt
 
six


5 
	gäom
 . 
impÜt
 
un™‹¡


7 
impÜt
 
	gkafka
.
commÚ


8 
impÜt
 
	gkafka
.
ut


11 
şass
 
	$UtTe¡
(
un™‹¡
.
Te¡Ca£
):

12 @
un™‹¡
.
	`sk
("Unwritten")

13 
def
 
	$‹¡_»Ïtive_uÅack
(
£lf
):

14 
·ss


16 
def
 
	$‹¡_wr™e_št_¡ršg
(
£lf
):

17 
£lf
.
	`as£¹Equ®
(

18 
kafka
.
ut
.
	`wr™e_št_¡ršg
(
b
'some string'),

19 
b
'\x00\x00\x00\x0bsome string'

22 
def
 
	$‹¡_wr™e_št_¡ršg__unicode
(
£lf
):

23 
w™h
 
£lf
.
	$as£¹Rai£s
(
Ty³E¼Ü
è
as
 
cm
:

24 
kafka
.
ut
.
	`wr™e_št_¡ršg
(
u
'unicode')

25 #: :
ty³
: 
Ty³E¼Ü


26 
‹
 = 
cm
.
exû±iÚ


27 
six
.
PY2
:

28 
£lf
.
	`as£¹In
('unicode', 
	$¡r
(
‹
))

30 
£lf
.
	`as£¹In
('¡r', 
	$¡r
(
‹
))

31 
£lf
.
	`as£¹In
('tØbby‹s', 
	$¡r
(
‹
))

33 
def
 
	$‹¡_wr™e_št_¡ršg__em±y
(
£lf
):

34 
£lf
.
	`as£¹Equ®
(

35 
kafka
.
ut
.
	`wr™e_št_¡ršg
(
b
''),

36 
b
'\x00\x00\x00\x00'

39 
def
 
	$‹¡_wr™e_št_¡ršg__nuÎ
(
£lf
):

40 
£lf
.
	`as£¹Equ®
(

41 
kafka
.
ut
.
	`wr™e_št_¡ršg
(
NÚe
),

42 
b
'\xff\xff\xff\xff'

45 
def
 
	$‹¡_»ad_št_¡ršg
(
£lf
):

46 
£lf
.
	`as£¹Equ®
(
kafka
.
ut
.
	`»ad_št_¡ršg
(
b
'\xff\xff\xff\xff', 0), (
NÚe
, 4))

47 
£lf
.
	`as£¹Equ®
(
kafka
.
ut
.
	`»ad_št_¡ršg
(
b
'\x00\x00\x00\x00', 0), (b'', 4))

48 
£lf
.
	`as£¹Equ®
(
kafka
.
ut
.
	`»ad_št_¡ršg
(
b
'\x00\x00\x00\x0bsome string', 0), (b'some string', 15))

50 
def
 
	$‹¡_»ad_št_¡ršg__šsuffic›Á_d©a
(
£lf
):

51 
w™h
 
£lf
.
	$as£¹Rai£s
(
kafka
.
commÚ
.
BufãrUnd”æowE¼Ü
):

52 
kafka
.
ut
.
	`»ad_št_¡ršg
(
b
'\x00\x00\x00\x021', 0)

54 
def
 
	$‹¡_wr™e_shÜt_¡ršg
(
£lf
):

55 
£lf
.
	`as£¹Equ®
(

56 
kafka
.
ut
.
	`wr™e_shÜt_¡ršg
(
b
'some string'),

57 
b
'\x00\x0bsome string'

60 
def
 
	$‹¡_wr™e_shÜt_¡ršg__unicode
(
£lf
):

61 
w™h
 
£lf
.
	$as£¹Rai£s
(
Ty³E¼Ü
è
as
 
cm
:

62 
kafka
.
ut
.
	`wr™e_shÜt_¡ršg
(
u
'hello')

63 #: :
ty³
: 
Ty³E¼Ü


64 
‹
 = 
cm
.
exû±iÚ


65 
six
.
PY2
:

66 
£lf
.
	`as£¹In
('unicode', 
	$¡r
(
‹
))

68 
£lf
.
	`as£¹In
('¡r', 
	$¡r
(
‹
))

69 
£lf
.
	`as£¹In
('tØbby‹s', 
	$¡r
(
‹
))

71 
def
 
	$‹¡_wr™e_shÜt_¡ršg__em±y
(
£lf
):

72 
£lf
.
	`as£¹Equ®
(

73 
kafka
.
ut
.
	`wr™e_shÜt_¡ršg
(
b
''),

74 
b
'\x00\x00'

77 
def
 
	$‹¡_wr™e_shÜt_¡ršg__nuÎ
(
£lf
):

78 
£lf
.
	`as£¹Equ®
(

79 
kafka
.
ut
.
	`wr™e_shÜt_¡ršg
(
NÚe
),

80 
b
'\xff\xff'

83 
def
 
	$‹¡_wr™e_shÜt_¡ršg__too_lÚg
(
£lf
):

84 
w™h
 
£lf
.
	$as£¹Rai£s
(.
”rÜ
):

85 
kafka
.
ut
.
	`wr™e_shÜt_¡ršg
(
b
' ' * 33000)

87 
def
 
	$‹¡_»ad_shÜt_¡ršg
(
£lf
):

88 
£lf
.
	`as£¹Equ®
(
kafka
.
ut
.
	`»ad_shÜt_¡ršg
(
b
'\xff\xff', 0), (
NÚe
, 2))

89 
£lf
.
	`as£¹Equ®
(
kafka
.
ut
.
	`»ad_shÜt_¡ršg
(
b
'\x00\x00', 0), (b'', 2))

90 
£lf
.
	`as£¹Equ®
(
kafka
.
ut
.
	`»ad_shÜt_¡ršg
(
b
'\x00\x0bsome string', 0), (b'some string', 13))

92 
def
 
	$‹¡_»ad_št_¡ršg__šsuffic›Á_d©a2
(
£lf
):

93 
w™h
 
£lf
.
	$as£¹Rai£s
(
kafka
.
commÚ
.
BufãrUnd”æowE¼Ü
):

94 
kafka
.
ut
.
	`»ad_št_¡ršg
('\x00\x021', 0)

96 
def
 
	$‹¡_»Ïtive_uÅack2
(
£lf
):

97 
£lf
.
	`as£¹Equ®
(

98 
kafka
.
ut
.
	`»Ïtive_uÅack
('>hh', 
b
'\x00\x01\x00\x00\x02', 0),

102 
def
 
	$‹¡_»Ïtive_uÅack3
(
£lf
):

103 
w™h
 
£lf
.
	$as£¹Rai£s
(
kafka
.
commÚ
.
BufãrUnd”æowE¼Ü
):

104 
kafka
.
ut
.
	`»Ïtive_uÅack
('>hh', '\x00', 0)

106 
def
 
	$‹¡_group_by_tİic_ªd_·¹™iÚ
(
£lf
):

107 
t
 = 
kafka
.
commÚ
.
TİicAndP¬t™iÚ


109 
l
 = [

110 
	`t
("a", 1),

111 
	`t
("a", 2),

112 
	`t
("a", 3),

113 
	`t
("b", 3),

116 
£lf
.
	`as£¹Equ®
(
kafka
.
ut
.
	`group_by_tİic_ªd_·¹™iÚ
(
l
), {

118 1: 
	`t
("a", 1),

119 2: 
	`t
("a", 2),

120 3: 
	`t
("a", 3),

123 3: 
	`t
("b", 3),

125 
	}
})

127 #should 
nÙ
 
be
 
abË
 
to
 
group
 
du¶iÿ‹
 
tİic
-
·¹™iÚs


128 
	gt1
 = 
t
("a", 1)

129 
w™h
 
	g£lf
.
	$as£¹Rai£s
(
As£¹iÚE¼Ü
):

130 
kafka
.
ut
.
	`group_by_tİic_ªd_·¹™iÚ
([
t1
,1])

	@/root/grocery-shop/language/python/kafka/test/testutil.py

1 #codšg:
utf
-
job


2 
impÜt
 
funùoŞs


3 
impÜt
 
loggšg


4 
impÜt
 
os


5 
impÜt
 
¿ndom


6 
impÜt
 
sock‘


7 
impÜt
 
¡ršg


8 
impÜt
 
time


9 
impÜt
 
uuid


11 
äom
 
	gsix
.
moves
 
impÜt
 
x¿nge


12 
	gäom
 . 
impÜt
 
un™‹¡


14 
äom
 
kafka
 
impÜt
 
KafkaCl›Á


15 
äom
 
	gkafka
.
commÚ
 
impÜt
 
Off£tReque¡


16 
äom
 
	gkafka
.
ut
 
impÜt
 
kafka_by‹¡ršg


18 
	g__®l__
 = [

26 
def
 
	$¿ndom_¡ršg
(
l
):

27  "".
	`još
(
¿ndom
.
	$choiû
(
¡ršg
.
ascii_Ë‰”s
è
i
 
š
 
	$x¿nge
(
l
))

29 
def
 
	$kafka_v”siÚs
(*
v”siÚs
):

30 
def
 
	$kafka_v”siÚs
(
func
):

31 @
funùoŞs
.
	$w¿ps
(
func
)

32 
def
 
	$w¿µ”
(
£lf
):

33 
kafka_v”siÚ
 = 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION')

35 
nÙ
 
kafka_v”siÚ
:

36 
£lf
.
	`skTe¡
("no kafka version specified")

37 
–if
 '®l' 
nÙ
 
š
 
v”siÚs
 
ªd
 
kafka_v”siÚ
‚ot in versions:

38 
£lf
.
	`skTe¡
("unsupported kafka version")

40  
	$func
(
£lf
)

41  
w¿µ”


42  
kafka_v”siÚs


44 
def
 
	$g‘_İ’_pÜt
():

45 
sock
 = 
sock‘
.
	$sock‘
()

46 
sock
.
	`bšd
(("", 0))

47 
pÜt
 = 
sock
.
	`g‘sockÇme
()[1]

48 
sock
.
	$şo£
()

49  
pÜt


51 
şass
 
	$KafkaIÁeg¿tiÚTe¡Ca£
(
un™‹¡
.
Te¡Ca£
):

52 
ü—‹_ş›Á
 = 
True


53 
tİic
 = 
NÚe


54 
by‹s_tİic
 = 
NÚe


55 
zk
 = 
NÚe


56 
£rv”
 = 
NÚe


58 
def
 
	$£tUp
(
£lf
):

59 
	`su³r
(
KafkaIÁeg¿tiÚTe¡Ca£
, 
£lf
).
	$£tUp
()

60 
nÙ
 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION'):

63 
nÙ
 
£lf
.
tİic
:

64 
tİic
 = "%s-%s" % (
£lf
.
	`id
()[£lf.id().
	`ršdex
("."è+ 1:], 
	$¿ndom_¡ršg
(10))

65 
£lf
.
tİic
 =opic

66 
£lf
.
by‹s_tİic
 = 
tİic
.
	`’code
('utf-job')

68 
£lf
.
ü—‹_ş›Á
:

69 
£lf
.
ş›Á
 = 
	`KafkaCl›Á
('%s:%d' % (£lf.
£rv”
.
ho¡
, s–f.£rv”.
pÜt
))

71 
£lf
.
ş›Á
.
	$’su»_tİic_exi¡s
(
£lf
.
tİic
)

73 
£lf
.
_mes§ges
 = {
	}
}

75 
def
 
	$‹¬Down
(
£lf
):

76 
	`su³r
(
KafkaIÁeg¿tiÚTe¡Ca£
, 
£lf
).
	$‹¬Down
()

77 
nÙ
 
os
.
’vœÚ
.
	`g‘
('KAFKA_VERSION'):

80 
£lf
.
ü—‹_ş›Á
:

81 
£lf
.
ş›Á
.
	$şo£
()

83 
def
 
	$cu¼’t_off£t
(
£lf
, 
tİic
, 
·¹™iÚ
):

84 
Œy
:

85 
off£ts
, = 
£lf
.
ş›Á
.
	`£nd_off£t_»que¡
([ 
	`Off£tReque¡
(
	`kafka_by‹¡ršg
(
tİic
), 
·¹™iÚ
, -1, 1) ])

86 
exû±
:

87 #XXX: 
We
've seen some UnknownErrors here‡nd cant debug w/o server†ogs

88 
£lf
.
zk
.
chd
.
	$dump_logs
()

89 
£lf
.
£rv”
.
chd
.
	$dump_logs
()

90 
¿i£


92  
off£ts
.offsets[0]

94 
def
 
	$msgs
(
£lf
, 
™”abË
):

95  [ 
£lf
.
	$msg
(
x
èx 
š
 
™”abË
 ]

97 
def
 
	$msg
(
£lf
, 
s
):

98 
s
 
nÙ
 
š
 
£lf
.
_mes§ges
:

99 
£lf
.
_mes§ges
[
s
] = '%s-%s-%s' % (s, s–f.
	`id
(), 
	`¡r
(
uuid
.
	$uuid4
()))

101  
£lf
.
_mes§ges
[
s
].
	`’code
('utf-job')

103 
def
 
	$key
(
£lf
, 
k
):

104  
k
.
	`’code
('utf-job')

107 
şass
 
	$Tim”
(
objeù
):

108 
def
 
	$__’‹r__
(
£lf
):

109 
£lf
.
¡¬t
 = 
time
.
	$time
()

110  
£lf


112 
def
 
	$__ex™__
(
£lf
, *
¬gs
):

113 
£lf
.
’d
 = 
time
.
	$time
()

114 
£lf
.
š‹rv®
 = s–f.
’d
 - s–f.
¡¬t


116 
loggšg
.
	$basicCÚfig
(
Ëv–
=
loggšg
.
DEBUG
)

117 
loggšg
.
	`g‘Logg”
('‹¡.fixtu»s').
	$£tLev–
(
loggšg
.
ERROR
)

118 
loggšg
.
	`g‘Logg”
('‹¡.£rviû').
	$£tLev–
(
loggšg
.
ERROR
)

120 #kafka.
cÚn
 
debug
 
loggšg
 
is
 
v”bo£
, 
di§bË
 
š
 
‹¡s
 
by
 

121 
loggšg
.
	`g‘Logg”
('kafka.cÚn').
	`£tLev–
Öoggšg.
INFO
)

	@/root/grocery-shop/language/python/leetCode/array/findString.py

1 #!/
u¤
/
bš
/
evn
 
pythÚ


3 
def
 
	$exi¡
(
bßrd
, 
wÜd
):

4 
X
 = 
	$Ën
(
bßrd
)

5 
Y
 = 
	$Ën
(
bßrd
[0])

6 
cÜ_add
 = 
Ïmbda
 
x
, 
y
: (x[0]+y[0], x[1]+y[1])

7 
ÃighbÜ
 = [(1,0), (-1,0), (0,1), (0,-1)]

8 
¡ack
 = []

9 
i
 
š
 
	$x¿nge
(
X
):

10 
j
 
š
 
	$x¿nge
(
Y
):

11 
bßrd
[
i
][
j
] =ğ
wÜd
[0]:

12 
¡ack
.
	`­³nd
(([(
i
, 
j
)], 
wÜd
[1:]))

13 
´št
 "¡ack(%s, %s):"%(
X
,
Y
), 
¡ack
, "| wÜd:", 
wÜd


14 
nÙ
 
¡ack
 == []:

15 
s
 = 
¡ack
.
	$pİ
()

16 
c
, 
w
 = 
s


17 
w
 == '':

18  
True


19 
l
 = 
c
[-1]

20 
Ê
 = [
	$cÜ_add
(
l
, 
n
èÀ
š
 
ÃighbÜ
]

21 
´št
 "Pİ:", 
c
, "l=", 
l
, "Ê=", 
Ê


22 
x
 
š
 
Ê
:

23 
	`nÙ
 (
x
[0]>=0 
ªd
 x[0]<
X
‡nd x[1]>=0‡nd x[1]<
Y
):

25 
	$nÙ
 (
bßrd
[
x
[0]][x[1]] =ğ
w
[0]):

27 
x
 
nÙ
 
š
 
c
:

28 
¡ack
.
	`­³nd
((
c
 + [
x
], 
w
[1:]))

29  
F®£


31 
__Çme__
 == "__main__":

33 
bßrd
 = [

38 
´št
 
	`exi¡
(
bßrd
, "ABCCED")

	@/root/grocery-shop/language/python/logging/multiprocessTest.py

1 
äom
 
	gloggšg
.
hªdËrs
 
impÜt
 
RÙ©šgFeHªdËr


2 
impÜt
 
	gmuÉroûssšg
, 
	gth»adšg
, 
	gloggšg
, 
	gsys
, 
Œaûback


4 
şass
 
	$MuÉiProûssšgLog
(
loggšg
.
HªdËr
):

5 
def
 
	$__š™__
(
£lf
, 
Çme
, 
mode
, 
maxsize
, 
rÙ©e
):

6 
loggšg
.
HªdËr
.
	$__š™__
(
£lf
)

8 
£lf
.
_hªdËr
 = 
	$RÙ©šgFeHªdËr
(
Çme
, 
mode
, 
maxsize
, 
rÙ©e
)

9 
£lf
.
queue
 = 
muÉroûssšg
.
	`Queue
(-1)

11 
t
 = 
th»adšg
.
	$Th»ad
(
rg‘
=
£lf
.
»ûive
)

12 
t
.
d«mÚ
 = 
True


13 
t
.
	$¡¬t
()

15 
def
 
	$£tFÜm©‹r
(
£lf
, 
fmt
):

16 
loggšg
.
HªdËr
.
	$£tFÜm©‹r
(
£lf
, 
fmt
)

17 
£lf
.
_hªdËr
.
	$£tFÜm©‹r
(
fmt
)

19 
def
 
	$»ûive
(
£lf
):

20 
True
:

21 
Œy
:

22 
»cÜd
 = 
£lf
.
queue
.
	$g‘
()

23 
£lf
.
_hªdËr
.
	$em™
(
»cÜd
)

24 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

25 
¿i£


26 
exû±
 
EOFE¼Ü
:

28 
exû±
:

29 
Œaûback
.
	$´št_exc
(
fe
=
sys
.
¡d”r
)

31 
def
 
	$£nd
(
£lf
, 
s
):

32 
£lf
.
queue
.
	$put_nowa™
(
s
)

34 
def
 
	$_fÜm©_»cÜd
(
£lf
, 
»cÜd
):

35 #’su» 
th©
 
exc_šfo
 
ªd
 
¬gs


36 #hav
b“n
 
¡ršgif›d
. 
Removes
 
ªy
 
chªû
 
of


37 #uÅickËabË 
thšgs
 
šside
 
ªd
 
psh™ibly
 
»duûs


38 #mes§g
size
 
£Á
 
ov”
 
the
 
pe


39 
»cÜd
.
¬gs
:

40 
»cÜd
.
msg
 =„ecÜd.msg %„ecÜd.
¬gs


41 
»cÜd
.
¬gs
 = 
NÚe


42 
»cÜd
.
exc_šfo
:

43 
dummy
 = 
£lf
.
	$fÜm©
(
»cÜd
)

44 
»cÜd
.
exc_šfo
 = 
NÚe


46  
»cÜd


48 
def
 
	$em™
(
£lf
, 
»cÜd
):

49 
Œy
:

50 
s
 = 
£lf
.
	$_fÜm©_»cÜd
(
»cÜd
)

51 
£lf
.
	$£nd
(
s
)

52 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

53 
¿i£


54 
exû±
:

55 
£lf
.
	$hªdËE¼Ü
(
»cÜd
)

57 
def
 
	$şo£
(
£lf
):

58 
£lf
.
_hªdËr
.
	$şo£
()

59 
loggšg
.
HªdËr
.
	`şo£
(
£lf
)

	@/root/grocery-shop/language/python/logging/simpleTest.py

1 #codšg:
utf
-
job


2 #!/
u¤
/
bš
/
pythÚ


3 
impÜt
 
loggšg


5 
def
 
	$cÚsŞe
():

7 
loggšg
.
	`debug
('This is‡est message of default…rint.')

8 
loggšg
.
	`šfo
('This is‡est message of default…rint.')

9 
loggšg
.
	`w¬nšg
('This is‡est message of default…rint.')

11 
def
 
	$fe
():

14 
loggšg
.
	`w¬nšg
('This is‡est message of default…rint.')

16 
loggšg
.
	`basicCÚfig
(
Ëv–
öoggšg.
DEBUG
, \

17 
fÜm©
=('%(asctime)s %(filename)s[line:%(lineno)d]'\

19 
f’ame
 = './test.log', \

20 
femode
 = 'w')

21 
loggšg
.
	`debug
('This is‡est message of filename…rint.')

22 
loggšg
.
	`”rÜ
('This is‡est message of filename…rint.')

24 
def
 
	$feHªdË
():

27 
	`Ën
(
roÙ
.
hªdËrs
) == 0:

30 
loggšg
.
	`w¬nšg
('This is‡est message of default…rint.')

32 
loggšg
.
	`basicCÚfig
(
Ëv–
öoggšg.
DEBUG
, \

33 
fÜm©
=('%(asctime)s %(filename)s[line:%(lineno)d]'\

35 
f’ame
 = './test.log', \

36 
femode
 = 'w')

37 
loggšg
.
	`debug
('This is‡est message of filename…rint.')

38 
loggšg
.
	`”rÜ
('This is‡est message of filename…rint.')

40 
def
 
	$¡»amHªdË
():

41 
cÚsŞe
 = 
loggšg
.
	$SŒ—mHªdËr
()

42 
cÚsŞe
.
	$£tLev–
(
loggšg
.
INFO
)

43 
fÜm©
 = 
loggšg
.
	`FÜm©‹r
('%(name)-12s: %(levelname)-jobs %(message)s')

44 
cÚsŞe
.
	$£tFÜm©‹r
(
fÜm©
)

45 
loggšg
.
	`g‘Logg”
('').
	$addHªdËr
(
cÚsŞe
)

47 
loggšg
.
	`”rÜ
('This ia‡est message for streamHandle.')

49 
__Çme__
 == '__main__':

53 
	`¡»amHªdË
()

	@/root/grocery-shop/language/python/logging/timeRotatFile.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
os


4 
impÜt
 
time


5 
impÜt
 
loggšg


6 
äom
 
	gloggšg
.
hªdËrs
 
impÜt
 
TimedRÙ©šgFeHªdËr


8 
def
 
	$‹¡RÙ©eSecÚd
():

10 
Im¶
:

11 1ï¼Œé¦–å…ˆåˆ›å»º
logfe
æ—¥å¿—æ–‡ä»¶

14 
logHªdËr
 = 
	`TimedRÙ©šgFeHªdËr
("logfe", 
wh’
="M")

15 
logHªdËr
.
suffix
 = "%Y-%m-%d.%M-%S.log"

17 
logFÜm©‹r
 = 
loggšg
.
	`FÜm©‹r
('%(asctime)s %(message)s')

18 
logHªdËr
.
	$£tFÜm©‹r
(
logFÜm©‹r
)

19 
logg”
 = 
loggšg
.
	`g‘Logg”
( 'MyLogger' )

20 
logg”
.
	$addHªdËr
Ğ
logHªdËr
 )

21 
logg”
.
	$£tLev–
Ğ
loggšg
.
INFO
 )

23 
k
 
š
 
	$¿nge
(5):

24 
logg”
.
	`šfo
("lš%d"%
k
)

25 
time
.
	$¦“p
(1)

27 
__Çme__
 == '__main__':

29 
	`‹¡RÙ©eSecÚd
()

	@/root/grocery-shop/language/python/magicOperator/newTest.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-8

5 ä½¿ç”¨å¯¹è±¡æ± æ¥è‡ªç”±çš„æ§åˆ¶å¯¹è±¡çš„é”€æ¯ï¼Œä½†æ˜¯å¯¹äº
	ggc
ç±»è¯­è¨€æ¥è¯´ï¼Œ

6 å°½å¯èƒ½å°‘çš„ä½¿ç”¨
	g__d–__
ï¼ˆä¸èƒ½å‡†ç¡®çš„é¢„çŸ¥å†…å­˜é‡Šæ”¾çš„æ—¶é—´ï¼‰

9 
impÜt
 
webdriv”


11 
şass
 
	$brow£r
(
objeù
):

12 
š¡ªûs
 = []

13 
def
 
	$__Ãw__
(
şs
):

14 
i
 
š
 
brow£r
.
š¡ªûs
:

15 
i
.
occup›d
==
F®£
:

16 
i
.
occup›d
=
True


17  
i


19 
x
 = 
	`su³r
(
brow£r
, 
şs
).
	$__Ãw__
(
şs
)

20 
brow£r
.
š¡ªûs
.
	$­³nd
(
x
)

21  
x


23 
def
 
	$__š™__
(
£lf
):

24 
£lf
.
occup›d
 = 
True


26 
nÙ
 
	`ha§‰r
(
£lf
, 'driver'):

27 
£lf
.
driv”
 = 
webdriv”
.
	$Fœefox
()

28 
£lf
.
driv”
.
	`g‘
('https://www.baidu.com/')

29 
£lf
.
driv”
.
	$d–‘e_®l_cook›s
()

30 
£lf
.
driv”
.
	$im¶ic™ly_wa™
(3)

32 
def
 
	$qu™
(
£lf
):

33 
£lf
.
occup›d
 = 
F®£


35 
def
 
	$__d–__
(
£lf
):

36 
£lf
.
driv”
.
	$qu™
()

39 
şass
 
	$A
(
objeù
):

41 
def
 
	$__š™__
(
£lf
):

42 
£lf
.
_brow£r
 = 
	$brow£r
()

43 
£lf
.
_driv”
 = s–f.
_brow£r
.
driv”


45 
def
 
	$__d–__
(
£lf
):

47 
£lf
.
_brow£r
.
	$qu™
()

50 
__Çme__
 == '__main__':

52 
a1
 = 
	$A
()

53 
a2
 = 
	`A
()

	@/root/grocery-shop/language/python/mock/simpleTest.py

1 #codšg:
utf
-
job


2 
impÜt
 
os


3 
impÜt
 
un™‹¡


4 
impÜt
 
	gos
.
·th


5 
impÜt
 
‹mpfe


7 
def
 
	$rmTe¡
(
f’ame
):

9 
os
.
	$»move
(
f’ame
)

11 
şass
 
	$RmTe¡Ca£
(
un™‹¡
.
Te¡Ca£
):

13 
tmpf•©h
 = 
os
.
·th
.
	`još
(
‹mpfe
.
	`g‘‹mpdœ
(), "tmp-testfile")

15 
def
 
	$£tUp
(
£lf
):

16 
w™h
 
	`İ’
(
£lf
.
tmpf•©h
, "wb"è
as
 
f
:

17 
f
.
	`wr™e
("Delete me!")

19 
def
 
	$‹¡_rm
(
£lf
):

20 #»mov
the
 
fe


21 
	$rmTe¡
(
£lf
.
tmpf•©h
)

22 #‹¡ 
th©
 
™
 
was
 
aùu®ly
 
»moved


23 
£lf
.
	`as£¹F®£
(
os
.
·th
.
	`isfe
(£lf.
tmpf•©h
),

26 
şass
 
	$RmTe¡Ca£Mock
(
un™‹¡
.
Te¡Ca£
):

28 @
mock
.
	`·tch
('mymo

30 
__Çme__
 == '__main__':

32 
un™Su™e
 = 
un™‹¡
.
	$Te¡Su™e
()

33 
un™Su™e
.
	`addTe¡
(
	`RmTe¡Ca£
('test_rm'))

34 
un™‹¡
.
	`maš
()

	@/root/grocery-shop/language/python/monitor/memory-monitor.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-
job


4 
impÜt
 
sys


5 
äom
 
guµy
 
impÜt
 
hpy


7 
	gli¡1
 = ['shite', 'gelgelgejge', 'xxxxx',

15 
def
 
	$šdex
():

16 
glob®
 
li¡1


17 
hp
 = 
	$hpy
()

18 
hp
.
	$£Œ–h—p
()

20 
i
 
š
 
li¡1
:

21 
i


23 
h
 = 
hp
.
	$h—p
()

24 
´št
 
h


25 
´št
 
h
.
mÜe


27 
def
 
	$™em
():

28 
glob®
 
li¡1


29 
hp
 = 
	$hpy
()

30 
hp
.
	$£Œ–h—p
()

32 
i
 
š
 
	`¿nge
(
	$Ën
(
li¡1
)):

33 
li¡1
[
i
]

35 
h
 = 
hp
.
	$h—p
()

36 
´št
 
h


37 
´št
 
h
.
mÜe


39 
__Çme__
 == '__main__':

41 
	`Ën
(
sys
.
¬gv
) <= 1:

42 
	`ex™
(-1)

43 
sys
.
¬gv
[1] == 'index':

44 
	$šdex
()

46 
	`™em
()

	@/root/grocery-shop/language/python/monitor/time-monitory.py

1 #codšg:
utf
-
job


2 #!/
u¤
/
bš
/
pythÚ


3 
impÜt
 
os


4 
impÜt
 
d©‘ime


5 
impÜt
 
time™


8 
def
 
	$w™h_šdexšg
(
t¡r
):

9  
d©‘ime
.
	`d©‘ime
(*
	$m­
(, [
t¡r
[:4],¡r[5:7],¡r[
job
:10],

10 
t¡r
[11:13],str[14:16],str[17:]]))

12 
def
 
	$w™h_šdex_»v”£
(
now
):

13  "%4s/%2s/%2s:%2s:%2s:%2s"%(
now
.
y—r
,‚ow.
mÚth
,‚ow.
day
, \

14 
now
.
hour
,‚ow.
mšu‹
,‚ow.
£cÚd
)

16 
now
 = 
d©‘ime
.d©‘ime.
	$now
()

17 
def
 
	$time™_‹¡
():

19 
time1
 = 
time™
.
	`time™
(

21 'äom d©‘imimpÜˆd©‘ime', 
numb”
=1000000)

22 
´št
 "SŒ±ime:", 
time1


24 
time2
 = 
time™
.
	`time™
(

26 'äom __maš__ impÜˆw™h_šdexšg', 
numb”
=1000000)

27 
´št
 'Sliû:', 
time2


29 
time3
 = 
time™
.
	`time™
(

31 'äom d©‘imimpÜˆd©‘ime;äom __maš__ impÜˆnow', 
numb”
=5000000)

32 
´št
 'SŒáime:', 
time3


34 
time4
 = 
time™
.
	`time™
(

36 'äom __maš__ impÜˆw™h_šdex_»v”£,‚ow', 
numb”
=5000000)

37 
´št
 'SŒšg:', 
time4


39 
	`time™_‹¡
()

	@/root/grocery-shop/language/python/multiprocess/multiProcsssingTest.py

1 #codšg:
utf
-
job


2 #/
u¤
/
bš
/
pythÚ


3 
impÜt
 
os


4 
impÜt
 
sys


5 
impÜt
 
time


6 
impÜt
 
muÉroûssšg


8 
	g£¬ch_·th
 = 
os
.
·th
.
dœÇme
(os.·th.dœÇme(os.·th.
	$»®·th
(
__fe__
)))

9 
sys
.
·th
.
	$š£¹
(0, 
£¬ch_·th
)

10 
äom
 
ba£·ckage
.
ba£·r£
 
impÜt
 
glob®CÚfigP¬£


11 
glob®CÚfigP¬£
.
	$£tPythÚ·th
()

13 
äom
 
ba£·ckage
.
ba£muÉog
 
impÜt
 
MuÉiProûssšgLog


15 
def
 
	$´oduûr1
(
squeue
, 
d1
):

17 
m¶
 = 
	$MuÉiProûssšgLog
(
squeue
)

18 
msgP»
 = 'Producer1:Msg'

19 
šdex
 = 1

21 
msg
 = ''.
	`još
([
msgP»
, 
	`¡r
(
šdex
)])

22 
m¶
.
	$£nd_debug
(
m¶
.
ERROR
, 
msg
)

23 
time
.
	$¦“p
(1)

24 
šdex
 += 1

25 
d1
[
šdex
] = 'xxxxx'+
	$¡r
(
šdex
)

27 
def
 
	$´oduûr2
(
squeue
):

29 
m¶
 = 
	$MuÉiProûssšgLog
(
squeue
)

30 
msgP»
 = '#1,Producer2:%d'

31 
šdex
 = 1

33 
šdex
 +=1

34 
m¶
.
	`£nd_”rÜ
(m¶.
ERROR
, 
msgP»
%(
šdex
))

35 
time
.
	$¦“p
(1)

37 
def
 
	$´oduûr3
():

38 
´št
 'xxxxxxxxxxxxx'

39 
·ss


41 
def
 
	$maš
():

43 
sh¬eQueue
 = 
muÉroûssšg
.
	`Queue
(-1)

44 
m¶
 = 
	`MuÉiProûssšgLog
(
sh¬eQueue
, "maš", 
moduË
='common')

45 
mgr
 = 
muÉroûssšg
.
	$Mªag”
()

46 
d1
 = 
mgr
.
	$diù
()

48 
p1
 = 
muÉroûssšg
.
	`Proûss
(
rg‘
=
´oduûr1
, 
¬gs
=(
sh¬eQueue
, 
d1
))

49 
p2
 = 
muÉroûssšg
.
	`Proûss
(
rg‘
=
´oduûr2
, 
¬gs
=(
sh¬eQueue
,))

50 
p3
 = 
muÉroûssšg
.
	`Proûss
(
rg‘
=
´oduûr3
, 
¬gs
=())

51 
´oûssDiù
 = {

52 '´oduûr1':
p1
,

53 '´oduûr2':
p2
,

54 
	}
}

56 #
#¡¬ˆ
´oûss


57 #
1.¡¬t()

58 
p2
.
	$¡¬t
()

59 
p3
.
	$¡¬t
()

61 
´št
 '----------------------1'

62 
´št
 
p1
.
	$još
()

63 
´št
 '----------------------2'

64 
´št
 
p2
.
	$još
()

65 
´št
 '----------------------3'

66 
´št
 
p3
.
	$još
()

69 #
 = 1

71 
šdex
 +=1

72 
šdex
 >20 
Ü
 
nÙ
 
m¶
.
	$»ûive
():

74 
´št
 'Index:', 
šdex


75 
´št
 'Diù:', 
d1


77 #
#¡İ 
®l
 
´oûss


78 #

	`Ën
(
´oûssDiù
):

79 
Çme
, 
´o
è
š
 
´oûssDiù
.
	$™ems
():

80 
´o
.
	$is_®ive
():

81 
´o
.
	$‹rmš©e
()

83 
d–
 
´oûssDiù
[
Çme
]

84 
time
.
	$¦“p
(1)

86 
__Çme__
 == '__main__':

87 
	`maš
()

	@/root/grocery-shop/language/python/multiprocess/simpleTest.py

1 #codšg:
utf
-
job


2 #/
u¤
/
bš
/
pythÚ


3 
impÜt
 
os


5 
äom
 
muÉroûssšg
 
impÜt
 
Proûss


7 
def
 
	$func1
(
¬g1
, 
¬g2
, 
¬g3
):

9 
´št
 '¬gs1:', 
¬g1


10 
´št
 '¬gs2:', 
¬g2


11 
´št
 '¬gs3:', 
¬g3


13 
şass
 
	$C®ÏbËFuú
(
objeù
):

15 
def
 
	$__š™__
(
£lf
, 
func
, 
¬gs
):

17 
£lf
.
_¬gsLi¡
 = 
¬gs


18 
£lf
.
_func
 = 
func


20 
def
 
	$__ÿÎ__
(
£lf
):

22 
	$­¶y
(
£lf
.
_func
, s–f.
_¬gsLi¡
)

24 
def
 
	$couÁ”
(
n
, 
b
):

25 
´št
 'CouÁ”…roûss:', 
n
*
b


27 
şass
 
	$MyMuÉroûss
(
Proûss
):

28 
def
 
	$__š™__
(
£lf
, 
a
, 
b
):

30 
	`su³r
(
MyMuÉroûss
, 
£lf
).
	$__š™__
()

31 
£lf
.
a
 =‡

32 
£lf
.
b
 = b

34 
def
 
	$run
(
£lf
):

35 
´št
 'a*b:', 
£lf
.
a
*£lf.
b


37 
__Çme__
 == '__main__':

39 
p1
 = 
	`Proûss
(
rg‘
=
	`C®ÏbËFuú
(
couÁ”
, 
¬gs
=(3, 4)))

40 
p1
.
	$¡¬t
()

41 
p1
.
	$još
()

42 
´št
 'p1 End'

44 
p2
 = 
	`Proûss
(
rg‘
=
func1
, 
¬gs
=(3, 4, 5))

45 
p2
.
	$¡¬t
()

46 
p2
.
	$još
()

47 
´št
 'p2,ƒnd'

49 
p3
 = 
	$MyMuÉroûss
(3, 4)

50 
p3
.
	$¡¬t
()

51 
p3
.
	$još
()

52 
´št
 'p3,ƒnd'

	@/root/grocery-shop/language/python/mysqldb/jobdb.py

1 #!/
u¤
/
bš
/
pythÚ


2 #-*- 
codšg
: 
utf
-
job
 -*-

3 
impÜt
 
sys


4 
impÜt
 
MySQLdb


6 
şass
 
	gOssDB
:

7 
def
 
	$__š™__
(
£lf
, 
logObj
, 
ho¡
, 
pÜt
, 
u£ºame
, 
·sswd
, 
dbÇme
):

10 :
logObj
: 
loggšg
 
objeù


12 
£lf
.
logObj
 =†ogObj

13 
£lf
.
ho¡Çme
 = 
ho¡


14 
£lf
.
pÜt
 =…ort

15 
£lf
.
u£ºame
 = username

16 
£lf
.
·sswÜd
 = 
·sswd


17 
£lf
.
d©aba£
 = 
dbÇme


18 
´št
 
£lf
.
ho¡Çme


19 
´št
 
£lf
.
pÜt


21 
def
 
	$cÚÃù
(
£lf
):

23 
Œy
:

24 
cÚn
 = 
MySQLdb
.
	`cÚÃù
(
ho¡
=
£lf
.
ho¡Çme
, \

25 
u£r
=
£lf
.
u£ºame
,
db
=£lf.
d©aba£
, \

26 
·sswd
=
£lf
.
·sswÜd
, 
ch¬£t
='utfjob')

27  
cÚn
, cÚn.
	$cursÜ
()

28 
exû±
 
Exû±iÚ
, 
msg
:

29 
exc_ty³
, 
_
, _ = 
sys
.
	$exc_šfo
()

30 
£lf
.
logObj
.
	`”rÜLog
(£lf.logObj.
ERROR
, \

32 
exc_ty³
 , 
msg
))

33  
NÚe
,None

35 
def
 
	$şo£
(
£lf
, 
cÚn
, 
cursÜ
):

37 
cursÜ
.
şo£
 cursÜ 
NÚe


38 
cÚn
.
şo£
 cÚÀ
NÚe


40 
def
 
	$execu‹
(
£lf
, 
cursÜ
, 
sql
):

43 :
cursÜ
: cursÜ 
objeù


44 :
sql
: sqÈ
commªd


46 
Œy
:

47 
cursÜ
.
	`execu‹
('Set AUTOCOMMIT = 1')

48 
r¡
 = 
cursÜ
.
	$execu‹
(
sql
)

49 #æˆ–è€…åœ¨æ¯æ¬¡
execu‹
æ—¶æ‰§è¡Œ
comm™
è¿›è¡Œæäº¤

50 #cÚÂeù.
	`cmm™e
()

51  
r¡


52 
exû±
 
Exû±iÚ
, 
msg
:

53 
£lf
.
logObj
.
	`”rÜLog
(£lf.logObj.
ERROR
, \

54 "Execu‹ SQL:% çed,, msg:%s."%(
sql
, 
msg
))

55  
NÚe


57 
__Çme__
=='__main__':

58 
·ss


	@/root/grocery-shop/language/python/mysqldb/simpleTest.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
os


4 
impÜt
 
sys


5 
impÜt
 
	gMySQLdb


7 #£ˆ
roÙ
 
dœeùÜy


8 
	g·ckage_·th
 = 
os
.
g‘cwd
() + '/../'

9 
sys
.
·th
.
	$­³nd
(
·ckage_·th
)

11 
äom
 
ba£·ckage
.
ba£log
 
impÜt
 
glob®Log


13 
şass
 
	$MysqldbHªdË
(
objeù
):

15 
def
 
	$__š™__
(
£lf
, 
add»ss
, 
u£r
, 
·sswd
, 
db
):

16 
£lf
.
_add»ss
 = 
add»ss


17 
£lf
.
_u£r
 = 
u£r


18 
£lf
.
_·sswd
 = 
·sswd


19 
£lf
.
_dbÇme
 = 
db


20 
£lf
.
_db
 = 
NÚe


21 
£lf
.
_cursÜ
 = 
NÚe


23 
def
 
	$cÚÃùDb
(
£lf
):

25 
Œy
:

26 
£lf
.
_db
 = 
MySQLdb
.
	$cÚÃù
(
£lf
.
_add»ss
, s–f.
_u£r
, s–f.
_·sswd
, s–f.
_db
)

27 
£lf
.
_cursÜ
 = s–f.
_db
.
	$cursÜ
()

28 
exû±
 
Exû±iÚ
,
msg
:

29 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, \

30 'CÚÃù SqlDB faed, msg:%s'%(
msg
))

33 
def
 
	$execu‹Sql
(
£lf
, 
sql
, 
isR‘uº
=
F®£
):

35 
Œy
:

36 
£lf
.
	$execu‹
(
sql
)

37 
£lf
.
_db
.
	$comm™
()

38 
nÙ
 
isR‘uº
:

40 
»suÉs
 = 
£lf
.
_cursÜ
.
	$ãtch®l
()

41 
row
 
š
 
»suÉs
:

42 
glob®Log
.
g‘E¼Ü
.
	`log
(glob®Log.
ERROR
, \

43 'row0=%s'%(
row
[0]))

44 
exû±
 
Exû±iÚ
,
msg
:

45 
£lf
.
_db
.
	$rŞlbak
()

46 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, \

47 'Execu‹ sqÈçed, sql=%s, msg:%s'%(
sql
, 
msg
))

49 
__Çme__
 == '__main__':

51 
·ss


	@/root/grocery-shop/language/python/pickle/mycPickle.py

1 #!/
u¤
/
bš
/
evn
 
pythÚ


2 #-*- 
codšg
: 
utf
-
job
 -*-

4 
impÜt
 
d©‘ime


5 
impÜt
 
	gcPickË


7 #impÜˆ
cPickË
 
as
 cPickle

9 
	gobj
 = {"a": 1, "b": 2, "c": 3}

10 
obj
 = {'min5': [('2015111205%02d', 45, 49), '201511120550', 5], 'hour': [], 'day': []}

12 #å°† 
obj
 æŒä¹…åŒ–ä¿å­˜åˆ°æ–‡ä»¶ 
tmp
.
txt
 ä¸­

13 
å
 = 
İ’
("tmp.txt", "wb")

14 
	gcPickË
.
	$dump
(
obj
, 
å
)

15 
cPickË
.
	$dump
(
NÚe
, 
å
)

16 
cPickË
.
	`dump
(
d©‘ime
.d©‘ime.
	`now
(), 
å
)

17 
å
.
	$şo£
()

19 #dØ
som‘hšg
 ...

21 #ä» 
tmp
.
txt
 ä¸­è¯»å–å¹¶æ¢å¤ 
obj
 å¯¹è±¡

22 
w™h
 
	`İ’
("tmp.txt", "rb"è
as
 
å
:

23 
obj2
 = 
cPickË
.
	$lßd
(
å
)

24 
obj2
:

25 
´št
 
obj2
, 
	`ty³
(obj2)

	@/root/grocery-shop/language/python/pickle/mypickle.py

1 #!/
u¤
/
bš
/
evn
 
pythÚ


2 #-*- 
codšg
: 
utf
-
job
 -*-

4 
impÜt
 
	gpickË


6 #impÜˆ
cPickË
 
as
 
pickË


9 
	gobj
 = {"a": 1, "b": 2, "c": 3}

11 #å°† 
obj
 æŒä¹…åŒ–ä¿å­˜åˆ°æ–‡ä»¶ 
tmp
.
txt
 ä¸­

12 
pickË
.
dump
(
obj
, 
İ’
("tmp.txt", "w"))

14 #dØ
som‘hšg
 ...

18 #ä» 
tmp
.
txt
 ä¸­è¯»å–å¹¶æ¢å¤ 
obj
 å¯¹è±¡

19 
	gobj2
 = 
pickË
.
lßd
(
İ’
("tmp.txt", "r"))

21 
´št
 
	gobj2


	@/root/grocery-shop/language/python/queue/dequeTest.py

1 #codšg:
utf
-
job


3 
	gdeque
:å›ºå®šå¤§å°çš„é˜Ÿåˆ—å¯¹è±¡ï¼Œç±»æ­¤æ•°æ®ç»“æ„ä¸­çš„å¾ªç¯é˜Ÿåˆ—ï¼Œ

6 
äom
 
cŞËùiÚs
 
impÜt
 
deque


8 
def
 
	$sim¶eTe¡
():

10 
dequeObjeù
 = 
	$deque
(
maxËn
=5)

11 
i
 
š
 
	$x¿nge
(100):

12 
dequeObjeù
.
	$­³nd
(
i
)

14 
i
 
š
 
dequeObjeù
:

15 
´št
 
i


18 
__Çme__
 == '__main__':

20 
	`sim¶eTe¡
()

	@/root/grocery-shop/language/python/queue/priorityQueueTest.py

1 #codšg:
utf
-
job


5 
impÜt
 
h—pq


7 
şass
 
	gPriÜ™yQueue
:

8 
def
 
	$__š™__
(
£lf
):

9 
£lf
.
_queue
 = []

10 
£lf
.
_šdex
 = 0

12 
def
 
	$push
(
£lf
, 
™em
, 
´iÜ™y
):

16 
h—pq
.
	`h—µush
(
£lf
.
_queue
, (-
´iÜ™y
, s–f.
_šdex
, 
™em
))

17 
£lf
.
_šdex
 += 1

19 
def
 
	$pİ
(
£lf
):

21  
h—pq
.
	$h—µİ
(
£lf
.
_queue
)

23 
şass
 
	$I‹m
(
objeù
):

24 
def
 
	$__š™__
(
£lf
, 
Çme
):

26 
£lf
.
Çme
 =‚ame

28 
def
 
	$__»´__
(
£lf
):

32 #»tuº 'I‹m({!r})'.
	`fÜm©
(
£lf
.
Çme
)

33  'I‹m({0!r})'.
	$fÜm©
(
£lf
.
Çme
)

35 
def
 
	$__¡r__
(
£lf
):

39  'Thi i ¨¡r(è‹¡ fÜ I‹m, it\' Çm:{0!s}'.
	$fÜm©
(
£lf
.
Çme
)

41 
def
 
	$‹¡R•rA‰r
():

43 
™em
 = 
	`I‹m
('zheng')

44 
™emR•rSŒ
 = 
	$»´
(
™em
)

45 
™emSŒ
 = 
	$¡r
(
™em
)

46 
™em2
 = 
	$ev®
(
™emR•rSŒ
)

47 
´št
 
™emR•rSŒ


48 
´št
 
™emSŒ


50 
def
 
	$‹¡PriÜ™yQueue
():

51 
qobj
 = 
	$PriÜ™yQueue
()

52 
qobj
.
	`push
(
	`I‹m
('foo'), 1)

53 
qobj
.
	`push
(
	`I‹m
('bar'), 5)

54 
qobj
.
	`push
(
	`I‹m
('kuag'), 4)

55 
´št
 
qobj
.
	$pİ
()

57 
__Çme__
 == '__main__':

59 
	`‹¡PriÜ™yQueue
()

	@/root/grocery-shop/language/python/redis/agentDaemon.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
os


4 
impÜt
 
sys


5 
impÜt
 
©ex™


6 
impÜt
 
time


7 
äom
 
sigÇl
 
impÜt
 
	gSIGTERM


9 #£ˆ
roÙ
 
dœeùÜy


10 
	g·ckage_·th
 = 
os
.
g‘cwd
() + '/../'

11 
sys
.
·th
.
	$­³nd
(
·ckage_·th
)

13 
äom
 
ba£·ckage
.
ba£log
 
impÜt
 
glob®Log


15 
şass
 
	$D«mÚ
(
objeù
):

17 
A
 
g’”ic
 
d«mÚ
 
şass
.

19 
U§ge
: 
subşass
 
the
 
D«mÚ
 
şass
 
ªd
 
ov”ride
h
	$run
(è
m‘hod


21 
def
 
	`__š™__
(
£lf
, 
pidfe
, 
¡dš
='/dev/nuÎ', 
¡dout
='/dev/nuÎ', 
¡d”r
='/dev/null'):

22 
£lf
.
¡dš
 = stdin

23 
£lf
.
¡dout
 = stdout

24 
£lf
.
¡d”r
 = stderr

25 
£lf
.
pidfe
 =…idfile

27 
def
 
	$d«mÚize
(
£lf
):

29 dØ
the
 
UNIX
 -
fÜk
 
magic
, 
£e
 
S‹v’s
' "Advanced

30 
Prog¿mmšg
 
š
 
the
 
UNIX
 
EnvœÚm’t
" for details (ISBN 0201563177)

32 #dØ
fœ¡
 
fÜk


33 
Œy
:

34 
pid
 = 
os
.
	$fÜk
()

35 
pid
 > 0:

36 
sys
.
	$ex™
(0)

37 
exû±
 
OSE¼Ü
, 
e
:

38 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
,

39 "fÜk #1 faed: %d (%s)\n" % (
e
.
”ºo
,ƒ.
¡»¼Ü
))

40 
sys
.
	$ex™
(1)

42 #decou¶
äom
 
·»Á
 
’vœÚm’t


43 
os
.
	`chdœ
("/")

44 
os
.
	$£tsid
()

45 
os
.
	$umask
(0)

47 #dØ
£cÚd
 
fÜk


48 
Œy
:

49 
pid
 = 
os
.
	$fÜk
()

50 
pid
 > 0:

51 
sys
.
	$ex™
(0)

52 
exû±
 
OSE¼Ü
, 
e
:

53 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
,

54 "fÜk #2 faed: %d (%s)\n" % (
e
.
”ºo
,ƒ.
¡»¼Ü
))

55 
sys
.
	$ex™
(1)

57 #»dœeù 
¡ªd¬d
 
fe
 
desütÜs


58 
sys
.
¡dout
.
	$æush
()

59 
sys
.
¡d”r
.
	$æush
()

60 
si
 = 
	`fe
(
£lf
.
¡dš
, 'r')

61 
so
 = 
	`fe
(
£lf
.
¡dout
, 'a+')

62 
£
 = 
	`fe
(
£lf
.
¡d”r
, 'a+', 0)

63 
os
.
	`dup2
(
si
.
	`f’o
(), 
sys
.
¡dš
.
	$f’o
())

64 
os
.
	`dup2
(
so
.
	`f’o
(), 
sys
.
¡dout
.
	$f’o
())

65 
os
.
	`dup2
(
£
.
	`f’o
(), 
sys
.
¡d”r
.
	$f’o
())

67 #»gi¡»m 
de¡ruùÜ
 
funùiÚ


68 
©ex™
.(
£lf
.
d–pid
)

69 #wr™
pidfe


70 
Œy
:

71 
fd
 = 
	`İ’
(
£lf
.
pidfe
, 'w+')

72 
fd
.
	`wr™e
('%s\n'%(
	`¡r
(
os
.
	$g‘pid
())))

73 
fd
.
	$şo£
()

74 
exû±
 
IOE¼Ü
,
msg
:

75 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, "%s:İ’…idfçed."%
msg
)

76 
sys
.
	$ex™
(1)

78 
def
 
	$d–pid
(
£lf
):

80 
os
.
	$»move
(
£lf
.
pidfe
)

82 
def
 
	$¡¬t
(
£lf
):

84 
S¹
 
the
 
d«mÚ


86 #Check 
a
 
pidfe
 
to
 
£e
 
the
 
d«mÚ
 
®»ady
 
runs


87 
Œy
:

88 
pf
 = 
	`fe
(
£lf
.
pidfe
,'r')

89 
pid
 = (
pf
.
	`»ad
().
	$¡r
())

90 
pf
.
	$şo£
()

91 
exû±
 
IOE¼Ü
:

92 
pid
 = 
NÚe


94 #exi¡ed 
d«mÚ
 
´oûss
, 
qu™


95 
pid
:

96 
mes§ge
 = "pidfile %s‡lreadyƒxist. Daemon‡lready„unning?\n"

97 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, 
mes§ge
 % 
£lf
.
pidfe
)

98 
sys
.
	$ex™
(1)

100 #S¹ 
the
 
d«mÚ


101 
£lf
.
	$d«mÚize
()

103 
£lf
.
	$run
()

105 
def
 
	$¡İ
(
£lf
):

107 
Stİ
 
the
 
d«mÚ


109 #G‘ 
the
 
pid
 
äom
h
pidfe


110 
Œy
:

111 
pf
 = 
	`fe
(
£lf
.
pidfe
,'r')

112 
pid
 = (
pf
.
	`»ad
().
	$¡r
())

113 
pf
.
	$şo£
()

114 
exû±
 
IOE¼Ü
:

115 
pid
 = 
NÚe


117 
nÙ
 
pid
:

118 
mes§ge
 = "pidfile %s does‚otƒxist. Daemon‚ot„unning?\n"

119 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, 
mes§ge
 % 
£lf
.
pidfe
)

120  #nÙ 
ª
 
”rÜ
 
š
 
a
 
»¡¬t


122 #Try 
klšg
 
the
 
d«mÚ
 
´oûss


123 
Œy
:

125 
os
.
	$kl
(
pid
, 
SIGTERM
)

126 
time
.
	$¦“p
(0.1)

127 
exû±
 
OSE¼Ü
, 
”r
:

128 
”r
 = 
	$¡r
(
”r
)

129 
”r
.
	`fšd
("No such…rocess") > 0:

130 
os
.
·th
.
	$exi¡s
(
£lf
.
pidfe
):

131 
os
.
	$»move
(
£lf
.
pidfe
)

133 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, 'D«mÚ stİ:%s'%
”r
)

134 
sys
.
	$ex™
(1)

136 
def
 
	$»¡¬t
(
£lf
):

138 
Re¡¬t
 
the
 
d«mÚ


140 
£lf
.
	$¡İ
()

141 
£lf
.
	$¡¬t
()

143 
def
 
	$run
(
£lf
):

145 
You
 
should
 
ov”ride
 
this
 
m‘hod
 
wh’
 
you
 
subşass
 
D«mÚ
.

146 
It
 
wl
 
be
 
ÿÎed
 
aá”
 
the
 
´oûss
 
has
 
b“n


147 
d«mÚized
 
by
 
	$¡¬t
(è
Ü
 
	`»¡¬t
().

149 
·ss


	@/root/grocery-shop/language/python/redis/agentTcpServer.py

1 #/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
os


4 
impÜt
 
sys


5 
impÜt
 
»dis


6 
impÜt
 
sock‘


7 
impÜt
 
£Ëù


8 
impÜt
 

9 
impÜt
 
©ex™


10 
impÜt
 
	gsigÇl


12 #£ˆ
roÙ
 
dœeùÜy


13 
	g·ckage_·th
 = 
os
.
g‘cwd
() + '/../'

14 
sys
.
·th
.
	$­³nd
(
·ckage_·th
)

16 
äom
 
ba£·ckage
.
ba£CÚfig
 
impÜt
 
BLACK_FILE
,
BLACK_PIPE


17 
äom
 
ba£·ckage
.
ba£log
 
impÜt
 
glob®Log


18 
äom
 
ag’tD«mÚ
 
impÜt
 
D«mÚ


20 
şass
 
	$RedisCommniÿ‹
():

22 
def
 
	`__š™__
(
£lf
, 
ho¡
='127.0.0.1', 
pÜt
=6379, 
maxnum
 = 2000000):

24 
Œy
:

25 
£lf
.
_ş›Á
 = 
»dis
.
	$Redis
(
ho¡
, 
pÜt
, 
db
=0)

26 
£lf
.
_p–še
 = s–f.
_ş›Á
.
	$p–še
() #transation

27 
exû±
 
Exû±iÚ
:

28 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, 'connect„edis server failed!')

29 
sys
.
	`ex™
(-1)

30 
£lf
.
_maxnum
 = 
maxnum


31 #»di 
key
 
which
 
¡Üe
 
bÏck
 
li¡


32 
£lf
.
_©ckKey
 = 'nginx.blacklist'

34 
def
 
	$_addRecÜd
(
£lf
, 
£¬chkey
):

36 #add 
commªd
 
to
 
pe


37 
nÙ
 
£lf
.
_ş›Á
.
	$g‘
(
£¬chkey
):

38 
£lf
.
_p–še
.
	$£‹x
(
£¬chkey
, 0, 60)

40 
£lf
.
_p–še
.
	$šü
(
£¬chkey
)

41 
£lf
.
_p–še
.
	$g‘
(
£¬chkey
)

42 #execu‹ 
commªd


43 
Œy
:

44  (
£lf
.
_p–še
.
	`execu‹
()[-1])

45 
exû±
 
Exû±iÚ
:

46 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, \

48  
£lf
.
_maxnum


50 
def
 
	$_wr™eBÏckLi¡
(
£lf
, 
©ck
):

52 
£lf
.
_ş›Á
.
	$§dd
(
£lf
.
_©ckKey
, 
©ck
)

54 
def
 
	$addRecÜd
(
£lf
, 

):

56 #£ˆ
£¬chkey


57 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
DEBUG
, \

58 "£¬chkey:%s"%(

))

59 #g‘ 
šfo
 
äom
 
»dis
 
ªd
 
¡Üe
 infØ
što
„edis

60  
True
 
£lf
.
	`_addRecÜd
(

è>ğ£lf.
_maxnum
 
F®£


62 
şass
 
	$Ag’tS”v”
(
D«mÚ
):

64 
def
 
	`__š™__
(
£lf
, 
»disS”v”
, 
»disPÜt
, 
add»ss
='127.0.0.1', 
pÜt
=
job00job
, \

65 
pid
='/data/agentServer/agent.pid'):

67 
	`su³r
(
Ag’tS”v”
, 
£lf
).
	$__š™__
(
pidfe
=
pid
)

68 
£lf
.
_sock
 = 
NÚe


69 
£lf
.
_·ckageLi¡
 = [

70 '_hªdËModuËRedis', #m­ 
REDIS_PACKAGE
 
maüo
 
š
 
C


72 
£lf
.
_»disCÚn
 = 
	$RedisCommniÿ‹
(
»disS”v”
, 
»disPÜt
)

73 
£lf
.
_add»ss
 = 
add»ss


74 
£lf
.
_pÜt
 = 
pÜt


75 
£lf
.
pŞËr
 = 
NÚe


76 
£lf
.
fdToSock‘
 = 
NÚe


77 
£lf
.
_©ckP
 = 
NÚe


79 
def
 
	$_ü—‹Pe
(
£lf
, 
f’ame
):

81 
Œy
:

82 
os
.
·th
.
	$exi¡s
(
f’ame
è
is
 
F®£
:

83 
os
.
	$mkfifo
(
f’ame
)

84 
£lf
.
_©ckP
 = 
	`İ’
(
f’ame
, 'w')

85 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
DEBUG
, \

87 
	`exû±
 (
OSE¼Ü
, 
Exû±iÚ
), 
msg
:

88 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, \

89 'C»©ªd O³ÀFIFO faed, %s'%
msg
)

90 
sys
.
	`ex™
(-1)

92 
def
 
	$_bšdSock‘
(
£lf
, 

, 
pÜt
):

94 
add»ss
 = (

, 
pÜt
)

95 
Œy
:

96 
£lf
.
_sock
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
)

97 
£lf
.
_sock
.
	$£tsockİt
(
sock‘
.
SOL_SOCKET
, sock‘.
SO_REUSEADDR
, 1)

98 
£lf
.
_sock
.
	$bšd
(
add»ss
)

99 
£lf
.
_sock
.
	$£tblockšg
(0)

100 
£lf
.
_sock
.
	$li¡’
(10)

101 
exû±
 
Exû±iÚ
, 
msg
:

102 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, \

103 'Ag’tS”v”:bšd sock‘ % çed, %s'%(

,
msg
))

104 
sys
.
	`ex™
(-1)

105 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
DEBUG
, 'Bšd % sucûssful.'%

)

107 
def
 
	$_wr™eRejeù
(
£lf
, 
d©a
):

109 #ü—‹ 
©ckfe


110 
Œy
:

111 
os
.
·th
.
	$exi¡s
(
BLACK_FILE
è
is
 
F®£
:

112 
	`İ’
(
BLACK_FILE
, 'w').
	$şo£
()

113 
os
.
·th
.
	$exi¡s
(
BLACK_PIPE
è
is
 
F®£
:

114 
os
.
	$mkfifo
(
BLACK_PIPE
)

115 
exû±
 
Exû±iÚ
,
msg
:

116 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
WARNING
, \

117 '%s:HªdË‡‰ack f%s.'%(
msg
, 
BLACK_FILE
))

120 #wr™
šfo
 
što
 
©ck
 
	`fe
(
pe
 
ªd
 
nÜm®
 
fe
)

121 
Œy
:

122 #Wh‘h” 
exi¡ed
 
bÏckli¡
 



123 
w™h
 
	`İ’
(
BLACK_FILE
, 'r'è
as
 
»Fd
:

124 
¡rbuf
 = 
»Fd
.
	$»ad
()

125 
d©a
 
š
 
¡rbuf
:

127 #wr™
bÏck
 
što
 
fe


128 
w™h
 
	`İ’
(
BLACK_FILE
, 'a'è
as
 
šFd
:

129 
šFd
.
	`wr™e
(
d©a
+'\n')

130 #wr™
što
 
pe


131 
£lf
.
_©ckP
.
	$wr™e
(
d©a
)

132 
£lf
.
_©ckP
.
	$æush
()

133 
exû±
 
Exû±iÚ
, 
msg
:

134 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
WARNING
, \

135 'W¬nšg:»¶aû fçed(%s)'%(
msg
))

137 
def
 
	$_hªdËModuËRedis
(
£lf
, 
Ën
, 
d©a
):

139 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
DEBUG
, \

140 "HªdËRedis:bÏck:%s"%
d©a
)

141 #£lf.
_»disCÚn
.
	`addRecÜd
(
šfo
[0], info[1])

142 
£lf
.
_»disCÚn
.
	$addRecÜd
(
d©a
):

143 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
INFO
, \

144 "Wr™bÏckli¡:%s"%
d©a
)

145 
£lf
.
	$_wr™eRejeù
(
d©a
)

147 
def
 
	$_hªdËModuË
(
£lf
, 
ty³
, 
Ën
, 
d©a
):

149 
·ckage
 
fÜm©
:

151 
·ckage
-
Ty³
 00

152 
·ckage
-
Ëngth
 001
job


153 
	`d©a
(

/
tok’
è
basic
 
·ckage
-
Ëngth
's value

154 
	}
}

156 #ÿÎ 
funùiÚ
 
u£
 
©Œibu‹


157 
	$g‘©Œ
(
£lf
, s–f.
_·ckageLi¡
[
ty³
])(
Ën
, 
d©a
)

159 
def
 
	$_»cvPackageFromCl›Á
(
£lf
, 
cÚn
):

161 
´eL’gth
 = 
job
#Ën(
ty³
 + 
d©a_Ën
)ï¼Œç»“æ„ä½“æœ¬èº«çš„é•¿åº¦

162 #impÜˆ
pdb


163 #pdb.
	`£t_Œaû
()

164 #»ûiv
	`·ckage
 (
hexadecim®
 
numb”
)

165 
d©a
 = 
cÚn
.
	$»cv
(
´eL’gth
)

166 
nÙ
 
d©a
:

167 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
DEBUG
, \

169  
F®£


170 
–if
 
	`Ën
(
d©a
è!ğ
´eL’gth
:

171 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
DEBUG
, \

173  
True


174 (
ty³
, 
tÙ®L’
èğ.
	`uÅack
('<ii', 
d©a
)

175 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
DEBUG
, \

176 "PackagTy³:%d, PackageL’g=%d"%(
ty³
, 
tÙ®L’
))

177 #»ûiv
	`·ckage
(
cÚ‹Á
)

178 
d©a
 = 
cÚn
.
	$»cv
(
tÙ®L’
)

179 
nÙ
 
d©a
:

180 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, \

182  
F®£


183 
–if
 
	`Ën
(
d©a
è!ğ
tÙ®L’
:

184 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
DEBUG
, \

186  
True


188 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
DEBUG
, "PaÿkgCÚ‹Á=%s"%
d©a
)

189 
£lf
.
	$_hªdËModuË
(
ty³
, 
tÙ®L’
, 
d©a
)

190  
True


192 
def
 
	$_»ûivePackage
(
£lf
, 
pŞËr
, 
cÚn
, 
fdToSock‘
, 
»adOÆy
):

194 
Œy
:

195 
cÚn
 
is
 
£lf
.
_sock
:

196 #add 
şifd
 
to
 
ev’ts


197 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
DEBUG
, 'A‚ew connection come on.')

198 
cÚn
, 
şiAddr
 = cÚn.
	$acû±
()

199 
cÚn
.
	$£tblockšg
(0)

200 
fdToSock‘
[
cÚn
.
	`f’o
()] = conn

201 
pŞËr
.(
cÚn
, 
»adOÆy
)

202  
True


204 #»ûiv
d©a


205  
F®£
 
nÙ
 
£lf
.
	$_»cvPackageFromCl›Á
(
cÚn
è
True


206 
exû±
 
Exû±iÚ
, 
msg
:

207 
glob®Log
.
	`g‘E¼Ü
().
	$log
(
glob®Log
.
ERROR
, 
msg
)

208  
F®£


210 
def
 
	$wa™CÚÃùiÚ
(
£lf
, 
pŞËr
, 
»adOÆy
, 
fdToSock‘
, 
timeout
):

212 #pŞÈ
timeout


213 
ev’ts
 = 
pŞËr
.
	$pŞl
(
timeout
)

214 
fd
, 
æag
 
š
 
ev’ts
:

215 #»Œ›v
the
 
aùu®
 
sock‘
 
äom
 
™s
 
fe
 
desütÜ


216 
s
 = 
fdToSock‘
[
fd
]

217 #hªdË 
šputs


218 ià(
æag
 & (
£Ëù
.
POLLIN
 | s–eù.
POLLPRI
)è
ªd
 \

219 
nÙ
 
£lf
.
	$_»ûivePackage
(
pŞËr
, 
s
, 
fdToSock‘
, 
»adOÆy
):

220 
pŞËr
.
	$uÄegi¡”
(
s
)

221 
s
.
	$şo£
()

222 
d–
 
fdToSock‘
[
fd
]

223 
–if
 
æag
 & (
£Ëù
.
POLLHUP
 | s–eù.
POLLERR
):

224 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, 'Client close connection')

225 
pŞËr
.
	$uÄegi¡”
(
s
)

226 
s
.
	$şo£
()

228 
def
 
	$hªdË
(
£lf
):

230 #commÚly 
u£d
 
æag
 
£ts


231 
timeout
 = 1000

232 
»adOÆy
 = (
£Ëù
.
POLLIN
 | s–eù.
POLLPRI
|

233 
£Ëù
.
POLLHUP
 | s–eù.
POLLERR
)

234 #£ˆ
up
 
the
 
pŞËr


235 
£lf
.
pŞËr
 = 
£Ëù
.
	$pŞl
()

236 
£lf
.
pŞËr
.(£lf.
_sock
, 
»adOÆy
)

237 #m­ 
fe
 
descœ±Üs
 
to
 
sock‘
 
objeùs


238 
£lf
.
fdToSock‘
 = {

239 
£lf
.
_sock
.
	`f’o
():self._sock,

240 
	}
}

242 
True
:

243 
Œy
:

244 
£lf
.
	$wa™CÚÃùiÚ
(
£lf
.
pŞËr
, 
»adOÆy
, s–f.
fdToSock‘
, 
timeout
)

245 
exû±
 
Exû±iÚ
,
msg
:

246 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, \

247 'Exû±iÚ iÀ£rv” hªdË:%s'%
msg
);

249 
def
 
	$doEx™
(
£lf
):

251 
£lf
.
_©ckP
:

252 
£lf
.
_©ckP
.
	$şo£
()

254 
def
 
	$sigÇlEx™
(
£lf
, 
a
, 
b
):

256 
£lf
.
_©ckP
:

257 
´št
 'XXXXXXXXXXXXXXXXXXXXXXXXXXXX----'

258 
£lf
.
_©ckP
.
	$şo£
()

259 
´št
 'XXXXXXXXXXXXXXXXXXXXXXXXXXXX'

260 
sys
.
	`ex™
(-1)

262 
def
 
	$run
(
£lf
):

264 #sigÇÈ
hªdË


265 
sigÇl
.
	$sigÇl
(
sigÇl
.
SIGQUIT
, 
£lf
.
sigÇlEx™
)

266 
sigÇl
.
	$sigÇl
(
sigÇl
.
SIGTERM
, 
£lf
.
sigÇlEx™
)

267 
sigÇl
.
	$sigÇl
(
sigÇl
.
SIGINT
, 
£lf
.
sigÇlEx™
)

269 
£lf
.
	$_ü—‹Pe
(
BLACK_PIPE
)

270 
£lf
.
	$_bšdSock‘
(
£lf
.
_add»ss
, s–f.
_pÜt
)

271 
£lf
.
	$hªdË
()

273 
__Çme__
 == '__main__':

275 #d«mÚ 
´oûss


276 
ag’tS”v”
 = 
	`Ag’tS”v”
('172.16.161.253', 6379, 
pid
='/tmp/agent.pid')

277 
©ex™
.(
ag’tS”v”
.
doEx™
)

278 
ag’tS”v”
.
	`run
()

280 
	`Ën
(
sys
.
¬gv
) == 2:

281 '¡¬t' =ğ
sys
.
¬gv
[1]:

282 
ag’tS”v”
.
	$¡¬t
()

283 
–if
 '¡İ' =ğ
sys
.
¬gv
[1]:

284 
ag’tS”v”
.
	$¡İ
()

285 
–if
 '»¡¬t' =ğ
sys
.
¬gv
[1]:

286 
ag’tS”v”
.
	$»¡¬t
()

288 
´št
 "Unknown command"

289 
sys
.
	$ex™
(2)

290 
sys
.
	$ex™
(0)

292 
´št
 "u§ge: % ¡¬t|¡İ|»¡¬t" % 
sys
.
¬gv
[0]

293 
sys
.
	`ex™
(2)

	@/root/grocery-shop/language/python/redis/agentTestServer.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
os


4 
impÜt
 
sys


5 
impÜt
 
time


6 
impÜt
 

7 
impÜt
 
sock‘


9 
äom
 
ag’tS”v”
 
impÜt
 
	gRedisCommniÿ‹


11 #£ˆ
roÙ
 
dœeùÜy


12 
	g·ckage_·th
 = 
os
.
g‘cwd
() + '/../'

13 
sys
.
·th
.
	$­³nd
(
·ckage_·th
)

15 
äom
 
ba£·ckage
.
ba£log
 
impÜt
 
glob®Log


17 
__Çme__
 == '__main__':

20 
£rv”_add»ss
 = '127.0.0.1'

21 
pÜt
 = 
job00job


22 
sock
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
)

24 
Œy
:

25 
sock
.
	`cÚÃù
((
£rv”_add»ss
, 
pÜt
))

26 
exû±
 
sock‘
.
”rÜ
,
msg
:

27 
sock
.
	$şo£
()

28 
´št
 
msg


29 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, '%s'%
msg
)

32 
i
 
š
 
	$¿nge
(1,10000):

33 
ş›Á_
 = '192.16job.16job.16job'

34 
tok’
 = '0' 
i
%2010 '20150724205220-gelgessssssjsjsjsjsjsjsjsjs%d'%(i)

35 
d©a
 = ' '.
	$još
([
ş›Á_
, 
tok’
])

36 
±y³
 = '00'

37 
Ëngth
 = '%04d'%
	$Ën
(
d©a
)

38 
·ckage
 = ''.
	$još
([
±y³
, 
Ëngth
, 
d©a
])

39 
´št
 '% ----- %d'%(
·ckage
, 
i
)

40 
Œy
:

41 
sock
.
	$£nd
(
·ckage
)

42 
exû±
 
sock‘
.
”rÜ
, 
msg
:

43 
´št
 
msg


44 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, '%s'%
msg
)

45 
sock
.
	$şo£
()

46 
sys
.
	`ex™
(-1)

47 
exû±
 
Exû±iÚ
,
msg
:

48 
´št
 
msg


49 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, '%s'%
msg
)

50 
sock
.
	$şo£
()

51 
sys
.
	`ex™
(-1)

52 
sock
.
	`şo£
()

	@/root/grocery-shop/language/python/regexOperator/fileFilter.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


6 è®¾å®šè¿”å›çš„ç¼“å­˜å¤§å°(
	g»tuºMaxBuf
):

7 10
M


8 è®¾å®šæ¯æ¬¡è¯»å–çš„å­—ç¬¦ä¸²ç¼“å­˜å¤§å°ä¸º(
»adMaxBuf
==
»tuºMaxBuf
):

9 5
M


12 *
Exû±iÚ
*

13 
©
 *.*.*.*

14 
©
 *.*.*.*

15 
Cau£
 
by
:*
Exû±iÚ
*

16 
©
 *.*.*.*

19 *
Exû±iÚ
*

20 
©
 *.*.*.*

21 
©
 *.*.*.*

22 *
Exû±iÚ
*

23 
©
 *.*.*.*

26 3ï¼‰å¦‚æœæ‰«æä¸€ä¸ªå•ä¸€çš„ç¼“å­˜åï¼Œè·å–çš„åŒ¹é…ä¿¡æ¯ä¸è¶³
»tuºMaxBuf
ï¼Œç»§ç»­æ‰«æ

27 ä¸‹ä¸€ä¸ª
»adMaxBuf
ï¼Œä¹‹åå¦‚æœè¶…é¢ï¼Œåˆ™å­˜å…¥ç»“æœä¸­å¹¶ç«‹åˆ»æ›´æ–°è¿”å›ã€‚

28 4èå¦‚æœå•ä¸ªåŸå­æ€§ä¿¡æ¯å¤§å°å¤§äº5
M
ï¼Œæ‰©å¤§è¿”å›å€¼

31 çš„æ—¥å¿—ä¿¡æ¯è¿‡å¤§ï¼ˆæ¯”å¦‚200
M
ï¼‰ï¼Œå…¶ä¸­çš„åŒ¹é…ä¿¡æ¯éƒ½è¶…è¿‡5Mï¼Œé‚£ä¹ˆå¯èƒ½é€ æˆå‘Šè­¦

34 1æ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶
java
.
log
ï¼›

35 2è¯»å–
»adMaxBuf
çš„ä¿¡æ¯ï¼ŒåŒ¹é…å¹¶å°†æ•´æ•°ä¸ªæ•°çš„åŸå­æ ˆä¿¡æ¯å­˜å…¥åˆ°
»tuºBuf
ä¸­.

36 3åˆ¤æ–­
Ën
(
»tuºBuf
)æ˜¯å¦è¿‘ä¼¼äº
»tuºMaxBuf
ï¼š

40 
impÜt
 
os


41 
impÜt
 
»


43 
äom
 
sh™log
 
impÜt
 
CRITICAL
,
	gFATAL
,
	gERROR
,
	gWARNING
,
	gWARN
,
	gINFO
,
	gDEBUG
,
	gNOTSET
,
debug


44 
äom
 
sh™log
 
impÜt
 
OssLog


45 
äom
 
sh™log
 
impÜt
 
glob®Log


47 
şass
 
	$FeF‹r
(
objeù
):

49 
def
 
	$__š™__
(
£lf
, 
f’ame
, 
maxbuf
 = 5242
jobjob0
):

50 
£lf
.
_maxBuf
 = 
maxbuf


51 
£lf
.
_f’ame
 = 
f’ame


52 
£lf
.
_fd
 = 
NÚe


53 
£lf
.
_Üigš¡r
 = 
NÚe


54 
£lf
.
_pos
 = 0

56 
£lf
.
	$_š™
()

58 
def
 
	$_š™
(
£lf
):

60 
Œy
:

61 
£lf
.
_fd
 = 
	`İ’
(£lf.
_f’ame
, 'rb')

62 
exû±
 
Exû±iÚ
:

63 
glob®Log
.
	`wr™eLog
(
WARNING
, 'R—d f% çed.'%(
£lf
.
_f’ame
))

64 
£lf
.
_fd
 = 
NÚe


66 
def
 
	$_»adBufBySize
(
£lf
):

68 
£lf
.
_fd
 
is
 
NÚe
:

69 
glob®Log
.
	`wr™eLog
(
WARNING
, 'Fİ”©Ü i NÚe, % exi¡ed?'%(
£lf
.
_f’ame
))

70  
F®£


71 
Œy
:

72 
£lf
.
Üigš¡r
 = s–f.
_fd
.
	$»ad
(
£lf
.
_maxBuf
)

73 
fx
 = 
	`İ’
('./logs/test', 'ab+')

74 
fx
.
	$wr™e
(
£lf
.
Üigš¡r
)

75 
fx
.
	$şo£
()

76 
exû±
 
Exû±iÚ
:

77 
glob®Log
.
	`wr™eExû±iÚ
('R—d f%s'%(
£lf
.
_f’ame
))

78  
F®£


79 
´št
 
	`Ën
(
£lf
.
Üigš¡r
), '+++++++++++++++++++++'

80 
	`Ën
(
£lf
.
Üigš¡r
) == 0:

81 
glob®Log
.
	`wr™eLog
(
INFO
, 'file\'s†ength is zero')

82  
F®£


84 
def
 
	$’dUp
(
£lf
):

86 
£lf
.
_f’ame
 = 
NÚe


87 
Œy
:

88 
£lf
.
_fd
.
	$şo£
()

89 
exû±
 
Exû±iÚ
:

90 
glob®Log
.
	`wr™eLog
(
WARNING
, 'close file failed!')

91 
£lf
.
_fd
 = 
NÚe


92 
£lf
.
_pos
 = 0

93 
£lf
.
_Üigš¡r
 = 
NÚe


95 
def
 
	$f‹r
(
£lf
, 
»tuºV®
=[]):

97 @
»tv®ue
æ ¼å¼:

105 åŒ¹é…ï¼š
com
.
xxx
.
abExû±iÚ
:xxxå­—æ®µ

106 (\
S
*\.)+[
a
-
z0
-9A-
Z_
]*
Exû±iÚ
:.*

107 åŒ¹é…ï¼š
©
 
Üg
.
ÿge
.
	`xxx
(
xxx
.
java
.
jobjob
)

108 ((\
n
[ \
t
]*
©
 *(\
S
*\.)+[
a
-
z0
-9A-
Z_
]*\(.*\))+)

109 åŒ¹é…ï¼š
Cau£d
 
by
: 
com
.
xxx
.
abdExû±iÚ
.xxxå­—æ®µ

110 (\
nÿu£d
 
by
: (\
S
*\.)+[
a
-
z0
-9A-
Z_
]*
Exû±iÚ
:.*

112 (\
n
[ \
t
]*
©
 *(\
S
*\.)+[
a
-
z0
-9A-
Z_
]*\(.*\))+)+

114 
»gexli¡
 = [

115 #´
m©ch


116 
r
'(\S*\.)+[a-z0-9A-Z_]*Exception:.*(\n[ \t]*at *(\S*\.)+[a-z0-9A-Z_]*\(.*\))+',

117 #fŞlow 
m©ch


118 
r
'(\ncaused by: (\S*\.)+[a-z0-9A-Z_]*Exception:.*(\n[ \t]*at *(\S*\.)+[a-z0-9A-Z_]*\(.*\))+)+',

120 #»ad 
buf
 
šfÜm©iÚ


121 
True
:

122 
£lf
.
	$_»adBufBySize
(è
is
 
F®£
:

124 #g‘ 
Üigš
 
¡ršg
's†ength

125 
buæ’
 = 
	$Ën
(
£lf
.
Üigš¡r
)

126 
´št
 'Te¡--------------buæ’=%d-----------------------'%(
buæ’
)

127 
»gex¡r
 
š
 
»gexli¡
:

128 
m©ch
 = 
»
.
	$£¬ch
(
»gex¡r
, 
£lf
.
Üigš¡r
, 
»
.
IGNORECASE
)

129 
m©ch
 
is
 
NÚe
:

130 
£lf
.
_pos
 = s–f._po + 
buæ’


132 #cİy 
¡ršg


133 
m¡¬t
 = 
m©ch
.
	$¡¬t
()

134 
m’d
 = 
m©ch
.
	$’d
()

135 
´št
 'M©ch sŒšg i :%s'%(
£lf
.
Üigš¡r
[
m¡¬t
:
m’d
])

137 
__Çme__
 == '__main__':

139 
impÜt
 
pdb


140 
pdb
.
	$£t_Œaû
()

141 
æ
 = 
	`FeF‹r
('./out.log')

143 
num
 = 10

144 
i
 
š
 
	$¿nge
(
num
):

145 
»tuºV®
 = []

146 
æ
.
	$f‹r
(
»tuºV®
)

147 
k
 
š
 
»tuºV®
:

148 
´št
 '\n=========================================================='

149 
´št
 
k


	@/root/grocery-shop/language/python/regexOperator/joblog.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 
Log
 
moduË
 
	gš‹rçû
:

5 
funùiÚ
ï¼š

9 ï¼ˆç£ç›˜æ–‡ä»¶ã€
	gTCPsock‘
ã€
	gunix
åŸŸå¥—æ¥å­—ã€é‚®ä»¶ï¼‰

11 ï¼ˆ
	gü™iÿl
ã€
	g”rÜ
ã€
	gw¬Âšg
ã€
	gšfo
ã€
	gdebug
ï¼‰

13 
impÜt
 
os


14 
impÜt
 
loggšg


15 
impÜt
 
	gloggšg
.
cÚfig


16 
impÜt
 
sock‘


17 
impÜt
 
time


18 
impÜt
 
¡©


19 
impÜt
 
cPickË


20 
impÜt
 

21 
impÜt
 
	gshut


23 #Ëv– -- 
»ã»nû
 
loggšg
 
moduË


24 
äom
 
loggšg
 
impÜt
 
	gCRITICAL
,
	gFATAL
,
	gERROR
,
	gWARNING
,
	gWARN
,
	gINFO
,
	gDEBUG
,
	gNOTSET
,
	gdebug


26 #deçuÉ 
log
 
cÚfigu»
 
f’ame
 
ªd
 †og 
ouut
 filename

27 
	gDEFAULT_DATA_DIR
 = 
os
.
g‘cwd
() + '/logs'

28 
os
.
·th
.
	$isdœ
(
DEFAULT_DATA_DIR
è
is
 
F®£
:

29 
os
.
	$mkdœ
(
DEFAULT_DATA_DIR
)

31 
PRE_DEFAULT_LOG
 = 
DEFAULT_DATA_DIR
 + '/´e_šfo.log' #æ‰§è¡Œ
OssLog
å‡½æ•°å‡ºé”™çš„æ—¥å¿—è®°å½•

32 
DEFAULT_CONF
 = 
DEFAULT_DATA_DIR
 + '/condLog.conf' #æ—¥å¿—é…ç½®æ–‡ä»¶

33 
DEFAULT_CONF_BAK
 = 
DEFAULT_CONF
 + '.bak' #æ—¥å¿—é…ç½®æ–‡ä»¶å¤‡ä»½æ–‡ä»¶

35 
INFO_LOG
 = 
DEFAULT_DATA_DIR
 + '/info.log' #æ—¥å¿—è®°å½•æ–‡ä»¶

36 
ERROR_LOG
 = 
DEFAULT_DATA_DIR
 + '/error.log' #æ—¥å¿—è®°å½•æ–‡ä»¶

37 
DEFAULT_UNIX_SERVER
 = 
DEFAULT_DATA_DIR
 + '/shit_socket' #UNIXåŸŸå¥—æ¥å­—åœ°å€

38 
DEFAULT_SOCKET_SERVER
ğ'loÿlho¡' #é»˜è®¤çš„
sock‘
æœåŠ¡å™¨åœ°å€

39 
DEFAULT_SOCKET_PORT
 = 999
job
 #é»˜è®¤çš„
sock‘
ç›‘å¬ç«¯å£

40 
DEFAULT_CONFIG_PORT
 = 9999 #é»˜è®¤çš„é…ç½®æœåŠ¡å™¨ç›‘å¬ç«¯å£

41 
DEFAULT_CONFIG_SERVER
 = 'localhost' #é»˜è®¤çš„é…ç½®æœåŠ¡å™¨åœ°å€

43 
şass
 
	$P»CÚdLog
(
objeù
):

45 @ç”¨äºåœ¨
OssLog
èµ·æ¥ä¹‹å‰çš„æ—¥å¿—è®°å½•

47 
def
 
	$__š™__
(
£lf
, 
f’ame
=
PRE_DEFAULT_LOG
):

49 
£lf
.
_f’ame
 = 
f’ame


50 
£lf
.
	$_š™Fe
()

51 
£lf
.
	$_š™Logg”
()

53 
def
 
	$_š™Fe
(
£lf
):

55 
os
.
·th
.
	$exi¡s
(
£lf
.
_f’ame
è
is
 
F®£
:

56 
fd
 = 
	`İ’
(
£lf
.
_f’ame
, 'w')

57 
fd
.
	$şo£
()

58 #os.
	`chmod
(
£lf
.
_f’ame
, 
¡©
.
S_IRWXU
|¡©.
S_IRWXG
|¡©.
S_IRWXO
)

60 
def
 
	$_š™Logg”
(
£lf
):

62 
£lf
.
_logg”DeçuÉ
 = 
loggšg
.
	`g‘Logg”
('PreCondLogger')

64 
f
='PreLog:%(asctime)s-%(name)s-%(filename)s[line:%(lineno)d]-%(levelname)s-%(message)s:'

65 
fm
 = 
loggšg
.
	$FÜm©‹r
(
f
)

67 
hd
 = 
loggšg
.
	$FeHªdËr
(
£lf
.
_f’ame
)

68 #hd = 
loggšg
.
	`SŒ—mHªdËr
()

69 
hd
.
	$£tFÜm©‹r
(
fm
)

70 
£lf
.
_logg”DeçuÉ
.
	$addHªdËr
(
hd
)

71 
£lf
.
_logg”DeçuÉ
.
	$£tLev–
(
DEBUG
)

73 
def
 
	$wr™eLog
(
£lf
, 
Ëv–
, 
msg
):

75 
£lf
.
_logg”DeçuÉ
.
	$log
(
Ëv–
, 
msg
)

77 
def
 
	$wr™eExû±iÚ
(
£lf
, 
msg
):

79 
£lf
.
_logg”DeçuÉ
.
	$exû±iÚ
(
msg
)

81 
şass
 
	$FeO³¿tÜ
(
objeù
):

83 
def
 
	$__š™__
(
£lf
, 
f’ame
):

84 
£lf
.
_f’ame
 = 
f’ame


85 
£lf
.
_fd
 = 
NÚe


87 
def
 
	$ü—‹Fe
(
£lf
, 
mode
=
NÚe
):

89 
Œy
:

90 
£lf
.
_fd
 = 
	`İ’
(£lf.
_f’ame
, 'w')

91 
£lf
.
_fd
.
	$şo£
()

92 
mode
:

93 
os
.
	$chmod
(
£lf
.
_f’ame
, 
mode
)

94 
exû±
 
Exû±iÚ
,
e
:

95  
F®£


97  
True


99 
def
 
	$acûssExi¡s
(
£lf
):

101 
Œy
:

102  
os
.
·th
.
	$exi¡s
(
£lf
.
_f’ame
)

103 
exû±
 
Exû±iÚ
, 
e
:

104  
F®£


106  
True


108 
def
 
	$acûssR—d
(
£lf
):

110 
Œy
:

111 
£lf
.
_fd
 = 
	`İ’
(£lf.
_f’ame
, 'r')

112 
£lf
.
_fd
.
	$şo£
()

113 
exû±
 
Exû±iÚ
,
e
:

114  
F®£


116  
True


118 
def
 
	$acûssWr™e
(
£lf
):

120 
Œy
:

121 
£lf
.
_fd
 = 
	`İ’
(£lf.
f’ame
, 'a')

122 
£lf
.
_fd
.
	$şo£
()

123 
exû±
 
Exû±iÚ
,
e
:

124  
F®£


126  
True


128 
def
 
	$chªgeFe
(
£lf
, 
Ãwf’ame
):

129 '''chªgfe'
s
 
cÚ‹Á
'''

130 
Œy
:

131 
os
.
·th
.
	$exi¡s
(
Ãwf’ame
è
is
 
F®£
:

132  
F®£


133 #cİy 
Ãw
 
fe
 
to
 
Şd
 fe, 
chªg
 
Şdfe
's content

134 
shut
.
	$cİy
(
Ãwf’ame
, 
£lf
.
_f’ame
)

135 
exû±
 
Exû±iÚ
:

136  
F®£


138  
True


140 
def
 
	$chmodFe
(
£lf
, 
mode
):

141 '''chªgfe'
s
 
mode
'''

142 
Œy
:

143 
os
.
	$chmod
(
£lf
.
_f’ame
, 
mode
)

144 
exû±
 
Exû±iÚ
,
e
:

145  
F®£


147  
True


149 
şass
 
	$UnixSock‘HªdËr
(
loggšg
.
HªdËr
):

151 
A
 
hªdËr
 
şass
 
which
 
wr™es
 
loggšg
 
»cÜds
, 
š
 
pickË
 
fÜm©
, 
to


152 
a
 
¡»amšg
 
sock‘
. 
The
 sock‘ 
is
 
k•t
 
İ’
 
aüsh™
 
loggšg
 
ÿÎs
.

153 
If
 
the
 
³”
 
»£ts
 
™
, 
ª
 
©‹m±
 
is
 
made
 
to
 
»cÚÃù
 
Ú
h
Ãxt
 
ÿÎ
.

154 
The
 
pickË
 
which
 
is
 
£Á
 i 
th©
 
of
 
the
 
LogRecÜd
's‡ttribute dictionary

155 (
__diù__
), 
so
 
th©
 
the
 
»ûiv”
 
dÛs
 
nÙ
 
Ãed
 
to
 
have
h
loggšg
 
moduË


156 
š¡®Ëd
 
š
 
Üd”
 
to
 
´oûss
 
the
 
loggšg
 
ev’t
.

158 
To
 
uÅickË
 
the
 
»cÜd
 
©
h
»ûivšg
 
’d
 
što
 
a
 
LogRecÜd
, 
u£
he

159 
makeLogRecÜd
 
funùiÚ
.

160 @è¯¥ç±»å®Œå…¨æ‹·è´
Sock‘HªdËr
ï¼Œä¿®æ”¹äº†éƒ¨åˆ†å®ç°ï¼Œä½œä¸ºå‘é€
unix
åŸŸå¥—æ¥å­—çš„
HªdËr


163 
def
 
	$__š™__
(
£lf
, 
£rv”
):

165 
In™Ÿlizes
 
the
 
hªdËr
 
w™h
 
a
 
¥ecific
 
£rv”
 
add»ss
.

167 
The
 
©Œibu‹
 'şo£OnE¼Ü' 
is
 
£t
 
to
 1 - 
which
 
m—ns
 
th©
 

168 
a
 
sock‘
 
”rÜ
 
occurs
, 
the
 sock‘ 
is
 
s’y
 
şo£d
 
ªd
 
th’


169 
»İ’ed
 
Ú
 
the
 
Ãxt
 
loggšg
 
ÿÎ
.

171 
loggšg
.
HªdËr
.
	$__š™__
(
£lf
)

172 
£lf
.
£rv”
 = server

173 
£lf
.
sock
 = 
NÚe


174 
£lf
.
şo£OnE¼Ü
 = 0

175 
£lf
.
»ŒyTime
 = 
NÚe


176 #
#ExpÚ’tŸÈ
backoff
 
·¿m‘”s
.

177 #
.»ŒyS¹ = 1.0

178 
£lf
.
»ŒyMax
 = 30.0

179 
£lf
.
»ŒyFaùÜ
 = 2.0

181 
def
 
	$makeSock‘
(
£lf
, 
timeout
=1):

183 
A
 
çùÜy
 
m‘hod
 
which
 
®lows
 
subşas£s
 
to
 
defše
 
the
 
´eci£


184 
ty³
 
of
 
sock‘
 
they
 
wªt
.

186 
s
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_UNIX
, sock‘.
SOCK_STREAM
)

187 
	`ha§‰r
(
s
, 'settimeout'):

188 
s
.
	$£‰imeout
(
timeout
)

189 
s
.
	$cÚÃù
(
£lf
.
£rv”
)

190  
s


192 
def
 
	$ü—‹Sock‘
(
£lf
):

194 
Try
 
to
 
ü—‹
 
a
 
sock‘
, 
usšg
 
ª
 
expÚ’tŸl
 
backoff
 
w™h


195 
a
 
max
 
»Œy
 
time
. 
Thªks
 
to
 
Rob”t
 
OlsÚ
 
the
 
Üigš®
 
·tch


196 (
SF
 #job15911è
which
 
has
 
b“n
 
¦ighy
 
»çùÜed
.

198 
now
 = 
time
.
	$time
()

199 #E™h” 
»ŒyTime
 
is
 
NÚe
, 
š
 
which
 
this


200 #i 
the
 
fœ¡
 
time
 
back
 
aá”
 
a
 
discÚÃù
, 
Ü


202 
£lf
.
»ŒyTime
 
is
 
NÚe
:

203 
©‹m±
 = 1

205 
©‹m±
 = (
now
 >ğ
£lf
.
»ŒyTime
)

206 
©‹m±
:

207 
Œy
:

208 
£lf
.
sock
 = s–f.
	$makeSock‘
()

209 
£lf
.
»ŒyTime
 = 
NÚe
 #Ãxˆ
time
, 
no
 
d–ay
 
befÜe
 
Œyšg


210 
exû±
 
sock‘
.
”rÜ
:

211 #C»©iÚ 
çed
, 
so
 
£t
 
the
 
»Œy
 
time
 
ªd
 .

212 
£lf
.
»ŒyTime
 
is
 
NÚe
:

213 
£lf
.
»ŒyP”iod
 = s–f.
»ŒyS¹


215 
£lf
.
»ŒyP”iod
 = s–f.»ŒyP”iod * s–f.
»ŒyFaùÜ


216 
£lf
.
»ŒyP”iod
 > s–f.
»ŒyMax
:

217 
£lf
.
»ŒyP”iod
 = s–f.
»ŒyMax


218 
£lf
.
»ŒyTime
 = 
now
 + s–f.
»ŒyP”iod


220 
def
 
	$£nd
(
£lf
, 
s
):

222 
S’d
 
a
 
pickËd
 
¡ršg
 
to
 
the
 
sock‘
.

224 
This
 
funùiÚ
 
®lows
 
·¹Ÿl
 
£nds
 
which
 
ÿn
 
h­³n
 
wh’
 
the


225 
ÃtwÜk
 
is
 
busy
.

227 
£lf
.
sock
 
is
 
NÚe
:

228 
£lf
.
	$ü—‹Sock‘
()

229 #£lf.
sock
 
ÿn
 
be
 
NÚe
 
e™h”
 
beÿu£
 
we
 
hav’
't„eachedhe„etry

230 #tim
y‘
, 
Ü
 
beÿu£
 
we
 
have
 
»ached
 
the
 
»Œy
 
time
 
ªd
 
»Œ›d
,

231 #buˆ
¬e
 
¡l
 
uÇbË
 
to
 
cÚÃù
.

232 
£lf
.
sock
:

233 
Œy
:

234 
	`ha§‰r
(
£lf
.
sock
, "sendall"):

235 
£lf
.
sock
.
	$£nd®l
(
s
)

237 
£Ásoçr
 = 0

238 
Ëá
 = 
	$Ën
(
s
)

239 
Ëá
 > 0:

240 
£Á
 = 
£lf
.
sock
.
	$£nd
(
s
[
£Ásoçr
:])

241 
£Ásoçr
 = s’tsoç¸+ 
£Á


242 
Ëá
 =†eá - 
£Á


243 
exû±
 
sock‘
.
”rÜ
:

244 
£lf
.
sock
.
	$şo£
()

245 
£lf
.
sock
 = 
NÚe
 #sØ
we
 
ÿn
 
ÿÎ
 
ü—‹Sock‘
 
Ãxt
 
time


247 
def
 
	$makePickË
(
£lf
, 
»cÜd
):

249 
PickËs
 
the
 
»cÜd
 
š
 
bš¬y
 
fÜm©
 
w™h
 
a
 
Ëngth
 
´efix
, 
ªd


250 
»tuºs
 
™
 
»ady
 
ŒªsmissiÚ
 
aüsh™
 
the
 
sock‘
.

252 
dummy
 = 
NÚe


253 
ei
 = 
»cÜd
.
exc_šfo


254 
ei
:

255 
dummy
 = 
£lf
.
	$fÜm©
(
»cÜd
è#ju¡ 
to
 
g‘
 
Œaûback
 
‹xt
 
što
„ecÜd.
exc_‹xt


256 
»cÜd
.
exc_šfo
 = 
NÚe
 #tØ
avoid
 
UÅickËabË
 
”rÜ


257 
s
 = 
cPickË
.
	$dumps
(
»cÜd
.
__diù__
, 1)

258 
ei
:

259 
»cÜd
.
exc_šfo
 = 
ei
 #fÜ 
Ãxt
 
hªdËr


260 
¦’
 = .
	`·ck
(">L", 
	$Ën
(
s
))

261  
¦’
 + 
s


263 
def
 
	$hªdËE¼Ü
(
£lf
, 
»cÜd
):

265 
HªdË
 
ª
 
”rÜ
 
duršg
 
loggšg
.

267 
An
 
”rÜ
 
has
 
occu¼ed
 
duršg
 
loggšg
. 
Mo¡
 
lik–y
 
ÿu£
 -

268 
cÚÃùiÚ
 
lo¡
. 
Clo£
 
the
 
sock‘
 
so
 
th©
 
we
 
ÿn
 
»Œy
 
Ú
he

269 
Ãxt
 
ev’t
.

271 
£lf
.
şo£OnE¼Ü
 
ªd
 s–f.
sock
:

272 
£lf
.
sock
.
	$şo£
()

273 
£lf
.
sock
 = 
NÚe
 #Œy 
to
 
»cÚÃù
 
Ãxt
 
time


275 
loggšg
.
HªdËr
.
	$hªdËE¼Ü
(
£lf
, 
»cÜd
)

277 
def
 
	$em™
(
£lf
, 
»cÜd
):

279 
Em™
 
a
 
»cÜd
.

281 
PickËs
 
the
 
»cÜd
 
ªd
 
wr™es
 
™
 
to
h
sock‘
 
š
 
bš¬y
 
fÜm©
.

282 
If
 
th”e
 
is
 
ª
 
”rÜ
 
w™h
 
the
 
sock‘
, 
s’y
 
drİ
h
·ck‘
.

283 
If
 
th”e
 
was
 
a
 
´obËm
 
w™h
 
the
 
sock‘
, 
»
-
e¡ablishes
he

284 
sock‘
.

286 
Œy
:

287 
s
 = 
£lf
.
	$makePickË
(
»cÜd
)

288 
£lf
.
	$£nd
(
s
)

289 
	$exû±
 (
KeybßrdIÁ”ru±
, 
Sy¡emEx™
):

290 
¿i£


291 
exû±
:

292 
£lf
.
	$hªdËE¼Ü
(
»cÜd
)

294 
def
 
	$şo£
(
£lf
):

296 
Clo£s
 
the
 
sock‘
.

298 
£lf
.
sock
:

299 
£lf
.
sock
.
	$şo£
()

300 
£lf
.
sock
 = 
NÚe


301 
loggšg
.
HªdËr
.
	$şo£
(
£lf
)

303 
şass
 
	$OssLog
(
objeù
):

305 
def
 
	$__š™__
(
£lf
, 
cÚf
=
DEFAULT_CONF
, 
di§bË_exi¡šg_logg”s
=
True
):

306 
£lf
.
_šfo
 = 
NÚe


307 
£lf
.
_”rÜ
 = 
NÚe


308 
£lf
.
_f’ame
 = 
cÚf


309 #šfØ
log
 
hªdËr


310 
£lf
.
_hcÚsŞe
 = 
NÚe


311 
£lf
.
_hfe
 = 
NÚe


312 
£lf
.
_hunix
 = 
NÚe


313 
£lf
.
_htı
 = 
NÚe


314 #”rÜ 
log
 
hªdËr


315 
£lf
.
_hefe
 = 
NÚe


316 
£lf
.
_heunix
 = 
NÚe


317 
£lf
.
_h‘ı
 = 
NÚe


318 
£lf
.
_cÚfigLi¡’
 = 
NÚe


319 
£lf
.
_cÚfigfe
 = 
NÚe


320 
£lf
.
_di§bË
 = 
di§bË_exi¡šg_logg”s


321 #´
log
 
cÚfigu»


322 
£lf
.
_deçuÉ
 = 
	$P»CÚdLog
()

323 
£lf
.
	$_š™
()

325 
def
 
	$_š™
(
£lf
):

327 #Logg” 
diù


328 
£lf
.
_logg”Diù
 = {

331 
	}
}

333 
£lf
.
_logg”Li¡
 = ['_info', '_error']

335 #deçuÉ 
log
 
¡Üe


336 
	g£lf
.
	$_logDeçuÉStÜe
()

337 #deçuÉ 
log
 
cÚfigu»


338 
Œy
:

339 
£lf
.
	$_logDeçuÉFeCÚfig
(è
is
 
F®£
:

340 
£lf
.
	$_š™Logg”
()

341 
£lf
.
	$_£tHªdËr
()

343 
£lf
.
	$_g‘Logg”
()

344 
exû±
 
Exû±iÚ
:

345 
£lf
.
_deçuÉ
.
	`wr™eExû±iÚ
('Load default config failure.')

346 
ex™
 -1

348 
def
 
	$_logDeçuÉStÜe
(
£lf
):

350 #ü—‹ 
fe
 
to
 
¡Üe
 
log


351 
feİ
 = 
	$FeO³¿tÜ
(
INFO_LOG
)

352 
nÙ
 
feİ
.
	$acûssExi¡s
(è
ªd
 
nÙ
 
feİ
.
	$ü—‹Fe
():

353 
£lf
.
_deçuÉ
.
	`wr™eExû±iÚ
('create store†og file:')

354 
ex™
 -1

356 
def
 
	$_logDeçuÉFeCÚfig
(
£lf
):

358 
Œy
:

359 #ü—‹ 
cÚfigu»
 
fe


360 
feİ
 = 
	$FeO³¿tÜ
(
DEFAULT_CONF
)

361 
nÙ
 
feİ
.
	$acûssExi¡s
(è
ªd
 
nÙ
 
feİ
.
	$chªgeFe
(
DEFAULT_CONF_BAK
):

362 
£lf
.
_deçuÉ
.
	`wr™eLog
(
WARNING
, 'chªg% çed.'%(
DEFAULT_CONF_BAK
))

363  
F®£


364 #Judg
fe
's‡ttr

365 
feİ
.
	$acûssR—d
(è
is
 
F®£
:

366 
£lf
.
_deçuÉ
.
	`wr™eLog
(
ERROR
, '% uÄ—dabË.'%(£lf.
_f’ame
))

367  
F®£


368 
exû±
 
Exû±iÚ
,
e
:

369 
£lf
.
_deçuÉ
.
	`wr™eExû±iÚ
(
sys
.
	`_g‘äame
().
f_code
.
co_Çme
)

370  
F®£


372 
Œy
:

373 #»ad 
logg”
 
äom
 
cÚfigu»
 
fe


374 
loggšg
.
cÚfig
.
	$feCÚfig
(
DEFAULT_CONF
, 
di§bË_exi¡šg_logg”s
=
£lf
.
_di§bË
)

375 
exû±
 
Exû±iÚ
, 
e
:

376 
£lf
.
_deçuÉ
.
	`wr™eLog
(
ERROR
, 'The configuration file format is‚ot valid.')

377  
F®£


378  
True


380 
def
 
	$upd©eLogCÚfig
(
£lf
):

382 
Œy
:

383 
w™h
 
	`İ’
(
£lf
.
_cÚfigfe
, 'rb'è
as
 
f
:

384 
d©a_to_£nd
 = 
f
.
	$»ad
()

385 
s
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
)

386 
s
.
	`cÚÃù
((
DEFAULT_CONFIG_SERVER
, 
DEFAULT_CONFIG_PORT
))

387 
s
.
	`£nd
(.
	`·ck
('>L', 
	$Ën
(
d©a_to_£nd
)))

388 
s
.
	$£nd
(
d©a_to_£nd
)

389 
s
.
	$şo£
()

390 
exû±
 
Exû±iÚ
,
e
:

391 
£lf
.
	`wr™eExû±iÚ
('\nupdateLogConfig')

393 
def
 
	$lßdCÚfigFromNewFe
(
£lf
, 
cÚfigfe
=
NÚe
):

395 
Œy
:

396 #f
©Œibu‹


397 
feİ
 = 
	$FeO³¿tÜ
(
cÚfigfe
)

398 
feİ
.
	$acûssExi¡s
(è
is
 
F®£
:

399 
£lf
.
	`wr™eLog
(
WARNING
, 'Ãw f’am% nÙƒxi¡s'%(
cÚfigfe
))

400  
F®£


401 
feİ
.
	$acûssR—d
(
£lf
è
is
 
F®£
:

402  
F®£


403 #»ad 
logg”
 
äom
 
cÚfigu»
 
fe


404 
loggšg
.
cÚfig
.
	$feCÚfig
(
cÚfigfe
)

405 
exû±
 
Exû±iÚ
,
e
:

406 
·ss


407 
£lf
.
_deçuÉ
.
	`wr™eExû±iÚ
('\nlogFileConfig:')

409 #»£ˆ
®l
 
logg”
 
about
 
fe
 
cÚfigu»


410 
£lf
.
	$_š™Logg”
()

411 #modify 
£lf
.
_cÚfigfe
 
vauË


412 
£lf
.
_cÚfigfe
 = 
cÚfigfe


413 #»-
li¡’
 
log
 
cÚfigu»


414 
£lf
.
	$´eUpd©eLogCÚfig
()

416 
def
 
	$´eUpd©eLogCÚfig
(
£lf
, 
pÜt
=
DEFAULT_CONFIG_PORT
):

418 
Œy
:

419 
£lf
.
_cÚfigLi¡’
 = 
loggšg
.
cÚfig
.
	$li¡’
(
pÜt
)

420 
£lf
.
_cÚfigLi¡’
.
	$¡¬t
()

421 
exû±
 
Exû±iÚ
,
e
:

422 
£lf
.
	`wr™eExû±iÚ
('\npreUpdateLogConfig:')

423 
ex™
 -1

425 
def
 
	$ş—rUpd©eLogCÚfig
(
£lf
):

427 
£lf
.
_cÚfigLi¡’
 
is
 
nÙ
 
NÚe
:

428 
loggšg
.
cÚfig
.
	$¡İLi¡’šg
()

429 
£lf
.
_cÚfigLi¡’
.
	$još
()

431 
def
 
	$_g‘Logg”
(
£lf
):

434 #šfØ
logg”


435 
£lf
.
_šfo
 = 
loggšg
.
	`g‘Logg”
(£lf.
_logg”Diù
['info'][0])

436 #”rÜ 
logg”


437 
£lf
.
_”rÜ
 = 
loggšg
.
	`g‘Logg”
(£lf.
_logg”Diù
['error'][0])

439 
def
 
	$_š™Logg”
(
£lf
):

442 #šfØ
logg”


443 
£lf
.
_šfo
 = 
loggšg
.
	`g‘Logg”
(£lf.
_logg”Diù
['info'][0])

444 #”rÜ 
logg”


445 
£lf
.
_”rÜ
 = 
loggšg
.
	`g‘Logg”
(£lf.
_logg”Diù
['error'][0])

446 #£ˆ
®l
  
logg”
 
Ëv–


447 #@ä¸ºäº†ä¿è¯ä¸å¹²æ‰°
hªdËrs
çš„è¿‡æ»¤çº§åˆ«ï¼Œå…³é—­ç»§æ‰¿å¹¶é‡ç½®
logg”
è¿‡æ»¤çº§åˆ«

448 #@å¦‚æœæœªè®¾ç½®
logg”
è¿‡æ»¤çº§åˆ«ï¼Œé»˜è®¤ä¸º
WARNING


449 
£lf
.
_šfo
.
´İag©e
 = 0

450 
£lf
.
_”rÜ
.
´İag©e
 = 0

451 
£lf
.
_šfo
.
	$£tLev–
(
loggšg
.
DEBUG
)

452 
£lf
.
_”rÜ
.
	$£tLev–
(
loggšg
.
ERROR
)

454 
def
 
	$_£tHªdËr
(
£lf
, 
hªdËrs
=[]):

457 #g’”©
fÜm©


458 
fm
 = 
loggšg
.
	`FÜm©‹r
('defaultLog: %(asctime)s-%(name)s-%(filename)s[line:%(lineno)d]-%(levelname)s-%(message)s')

460 
£lf
.
_hcÚsŞe
 = 
loggšg
.
	$SŒ—mHªdËr
()

461 
£lf
.
_hcÚsŞe
.
	$£tFÜm©‹r
(
fm
)

462 
£lf
.
_hcÚsŞe
.
	$£tLev–
(
loggšg
.
WARNING
)

463 #commÚ 
fe


464 
£lf
.
_hfe
 = 
loggšg
.
	$FeHªdËr
(
INFO_LOG
)

465 
£lf
.
_hfe
.
	$£tFÜm©‹r
(
fm
)

466 
£lf
.
_hfe
.
	$£tLev–
(
loggšg
.
INFO
)

467 #unix 
sock‘


468 
£lf
.
_hunix
 = 
	$UnixSock‘HªdËr
(
DEFAULT_UNIX_SERVER
)

469 
£lf
.
_hunix
.
	$£tFÜm©‹r
(
fm
)

470 
£lf
.
_hunix
.
	$£tLev–
(
loggšg
.
INFO
)

471 #tı 
sock‘


472 
£lf
.
_htı
 = 
loggšg
.
hªdËrs
.
	$Sock‘HªdËr
(
DEFAULT_SOCKET_SERVER
, 
DEFAULT_SOCKET_PORT
)

473 
£lf
.
_htı
.
	$£tFÜm©‹r
(
fm
)

474 
£lf
.
_hunix
.
	$£tLev–
(
loggšg
.
INFO
)

477 
£lf
.
_hecÚsŞe
 = 
loggšg
.
	$SŒ—mHªdËr
()

478 
£lf
.
_hecÚsŞe
.
	$£tFÜm©‹r
(
fm
)

479 
£lf
.
_hecÚsŞe
.
	$£tLev–
(
loggšg
.
ERROR
)

480 #commÚ 
fe


481 
£lf
.
_hefe
 = 
loggšg
.
	$FeHªdËr
(
ERROR_LOG
)

482 
£lf
.
_hefe
.
	$£tFÜm©‹r
(
fm
)

483 
£lf
.
_hefe
.
	$£tLev–
(
loggšg
.
ERROR
)

484 #unix 
sock‘


485 
£lf
.
_heunix
 = 
	$UnixSock‘HªdËr
(
DEFAULT_UNIX_SERVER
)

486 
£lf
.
_heunix
.
	$£tFÜm©‹r
(
fm
)

487 
£lf
.
_heunix
.
	$£tLev–
(
loggšg
.
ERROR
)

488 #tı 
sock‘


489 
£lf
.
_h‘ı
 = 
loggšg
.
hªdËrs
.
	$Sock‘HªdËr
(
DEFAULT_SOCKET_SERVER
, 
DEFAULT_SOCKET_PORT
)

490 
£lf
.
_h‘ı
.
	$£tFÜm©‹r
(
fm
)

491 
£lf
.
_heunix
.
	$£tLev–
(
loggšg
.
ERROR
)

493 #add 
hªdËr
 
to
 
logg”


494 
™
 
š
 
£lf
.
_logg”Diù
['info'][1]:

495 
£lf
.
_šfo
.
	`addHªdËr
(
	$g‘©Œ
(
£lf
, 
™
))

496 
™
 
š
 
£lf
.
_logg”Diù
['error'][1]:

497 
£lf
.
_”rÜ
.
	`addHªdËr
(
	$g‘©Œ
(
£lf
, 
™
))

499 
def
 
	`wr™eLog
(
£lf
, 
Ëv–
=
DEBUG
, 
msg
=''):

501 
Œy
:

502 
lg
 
š
 
£lf
.
_logg”Li¡
:

503 
x
 = 
	$g‘©Œ
(
£lf
, 
lg
)

504 #æ‰“å°
hªdËrs
å’Œæ‹¥æœ‰çš„è¿‡æ»¤çº§åˆ«

505 #´šˆ
lg
, '+++', 
Ëv–
, '+++', 
x
.
hªdËrs
, '+++',x.
	`g‘EfãùiveLev–
()

506 
x
.
	$log
(
Ëv–
, 
msg
)

507 
exû±
 
Exû±iÚ
,
e
:

508 
¿i£


509 #şo£ 
fe
 
cÚfigu»
 
li¡’
, åæœŸä¼šåˆ é™¤ï¼Œè¿™é‡Œæœ‰é€»è¾‘é—®é¢˜

510 
£lf
.
	$ş—rUpd©eLogCÚfig
()

512 
def
 
	`wr™eExû±iÚ
(
£lf
, 
msg
, 
¬g
=''):

514 
Œy
:

515 
lg
 
š
 
£lf
.
_logg”Li¡
:

516 
	`g‘©Œ
(
£lf
, 
lg
).
	$exû±iÚ
(
msg
, 
¬g
)

517 
exû±
 
Exû±iÚ
,
e
:

518 
£lf
.
_deçuÉ
.
	`wr™eExû±iÚ
('\nwriteLog:')

519 #şo£ 
fe
 
cÚfigu»
 
li¡’
, åæœŸä¼šåˆ é™¤ï¼Œè¿™é‡Œæœ‰é€»è¾‘é—®é¢˜

520 
£lf
.
	$ş—rUpd©eLogCÚfig
()

522 
def
 
	$wr™eLogByLogg”
(
£lf
, 
Ëv–
, 
msg
, 
ty³
=[]):

524 
Œy
:

525 
t
 
š
 
ty³
:

526 
	`g‘©Œ
(
£lf
, s–f.
_logg”Li¡
[
t
]).
	$log
(
Ëv–
, 
msg
)

527 
exû±
 
Exû±iÚ
,
e
:

528 
£lf
.
_deçuÉ
.
	`wr™eExû±iÚ
('\nwriteLogByLogger:')

529 #şo£ 
fe
 
cÚfigu»
 
li¡’
, åæœŸä¼šåˆ é™¤ï¼Œè¿™é‡Œæœ‰é€»è¾‘é—®é¢˜

530 
£lf
.
	$ş—rUpd©eLogCÚfig
()

532 #glob® 
log
 
v¬ŸbËs


533 
glob®Log
 = 
	$OssLog
(
F®£
)

534 ## 
Drive
 
‹¡


535 
__Çme__
 == '__main__':

537 
maš
 
‹¡


540 ä¹™ï¼Œé»˜è®¤çš„æ—¥å¿—é…ç½®è¾“å‡º:ä»
cÚdLog
.
cÚf
ä¸­è¯»å–çš„é»˜è®¤æ—¥å¿—é…ç½®

541 ä¸™ï¼Œç®¡ç†å‘˜åœ¨æ›´æ–°
cÚdLog
.
cÚf
ä¹‹åï¼Œè§¦å‘çš„æ—¥å¿—é…ç½®æ›´æ–°

543 
äom
 
sh™log
 
impÜt
 
CRITICAL
,
FATAL
,
ERROR
,
WARNING
,
WARN
,
INFO
,
DEBUG
,
NOTSET
,
debug


544 
äom
 
sh™log
 
impÜt
 
OssLog


545 
äom
 
sh™log
 
impÜt
 
glob®Log


547 
glob®Log
.
	`wr™eLog
(
INFO
, 'Test for†og.....................')

549 #fd = 
	`İ’
(
INFO_LOG
, 'w')

550 #fd.
	`şo£
()

551 #fd = 
	`İ’
(
ERROR_LOG
, 'w')

552 #fd.
	`şo£
()

553 #fd = 
	`İ’
(
PRE_DEFAULT_LOG
, 'w')

554 #fd.
	`şo£
()

562 #ç»ˆç«¯ï¼š
w¬šg
ä»¥ä¸Šçº§åˆ«

563 #æ–‡ä»¶ï¼š
šfo
ä»¥ä¸Šçº§åˆ«

565 #ç»ˆç«¯ä¸Šï¼šè¾“å‡º
w¬nšg
/
”rÜ
çº§åˆ«ä¿¡æ¯, 
dl
ä¸Šçš„æŠ¥é”™ä¿¡æ¯

567 #šfo.
log
è¾“å‡º
šfo
/
w¬nšg
/
”rÜ
çº§åˆ«ä¿¡æ¯

568 #”rÜ.
log
è¾“å‡º
”rÜ
çº§åˆ«ä¿¡æ¯

570 #bak = 
DEFAULT_CONF_BAK
+'xx'

571 #os.
	`»Çme
(
DEFAULT_CONF_BAK
, 
bak
)

574 #ià
os
.
·th
.
	`exi¡s
(
DEFAULT_CONF
):

575 #os.
	`»move
(
DEFAULT_CONF
)

576 #sh™log = 
	`OssLog
(
F®£
)

578 #sh™log.
	`wr™eLog
(
INFO
, 'Info111 msg')

579 #sh™log.
	`wr™eLog
(
WARNING
, 'warning111 msg')

580 #sh™log.
	`wr™eLog
(
ERROR
, 'error111 msg')

581 #exû± 
Exû±iÚ
,
e
:

582 #´šˆ
e


583 #loggšg.
	`di§bË
(
loggšg
.
NOTSET
)

590 #é»˜è®¤çš„æ—¥å¿—é…ç½®æ–‡ä»¶ï¼š
$PATH_XX
/
cÚdLog
.
cÚf


593 #æ–‡ä»¶ï¼š
INFO


596 #æ–‡ä»¶
šfo
.
log
ä¸­è¾“å‡ºšfo/
w¬nšg
/
”rÜ


597 #æ–‡ä»¶
”rÜ
.
log
ä¸­è¾“å‡ºä¸€æ¡é”™è¯¯æ—¥å¿—

599 #os.
	`»Çme
(
bak
, 
DEFAULT_CONF_BAK
)

601 #sh™log = 
	`OssLog
()

603 #sh™log.
	`wr™eLog
(
INFO
, 'Info2222 msg')

604 #sh™log.
	`wr™eLog
(
WARNING
, 'warning2222 msg')

605 #sh™log.
	`wr™eLog
(
ERROR
, 'error2222 msg')

606 #exû± 
Exû±iÚ
,
e
:

607 #´šˆ
e


614 #1ï¼Œæ›´æ–°çš„æ—¥å¿—é…ç½®æ–‡ä»¶ï¼š
$PATH_XX
/
cÚdLog
.
cÚf


618 #os.
	`»move
(
DEFAULT_CONF
)

	@/root/grocery-shop/language/python/regexOperator/regexTest.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
os


4 
impÜt
 
sys


5 
impÜt
 
»


7 
şass
 
	$RegexTe¡
(
objeù
):

9 
def
 
	$__š™__
(
£lf
):

10 
·ss


12 
def
 
	$»gex_‹¡_1
(
£lf
):

13 
·‰”n
 = 
»
.
	`compe
(
r
"hello")

14 
m©ch
 = 
·‰”n
.
	`m©ch
('hello world')

15 
m©ch
:

16 
´št
 
m©ch
.
	$group
()

17 
´št
 
m©ch
.
¡ršg


18 
´št
 
m©ch
.
»


19 
´št
 
m©ch
.
pos


20 
´št
 
m©ch
.
’dpos


21 
´št
 
m©ch
.
	$¡¬t
()

22 
´št
 
m©ch
.
	$’d
()

23 
´št
 "======================================"

25 
def
 
	$»gex_‹¡_2
(
£lf
):

26 #\
w
åŒ¹é…å•è¯å­—ç¬¦

27 
p
 = 
»
.
	`compe
(
r
'(\w+) (\w+)')

28 
s
 = 'i say, hello world!'

30 
´št
 
p
.
	`sub
(
r
'\2 \1', 
s
)

32 
def
 
	$func
(
m
):

33  
m
.
	`group
(1).
	`t™Ë
(è+ '(funùiÚ)' + m.group(2).
	$t™Ë
()

34 
´št
 
p
.
	$sub
(
func
, 
s
)

35 ###ouuˆ###
#§y 
i
, 
wÜld
 
h–lo
!

36 #I 
Say
, 
H–lo
 
WÜld
!

37 
´št
 "======================================"

40 
def
 
	$maš
():

42 
»gexTe¡
 = 
	$RegexTe¡
()

43 
»gexTe¡
.
	$»gex_‹¡_1
()

44 
»gexTe¡
.
	$»gex_‹¡_2
()

46 
__Çme__
 == "__main__":

48 
	`maš
()

	@/root/grocery-shop/language/python/setuptool/basepackage/__init__.py

	@/root/grocery-shop/language/python/setuptool/basepackage/baseconfig.py

	@/root/grocery-shop/language/python/setuptool/basepackage/baselog.py

	@/root/grocery-shop/language/python/setuptool/basepackage/test/__init__.py

	@/root/grocery-shop/language/python/setuptool/build/lib/basepackage/__init__.py

	@/root/grocery-shop/language/python/setuptool/build/lib/basepackage/baseconfig.py

	@/root/grocery-shop/language/python/setuptool/build/lib/basepackage/baselog.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-8

4 
def
 
	$bamboo
():

6 
´št
 'Good Night.'

	@/root/grocery-shop/language/python/setuptool/build/lib/basepackage/test/__init__.py

	@/root/grocery-shop/language/python/setuptool/setup.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-8

3 
impÜt
 
»


4 
impÜt
 
sys


5 
impÜt
 
os


6 
impÜt
 
¡©


7 
impÜt
 
shut


8 
	gŒy
:

9 #äom 
£tu±oŞs
 
impÜt
 
£tup
, 
fšd_·ckages


10 
äom
 
£tu±oŞs
 
impÜt
 
£tup


11 
exû±
 
	gImpÜtE¼Ü
:

12 
äom
 
di¡uts
.
cÜe
 
impÜt
 
£tup


15 
DATADIR
 = "/data/test1"

16 
LOGDIR
 = "/data/logs/test1"

17 
CONFDIR
 = "/data/conf/test1"

20 
def
 
	$š™CÚfEnv
():

23 
cÚf
 = 'conf/basepackage.ini'

24 
w™h
 
	`İ’
(
cÚf
, 'r'è
as
 
f
:

25 
ŞdSŒ
 = 
f
.
	$»ad
()

26 
w™h
 
	`İ’
(
cÚf
, 'w'è
as
 
f
:

27 
f
.
	`wr™e
(
»
.
	`sub
("\ndata=.*?\n",

28 "\nd©a={0}\n".
	`fÜm©
(
DATADIR
), 
ŞdSŒ
))

31 
cÚf
 = 'conf/basepackage.ini'

32 
w™h
 
	`İ’
(
cÚf
, 'r'è
as
 
f
:

33 
ŞdSŒ
 = 
f
.
	$»ad
()

34 
w™h
 
	`İ’
(
cÚf
, 'w'è
as
 
f
:

35 
f
.
	`wr™e
(
»
.
	`sub
("\nlogs=.*?\n",

36 "\Æogs={0}\n".
	`fÜm©
(
LOGDIR
), 
ŞdSŒ
))

39 
cÚf
 = 'basepackage/baseconfig.py'

40 
w™h
 
	`İ’
(
cÚf
, 'r'è
as
 
f
:

41 
ŞdSŒ
 = 
f
.
	$»ad
()

42 
w™h
 
	`İ’
(
cÚf
, 'w'è
as
 
f
:

43 
f
.
	`wr™e
(
»
.
	`sub
("\nCONF_DIR.*basepackage.ini\"?\n",

45 "\"\n".
	`fÜm©
(
CONFDIR
), 
ŞdSŒ
))

48 
def
 
	$mkdœDœ
():

51 
nÙ
 
os
.
·th
.
	$isdœ
(
CONFDIR
):

52 
os
.
	$makedœs
(
CONFDIR
)

54 #modify 
fe
 
authÜ™y


55 
Œy
:

56 
os
.
	`chmod
(
CONFDIR
, 
¡©
.
S_IRWXU
 | st.
S_IRWXG
 | st.
S_IRWXO
)

57 
exû±
 
Exû±iÚ
, 
msg
:

58 
sys
.
¡d”r
.
	`wr™e
('User does‚ot have '

59 'modify…”missiÚs, msg:%s\n' % 
msg
)

62 
def
 
	$cİyCÚf
():

65 
cÚf
 = "conf/basepackage.ini"

66 
nÙ
 
os
.
·th
.
	$exi¡s
(
cÚf
):

67 
sys
.
¡d”r
.
	`wr™e
("NÙexi¡ cÚfigu» %s.\n" % 
cÚf
)

68 
sys
.
	`ex™
(-1)

69 
shut
.
	`cİy
(
cÚf
, 
CONFDIR
 + "/")

72 
cÚf
 = "conf/kafka.ini"

73 
nÙ
 
os
.
·th
.
	$exi¡s
(
cÚf
):

74 
sys
.
¡d”r
.
	`wr™e
("NÙexi¡ cÚfigu» %s.\n" % 
cÚf
)

75 
sys
.
	`ex™
(-1)

76 
shut
.
	`cİy
(
cÚf
, 
CONFDIR
 + "/")

79 
def
 
	$maš
():

81 
Œy
:

82 
	$š™CÚfEnv
()

83 
	$mkdœDœ
()

84 
	$cİyCÚf
()

85 
exû±
 
Exû±iÚ
, 
msg
:

86 
sys
.
¡d”r
.
	`wr™e
("Occu¸”rÜ, msg:{0}.\n".
	$fÜm©
(
msg
))

87 
sys
.
	`ex™
(-1)

89 
	$maš
()

91 #
#è°ƒç”¨ä»£ç ï¼š/
u¤
/
loÿl
/
pythÚ
/
lib
/
pythÚ2
.7/
di¡uts
/
cÜe
.
py


92 #è°ƒè¯•ï¼šè®¾ç½®
DISTUTILS_DEBUG
ç¯å¢ƒå˜é‡ï¼Œä»»ä½•å€¼ï¼ˆé™¤äº†ç©ºï¼‰

94 #1ï¼Œ
·ckages
æˆ–è€…
py_moduËs
æŒ‡å®šçš„æºç æ–‡ä»¶

95 #2ï¼Œ
lib¿r›s
æˆ–è€…
ext_moduËs
æŒ‡å®šçš„
C
æ–‡ä»¶

96 #3ï¼Œ
süts
æŒ‡å®šçš„è„šæœ¬æ–‡ä»¶

97 #4ï¼Œ
‹¡
/‹¡*.
py
æ–‡ä»¶

98 #5ï¼Œ
README
ä»¥åŠ
£tup
.
py
,£tup.
cfg
æ–‡ä»¶

99 #6ï¼Œ
·ckage_d©a
ä»¥åŠ
d©a_fes
æŒ‡å®šçš„æ–‡ä»¶

100 #7ï¼Œ
MANIFEST
.
š
æ–‡ä»¶æŒ‡å®šçš„æ–‡ä»¶(ä¸æ˜¯
mašã¡
ï¼Œè€Œæ˜¯
mªiã¡
)

104 #£tupsüt.
html
?
highlight
=
di¡uts_debug


105 #
 = [

110 
	`£tup
(

112 
Çme
="basepackage",

115 
v”siÚ
="0.1",

117 #åŠŸèƒ½ï¼šå‘ŠçŸ¥
£tu±oŞs
è¦å¤„ç†é‚£äº›åŒ…ï¼Œä¾‹å¦‚

119 #'
ba£·ckage
',

120 #'
ba£·ckage
.
‹¡
',

121 #'
ba£·ckage
.
s1
',

124 #é¦–å‚æ•°ï¼šä¸€èˆ¬ä¸ºç©ºï¼Œå¯ä»¥ç”¨äºæŒ‡å®š
sourû
 
dœeùÜy
æˆ–è€…
roÙ
 
dœ


125 #æ­¤æ—¶éœ€è¦
·ckages_dœ
æ¥åˆä½œå®Œæˆ

128 #1,ç®€å•--å¦‚æœæœªåšä»»ä½•åµŒå…¥å‚æ•°ï¼šé»˜è®¤ä¸º
Çme
å­—æ®µæŒ‡å®šçš„åŒåç›®å½•

129 #2,å¤æ‚--æŒ‡å®š
·ckages
è·¯å¾„ï¼Œæ­¤æ—¶éœ€è¦
·ckage_dœ
é…åˆ

130 #PS:å‡½æ•°è¿”å›ä¸€ä¸ª
·ckages
åˆ—è¡¨ï¼Œä»¥ä¾›
£tup
è¿›è¡Œæ‰“åŒ…-----

132 #å…¶ä¸­æ‰€æœ‰ç›®å½•ä¸‹å¿…é¡»å­˜åœ¨
__š™__
.
py
æ–‡ä»¶

133 #·ckages=
	`fšd_·ckages
('src'),

134 #·ckages=
	`fšd_·ckages
(),

135 
·ckages
=packages,

138 #1,å‘ŠçŸ¥
£tu±oŞs
æ ¹ç›®å½•ï¼Œæ­¤æ—¶å¿…é¡»è®¾ç½®è¯¥å€¼

139 #2,æ­¤æ—¶æ‰€æœ‰çš„
·ckages
è·¯å¾„åº”è¯¥æ˜¯ï¼š

141 #'
¤c
/
ba£·ckage
',

142 #'
¤c
/
ba£·ckage
.
‹¡
',

143 #'
¤c
/
ba£·ckage
.
s1
',

145 #å½“ç„¶ï¼Œ
fšd_·ckages
ä¼šå¸®ä½ å¯»æ‰¾åˆ°æ‰€æœ‰ç¬¦åˆè¦æ±‚çš„è·¯å¾„

146 #3,å¦‚æœä½¿ç”¨{'ba£·ckage': '¤c'
	}
}ï¼Œåˆ™é»˜è®¤ä¸è¿›è¡Œé€’å½’æŸ¥æ‰¾ï¼Œæ‰€æœ‰çš„

147 #å­ç›®å½•éƒ½å¿…é¡»åœ¨
·ckages
ä¸­æŒ‡å®šæ‰å¯ä»¥

148 #
#
_dœ={'ba£·ckage': 'ba£·ckage'},

158 #1ï¼Œè®¾ç½®äº†
šşude_·ckage_d©a
ï¼Œå°±æ²¡æœ‰å¿…è¦è®¾ç½®è¯¥é¡¹çš„å€¼(ä¸ä¸€å®š)ï¼Œ

160 #'': ['*.
txt
']ï¼Œ ä»»ä½•åŒ…ä¸‹é¢çš„æ‰€æœ‰.txtæ–‡ä»¶

161 #'
cÚf
': ['conf

	@/root/grocery-shop/language/python/signal/partialTest.py

1 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


2 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime
,
timed–


4 
def
 
	$G‘NextDay
(
ba£day
,
n
):

5  
	`¡r
((
d©‘ime
.
	`¡½time
(¡r(
ba£day
),

6 '%Y-%m-%d')+
	`timed–
(
days
=
n
)).
	$d©e
())

9 
nday
 = 
	`·¹Ÿl
(
G‘NextDay
, '2015-01-01')

10 
´št
 
	$nday
(1)

11 
´št
 
	`nday
(3)

	@/root/grocery-shop/language/python/signal/simpleTest.py

1 #codšg:
utf
-
job


2 #/
u¤
/
bš
/
pythÚ


3 
impÜt
 
time


4 
impÜt
 
sigÇl


5 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


7 
	gg_qu™_æag
 = 1

8 
def
 
	$commÚ_cb
(
signum
, 
äame
):

10 
glob®
 
g_qu™_æag


11 
´št
 
signum
, '--', 
äame


12 
g_qu™_æag
 = 0

14 
def
 
	$·¹Ÿl_cb
(
msg
, 
signum
, 
äame
):

16 
´št
 'msg:', 
	$¡r
(
msg
)

17 
´št
 'signum:', 
signum


18 
´št
 'äame:', 
äame


22 
def
 
	$maš
():

24 
li¡1
 = ['1']

25 
sigÇl
.
	$sigÇl
(
sigÇl
.
SIGINT
, 
commÚ_cb
)

26 
sigÇl
.
	`sigÇl
(sigÇl.
SIGHUP
, 
	$·¹Ÿl
(
·¹Ÿl_cb
, 
li¡1
))

27 
li¡1
.
	`­³nd
('3')

28 
g_qu™_æag
:

29 
´št
 'xx'

30 
time
.
	$¦“p
(2)

32 
__Çme__
 == '__main__':

34 
	`maš
()

	@/root/grocery-shop/language/python/signal/timesleep.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
os


4 
impÜt
 
sys


5 
impÜt
 
time


6 
impÜt
 
©ex™


7 
impÜt
 
time


8 
impÜt
 
sigÇl


9 
äom
 
sigÇl
 
impÜt
 
SIGTERM


11 
	gdœ·th
 = 
os
.
g‘cwd
() + "/../"

12 
sys
.
·th
.
	$­³nd
(
dœ·th
)

14 
äom
 
ba£·ckage
.
ba£log
 
impÜt
 
glob®Log


15 
äom
 
ba£·ckage
.
ba£cÚfig
 
impÜt
 
AGENT_PID


17 
şass
 
	$D«mÚ
(
objeù
):

19 
A
 
g’”ic
 
d«mÚ
 
şass
.

21 
U§ge
: 
subşass
 
the
 
D«mÚ
 
şass
 
ªd
 
ov”ride
h
	$run
(è
m‘hod


23 
def
 
	`__š™__
(
£lf
, 
pidfe
=
AGENT_PID
, 
¡dš
='/dev/nuÎ', 
¡dout
='/dev/nuÎ', 
¡d”r
='/dev/null'):

24 
£lf
.
¡dš
 = stdin

25 
£lf
.
¡dout
 = stdout

26 
£lf
.
¡d”r
 = stderr

27 
£lf
.
pidfe
 =…idfile

29 
def
 
	$d«mÚize
(
£lf
):

31 dØ
the
 
UNIX
 -
fÜk
 
magic
, 
£e
 
S‹v’s
' "Advanced

32 
Prog¿mmšg
 
š
 
the
 
UNIX
 
EnvœÚm’t
" for details (ISBN 0201563177)

34 #dØ
fœ¡
 
fÜk


35 
Œy
:

36 
pid
 = 
os
.
	$fÜk
()

37 
pid
 > 0:

38 
sys
.
	$ex™
(0)

39 
exû±
 
OSE¼Ü
, 
e
:

40 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
,

41 "fÜk #1 faed: %d (%s)\n" % (
e
.
”ºo
,ƒ.
¡»¼Ü
))

42 
sys
.
	$ex™
(1)

44 #decou¶
äom
 
·»Á
 
’vœÚm’t


45 
os
.
	`chdœ
("/")

46 
os
.
	$£tsid
()

47 
os
.
	$umask
(0)

49 #dØ
£cÚd
 
fÜk


50 
Œy
:

51 
pid
 = 
os
.
	$fÜk
()

52 
pid
 > 0:

53 
sys
.
	$ex™
(0)

54 
exû±
 
OSE¼Ü
, 
e
:

55 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
,

56 "fÜk #2 faed: %d (%s)\n" % (
e
.
”ºo
,ƒ.
¡»¼Ü
))

57 
sys
.
	$ex™
(1)

59 #»dœeù 
¡ªd¬d
 
fe
 
desütÜs


60 
sys
.
¡dout
.
	$æush
()

61 
sys
.
¡d”r
.
	$æush
()

62 
si
 = 
	`fe
(
£lf
.
¡dš
, 'r')

63 
so
 = 
	`fe
(
£lf
.
¡dout
, 'a+')

64 
£
 = 
	`fe
(
£lf
.
¡d”r
, 'a+', 0)

65 
os
.
	`dup2
(
si
.
	`f’o
(), 
sys
.
¡dš
.
	$f’o
())

66 
os
.
	`dup2
(
so
.
	`f’o
(), 
sys
.
¡dout
.
	$f’o
())

67 
os
.
	`dup2
(
£
.
	`f’o
(), 
sys
.
¡d”r
.
	$f’o
())

69 #»gi¡»m 
de¡ruùÜ
 
funùiÚ


70 
©ex™
.(
£lf
.
d–pid
)

71 #wr™
pidfe


72 
Œy
:

73 
fd
 = 
	`İ’
(
£lf
.
pidfe
, 'w+')

74 
fd
.
	`wr™e
('%s\n'%(
	`¡r
(
os
.
	$g‘pid
())))

75 
fd
.
	$şo£
()

76 
exû±
 
IOE¼Ü
,
msg
:

77 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, "%s:İ’…idfçed."%
msg
)

78 
sys
.
	$ex™
(1)

80 
def
 
	$__d–__
(
£lf
):

82 
·ss


84 
def
 
	$sigIÁ
(
£lf
, 
signum
, 
äame
):

86 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, "Receive SIGINT,ƒixt…rocess")

87 #os.
	`kl
(
os
.
	`g‘pid
(), 
sigÇl
.
SIGTERM
)

89 
def
 
	$d–pid
(
£lf
):

91 
os
.
	$»move
(
£lf
.
pidfe
)

93 
def
 
	$debug
(
£lf
):

95 #sigÇl.
	`sigÇl
(
sigÇl
.
SIGINT
, 
£lf
.
sigIÁ
)

96 
£lf
.
	$run
()

98 
def
 
	$¡¬t
(
£lf
):

100 
S¹
 
the
 
d«mÚ


102 #Check 
a
 
pidfe
 
to
 
£e
 
the
 
d«mÚ
 
®»ady
 
runs


103 
Œy
:

104 
pf
 = 
	`fe
(
£lf
.
pidfe
,'r')

105 
pid
 = (
pf
.
	`»ad
().
	$¡r
())

106 
pf
.
	$şo£
()

107 
exû±
 
IOE¼Ü
:

108 
pid
 = 
NÚe


110 #exi¡ed 
d«mÚ
 
´oûss
, 
qu™


111 
pid
:

112 
mes§ge
 = "pidfile %s‡lreadyƒxist. Daemon‡lready„unning?\n"

113 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, 
mes§ge
 % 
£lf
.
pidfe
)

114 
sys
.
	$ex™
(1)

116 #S¹ 
the
 
d«mÚ


117 
£lf
.
	$d«mÚize
()

119 
£lf
.
	$run
()

121 
def
 
	$¡İ
(
£lf
):

123 
Stİ
 
the
 
d«mÚ


125 #G‘ 
the
 
pid
 
äom
h
pidfe


126 
Œy
:

127 
pf
 = 
	`fe
(
£lf
.
pidfe
,'r')

128 
pid
 = (
pf
.
	`»ad
().
	$¡r
())

129 
pf
.
	$şo£
()

130 
exû±
 
IOE¼Ü
:

131 
pid
 = 
NÚe


133 
nÙ
 
pid
:

134 
mes§ge
 = "pidfile %s does‚otƒxist. Daemon‚ot„unning?\n"

135 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, 
mes§ge
 % 
£lf
.
pidfe
)

136  #nÙ 
ª
 
”rÜ
 
š
 
a
 
»¡¬t


138 #Try 
klšg
 
the
 
d«mÚ
 
´oûss


139 
Œy
:

141 
os
.
	$kl
(
pid
, 
SIGTERM
)

142 
time
.
	$¦“p
(0.1)

143 
exû±
 
OSE¼Ü
, 
”r
:

144 
”r
 = 
	$¡r
(
”r
)

145 
”r
.
	`fšd
("No such…rocess") > 0:

146 
os
.
·th
.
	$exi¡s
(
£lf
.
pidfe
):

147 
os
.
	$»move
(
£lf
.
pidfe
)

149 
glob®Log
.
	`g‘E¼Ü
().
	`log
(glob®Log.
ERROR
, 'D«mÚ stİ:%s'%
”r
)

150 
sys
.
	$ex™
(1)

152 
def
 
	$»¡¬t
(
£lf
):

154 
Re¡¬t
 
the
 
d«mÚ


156 
£lf
.
	$¡İ
()

157 
£lf
.
	$¡¬t
()

159 
def
 
	$run
(
£lf
):

161 
You
 
should
 
ov”ride
 
this
 
m‘hod
 
wh’
 
you
 
subşass
 
D«mÚ
.

162 
It
 
wl
 
be
 
ÿÎed
 
aá”
 
the
 
´oûss
 
has
 
b“n


163 
d«mÚized
 
by
 
	$¡¬t
(è
Ü
 
	`»¡¬t
().

165 
·ss


167 
şass
 
	$timeSË•
(
D«mÚ
):

168 
def
 
	$run
(
£lf
):

169 
MAXVAL
 = 10000

170 
STEP_INTERVAL
 = 10

172 
True
:

173 
i
 
š
 
	$¿nge
(1, 
MAXVAL
, 
STEP_INTERVAL
):

174 
Œy
:

175 
time
.
	$¦“p
(60)

176 
exû±
 
KeybßrdIÁ”ru±
:

177 
´št
 'Interrupt'

180 
´št
 "done"

182 
__Çme__
 == '__main__':

184 
timeobjeù
 = 
	$timeSË•
()

185 
timeobjeù
.
	`debug
()

	@/root/grocery-shop/language/python/socket/baseHttpServer.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
äom
 
Ba£HTTPS”v”
 
impÜt
 
	gBa£HTTPReque¡HªdËr
 #Ba£HTTPReque¡HªdËrç±»ç»†åˆ†åˆ°å¤„ç†æ¯ä¸ªåè®®çš„æ–¹æ³•ï¼Œè¿™é‡Œæ˜¯â€˜
	gGET
â€™æ–¹æ³•çš„ä¾‹å­

4 
impÜt
 
u¾·r£


8 
şass
 
	$G‘HªdËr
(
Ba£HTTPReque¡HªdËr
):

9 
def
 
	$do_GET
(
£lf
): #é‡å†™è¿™ä¸ªæ–¹æ³•

10 #impÜˆ
pdb


11 #pdb.
	`£t_Œaû
()

12 
·r£d_·th
 = 
u¾·r£
.
	$u¾·r£
(
£lf
.
·th
)

13 
´št
 "============================================="

14 
´št
 
·r£d_·th


15 
´št
 
	$ty³
(
·r£d_·th
)

16 
´št
 
·r£d_·th
.
qu”y


17 
´št
 "============================================="

18 
mes§ge_·¹s
 = [ #å»ºç«‹ä¸€ä¸ªæƒ³è¦è¿”å›çš„åˆ—è¡¨

20 'ş›Á_add»ss=% (%s)' % (
£lf
.
ş›Á_add»ss
,

21 
£lf
.
	`add»ss_¡ršg
()), #è¿”å›å®¢æˆ·ç«¯çš„åœ°å€å’Œç«¯å£

22 'commªd=%s' % 
£lf
.
commªd
, #è¿”å›æ“ä½œçš„å‘½ä»¤ï¼Œè¿™é‡Œæ¯”ç„¶æ˜¯'get'

23 '·th=%s' % 
£lf
.
·th
, #è¿”å›è¯·æ±‚çš„è·¯å¾„

24 '»®…©h=%s' % 
·r£d_·th
.
·th
, #è¿”å›é€šè¿‡
u¾·r£
æ ¼å¼åŒ–çš„è·¯å¾„

25 'qu”y=%s' % 
·r£d_·th
.
qu”y
, #è¿”å›
u¾·r£
æ ¼å¼åŒ–çš„æŸ¥è¯¢è¯­å¥çš„é”®å€¼

26 '»que¡_v”siÚ=%s' % 
£lf
.
»que¡_v”siÚ
, #è¿”å›è¯·æ±‚çš„
h‰p
åè®®ç‰ˆæœ¬å·

29 '£rv”_v”siÚ=%s' % 
£lf
.
£rv”_v”siÚ
, #è¿”å›æœåŠ¡å™¨ç«¯
h‰p
çš„ä¿¡æ¯

30 'sys_v”siÚ=%s' % 
£lf
.
sys_v”siÚ
, #è¿”å›æœåŠ¡å™¨ç«¯ä½¿ç”¨çš„
pythÚ
ç‰ˆæœ¬

31 '´ÙocŞ_v”siÚ=%s' % 
£lf
.
´ÙocŞ_v”siÚ
, #è¿”å›æœåŠ¡å™¨ç«¯ä½¿ç”¨çš„
h‰p
åè®®ç‰ˆæœ¬

35 
Çme
, 
v®ue
 
š
 
	`sÜ‹d
(
£lf
.
h—d”s
.
	$™ems
()): #è¿”å›é …æ·»åŠ å¤´ä¿¡æ¯ï¼ŒåŒ…å«ç”¨æˆ·çš„
u£r
-
ag’t
ä¿¡æ¯ï¼Œä¸»æœºä¿¡æ¯ç­‰

36 
mes§ge_·¹s
.
	`­³nd
('%s=%s' % (
Çme
, 
v®ue
.
	$r¡r
()))

37 
mes§ge_·¹s
.
	`­³nd
('')

38 
mes§ge
 = '\r\n'.
	$još
(
mes§ge_·¹s
)

39 
£lf
.
	$£nd_»¥Ú£
(200è#è¿”å›ç»™å®¢æˆ·ç«¯ç»“æœï¼Œè¿™é‡Œçš„å“åº”ç æ˜¯200 
OK
ï¼Œå¹¶åŒ…å«ä¸€äº›å…¶ä»–ä¿¡æ¯

40 
£lf
.
	$’d_h—d”s
() #ç»“æŸå¤´ä¿¡æ¯

41 
£lf
.
wfe
.
	$wr™e
(
mes§ge
) #è¿”å›æ•°æ®

43 
__Çme__
 == '__main__':

44 
äom
 
Ba£HTTPS”v”
 
impÜt
 
HTTPS”v”


45 
£rv”
 = 
	`HTTPS”v”
(('loÿlho¡', 
job0job0
), 
G‘HªdËr
è#åœ¨æœ¬åœ°job0job0ç«¯å£ä¸Šå¯ç”¨
h‰p£rv”
ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„GetHandlerå¤„ç†

46 
´št
 'Starting server, use <Ctrl-C>o stop'

47 
£rv”
.
	$£rve_fÜev”
() #ä¿å­˜ç¨‹åºä¸€ç›´è¿è¡Œ

	@/root/grocery-shop/language/python/socket/client.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
sock‘


5 
	gho¡
 = '127.0.0.1'

6 
pÜt
 = 
job00job


7 
bufsize
 = 1024

8 
addr
 = (
ho¡
,
	gpÜt
)

9 
	gş›Á
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_INET
,sock‘.
SOCK_STREAM
)

10 
ş›Á
.
	$cÚÃù
(
addr
)

12 
d©a
 = "xxxxxxxxxxxxx"

13 
ş›Á
.
	`£nd
('%s\r\n' % 
d©a
)

15 
ş›Á
.
	`şo£
()

	@/root/grocery-shop/language/python/socket/ip.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #-*- 
codšg
: 
utf
-
job
 -*-

4 
impÜt
 
sock‘


5 
impÜt
 
fú


6 
impÜt
 

8 
def
 
	$g‘__add»ss
(
iâame
):

9 
s
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_INET
, sock‘.
SOCK_DGRAM
)

10  
sock‘
.
	`š‘_Áß
(
fú
.
	`ioùl
(

11 
s
.
	`f’o
(),

12 0x
job915
, #SIOCGIFADDR

13 .
	`·ck
('256s', 
iâame
[:15])

16 
´št
 "‘h0 = "+ 
	`g‘__add»ss
('eth0')

17 
´št
 "lØğ" + 
	`g‘__add»ss
('lo')

	@/root/grocery-shop/language/python/socket/server.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


3 
impÜt
 
Sock‘S”v”


4 
äom
 
Sock‘S”v”
 
impÜt
 
SŒ—mReque¡HªdËr
 
as
 
SRH


5 
äom
 
time
 
impÜt
 
ùime


7 
	gho¡
 = '127.0.0.1'

8 
pÜt
 = 
job00job


9 
addr
 = (
ho¡
,
	gpÜt
)

11 
şass
 
	$S”v”s
(
SRH
):

12 
def
 
	$hªdË
(
£lf
):

13 
´št
 'gÙ cÚÃùiÚ from ',
£lf
.
ş›Á_add»ss


14 
£lf
.
wfe
.
	`wr™e
('cÚÃùiÚ %s:% © % sucûed!' % (
ho¡
,
pÜt
,
	$ùime
()))

15 
True
:

16 
d©a
 = 
£lf
.
»que¡
.
	$»cv
(1024)

17 
nÙ
 
d©a
:

19 
´št
 
d©a


20 
£lf
.
»que¡
.
	$£nd
(
d©a
)

22 
´št
 'server is„unning....'

23 
£rv”
 = 
Sock‘S”v”
.
	$Th»adšgTCPS”v”
(
addr
, 
S”v”s
)

24 
£rv”
.
	`£rve_fÜev”
()

	@/root/grocery-shop/language/python/socket/tcpClient.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #-*- 
codšg
:
utfjob
 -*-

4 
impÜt
 
sys


5 
	$»lßd
(
sys
)

6 
sys
.
	`£tdeçuÉ’codšg
('utf-job')

8 
impÜt
 
sock‘


10 
şass
 
	$N‘Cl›Á
(
objeù
):

11 
def
 
	$tış›Á
(
£lf
):

12 
ş›ÁSock
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
)

13 
ş›ÁSock
.
	`cÚÃù
(('localhost', 9527))

15 
£ndD©aL’
 = 
ş›ÁSock
.
	`£nd
("this is send data from client")

16 
»cvD©a
 = 
ş›ÁSock
.
	$»cv
(1024)

17 
´št
 "£ndD©aL’: ", 
£ndD©aL’


18 
´št
 "»cvD©a: ", 
»cvD©a


20 
ş›ÁSock
.
	$şo£
()

22 
__Çme__
 == "__main__":

23 
ÃtCl›Á
 = 
	$N‘Cl›Á
()

24 
ÃtCl›Á
.
	`tış›Á
()

	@/root/grocery-shop/language/python/socket/tcpServer.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #-*- 
codšg
:
utfjob
 -*-

3 
impÜt
 
sock‘


5 
şass
 
	$N‘S”v”
(
objeù
):

6 
def
 
	$tıS”v”
(
£lf
):

7 
sock
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_INET
, sock‘.
SOCK_STREAM
)

8 
sock
.
	`bšd
(('', 9527)) #ç»‘å®šåŒä¸€ä¸ªåŸŸåä¸‹çš„æ‰€æœ‰æœºå™¨

9 
sock
.
	$li¡’
(5)

11 
True
:

12 
ş›ÁSock
, (
»mÙeHo¡
, 
»mÙePÜt
èğ
sock
.
	$acû±
()

13 #æ¥æ”¶å®¢æˆ·ç«¯çš„

, 
pÜt


14 
	`´št
("[%s:%s] cÚÃù" % (
»mÙeHo¡
, 
»mÙePÜt
))

16 
»vcD©a
 = 
ş›ÁSock
.
	$»cv
(1024)

17 
£ndD©aL’
 = 
ş›ÁSock
.
	`£nd
("this is send data from server")

18 
´št
 "»vcD©a: ", 
»vcD©a


19 
´št
 "£ndD©aL’: ", 
£ndD©aL’


21 
ş›ÁSock
.
	$şo£
()

23 
__Çme__
 == "__main__":

24 
ÃtS”v”
 = 
	$N‘S”v”
()

25 
ÃtS”v”
.
	`tıS”v”
()

	@/root/grocery-shop/language/python/socket/udpClient.py

1 
impÜt
 
sock‘


3 
	gadd»ss
 = ('127.0.0.1', 31500)

4 
	gs
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_INET
, sock‘.
SOCK_DGRAM
)

6 
True
:

7 
msg
 = 
	$¿w_šput
()

8 
nÙ
 
msg
:

10 
s
.
	$£ndto
(
msg
, 
add»ss
)

12 
s
.
	`şo£
()

	@/root/grocery-shop/language/python/socket/udpServer.py

1 
impÜt
 
sock‘


3 
	gadd»ss
 = ('127.0.0.1', 31500)

4 
	gs
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_INET
, sock‘.
SOCK_DGRAM
)

5 
s
.
	$bšd
(
add»ss
)

7 
True
:

8 
d©a
, 
addr
 = 
s
.
	$»cväom
(204
job
)

9 
nÙ
 
d©a
:

10 
´št
 "client hasƒxist"

12 
´št
 "»ûived:", 
d©a
, "äom", 
addr


14 
s
.
	`şo£
()

	@/root/grocery-shop/language/python/socket/unixClient.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 
impÜt
 
sock‘


5 
impÜt
 
	gsys


7 #C»©
a
 
UDS
 
sock‘


8 
	gsock
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_UNIX
, sock‘.
SOCK_STREAM
)

10 #CÚÃù 
the
 
sock‘
 
to
h
pÜt
 
wh”e
h
£rv”
 
is
 
li¡’šg


11 
£rv”_add»ss
 = '/data/agentServer/nginx-redis.sock'

12 
´št
 >>
sys
.
¡d”r
, 'cÚÃùšgØ%s' % 
£rv”_add»ss


13 
Œy
:

14 
sock
.
	$cÚÃù
(
£rv”_add»ss
)

15 
exû±
 
sock‘
.
”rÜ
, 
msg
:

16 
´št
 >>
sys
.
¡d”r
, 
msg


17 
sys
.
	$ex™
(1)

19 
Œy
:

20 #S’d 
d©a


21 
mes§ge
 = 'This ishe message. It will be„epeated.'

22 
´št
 >>
sys
.
¡d”r
, '£ndšg "%s"' % 
mes§ge


23 
sock
.
	$£nd®l
(
mes§ge
)

25 
amouÁ_»ûived
 = 0

26 
amouÁ_ex³ùed
 = 
	$Ën
(
mes§ge
)

28 
amouÁ_»ûived
 < 
amouÁ_ex³ùed
:

29 
d©a
 = 
sock
.
	$»cv
(16)

30 
amouÁ_»ûived
 +ğ
	$Ën
(
d©a
)

31 
´št
 >>
sys
.
¡d”r
, '»ûived "%s"' % 
d©a


33 
fš®ly
:

34 
´št
 >>
sys
.
¡d”r
, 'closing socket'

35 
sock
.
	`şo£
()

	@/root/grocery-shop/language/python/socket/unixServer.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 
impÜt
 
sock‘


5 
impÜt
 
sys


6 
impÜt
 
os


8 
	g£rv”_add»ss
 = '/data/agentServer/nginx-redis.sock'

10 #Mak
su»
 
the
 
sock‘
 
dÛs
 
nÙ
 
®»ady
 
exi¡


11 
Œy
:

12 
os
.
	$uÆšk
(
£rv”_add»ss
)

13 
exû±
 
OSE¼Ü
:

14 
os
.
·th
.
	$exi¡s
(
£rv”_add»ss
):

15 
¿i£


16 #C»©
a
 
UDS
 
sock‘


17 
sock
 = 
sock‘
.
	$sock‘
(
sock‘
.
AF_UNIX
, sock‘.
SOCK_STREAM
)

18 
sock
.
	$bšd
(
£rv”_add»ss
)

20 #Li¡’ 
šcomšg
 
cÚÃùiÚs


21 
sock
.
	$li¡’
(20)

23 
True
:

24 #Wa™ 
a
 
cÚÃùiÚ


25 
´št
 >>
sys
.
¡d”r
, 'waiting for‡ connection'

26 
cÚÃùiÚ
, 
ş›Á_add»ss
 = 
sock
.
	$acû±
()

27 
Œy
:

28 
´št
 >>
sys
.
¡d”r
, 'cÚÃùiÚ from', 
ş›Á_add»ss


30 #Reûiv
the
 
d©a
 
š
 
sm®l
 
chunks
 
ªd
 
»Œªsm™
 
™


31 
True
:

32 
d©a
 = 
cÚÃùiÚ
.
	$»cv
(16)

33 
´št
 >>
sys
.
¡d”r
, '»ûived "%s"' % 
d©a


34 
d©a
:

35 
´št
 >>
sys
.
¡d”r
, 'sending data backohe client'

36 
cÚÃùiÚ
.
	$£nd®l
(
d©a
)

38 
´št
 >>
sys
.
¡d”r
, 'nØmÜd©¨äom', 
ş›Á_add»ss


41 
fš®ly
:

42 #CËª 
up
 
the
 
cÚÃùiÚ


43 
cÚÃùiÚ
.
	`şo£
()

	@/root/grocery-shop/language/python/threading/simpleTest.py

1 #codšg:
utf
-
job


2 
impÜt
 
sys


3 
impÜt
 
th»adšg


4 
impÜt
 
sigÇl


5 
impÜt
 
time


6 
impÜt
 
Queue


8 
şass
 
	gA
:

9 
def
 
	$__š™__
(
£lf
):

10 
£lf
.
æag
 = 
F®£


11 
£lf
.
queue
 = 
Queue
.
	$Queue
()

13 
def
 
	$di¥Ïy
(
£lf
, *
¬gs
, **
kw¬gs
):

15 
´št
 
¬gs


16 
i
 
š
 
	$¿nge
(1000):

17 
£lf
.
queue
.
	`put
('Thi i %de¡'%(
i
))

18 
time
.
	$¦“p
(1)

19 
£lf
.
æag
:

22 
def
 
	$hªdË
(
£lf
, 
a
, 
b
):

23 
´št
 'XXXXXXXXXXXXXXXXXXXXXXXX'

24 
£lf
.
æag
 = 
True


26 
def
 
	$th»adšgFunc
(
£lf
):

28 
th»adšg
.
Th»ad
æµ‹è¯•

30 #åˆ›å»º
Th»ad
å¯¹è±¡

31 
th»ad1
 = 
th»adšg
.
	`Th»ad
(
rg‘
=
£lf
.
di¥Ïy
,

32 
Çme
='di¥ÏyTh»ad', 
¬gs
=[1, 2, 3, 4,],

33 
kw¬gs
 = {'a':'sh™', 'b':'‹¡'
	}
})

35 
th»ad1
.
	$¡¬t
()

36 
nÙ
 
£lf
.
æag
:

37 
´št
 '==============='

38 
´št
 
£lf
.
queue
.
	$g‘
()

39 
time
.
	$¦“p
(1)

40 
th»ad1
.
	$još
()

41 
time
.
	$¦“p
(3)

42 
´št
 "xxxxxxxxxx", 
th»ad1
.
	$isAlive
()

44 
__Çme__
 == '__main__':

46 
a
 = 
	$A
()

47 
sigÇl
.
	$sigÇl
(
sigÇl
.
SIGTERM
, 
a
.
hªdË
)

48 
a
.
	`th»adšgFunc
()

	@/root/grocery-shop/language/python/threading/startTest.py

1 #codšg:
utf
-
job


3 ç®€å•çš„æµ‹è¯•:
run
()å’Œ
¡¬t
()å‡½æ•°æ˜¯å¦‚ä½•æ„é€ çš„ï¼Ÿ

6 
şass
 
	$S¹Te¡
(
objeù
):

7 
def
 
	$__š™__
(
£lf
):

9 
£lf
.
‹¡V¬
 = ''

11 
def
 
	$di¥Ïy
(
£lf
):

13 
´št
 
£lf
.
‹¡V¬


15 
def
 
	$run
(
£lf
):

17 
£lf
.
‹¡V¬
 = 'xxxxxxxxxxxxxxxxxxx'

19 
__Çme__
 == '__main__':

21 
¡¬tTe¡
 = 
	$S¹Te¡
()

22 
¡¬tTe¡
.
	$¡¬t
()

23 
¡¬tTe¡
.
	`di¥Ïy
()

	@/root/grocery-shop/language/python/threading/test.py

1 
impÜt
 
Queue


2 
impÜt
 
time


3 
impÜt
 
loggšg


4 
impÜt
 
sys


5 
impÜt
 
th»adšg


6 
impÜt
 
sigÇl


8 
	gloggšg
.
basicCÚfig
(
fÜm©
='%Öev–Çme)s:%(mes§ge)s', 
Ëv–
=
loggšg
.
DEBUG
)

10 
şass
 
	$Te¡1
(
objeù
):

11 
def
 
	$__š™__
(
£lf
):

12 
£lf
.
šdex
 = 3

13 
£lf
.
q1
 = 
Queue
.
	$Queue
()

15 
def
 
	$sig_qu™
(
£lf
, 
a
, 
b
):

16 
£lf
.
šdex
 = 10

17 
£lf
.
q1
.
	`put
('quit')

18 
´št
 '========================'

20 
def
 
	$sig_‹rm
(
£lf
, 
a
, 
b
):

21 
£lf
.
šdex
 = 10

22 
£lf
.
q1
.
	`put
('quit')

23 
´št
 '========================'

24 
´št
 '++++++++++++++++++'

26 
def
 
	$run
(
£lf
):

27 
sigÇl
.
	$sigÇl
(
sigÇl
.
SIGQUIT
, 
£lf
.
sig_qu™
)

28 
sigÇl
.
	$sigÇl
(
sigÇl
.
SIGTERM
, 
£lf
.
sig_‹rm
)

30 
def
 
	$th»ad1
():

31 
glob®
 
q1


33 
loggšg
.
	`šfo
(
£lf
.
q1
.
	$g‘
())

35 
t1
 = 
th»adšg
.
	$Th»ad
(
rg‘
=
th»ad1
)

36 
t1
.
	$£tD«mÚ
(
True
)

37 
t1
.
	$¡¬t
()

40 
´št
 '*****************', 
£lf
.
šdex


41 
£lf
.
q1
.
	`put
('bbbbbbbbbb')

42 
time
.
	$¦“p
(1)

44 
´št
 'xxxxxxxxxxxxxxxxx'

46 
tObj
 = 
	$Te¡1
()

47 
tObj
.
	`run
()

	@/root/grocery-shop/language/python/threading/timerTest.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utf
-
job


4 
impÜt
 
th»adšg


5 
impÜt
 
time


7 
şass
 
	gA
:

8 
def
 
	$__š™__
(
£lf
):

9 
£lf
.
tim”1
 = 
NÚe


11 
def
 
	$£tTim”
(
£lf
):

12 
£lf
.
tim”1
 = 
th»adšg
.
	$Tim”
(3, 
£lf
.
di¥Ïy
)

14 
def
 
	$¡¬tTim”
(
£lf
):

15 
£lf
.
tim”1
.
	$¡¬t
()

17 
def
 
	$run
(
£lf
):

18 
£lf
.
	$£tTim”
()

19 
£lf
.
	$¡¬tTim”
()

21 
def
 
	$di¥Ïy
(
£lf
):

22 
´št
 'this is‡imer....'

23 
£lf
.
tim”1
 = 
th»adšg
.
	$Tim”
(3, 
£lf
.
di¥Ïy
)

24 
£lf
.
tim”1
.
	$¡¬t
()

26 
__Çme__
 == '__main__':

28 
a
 = 
	$A
()

29 
a
.
	$run
()

30 
True
:

31 
time
.
	`¦“p
(2)

	@/root/grocery-shop/language/python/threading/yieldTest.py

1 #codšg:
utf
-
job


2 #!/
u¤
/
bš
/
pythÚ


3 
impÜt
 
os


4 
impÜt
 
th»adšg


5 
impÜt
 
g»’Ët


8 
şass
 
	$Th»ad
(
th»adšg
.
Th»ad
):

9 
def
 
	$__š™__
(
£lf
, 
Çme
):

10 
th»adšg
.
Th»ad
.
	$__š™__
(
£lf
)

11 
£lf
.
Çme
 =‚ame

13 
def
 
	$run
(
£lf
):

14 
i
 
š
 
	$x¿nge
(10):

15 
´št
 
£lf
.
Çme


18 
def
 
	$th»adTe¡
():

19 
th»adA
 = 
	`Th»ad
("A")

20 
th»adB
 = 
	`Th»ad
("B")

22 
th»adA
.
	$¡¬t
()

23 
th»adB
.
	$¡¬t
()

25 
def
 
	$run
(
Çme
, 
ÃxtG»’Ëts
):

26 
i
 
š
 
	$x¿nge
(10):

27 
´št
 
Çme


28 
ÃxtG»’Ëts
:

29 
ÃxtG»’Ëts
.
	`pİ
(0).
	`chr
(
	`Üd
(
Çme
) + 1),‚extGreenlets)

31 
def
 
	$yedTe¡
():

32 
g»’ËtA
 = 
g»’Ët
.
	$g»’Ët
(
run
)

33 
g»’ËtB
 = 
g»’Ët
.
	$g»’Ët
(
run
)

35 
g»’ËtA
.'A', [
g»’ËtB
])

38 
__Çme__
 == '__main__':

39 
	`th»adTe¡
()

	@/root/grocery-shop/language/python/unittest/simpleTest.py

1 #codšg:
utf
-
job


2 
impÜt
 
¿ndom


3 
impÜt
 
un™‹¡


5 
şass
 
	$Te¡Sequ’ûFunùiÚs
(
un™‹¡
.
Te¡Ca£
):

6 
def
 
	$£tUp
(
£lf
):

7 
£lf
.
£q
 = 
	$¿nge
(10)

9 
def
 
	$§m¶e_¿i£
(
£lf
):

11 
¿ndom
.
	$§m¶e
(
£lf
.
£q
, 20)

13 
def
 
	$‹¡_shufæe
(
£lf
):

14 #mak
su»
 
the
 
shufæed
 
£qu’û
 
dÛs
 
nÙ
 
lo£
 
ªy
 
–em’ts


15 
¿ndom
.
	$shufæe
(
£lf
.
£q
)

16 
£lf
.
£q
.
	$sÜt
()

17 
£lf
.
	`as£¹Equ®
(£lf.
£q
, 
	$¿nge
(10))

18 #should 
¿i£
 
ª
 
exû±iÚ
 ª 
immubË
 
£qu’û


19 
£lf
.
	`as£¹Rai£s
(
Ty³E¼Ü
, 
¿ndom
.
shufæe
, (1,2,3))

21 
def
 
	$‹¡_choiû
(
£lf
):

22 
–em’t
 = 
¿ndom
.
	$choiû
(
£lf
.
£q
)

23 
£lf
.
	$as£¹True
(
–em’t
 
š
 
£lf
.
£q
)

25 
def
 
	$‹¡_§m¶e
(
£lf
):

26 
£lf
.
	$as£¹Rai£s
(
V®ueE¼Ü
, 
£lf
.
§m¶e_¿i£
)

27 
–em’t
 
š
 
¿ndom
.
	$§m¶e
(
£lf
.
£q
, 5):

28 
£lf
.
	$as£¹True
(
–em’t
 
š
 
£lf
.
£q
)

30 
__Çme__
 == '__main__':

32 
un™‹¡
.
	`maš
()

	@/root/grocery-shop/language/python/unittest/simpleTestUnit.py

1 #codšg:
utf
-
job


2 
impÜt
 
un™‹¡


4 
şass
 
	$Widg‘
(
objeù
):

5 
def
 
	`__š™__
(
£lf
, 
desc
, 
size
=(40,40)):

6 
£lf
.
size
 = size

7 
£lf
.
Çme
 = 
desc


9 
def
 
	$g‘Size
(
£lf
):

11  
£lf
.
size


13 
def
 
	$»size
(
£lf
, 
width
, 
height
):

15 
width
 <0 
Ü
 
height
 < 0:

16 
¿i£
 
V®ueE¼Ü
, 'illegal size'

18 
£lf
.
size
 = (
width
, 
height
)

19  
£lf
.
size


21 
def
 
	$di¥o£
(
£lf
):

23 
·ss


25 
şass
 
	$Widg‘Te¡Ca£
(
un™‹¡
.
Te¡Ca£
):

26 
def
 
	$£tUp
(
£lf
):

27 
£lf
.
widg‘
 = 
	`Widg‘
('The widget')

29 
def
 
	$‹¬Down
(
£lf
):

30 
£lf
.
widg‘
.
	$di¥o£
()

31 
£lf
.
widg‘
 = 
NÚe


33 
def
 
	$‹¡_deçuÉ_size
(
£lf
):

34 
£lf
.
	`as£¹Equ®
(£lf.
widg‘
.
	`g‘Size
(), (40, 40), 'Incorrect default size')

36 
def
 
	$‹¡_»size
(
£lf
):

37 
£lf
.
widg‘
.
	$»size
(100,150)

38 
£lf
.
	`as£¹Equ®
(£lf.
widg‘
.
	`g‘Size
(), (100,150), 'wrong size‡fter„esize')

40 
__Çme__
 == '__main__':

42 
widg‘Te¡Su™e
 = 
un™‹¡
.
	$Te¡Su™e
()

43 
widg‘Te¡Su™e
.
	`addTe¡
(
	`Widg‘Te¡Ca£
('test_default_size'))

44 
widg‘Te¡Su™e
.
	`addTe¡
(
	`Widg‘Te¡Ca£
('test_resize'))

45 
un™‹¡
.
	`maš
()

	@/root/grocery-shop/language/python/webOperator/hbaserest/sendMultiKey.py

1 #codšg:
utf
-
job


3 å‘é€
	gh‰p
æ•°æ®åˆ°
	ghba£
ä¸Šï¼Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š

4 1ï¼Œæ¯ä¸€ä¸ª
	gcŞumn
çš„æ ¼å¼å¿…é¡»æ˜¯(
	gcŞumnName
:
sub
)ï¼Œå…¶ä¸­subå¯ä»¥ä¸å­˜åœ¨ï¼Œä½†æ˜¯':'å¿…é¡»å­˜åœ¨

5 2ï¼Œå‘é€å¤šä¸ª
Keys
æ—¶ï¼Œ
URL
ä¸º
çl£
-
row
-
key


7 
impÜt
 
sys


8 
impÜt
 
ba£64


9 
impÜt
 
jsÚ


10 
impÜt
 
»que¡s


12 
ageB64
 = 
ba£64
.
b64’code
('age:')

13 
cŞÜB64
 = 
ba£64
.
b64’code
('color:')

14 
ÇmeB64
 = 
ba£64
.
b64’code
('name:')

15 
mšmoduËdiù
 = {

16 
u
'Row':[

18 
u
'key':
ba£64
.
b64’code
('panxiaoyuan:01'),

19 
u
'Cell':[

21 
u
'cŞumn':
ageB64
,

22 
u
'$':
ba£64
.
b64’code
('24'),

25 
u
'cŞumn':
cŞÜB64
,

26 
u
'$':
ba£64
.
b64’code
('red'),

29 
u
'cŞumn':
ÇmeB64
,

30 
u
'$':
ba£64
.
b64’code
('mylove'),

35 
u
'key':
ba£64
.
b64’code
('panxiaoyuan:02'),

36 
u
'Cell':[

38 
u
'cŞumn':
ageB64
,

39 
u
'$':
ba£64
.
b64’code
('24'),

42 
u
'cŞumn':
cŞÜB64
,

43 
u
'$':
ba£64
.
b64’code
('red'),

46 
u
'cŞumn':
ÇmeB64
,

47 
u
'$':
ba£64
.
b64’code
('mylove'),

52 
u
'key':
ba£64
.
b64’code
('panxiaoyuan:03'),

53 
u
'Cell':[

55 
u
'cŞumn':
ageB64
,

56 
u
'$':
ba£64
.
b64’code
('24'),

59 
u
'cŞumn':
cŞÜB64
,

60 
u
'$':
ba£64
.
b64’code
('red'),

63 
u
'cŞumn':
ÇmeB64
,

64 
u
'$':
ba£64
.
b64’code
('mylove'),

69 
u
'key':
ba£64
.
b64’code
('who:01'),

70 
u
'Cell':[

72 
u
'cŞumn':
ageB64
,

73 
u
'$':
ba£64
.
b64’code
('27'),

76 
u
'cŞumn':
cŞÜB64
,

77 
u
'$':
ba£64
.
b64’code
('blue'),

80 
u
'cŞumn':
ÇmeB64
,

81 
u
'$':
ba£64
.
b64’code
('love'),

88 
·yd©a
 = 
jsÚ
.
dumps
(
mšmoduËdiù
, 
£·¿tÜs
=(',', ':'))

89 
	gu¾
 = 'http://10.1.200.7:job0job0/bifeng/false-row-key'

91 
r¥
 = 
»que¡s
.
put
(
u¾
, 
d©a
=
·yd©a
, \

92 
h—d”s
= {"Content-Type":"application/json"})

93 
r¥
 
is
 
NÚe
:

94 
´št
 'return‚one'

95 
sys
.
ex™
(-1)

96 
´št
 
r¥
.
¡©us_code


	@/root/grocery-shop/language/python/webOperator/requests/postimage.py

1 #codšg:
utf
-
job


2 
impÜt
 
»que¡s


3 
impÜt
 
ba£64


4 
impÜt
 
jsÚ


6 
	gå
 = 
İ’
('1.png', 'rb')

7 
	g¡r1
 = 
ba£64
.
b64’code
(
å
.
	$»ad
())

9 
cÚ‹Á
 = ('<b>xxxxxxxxxxxxxxxxx</b>'

11 
©chm’t
 = {'image':[('1.²g', 
¡r1
),]
	}
}

12 
»c
 = ['shit@shit.com']

14 
d©aDiù
 = {}

15 #d©aDiù['©chm’t'] = 
©chm’t


16 
d©aDiù
['content'] = "xxxxxxxxxxxxxxxxxx"

17 
d©aDiù
['»c'] = 
»c


18 
d©aDiù
['subject'] = 'This is‡est for ssh.'

20 #r¥ = 
»que¡s
.
po¡
('http://10.1.193.1job1:job000/sendemail/sendtest',

21 #d©a=
jsÚ
.
dumps
({
u
'body':3}),

23 #´šˆ
r¥


25 
	gr¥
 = 
»que¡s
.
po¡
('http://127.0.0.1:job000/sendemail/send',

26 
d©a
=
jsÚ
.
dumps
(
d©aDiù
),

27 
h—d”s
={"Content-Type":"application/json"})

28 
´št
 
r¥


	@/root/grocery-shop/language/python/webOperator/requests/requestsTest.py

1 
impÜt
 
»que¡s


4 
def
 
	$g‘RecÜd
(
u¾
, 
timeout
=5, **
kw¬gs
):

5  
»que¡s
.
	$g‘
(
u¾
, 
timeout
ñimeout, **
kw¬gs
)

7 
def
 
	$putRecÜd
(
u¾
, 
d©a
=
NÚe
, 
timeout
 = 5,**
kw¬gs
):

8  
»que¡s
.
	$put
(
u¾
, 
timeout
=5, 
d©a
=d©a, **
kw¬gs
)

10 
u¾
 = "http://10.1.200.7:job0job0/basic_module/devops:201510221255"

12 
i
 
š
 
	$¿nge
(20):

13 
r1
 = 
	`g‘RecÜd
(
u¾
, 
h—d”s
={"Acû±":"­¶iÿtiÚ/jsÚ"
	}
})

14 
´št
 
r1


15 
´št
 'xxxxxxxxxxxxxxxxxxxxxxxx'

16 
r2
 = 
»que¡s
.
g‘
(
u¾
, 
h—d”s
={"Accept":"application/json"})

17 
´št
 
r2


19 
impÜt
 
pdb


20 
pdb
.
	$£t_Œaû
()

21 
u¾
 = "http://10.1.200.7:job0job0/basic_module/devops:201510221552"

22 
·yd©a
 = '{"Row": [{"key": "ZGV2b3BzOjIwMTUxMDIyMTU1Mg==", "Cell": [{"column": "aWjob6cmVhZF9ieXRlcw==", "$": "MC4wMA=="}, {"column": "bmV0OmJ5dGVzX3NlbnQ=", "$": "NjAzNC4wMA=="}, {"column": "bmV0OmJ5dGVzX3JlY3Y=", "$": "MTI1MDIuMDA="}, {"column": "Y3B1Omlvd2FpdA==", "$": "MC4xNQ=="}, {"column": "bWVtOm1lbXBlcmNlbnQ=", "$": "NTEuMjQ="}, {"column": "aWjob6d3JpdGVfdGltZQ==", "$": "MTYuMDA="}, {"column": "Y3B1OnNvZnRpcnE=", "$": "MC4wNw=="}, {"column": "bmV0OmVycmlu", "$": "MC4wMA=="}, {"column": "bmV0OmRyb3BvdXQ=", "$": "MC4wMA=="}, {"column": "bmV0OmRyb3Bpbg==", "$": "MC4wMA=="}, {"column": "Y3B1OnN5c3RlbQ==", "$": "MC43Mw=="}, {"column": "Y3B1OnVzZWQ=", "$": "NC4yMQ=="}, {"column": "bmV0OnBhY2tldHNfc2VudA==", "$": "NjguMDA="}, {"column": "bmV0OnBhY2tldHNfcmVjdg==", "$": "MTQ4LjAw"}, {"column": "bmV0OmVycm91dA==", "$": "MC4wMA=="}, {"column": "aWjob6cmVhZF90aW1l", "$": "MC4wMA=="}, {"column": "Y3B1OnVzZXI=", "$": "MS41Mw=="}, {"column": "aWjob6d3JpdGVfY291bnQ=", "$": "Ny4wMA=="}, {"column": "Y3B1OmlycQ==", "$": "MC4wMw=="}, {"column": "aWjob6d3JpdGVfYnl0ZXM=", "$": "NTY0NzAuMDA="}, {"column": "aWjob6cmVhZF9jb3VudA==", "$": "MC4wMA=="}]}]}'

23 
r3
 = 
	`putRecÜd
(
u¾
, 
d©a
 = 
·yd©a
, 
h—d”s
={"CÚ‹Á-Ty³":"­¶iÿtiÚ/jsÚ"
	}
})

24 
´št
 
r3


26 
u¾
 = "http://10.1.200.7:job0job0/basic/false-row-key"

27 
·yd©a
 = '{"Row": [{"key": "201510221605", "Cell": [{"column": "Y3B1OnN5c3RlbQ==", "$": "MC4zNTIwMjE4NTc5MjQ="}, {"column": "bmV0OmRyb3Bpbg==", "$": "MC4w"}, {"column": "aWjob6cmVhZF9ieXRlcw==", "$": "MC4w"}, {"column": "Y3B1Omlvd2FpdA==", "$": "MC4xOTg5ODkwNzEwMzg="}, {"column": "bmV0OnBhY2tldHNfc2VudA==", "$": "NS4w"}, {"column": "aWjob6d3JpdGVfYnl0ZXM=", "$": "ODQ5NzguMA=="}, {"column": "aWjob6d3JpdGVfdGltZQ==", "$": "MjMuMA=="}, {"column": "Y3B1OnNvZnRpcnE=", "$": "MC4wNDkzNDQyNjIyOTUx"}, {"column": "bmV0OmVycmlu", "$": "MC4w"}, {"column": "bWVtOm1lbXBlcmNlbnQ=", "$": "ODguMw=="}, {"column": "Y3B1OmlycQ==", "$": "MC4w"}, {"column": "Y3B1OnVzZWQ=", "$": "Mi45MDI2Nzc1OTU2Mw=="}, {"column": "bmV0OmRyb3BvdXQ=", "$": "MC4w"}, {"column": "bmV0OmJ5dGVzX3JlY3Y=", "$": "MTEzNi4w"}, {"column": "bmV0OmJ5dGVzX3NlbnQ=", "$": "MTA3Ni4w"}, {"column": "aWjob6cmVhZF90aW1l", "$": "MC4w"}, {"column": "aWjob6d3JpdGVfY291bnQ=", "$": "Ny4w"}, {"column": "Y3B1OnVzZXI=", "$": "MC42MDgxNjkzOTg5MDc="}, {"column": "bmV0OmVycm91dA==", "$": "MC4w"}, {"column": "bmV0OnBhY2tldHNfcmVjdg==", "$": "Ny4w"}, {"column": "aWjob6cmVhZF9jb3VudA==", "$": "MC4w"}]}, {"key": "201510221605", "Cell": [{"column": "Y3B1OnN5c3RlbQ==", "$": "MC43MDgxOTY3MjEzMTE="}, {"column": "bmV0OmRyb3Bpbg==", "$": "MC4w"}, {"column": "aWjob6cmVhZF9ieXRlcw==", "$": "MjY4NS4w"}, {"column": "Y3B1Omlvd2FpdA==", "$": "MC4xOTgzNjA2NTU3Mzg="}, {"column": "bmV0OnBhY2tldHNfc2VudA==", "$": "MTQuMA=="}, {"column": "aWjob6d3JpdGVfYnl0ZXM=", "$": "MjkxNDIuMA=="}, {"column": "aWjob6d3JpdGVfdGltZQ==", "$": "MTIuMA=="}, {"column": "Y3B1OnNvZnRpcnE=", "$": "MC4xNDc1NDA5ODM2MDc="}, {"column": "bmV0OmVycmlu", "$": "MC4w"}, {"column": "bWVtOm1lbXBlcmNlbnQ=", "$": "MTQuMTY1NTczNzcwNQ=="}, {"column": "Y3B1OmlycQ==", "$": "MC4wMzI3ODY4ODUyNDU5"}, {"column": "Y3B1OnVzZWQ=", "$": "NS4xNTU3Mzc3MDQ5Mg=="}, {"column": "bmV0OmRyb3BvdXQ=", "$": "MC4w"}, {"column": "bmV0OmJ5dGVzX3JlY3Y=", "$": "MTM1NTUuMA=="}, {"column": "bmV0OmJ5dGVzX3NlbnQ=", "$": "MzkwMC4w"}, {"column": "aWjob6cmVhZF90aW1l", "$": "MS4w"}, {"column": "aWjob6d3JpdGVfY291bnQ=", "$": "NS4w"}, {"column": "Y3B1OnVzZXI=", "$": "Mi40MjQ1OTAxNjM5Mw=="}, {"column": "bmV0OmVycm91dA==", "$": "MC4w"}, {"column": "bmV0OnBhY2tldHNfcmVjdg==", "$": "MTkzLjA="}, {"column": "aWjob6cmVhZF9jb3VudA==", "$": "MC4w"}]}]}'

28 
r4
 = 
putRecÜd
(
u¾
, 
d©a
 = 
·yd©a
, 
h—d”s
={"Content-Type":"application/json"})

29 
´št
 
r4


	@/root/grocery-shop/language/python/webOperator/requests/simpleTest.py

1 #!/
u¤
/
bš
/
pythÚ


2 #codšg:
utfjob


3 
impÜt
 
»que¡s


4 
impÜt
 
jsÚ


7 
	gURL
='http://www.baidu.com'

9 
def
 
	$‹¡_·¿ms
():

11 
d1
 = {'sh™':3, 'xŸng':4
	}
}

12 
r¥
 = 
»que¡s
.
	$g‘
(
URL
, 
·¿ms
=
d1
)

13 
´št
 
r¥
.
u¾


14 
´št
 
r¥
.
¿w


16 
def
 
	$‹¡_h—d”s
():

18 
d1
 = {'cÚ‹Á-ty³': '­¶iÿtiÚ/jsÚ'
	}
}

19 
r¥
 = 
»que¡s
.
g‘
(
URL
, 
d©a
=
jsÚ
.
dumps
({'shit':3}), \

20 
h—d”s
=
d1
)

21 
´št
 
r¥
.
u¾


23 
def
 
	$‹¡_cook›s
():

25 
cook›Diù
 = 
	`diù
(
mykey
='123')

26 
r¥
 = 
»que¡s
.
	$g‘
(
URL
, 
cook›s
=
cook›Diù
)

27 
´št
 
r¥
.
¡©us_code


29 
def
 
	$‹¡_fes
():

31 
r¥
 = 
»que¡s
.
	`g‘
(
URL
, 
fes
={'fe1':
	`İ’
('manage', 'rb'), \

32 'fe2':('mªage999', 
	`İ’
('mªage', 'rb'))
	}
}, \

33 
	gd©a
={'shit':3})

34 
´št
 
r¥
.
¡©us_code


36 
def
 
	$‹¡_¡»am
():

38 
w™h
 
	`İ’
('mªage', 'rb'è
as
 
å
:

39 
r¥
 = 
»que¡s
.
	$g‘
(
URL
, 
d©a
=
å
)

40 
´št
 
r¥
.
¡©us_code


42 
def
 
	$‹¡_d–ay_dowÆßd
():

44 @
™”_cÚ’t
ä»¥åŠ
™”_lšes
è¿­ä»£å¤„ç†

46 
r¥
 = 
»que¡s
.
	$g‘
(
URL
, 
¡»am
=
True
)

47 (
r¥
.
h—d”s
['Content-length']) < 3939535:

48 
cÚ‹Á
 = 
r¥
.content

49 
´št
 
cÚ‹Á


51 
def
 
	$‹¡_»dœeù
():

53 
r¥
 = 
»que¡s
.
	`g‘
('http://github.com')

54 
´št
 
r¥
.
hi¡Üy


56 
def
 
	$‹¡_auth
():

58 
äom
 
»que¡s
.
auth
 
impÜt
 
HTTPBasicAuth


59 
auth
 = 
	`HTTPBasicAuth
('unlessbamboo@gmail.com', 'passwd')

60 
r¥
 = 
»que¡s
.
	`g‘
('h‰p://g™hub.com', 
auth
=auth)

61 
´št
 
r¥
.
hi¡Üy


63 
def
 
	$‹¡_jsÚ
():

65 
r¥
 = 
»que¡s
.
	`g‘
('http://github.com')

66 
r¥
.
¡©us_code
 =ğ
»que¡s
.
codes
.
ok
 
ªd
 \

67 
r¥
.
h—d”s
['content-type'] == \

69 
d©a
 = 
r¥
.
	$jsÚ
()

70 
´št
 
d©a


72 
def
 
	$‹¡_’codšg
():

74 
·ss


76 
__Çme__
 == '__main__':

79 
	$‹¡_h—d”s
()

	@/root/grocery-shop/language/python/wordcount/_resources/resources/bolts/__init__.py

	@/root/grocery-shop/language/python/wordcount/_resources/resources/bolts/sentencebolt.py

1 
impÜt
 
»


3 
äom
 
	g¡»am·r£
.
bŞt
 
impÜt
 
BŞt


6 
şass
 
	$S’‹nûS¶™‹rBŞt
(
BŞt
):

8 
def
 
	$´oûss
(
£lf
, 
tup
):

9 
£Á’û
 = 
tup
.
v®ues
[0] #exŒaù 
the
 sentence

10 #g‘ 
rid
 
of
 
punùu©iÚ


11 
£Á’û
 = 
»
.
	`sub
(
r
"[,.;!\?]", "", sentence)

12 
wÜds
 = [[
wÜd
.
	`¡r
()]

13 
wÜd
 
š
 
£Á’û
.
	`¥l™
(" "èwÜd.
	`¡r
()]

14 
nÙ
 
wÜds
:

15 #nØ
wÜds
 
to
 
´oûss
 
š
 
the
 
£Á’û
, 
ç
h
tu¶e


16 
£lf
.
	$ç
(
tup
)

19 
£lf
.
	$em™_mªy
(
wÜds
)

20 #tu¶
acknowËdgem’t
 
is
 
hªdËd
 
autom©iÿÎy


	@/root/grocery-shop/language/python/wordcount/_resources/resources/bolts/wordcount.py

1 
äom
 
__futu»__
 
impÜt
 
	gabsŞu‹_impÜt
, 
	g´št_funùiÚ
, 
unicode_l™”®s


3 
äom
 
cŞËùiÚs
 
impÜt
 
CouÁ”


4 
äom
 
	g¡»am·r£
.
bŞt
 
impÜt
 
BŞt


7 
şass
 
	$WÜdCouÁ”
(
BŞt
):

9 
def
 
	$š™Ÿlize
(
£lf
, 
cÚf
, 
ùx
):

10 
£lf
.
couÁs
 = 
	$CouÁ”
()

12 
def
 
	$´oûss
(
£lf
, 
tup
):

13 
wÜd
 = 
tup
.
v®ues
[0]

14 
£lf
.
couÁs
[
wÜd
] += 1

15 
£lf
.
	$em™
([
wÜd
, 
£lf
.
couÁs
[word]])

18 
şass
 
	$WÜdSav”
(
BŞt
):

19 
def
 
	$š™Ÿlize
(
£lf
, 
cÚf
, 
ùx
):

20 
£lf
.
Çme
 = "bamboo"

22 
def
 
	$´oûss
(
£lf
, 
tup
):

23 
wÜd
 = 
tup
.
v®ues
[0]

24 
wÜdCouÁ”
 = 
tup
.
v®ues
[1]

25 
£lf
.
	`log
('%s: %d' % (
wÜd
, 
wÜdCouÁ”
))

	@/root/grocery-shop/language/python/wordcount/_resources/resources/spouts/__init__.py

	@/root/grocery-shop/language/python/wordcount/_resources/resources/spouts/sentencespout.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf8


3 
impÜt
 
™”toŞs


4 
äom
 
	g¡»am·r£
.
¥out
 
impÜt
 
Spout


7 
şass
 
	$S’‹nûSpout
(
Spout
):

9 
def
 
	$š™Ÿlize
(
£lf
, 
¡ÜmcÚf
, 
cÚ‹xt
):

12 :
·¿m
 
¡ÜmcÚf
:

13 :
·¿m
 
cÚ‹xt
:

15 
£lf
.
£Á’ûs
 = [

22 
£lf
.
£Á’ûs
 = 
™”toŞs
.
	$cyşe
(
£lf
.
£Á’ûs
)

24 
def
 
	$Ãxt_tu¶e
(
£lf
):

26 
£Á’û
 = 
	$Ãxt
(
£lf
.
£Á’ûs
)

27 
£lf
.
	$em™
([
£Á’û
])

29 
def
 
	$ack
(
£lf
, 
tup_id
):

30 
·ss
 #ià
a
 
tu¶e
 
is
 
´oûs£d
 
´İ”ly
, dØ
nÙhšg


32 
def
 
	$ç
(
£lf
, 
tup_id
):

33 
·ss
 #ià
a
 
tu¶e
 
çs
 
to
 
´oûss
, dØ
nÙhšg


	@/root/grocery-shop/language/python/wordcount/_resources/resources/spouts/words.py

1 
äom
 
__futu»__
 
impÜt
 
	gabsŞu‹_impÜt
, 
	g´št_funùiÚ
, 
unicode_l™”®s


3 
impÜt
 
™”toŞs


4 
äom
 
	g¡»am·r£
.
¥out
 
impÜt
 
Spout


6 
şass
 
	$WÜdSpout
(
Spout
):

8 
def
 
	$š™Ÿlize
(
£lf
, 
¡ÜmcÚf
, 
cÚ‹xt
):

9 
£lf
.
wÜds
 = 
™”toŞs
.
	`cyşe
(['dog', 'cat',

12 
def
 
	$Ãxt_tu¶e
(
£lf
):

13 
wÜd
 = 
	$Ãxt
(
£lf
.
wÜds
)

14 
£lf
.
	`em™
([
wÜd
])

	@/root/grocery-shop/language/python/wordcount/fabfile.py

1 
def
 
	$´e_subm™
(
tİŞogy_Çme
, 
’v_Çme
, 
’v_cÚfig
):

3 
submissiÚ
. 
No
 
SSH
 
tuÂ–s
 
wl
 
be
 
aùive
 
wh’
 
this
 
funùiÚ
 
is
 
ÿÎed
."""

4 
·ss


7 
def
 
	$po¡_subm™
(
tİo_Çme
, 
’v_Çme
, 
’v_cÚfig
):

9 
submissiÚ
. 
NÙe
 
th©
 
the
 
SSH
 
tuÂ–
 
to
 
Nimbus
 
wl
 
¡l
 
be
 
aùive


10 
wh’
 
this
 
funùiÚ
 
is
 
ÿÎed
."""

11 
·ss


	@/root/grocery-shop/language/python/wordcount/src/bolts/__init__.py

	@/root/grocery-shop/language/python/wordcount/src/bolts/sentencebolt.py

1 
impÜt
 
»


3 
äom
 
	g¡»am·r£
.
bŞt
 
impÜt
 
BŞt


6 
şass
 
	$S’‹nûS¶™‹rBŞt
(
BŞt
):

8 
def
 
	$´oûss
(
£lf
, 
tup
):

9 
£Á’û
 = 
tup
.
v®ues
[0] #exŒaù 
the
 sentence

10 #g‘ 
rid
 
of
 
punùu©iÚ


11 
£Á’û
 = 
»
.
	`sub
(
r
"[,.;!\?]", "", sentence)

12 
wÜds
 = [[
wÜd
.
	`¡r
()]

13 
wÜd
 
š
 
£Á’û
.
	`¥l™
(" "èwÜd.
	`¡r
()]

14 
nÙ
 
wÜds
:

15 #nØ
wÜds
 
to
 
´oûss
 
š
 
the
 
£Á’û
, 
ç
h
tu¶e


16 
£lf
.
	$ç
(
tup
)

19 
£lf
.
	$em™_mªy
(
wÜds
)

20 #tu¶
acknowËdgem’t
 
is
 
hªdËd
 
autom©iÿÎy


	@/root/grocery-shop/language/python/wordcount/src/bolts/wordcount.py

1 
äom
 
__futu»__
 
impÜt
 
	gabsŞu‹_impÜt
, 
	g´št_funùiÚ
, 
unicode_l™”®s


3 
äom
 
cŞËùiÚs
 
impÜt
 
CouÁ”


4 
äom
 
	g¡»am·r£
.
bŞt
 
impÜt
 
BŞt


7 
şass
 
	$WÜdCouÁ”
(
BŞt
):

9 
def
 
	$š™Ÿlize
(
£lf
, 
cÚf
, 
ùx
):

10 
£lf
.
couÁs
 = 
	$CouÁ”
()

12 
def
 
	$´oûss
(
£lf
, 
tup
):

13 
wÜd
 = 
tup
.
v®ues
[0]

14 
£lf
.
couÁs
[
wÜd
] += 1

15 
£lf
.
	$em™
([
wÜd
, 
£lf
.
couÁs
[word]])

18 
şass
 
	$WÜdSav”
(
BŞt
):

19 
def
 
	$š™Ÿlize
(
£lf
, 
cÚf
, 
ùx
):

20 
£lf
.
Çme
 = "bamboo"

22 
def
 
	$´oûss
(
£lf
, 
tup
):

23 
wÜd
 = 
tup
.
v®ues
[0]

24 
wÜdCouÁ”
 = 
tup
.
v®ues
[1]

25 
£lf
.
	`log
('%s: %d' % (
wÜd
, 
wÜdCouÁ”
))

	@/root/grocery-shop/language/python/wordcount/src/spouts/__init__.py

	@/root/grocery-shop/language/python/wordcount/src/spouts/sentencespout.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


2 #codšg:
utf8


3 
impÜt
 
™”toŞs


4 
äom
 
	g¡»am·r£
.
¥out
 
impÜt
 
Spout


7 
şass
 
	$S’‹nûSpout
(
Spout
):

9 
def
 
	$š™Ÿlize
(
£lf
, 
¡ÜmcÚf
, 
cÚ‹xt
):

12 :
·¿m
 
¡ÜmcÚf
:

13 :
·¿m
 
cÚ‹xt
:

15 
£lf
.
£Á’ûs
 = [

22 
£lf
.
£Á’ûs
 = 
™”toŞs
.
	$cyşe
(
£lf
.
£Á’ûs
)

24 
def
 
	$Ãxt_tu¶e
(
£lf
):

26 
£Á’û
 = 
	$Ãxt
(
£lf
.
£Á’ûs
)

27 
£lf
.
	$em™
([
£Á’û
])

29 
def
 
	$ack
(
£lf
, 
tup_id
):

30 
·ss
 #ià
a
 
tu¶e
 
is
 
´oûs£d
 
´İ”ly
, dØ
nÙhšg


32 
def
 
	$ç
(
£lf
, 
tup_id
):

33 
·ss
 #ià
a
 
tu¶e
 
çs
 
to
 
´oûss
, dØ
nÙhšg


	@/root/grocery-shop/language/python/wordcount/src/spouts/words.py

1 
äom
 
__futu»__
 
impÜt
 
	gabsŞu‹_impÜt
, 
	g´št_funùiÚ
, 
unicode_l™”®s


3 
impÜt
 
™”toŞs


4 
äom
 
	g¡»am·r£
.
¥out
 
impÜt
 
Spout


6 
şass
 
	$WÜdSpout
(
Spout
):

8 
def
 
	$š™Ÿlize
(
£lf
, 
¡ÜmcÚf
, 
cÚ‹xt
):

9 
£lf
.
wÜds
 = 
™”toŞs
.
	`cyşe
(['dog', 'cat',

12 
def
 
	$Ãxt_tu¶e
(
£lf
):

13 
wÜd
 = 
	$Ãxt
(
£lf
.
wÜds
)

14 
£lf
.
	`em™
([
wÜd
])

	@/root/grocery-shop/language/python/wordcount/tasks.py

1 
def
 
	$´e_subm™
(
tİŞogy_Çme
, 
’v_Çme
, 
’v_cÚfig
):

3 
submissiÚ
. 
No
 
SSH
 
tuÂ–s
 
wl
 
be
 
aùive
 
wh’
 
this
 
funùiÚ
 
is
 
ÿÎed
."""

4 
·ss


7 
def
 
	$po¡_subm™
(
tİo_Çme
, 
’v_Çme
, 
’v_cÚfig
):

9 
submissiÚ
. 
NÙe
 
th©
 
the
 
SSH
 
tuÂ–
 
to
 
Nimbus
 
wl
 
¡l
 
be
 
aùive


10 
wh’
 
this
 
funùiÚ
 
is
 
ÿÎed
."""

11 
·ss


	@/root/grocery-shop/language/python/xml/parseXml.py

1 #!/
u¤
/
bš
/
pythÚ


2 #!
codšg
:
utf
-
job


5 
äom
 
os
 
impÜt
 
·th


6 
impÜt
 
	gxml
.
	g‘»e
.
EËm’tT»e
 
as
 
ET


8 
şass
 
	$·r£Xml
(
objeù
):

9 
def
 
	$__š™__
(
£lf
):

11 
£lf
.
_roÙ
 = 
NÚe


13 
def
 
	$cÚ¡ruùT»e
(
£lf
, 
f’ame
):

15 
nÙ
 
·th
.
	$isfe
(
f’ame
):

16  
NÚe


17 
£lf
.
_roÙ
 = 
ET
.
	`·r£
(
f’ame
).
	$g‘roÙ
()

19 
def
 
	$g‘RoÙ
(
£lf
):

21  
£lf
.
_roÙ


23 
def
 
	$fšdChdNode
(
£lf
, 
–em’t
):

25  
£lf
.
_roÙ
.
	$fšd®l
(
–em’t
)

27 
def
 
	$di¥ÏyT»e
(
£lf
, 
roÙ
):

29 
´št
 
roÙ
.
g
,„oÙ.
©Œib
,„oÙ.
‹xt


30 
chd
 
š
 
roÙ
:

31 
£lf
.
	$di¥ÏyT»e
(
chd
)

33 
__Çme__
 == '__main__':

35 
·r£
 = 
	$·r£Xml
()

36 
·r£
.
	`cÚ¡ruùT»e
('./filedir/test.xml')

37 
·r£
.
	`di¥ÏyT»e
Õ¬£.
	$g‘RoÙ
())

38 
	`´št
("======================================\n")

39 
node
 = 
·r£
.
	`fšdChdNode
('./movie/type')

40 
a
 
š
 
node
:

41 
	`´št
(
a
.
‹xt
)

	@
1
.
1
/usr/include
171
10928
/root/grocery-shop/language/python/baseSyntax/classGlobalVarTest.py
/root/grocery-shop/language/python/baseSyntax/closureTest.py
/root/grocery-shop/language/python/baseSyntax/distTest.py
/root/grocery-shop/language/python/baseSyntax/generatorTest.py
/root/grocery-shop/language/python/baseSyntax/iterTest.py
/root/grocery-shop/language/python/baseSyntax/listTest.py
/root/grocery-shop/language/python/baseSyntax/module/moduleMain.py
/root/grocery-shop/language/python/baseSyntax/module/moduleTest.py
/root/grocery-shop/language/python/baseSyntax/module/objectReference.py
/root/grocery-shop/language/python/baseSyntax/moduleTest.py
/root/grocery-shop/language/python/baseSyntax/objectReference.py
/root/grocery-shop/language/python/baseSyntax/oop.py
/root/grocery-shop/language/python/baseSyntax/package/__init__.py
/root/grocery-shop/language/python/baseSyntax/package/main.py
/root/grocery-shop/language/python/baseSyntax/package/main2.py
/root/grocery-shop/language/python/baseSyntax/package/main3.py
/root/grocery-shop/language/python/baseSyntax/package/pythonpath/__init__.py
/root/grocery-shop/language/python/baseSyntax/package/pythonpath/bamboo.py
/root/grocery-shop/language/python/baseSyntax/package/repeImport.py
/root/grocery-shop/language/python/baseSyntax/package/repeTest.py
/root/grocery-shop/language/python/baseSyntax/package/sub_package/__init__.py
/root/grocery-shop/language/python/baseSyntax/package/sub_package/mod.py
/root/grocery-shop/language/python/baseSyntax/package/sub_package/string.py
/root/grocery-shop/language/python/baseSyntax/packageTest.py
/root/grocery-shop/language/python/baseSyntax/tupleTest.py
/root/grocery-shop/language/python/baseSyntax/variParameterTest.py
/root/grocery-shop/language/python/cProfile/simpleTest.py
/root/grocery-shop/language/python/cliOperator/baseparse.py
/root/grocery-shop/language/python/cliOperator/cliOptionTest.py
/root/grocery-shop/language/python/cliOperator/installMonitor.py
/root/grocery-shop/language/python/cliOperator/pathTest/att.py
/root/grocery-shop/language/python/cliOperator/pathTest/test/a.py
/root/grocery-shop/language/python/cliOperator/pathTest/test/testdir/__init__.py
/root/grocery-shop/language/python/cliOperator/pathTest/test/testdir/add.py
/root/grocery-shop/language/python/cliOperator/pathTest/test/testdir/add2.py
/root/grocery-shop/language/python/descripter/testDescipter.py
/root/grocery-shop/language/python/django/bamboo/bamboo/__init__.py
/root/grocery-shop/language/python/django/bamboo/bamboo/settings.py
/root/grocery-shop/language/python/django/bamboo/bamboo/urls.py
/root/grocery-shop/language/python/django/bamboo/bamboo/wsgi.py
/root/grocery-shop/language/python/django/bamboo/books/__init__.py
/root/grocery-shop/language/python/django/bamboo/books/models.py
/root/grocery-shop/language/python/django/bamboo/books/tests.py
/root/grocery-shop/language/python/django/bamboo/books/views.py
/root/grocery-shop/language/python/django/bamboo/manage.py
/root/grocery-shop/language/python/email/mail_header_simple.py
/root/grocery-shop/language/python/email/mail_image_simple.py
/root/grocery-shop/language/python/email/mail_parser_send.py
/root/grocery-shop/language/python/email/mail_send_simple.py
/root/grocery-shop/language/python/email/mail_topsec.py
/root/grocery-shop/language/python/email/sendmail.py
/root/grocery-shop/language/python/encodeDiscuss/decodeProblem.py
/root/grocery-shop/language/python/envOperator/interpreter1.py
/root/grocery-shop/language/python/envOperator/interpreter2.py
/root/grocery-shop/language/python/envOperator/interpreterTest.py
/root/grocery-shop/language/python/exceptOperator/cgitbTest.py
/root/grocery-shop/language/python/exceptOperator/decorator/decoratorTest.py
/root/grocery-shop/language/python/exceptOperator/decorator/decoratorType.py
/root/grocery-shop/language/python/exceptOperator/exceptadorner.py
/root/grocery-shop/language/python/exceptOperator/exceptadorner2.py
/root/grocery-shop/language/python/exceptOperator/excepthookTest.py
/root/grocery-shop/language/python/exceptOperator/try-except-else.py
/root/grocery-shop/language/python/exceptOperator/try-finally.py
/root/grocery-shop/language/python/fileOperator/createFileTest.py
/root/grocery-shop/language/python/fileOperator/dirDfsTest.py
/root/grocery-shop/language/python/fileOperator/fileLockTest.py
/root/grocery-shop/language/python/fileOperator/fileSortTest.py
/root/grocery-shop/language/python/fileOperator/parse.py
/root/grocery-shop/language/python/fileOperator/readBigFile.py
/root/grocery-shop/language/python/fileOperator/readFileTest.py
/root/grocery-shop/language/python/fileOperator/statTest.py
/root/grocery-shop/language/python/ioOperator/__init__.py
/root/grocery-shop/language/python/ioOperator/ioNotify.py
/root/grocery-shop/language/python/ioOperator/ioRedirect.py
/root/grocery-shop/language/python/ioOperator/scriptPathTest.py
/root/grocery-shop/language/python/ioOperator/writeMsg.py
/root/grocery-shop/language/python/kafka/consumerTest.py
/root/grocery-shop/language/python/kafka/partitionTest.py
/root/grocery-shop/language/python/kafka/pykafkaConsumerTest.py
/root/grocery-shop/language/python/kafka/pykafkaProducerTest.py
/root/grocery-shop/language/python/kafka/replicaTest.py
/root/grocery-shop/language/python/kafka/run_umi.py
/root/grocery-shop/language/python/kafka/simpleConsumer.py
/root/grocery-shop/language/python/kafka/simpleProducer.py
/root/grocery-shop/language/python/kafka/test/__init__.py
/root/grocery-shop/language/python/kafka/test/fixtures.py
/root/grocery-shop/language/python/kafka/test/service.py
/root/grocery-shop/language/python/kafka/test/test_client.py
/root/grocery-shop/language/python/kafka/test/test_client_integration.py
/root/grocery-shop/language/python/kafka/test/test_codec.py
/root/grocery-shop/language/python/kafka/test/test_conn.py
/root/grocery-shop/language/python/kafka/test/test_consumer.py
/root/grocery-shop/language/python/kafka/test/test_consumer_integration.py
/root/grocery-shop/language/python/kafka/test/test_context.py
/root/grocery-shop/language/python/kafka/test/test_failover_integration.py
/root/grocery-shop/language/python/kafka/test/test_package.py
/root/grocery-shop/language/python/kafka/test/test_producer.py
/root/grocery-shop/language/python/kafka/test/test_producer_integration.py
/root/grocery-shop/language/python/kafka/test/test_protocol.py
/root/grocery-shop/language/python/kafka/test/test_util.py
/root/grocery-shop/language/python/kafka/test/testutil.py
/root/grocery-shop/language/python/leetCode/array/findString.py
/root/grocery-shop/language/python/logging/multiprocessTest.py
/root/grocery-shop/language/python/logging/simpleTest.py
/root/grocery-shop/language/python/logging/timeRotatFile.py
/root/grocery-shop/language/python/magicOperator/newTest.py
/root/grocery-shop/language/python/mock/simpleTest.py
/root/grocery-shop/language/python/monitor/memory-monitor.py
/root/grocery-shop/language/python/monitor/time-monitory.py
/root/grocery-shop/language/python/multiprocess/multiProcsssingTest.py
/root/grocery-shop/language/python/multiprocess/simpleTest.py
/root/grocery-shop/language/python/mysqldb/jobdb.py
/root/grocery-shop/language/python/mysqldb/simpleTest.py
/root/grocery-shop/language/python/pickle/mycPickle.py
/root/grocery-shop/language/python/pickle/mypickle.py
/root/grocery-shop/language/python/queue/dequeTest.py
/root/grocery-shop/language/python/queue/priorityQueueTest.py
/root/grocery-shop/language/python/redis/agentDaemon.py
/root/grocery-shop/language/python/redis/agentTcpServer.py
/root/grocery-shop/language/python/redis/agentTestServer.py
/root/grocery-shop/language/python/regexOperator/fileFilter.py
/root/grocery-shop/language/python/regexOperator/joblog.py
/root/grocery-shop/language/python/regexOperator/regexTest.py
/root/grocery-shop/language/python/setuptool/basepackage/__init__.py
/root/grocery-shop/language/python/setuptool/basepackage/baseconfig.py
/root/grocery-shop/language/python/setuptool/basepackage/baselog.py
/root/grocery-shop/language/python/setuptool/basepackage/test/__init__.py
/root/grocery-shop/language/python/setuptool/build/lib/basepackage/__init__.py
/root/grocery-shop/language/python/setuptool/build/lib/basepackage/baseconfig.py
/root/grocery-shop/language/python/setuptool/build/lib/basepackage/baselog.py
/root/grocery-shop/language/python/setuptool/build/lib/basepackage/test/__init__.py
/root/grocery-shop/language/python/setuptool/setup.py
/root/grocery-shop/language/python/signal/partialTest.py
/root/grocery-shop/language/python/signal/simpleTest.py
/root/grocery-shop/language/python/signal/timesleep.py
/root/grocery-shop/language/python/socket/baseHttpServer.py
/root/grocery-shop/language/python/socket/client.py
/root/grocery-shop/language/python/socket/ip.py
/root/grocery-shop/language/python/socket/server.py
/root/grocery-shop/language/python/socket/tcpClient.py
/root/grocery-shop/language/python/socket/tcpServer.py
/root/grocery-shop/language/python/socket/udpClient.py
/root/grocery-shop/language/python/socket/udpServer.py
/root/grocery-shop/language/python/socket/unixClient.py
/root/grocery-shop/language/python/socket/unixServer.py
/root/grocery-shop/language/python/threading/simpleTest.py
/root/grocery-shop/language/python/threading/startTest.py
/root/grocery-shop/language/python/threading/test.py
/root/grocery-shop/language/python/threading/timerTest.py
/root/grocery-shop/language/python/threading/yieldTest.py
/root/grocery-shop/language/python/unittest/simpleTest.py
/root/grocery-shop/language/python/unittest/simpleTestUnit.py
/root/grocery-shop/language/python/webOperator/hbaserest/sendMultiKey.py
/root/grocery-shop/language/python/webOperator/requests/postimage.py
/root/grocery-shop/language/python/webOperator/requests/requestsTest.py
/root/grocery-shop/language/python/webOperator/requests/simpleTest.py
/root/grocery-shop/language/python/wordcount/_resources/resources/bolts/__init__.py
/root/grocery-shop/language/python/wordcount/_resources/resources/bolts/sentencebolt.py
/root/grocery-shop/language/python/wordcount/_resources/resources/bolts/wordcount.py
/root/grocery-shop/language/python/wordcount/_resources/resources/spouts/__init__.py
/root/grocery-shop/language/python/wordcount/_resources/resources/spouts/sentencespout.py
/root/grocery-shop/language/python/wordcount/_resources/resources/spouts/words.py
/root/grocery-shop/language/python/wordcount/fabfile.py
/root/grocery-shop/language/python/wordcount/src/bolts/__init__.py
/root/grocery-shop/language/python/wordcount/src/bolts/sentencebolt.py
/root/grocery-shop/language/python/wordcount/src/bolts/wordcount.py
/root/grocery-shop/language/python/wordcount/src/spouts/__init__.py
/root/grocery-shop/language/python/wordcount/src/spouts/sentencespout.py
/root/grocery-shop/language/python/wordcount/src/spouts/words.py
/root/grocery-shop/language/python/wordcount/tasks.py
/root/grocery-shop/language/python/xml/parseXml.py
